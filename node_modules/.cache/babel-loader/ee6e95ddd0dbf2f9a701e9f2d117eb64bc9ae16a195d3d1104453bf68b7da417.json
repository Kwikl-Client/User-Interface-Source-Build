{"ast":null,"code":"import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */function () {\n  function Image(parent, serviceLocator) {\n    this.isImgUploaded = false;\n    this.isAllowedTypes = true;\n    this.pageX = null;\n    this.pageY = null;\n    this.mouseX = null;\n    this.deletedImg = [];\n    this.parent = parent;\n    this.rteID = parent.element.id;\n    this.i10n = serviceLocator.getService('rteLocale');\n    this.rendererFactory = serviceLocator.getService('rendererFactory');\n    this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n    this.addEventListener();\n  }\n  Image.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.insertImage, this.insertImage, this);\n    this.parent.on(events.showImageDialog, this.showDialog, this);\n    this.parent.on(events.closeImageDialog, this.closeDialog, this);\n    this.parent.on(events.windowResize, this.onWindowResize, this);\n    this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n    this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n    this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n    this.parent.on(events.imageCaption, this.caption, this);\n    this.parent.on(events.imageDelete, this.deleteImg, this);\n    this.parent.on(events.imageLink, this.insertImgLink, this);\n    this.parent.on(events.imageAlt, this.insertAltText, this);\n    this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n    this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n    this.parent.on(events.imageSize, this.imageSize, this);\n    this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n    this.parent.on(events.initialEnd, this.afterRender, this);\n    this.parent.on(events.dynamicModule, this.afterRender, this);\n    this.parent.on(events.paste, this.imagePaste, this);\n    this.parent.on(events.bindCssClass, this.setCssClass, this);\n    this.parent.on(events.destroy, this.removeEventListener, this);\n    this.parent.on(events.moduleDestroy, this.moduleDestroy, this);\n  };\n  Image.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.keyUp, this.onKeyUp);\n    this.parent.off(events.windowResize, this.onWindowResize);\n    this.parent.off(events.insertImage, this.insertImage);\n    this.parent.off(events.showImageDialog, this.showDialog);\n    this.parent.off(events.closeImageDialog, this.closeDialog);\n    this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n    this.parent.off(events.clearDialogObj, this.clearDialogObj);\n    this.parent.off(events.imageCaption, this.caption);\n    this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n    this.parent.off(events.imageDelete, this.deleteImg);\n    this.parent.off(events.imageLink, this.insertImgLink);\n    this.parent.off(events.imageAlt, this.insertAltText);\n    this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n    this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n    this.parent.off(events.imageSize, this.imageSize);\n    this.parent.off(events.dropDownSelect, this.alignmentSelect);\n    this.parent.off(events.initialEnd, this.afterRender);\n    this.parent.off(events.dynamicModule, this.afterRender);\n    this.parent.off(events.paste, this.imagePaste);\n    this.parent.off(events.bindCssClass, this.setCssClass);\n    this.parent.off(events.destroy, this.removeEventListener);\n    this.parent.off(events.moduleDestroy, this.moduleDestroy);\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n    dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n    if (!isNullOrUndefined(this.contentModule)) {\n      EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n      this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n      if (this.parent.insertImageSettings.resize) {\n        EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n        EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n        EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n      }\n    }\n  };\n  Image.prototype.updateCss = function (currentObj, e) {\n    if (currentObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim()\n        });\n      } else {\n        currentObj.setProperties({\n          cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim()\n        });\n      }\n    }\n  };\n  // eslint-disable-next-line @typescript-eslint/tslint/config\n  Image.prototype.setCssClass = function (e) {\n    if (this.popupObj && e.cssClass) {\n      if (isNullOrUndefined(e.oldCssClass)) {\n        addClass([this.popupObj.element], e.cssClass);\n      } else {\n        removeClass([this.popupObj.element], e.oldCssClass);\n        addClass([this.popupObj.element], e.cssClass);\n      }\n    }\n    this.updateCss(this.checkBoxObj, e);\n    this.updateCss(this.widthNum, e);\n    this.updateCss(this.heightNum, e);\n    this.updateCss(this.uploadObj, e);\n    this.updateCss(this.dialogObj, e);\n  };\n  Image.prototype.onIframeMouseDown = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n  Image.prototype.afterRender = function () {\n    this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n    EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n    if (this.parent.insertImageSettings.resize) {\n      EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n      EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n      EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n    }\n    var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument : this.parent.inputElement;\n    dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n    dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n    dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n    dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n  };\n  Image.prototype.undoStack = function (args) {\n    if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n      for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n        var temp = this.parent.createElement('div');\n        var contentElem = this.parent.formatter.getUndoRedoStack()[i].text;\n        temp.appendChild(contentElem.cloneNode(true));\n        var img = temp.querySelectorAll('img');\n        if (temp.querySelector('.e-img-resize') && img.length > 0) {\n          for (var j = 0; j < img.length; j++) {\n            img[j].style.outline = '';\n          }\n          detach(temp.querySelector('.e-img-resize'));\n          var clonedElement = temp.cloneNode(true);\n          var fragment = document.createDocumentFragment();\n          while (clonedElement.firstChild) {\n            fragment.appendChild(clonedElement.firstChild);\n          }\n          this.parent.formatter.getUndoRedoStack()[i].text = fragment;\n        }\n      }\n    }\n  };\n  Image.prototype.resizeEnd = function (e) {\n    this.resizeBtnInit();\n    this.imgEle.parentElement.style.cursor = 'auto';\n    if (Browser.isDevice) {\n      removeClass([e.target.parentElement], 'e-mob-span');\n    }\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.resizeStop, args);\n    /* eslint-disable */\n    var pageX = this.getPointX(e);\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n    /* eslint-enable */\n    this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n    this.parent.formatter.saveData();\n  };\n  Image.prototype.resizeStart = function (e, ele) {\n    var _this = this;\n    if (this.parent.readonly) {\n      return;\n    }\n    var target = ele ? ele : e.target;\n    this.prevSelectedImgEle = this.imgEle;\n    if (target.tagName === 'IMG') {\n      this.parent.preventDefaultResize(e);\n      var img = target;\n      if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n        detach(this.imgResizeDiv);\n      }\n      this.imageResize(img);\n    }\n    if (target.classList.contains('e-rte-imageboxmark')) {\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n      this.pageX = this.getPointX(e);\n      this.pageY = this.getPointY(e);\n      e.preventDefault();\n      e.stopImmediatePropagation();\n      this.resizeBtnInit();\n      if (this.quickToolObj) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n      if (target.classList.contains('e-rte-topLeft')) {\n        this.resizeBtnStat.topLeft = true;\n      }\n      if (target.classList.contains('e-rte-topRight')) {\n        this.resizeBtnStat.topRight = true;\n      }\n      if (target.classList.contains('e-rte-botLeft')) {\n        this.resizeBtnStat.botLeft = true;\n      }\n      if (target.classList.contains('e-rte-botRight')) {\n        this.resizeBtnStat.botRight = true;\n      }\n      if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) && !this.imgResizeDiv.classList.contains('e-mob-span')) {\n        addClass([this.imgResizeDiv], 'e-mob-span');\n      } else {\n        var args = {\n          event: e,\n          requestType: 'images'\n        };\n        this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n          if (resizeStartArgs.cancel) {\n            _this.cancelResizeAction();\n          }\n        });\n      }\n      EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n    }\n  };\n  Image.prototype.imageClick = function (e) {\n    if (Browser.isDevice) {\n      if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A' || e.target.tagName === 'IMG') {\n        this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n        e.target.focus();\n      } else {\n        if (!this.parent.readonly) {\n          this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n        }\n      }\n    }\n    if (e.target.tagName === 'IMG' && e.target.parentElement.tagName === 'A') {\n      e.preventDefault();\n    }\n  };\n  Image.prototype.onCutHandler = function () {\n    if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n  };\n  Image.prototype.imageResize = function (e) {\n    this.resizeBtnInit();\n    this.imgEle = e;\n    addClass([this.imgEle], 'e-resize');\n    this.imgResizeDiv = this.parent.createElement('span', {\n      className: 'e-img-resize' + this.parent.getCssClass(true),\n      id: this.rteID + '_imgResize'\n    });\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topLeft' + this.parent.getCssClass(true),\n      styles: 'cursor: nwse-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-topRight' + this.parent.getCssClass(true),\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botLeft' + this.parent.getCssClass(true),\n      styles: 'cursor: nesw-resize'\n    }));\n    this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n      className: 'e-rte-imageboxmark e-rte-botRight' + this.parent.getCssClass(true),\n      styles: 'cursor: nwse-resize'\n    }));\n    if (Browser.isDevice) {\n      addClass([this.imgResizeDiv], 'e-mob-rte');\n    }\n    e.style.outline = '2px solid #4a90e2';\n    this.imgResizePos(e, this.imgResizeDiv);\n    this.resizeImgDupPos(e);\n    this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n    EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n  };\n  Image.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n  Image.prototype.getPointY = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageY;\n    } else {\n      return e.pageY;\n    }\n  };\n  Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n    var pos = this.calcPos(e);\n    var top = pos.top;\n    var left = pos.left;\n    var imgWid = e.getBoundingClientRect().width;\n    var imgHgt = e.getBoundingClientRect().height;\n    var borWid = Browser.isDevice ? 4 * parseInt(e.style.outline.slice(-3), 10) + 2 : 2 * parseInt(e.style.outline.slice(-3), 10) + 2; //span border width + image outline width\n    var devWid = Browser.isDevice ? 0 : 2; // span border width\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-botLeft').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-botRight').style.top = imgHgt - borWid + top + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.left = imgWid - (borWid - devWid) + left + 'px';\n    imgResizeDiv.querySelector('.e-rte-topRight').style.top = top - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.left = left - borWid + 'px';\n    imgResizeDiv.querySelector('.e-rte-topLeft').style.top = top - borWid + 'px';\n  };\n  Image.prototype.calcPos = function (elem) {\n    var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var elementOffset;\n    var doc = elem.ownerDocument;\n    var offsetParent = (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') || ignoreOffset.indexOf(elem.offsetParent.tagName) > -1) ? closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n    if (elem.offsetParent && elem.offsetParent.classList.contains('e-img-caption')) {\n      elementOffset = elem.getBoundingClientRect();\n      return {\n        top: elementOffset.top - parentOffset.top,\n        left: elementOffset.left - parentOffset.left\n      };\n    } else {\n      return {\n        top: elem.offsetTop,\n        left: elem.offsetLeft\n      };\n    }\n  };\n  Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n    if (isNullOrUndefined(img.width)) {\n      return;\n    }\n    // eslint-disable-next-line security/detect-unsafe-regex\n    var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) : parseInt(img.style.width, 10) : img.width;\n    var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n    if (width > height) {\n      img.style.minWidth = this.parent.insertImageSettings.minWidth === 0 ? '20px' : formatUnit(this.parent.insertImageSettings.minWidth);\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var original = img.offsetWidth + this.mouseX;\n          var finalWidthByPerc = original / img.offsetWidth * (parseFloat(img.style.width).toString() === 'NaN' ? img.offsetWidth / parseFloat(getComputedStyle(this.parent.element).width) * 100 : parseFloat(img.style.width));\n          img.style.width = (finalWidthByPerc > 3 ? finalWidthByPerc : 3) + '%';\n        } else {\n          img.style.width = this.pixToPerc(width / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width === '' && img.style.height !== '') {\n        img.style.height = expectedY + 'px';\n      } else if (img.style.width !== '' && img.style.height === '') {\n        var currentWidth = width / height * expectedY + width / height < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY + width / height : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth.toString() + 'px';\n        img.style.height = expectedY + 'px';\n      } else if (img.style.width !== '') {\n        var currentWidth = width / height * expectedY < this.parent.inputElement.getBoundingClientRect().right - 32 ? width / height * expectedY : this.parent.inputElement.getBoundingClientRect().right - 32;\n        img.style.width = currentWidth + 'px';\n        img.style.height = expectedY + 'px';\n      } else {\n        if (this.parent.iframeSettings.enable) {\n          img.setAttribute('width', (img.width + this.mouseX).toString());\n        } else {\n          var currentWidth = img.offsetWidth === 0 ? img.width + this.mouseX + parseInt(img.style.outlineWidth.split('p')[0], 10) : img.offsetWidth + this.mouseX;\n          img.setAttribute('width', currentWidth.toString());\n        }\n      }\n    } else if (height > width) {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n          var original = img.offsetWidth + this.mouseX;\n          var finalWidthByPerc = original / img.offsetWidth * (parseFloat(img.style.width).toString() === 'NaN' ? img.offsetWidth / parseFloat(getComputedStyle(this.parent.element).width) * 100 : parseFloat(img.style.width));\n          img.style.width = (finalWidthByPerc > 3 ? finalWidthByPerc : 3) + '%';\n        } else {\n          img.style.width = this.pixToPerc(expectedX / height * expectedY, img.previousElementSibling || img.parentElement) + '%';\n        }\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else if (img.style.width !== '') {\n        img.style.width = expectedX + 'px';\n        img.style.height = height / width * expectedX + 'px';\n      } else {\n        img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n      }\n    } else {\n      if (this.parent.insertImageSettings.resizeByPercent) {\n        img.style.width = this.pixToPerc(expectedX, img.previousElementSibling || img.parentElement) + '%';\n        img.style.height = null;\n        img.removeAttribute('height');\n      } else {\n        img.style.width = (expectedX >= 15 ? expectedX : 15) + 'px';\n        img.style.height = (expectedX >= 15 ? expectedX : 15) + 'px';\n      }\n    }\n  };\n  Image.prototype.pixToPerc = function (expected, parentEle) {\n    return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n  };\n  Image.prototype.imgDupMouseMove = function (width, height, e) {\n    var _this = this;\n    var args = {\n      event: e,\n      requestType: 'images'\n    };\n    this.parent.trigger(events.onResize, args, function (resizingArgs) {\n      if (resizingArgs.cancel) {\n        _this.cancelResizeAction();\n      } else {\n        if (parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) || parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) && isNOU(_this.imgEle.style.width)) {\n          return;\n        }\n        if (!_this.parent.insertImageSettings.resizeByPercent && (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) || parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n          return;\n        }\n        _this.imgEle.parentElement.style.cursor = 'pointer';\n        _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n        _this.resizeImgDupPos(_this.imgEle);\n        _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n      }\n    });\n  };\n  Image.prototype.resizing = function (e) {\n    if (!this.parent) {\n      this.cancelResizeAction();\n      return;\n    }\n    if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n      this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n    } else if (isNOU(this.parent.insertImageSettings.maxHeight)) {\n      this.imgEle.style.maxHeight = '';\n    }\n    this.imgEle.style.maxWidth = (closest(this.imgEle, 'ol,ul') != null ? this.parent.getInsertImgMaxWidth() - parseInt(getComputedStyle(closest(this.imgEle, 'ol,ul')).paddingLeft, 0) : this.parent.getInsertImgMaxWidth()) + 'px';\n    var pageX = this.getPointX(e);\n    var pageY = this.getPointY(e);\n    var mouseX = this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft ? -(pageX - this.pageX) : pageX - this.pageX;\n    var mouseY = this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft ? -(pageY - this.pageY) : pageY - this.pageY;\n    var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n    var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n    this.mouseX = mouseX;\n    this.pageX = pageX;\n    this.pageY = pageY;\n    if (this.resizeBtnStat.botRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.botLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topRight) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    } else if (this.resizeBtnStat.topLeft) {\n      this.imgDupMouseMove(width + 'px', height + 'px', e);\n    }\n  };\n  Image.prototype.cancelResizeAction = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      detach(this.imgResizeDiv);\n      this.imgEle.style.outline = '';\n      this.imgResizeDiv = null;\n      this.pageX = null;\n      this.pageY = null;\n    }\n  };\n  Image.prototype.resizeImgDupPos = function (e) {\n    this.imgDupPos = {\n      width: e.style.width !== '' && this.parent.insertImageSettings && !this.parent.insertImageSettings.resizeByPercent ? this.imgEle.style.width : e.width + 'px',\n      height: e.style.height !== '' ? this.imgEle.style.height : e.height + 'px'\n    };\n  };\n  Image.prototype.resizeBtnInit = function () {\n    return this.resizeBtnStat = {\n      botLeft: false,\n      botRight: false,\n      topRight: false,\n      topLeft: false\n    };\n  };\n  Image.prototype.onToolbarAction = function (args) {\n    if (isIDevice()) {\n      this.parent.notify(events.selectionRestore, {});\n    }\n    var item = args.args.item;\n    switch (item.subCommand) {\n      case 'Replace':\n        if (this.parent.fileManagerSettings.enable) {\n          this.parent.notify(events.renderFileManager, args);\n        } else {\n          this.parent.notify(events.insertImage, args);\n        }\n        break;\n      case 'Caption':\n        this.parent.notify(events.imageCaption, args);\n        break;\n      case 'InsertLink':\n        this.parent.notify(events.imageLink, args);\n        break;\n      case 'AltText':\n        this.parent.notify(events.imageAlt, args);\n        break;\n      case 'Remove':\n        this.parent.notify(events.imageDelete, args);\n        break;\n      case 'Dimension':\n        this.parent.notify(events.imageSize, args);\n        break;\n      case 'OpenImageLink':\n        this.openImgLink(args);\n        break;\n      case 'EditImageLink':\n        this.editImgLink(args);\n        break;\n      case 'RemoveImageLink':\n        this.removeImgLink(args);\n        break;\n    }\n  };\n  Image.prototype.openImgLink = function (e) {\n    var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      url: e.selectParent[0].parentNode.href,\n      target: target,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n  };\n  Image.prototype.editImgLink = function (e) {\n    var selectParentEle = e.selectParent[0].parentNode;\n    var linkUpdate = this.i10n.getConstant('dialogUpdate');\n    var inputDetails = {\n      url: selectParentEle.href,\n      target: selectParentEle.target,\n      header: 'Edit Link',\n      btnText: linkUpdate\n    };\n    this.insertImgLink(e, inputDetails);\n  };\n  Image.prototype.removeImgLink = function (e) {\n    if (Browser.isIE) {\n      this.contentModule.getEditPanel().focus();\n    }\n    e.selection.restore();\n    var isCapLink = this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle) ? true : false;\n    var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      insertElement: e.selectNode[0],\n      selectParent: selectParent,\n      selection: e.selection,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      if (!isNullOrUndefined(e.selectParent)) {\n        removeClass([e.selectParent[0]], 'e-img-focus');\n      }\n    }\n    if (isCapLink) {\n      select('.e-img-inner', this.captionEle).focus();\n    }\n  };\n  Image.prototype.onKeyDown = function (event) {\n    var originalEvent = event.args;\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    this.deletedImg = [];\n    var isCursor;\n    var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n    if (this.parent.editorMode === 'HTML') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n    }\n    if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n      var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      for (var i = 0; i < nodes.length; i++) {\n        if (nodes[i].nodeName === 'IMG') {\n          this.deletedImg.push(nodes[i]);\n        }\n      }\n    }\n    if (this.parent.editorMode === 'HTML' && (originalEvent.which === 8 && originalEvent.code === 'Backspace' || originalEvent.which === 46 && originalEvent.code === 'Delete')) {\n      var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n      if (originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1) {\n        this.checkImageBack(range);\n      } else if (originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1) {\n        this.checkImageDel(range);\n      }\n    }\n    if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) && originalEvent.code !== 'KeyK') {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') && !isNOU(selectParentEle[0]) && selectParentEle[0].tagName === 'IMG' && selectParentEle[0].parentElement) {\n        var prev = selectParentEle[0].parentElement.childNodes[0];\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n          this.removeResizeEle();\n        }\n        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n        removeClass([selectParentEle[0]], 'e-img-focus');\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n    if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n      this.undoStack({\n        subCommand: originalEvent.keyCode === 90 ? 'undo' : 'redo'\n      });\n    }\n    if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n      if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)) {\n          save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n        }\n        originalEvent.preventDefault();\n        var event_1 = {\n          selectNode: selectNodeEle,\n          selection: save,\n          selectParent: selectParentEle,\n          args: {\n            item: {\n              command: 'Images',\n              subCommand: 'Remove'\n            },\n            originalEvent: originalEvent\n          }\n        };\n        this.deleteImg(event_1, originalEvent.keyCode);\n      }\n      if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        this.removeResizeEle();\n      }\n    }\n    if (originalEvent.code === 'Backspace') {\n      originalEvent.action = 'backspace';\n    }\n    switch (originalEvent.action) {\n      case 'escape':\n        if (!isNullOrUndefined(this.dialogObj)) {\n          this.dialogObj.close();\n        }\n        break;\n      case 'backspace':\n      case 'delete':\n        for (var i = 0; i < this.deletedImg.length; i++) {\n          var src = this.deletedImg[i].src;\n          this.imageRemovePost(src);\n        }\n        if (this.parent.editorMode !== 'Markdown') {\n          if (range.startContainer.nodeType === 3) {\n            if (originalEvent.code === 'Backspace') {\n              if (range.startContainer.previousElementSibling && range.startOffset === 0 && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.previousElementSibling);\n              }\n            } else {\n              if (range.startContainer.nextElementSibling && range.endContainer.textContent.length === range.endOffset && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) && range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                detach(range.startContainer.nextElementSibling);\n              }\n            }\n          } else if (range.startContainer.nodeType === 1) {\n            if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n              detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n            } else if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK)) {\n              detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK));\n            } else if (range.startContainer.classList.contains('e-img-wrap') && closest(range.startContainer, '.' + classes.CLS_CAPTION)) {\n              var parentElem = range.startContainer.parentElement.parentElement;\n              detach(closest(range.startContainer, '.' + classes.CLS_CAPTION));\n              if (parentElem && parentElem.textContent.trim() === '') {\n                var brElem = this.parent.createElement('br');\n                brElem.classList.add('e-rte-image-remove-focus');\n                parentElem.appendChild(brElem);\n              }\n            }\n          }\n        }\n        break;\n      case 'insert-image':\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)) {\n          save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n        }\n        this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n        originalEvent.preventDefault();\n        break;\n    }\n    if (originalEvent.ctrlKey && originalEvent.key === 'a') {\n      this.handleSelectAll();\n    }\n  };\n  Image.prototype.handleSelectAll = function () {\n    this.cancelResizeAction();\n    var imgFocusNodes = this.parent.inputElement.querySelectorAll('.' + classes.CLS_IMG_FOCUS);\n    removeClass(imgFocusNodes, classes.CLS_IMG_FOCUS);\n  };\n  Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n    var range;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n      range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n      selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = selection;\n      selectNodeEle = ele;\n      selectParentEle = parentEle;\n    }\n    if (this.parent.editorMode === 'HTML') {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event,\n          name: !isInternal ? 'showDialog' : null\n        },\n        selectNode: selectNodeEle,\n        selection: save,\n        selectParent: selectParentEle\n      });\n    } else {\n      this.insertImage({\n        args: {\n          item: {\n            command: 'Images',\n            subCommand: 'Image'\n          },\n          originalEvent: event,\n          name: !isInternal ? 'showDialog' : null\n        },\n        member: 'image',\n        text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n        module: 'Markdown',\n        name: 'insertImage'\n      });\n    }\n  };\n  Image.prototype.showDialog = function () {\n    this.openDialog(false);\n    this.setCssClass({\n      cssClass: this.parent.getCssClass()\n    });\n  };\n  Image.prototype.closeDialog = function () {\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n    }\n  };\n  // eslint-disable-next-line\n  Image.prototype.onKeyUp = function (event) {\n    if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n      for (var i = 0; i < this.deletedImg.length; i++) {\n        var args = {\n          element: this.deletedImg[i],\n          src: this.deletedImg[i].getAttribute('src')\n        };\n        this.parent.trigger(events.afterImageDelete, args);\n      }\n    }\n  };\n  Image.prototype.checkImageBack = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === 0 && !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.previousSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) && range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n    }\n  };\n  Image.prototype.checkImageDel = function (range) {\n    if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length && !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.nextSibling);\n    } else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) && range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n      this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n    }\n  };\n  Image.prototype.alignmentSelect = function (e) {\n    var item = e.item;\n    if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n      return;\n    }\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n    selectNodeEle = selectNodeEle[0].nodeName === 'IMG' ? selectNodeEle : [this.imgEle];\n    var args = {\n      args: e,\n      selectNode: selectNodeEle\n    };\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    switch (item.subCommand) {\n      case 'JustifyLeft':\n        this.alignImage(args, 'JustifyLeft');\n        break;\n      case 'JustifyCenter':\n        this.alignImage(args, 'JustifyCenter');\n        break;\n      case 'JustifyRight':\n        this.alignImage(args, 'JustifyRight');\n        break;\n      case 'Inline':\n        this.inline(args);\n        break;\n      case 'Break':\n        this.break(args);\n        break;\n    }\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNodeEle[0]], 'e-img-focus');\n    }\n    this.cancelResizeAction();\n  };\n  Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n    var separator;\n    var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n    for (var i = 0; i < items.length; i++) {\n      if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n        addClass([items[i]], 'e-link-groups');\n        items[i].style.display = 'none';\n      } else if (items[i].getAttribute('title') === 'Insert Link') {\n        items[i].style.display = '';\n      } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n        // eslint-disable-next-line\n        separator = items[i];\n        detach(items[i]);\n      }\n    }\n    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n  };\n  Image.prototype.showImageQuickToolbar = function (e) {\n    var _this = this;\n    if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule) || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n      return;\n    }\n    this.quickToolObj = this.parent.quickToolbarModule;\n    var args = e.args;\n    var target = e.elements;\n    [].forEach.call(e.elements, function (element, index) {\n      if (index === 0) {\n        target = element;\n      }\n    });\n    if (target && !closest(target, 'a')) {\n      this.imageWithLinkQTBarItemUpdate();\n    }\n    if (target.nodeName === 'IMG') {\n      addClass([target], ['e-img-focus']);\n    }\n    var pageY = this.parent.iframeSettings.enable ? window.pageYOffset + this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n    if (this.parent.quickToolbarModule.imageQTBar) {\n      if (e.isNotify) {\n        setTimeout(function () {\n          _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n          _this.parent.formatter.editorManager.nodeSelection.setSelectionContents(_this.contentModule.getDocument(), target);\n          _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n          _this.resizeStart(e.args, target);\n        }, 400);\n      } else {\n        var coordinates = target.getBoundingClientRect();\n        this.quickToolObj.imageQTBar.showPopup(coordinates.left, coordinates.top, target, 'Image');\n      }\n    }\n  };\n  Image.prototype.hideImageQuickToolbar = function () {\n    if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n      removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n      if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n      }\n    }\n  };\n  Image.prototype.editAreaClickHandler = function (e) {\n    if (this.parent.readonly) {\n      this.hideImageQuickToolbar();\n      return;\n    }\n    var args = e.args;\n    var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n    if (args.which === 2 || showOnRightClick && args.which === 1 || !showOnRightClick && args.which === 3) {\n      if (showOnRightClick && args.which === 1 && !isNullOrUndefined(args.target) && args.target.tagName === 'IMG') {\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n      }\n      return;\n    }\n    if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n      this.quickToolObj = this.parent.quickToolbarModule;\n      var target = args.target;\n      this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n      var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n      if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n        if (isPopupOpen) {\n          return;\n        }\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n        if (isIDevice()) {\n          this.parent.notify(events.selectionSave, e);\n        }\n        addClass([target], 'e-img-focus');\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        var separator = void 0;\n        if (closest(target, 'a')) {\n          for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') || items[i].getAttribute('title') === this.i10n.getConstant('editLink') || items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n              items[i].style.display = '';\n              removeClass([items[i]], 'e-link-groups');\n            } else if (items[i].getAttribute('title') === 'Insert Link') {\n              items[i].style.display = 'none';\n            } else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n              // eslint-disable-next-line\n              separator = items[i];\n              detach(items[i]);\n            }\n          }\n          var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n          this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n        } else if (!closest(target, 'a')) {\n          this.imageWithLinkQTBarItemUpdate();\n        }\n        this.showImageQuickToolbar({\n          args: args,\n          type: 'Images',\n          elements: [args.target]\n        });\n      } else {\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n  Image.prototype.insertImgLink = function (e, inputDetails) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var linkWrap = this.parent.createElement('div', {\n        className: 'e-img-linkwrap' + this.parent.getCssClass(true)\n      });\n      var linkUrl = this.i10n.getConstant('linkurl');\n      var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' + '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link' + this.parent.getCssClass(true) + '\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' + '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' + '<input type=\"checkbox\" class=\"e-rte-linkTarget' + this.parent.getCssClass(true) + '\"  data-role =\"none\"></div>';\n      var contentElem = parseHtml(content);\n      linkWrap.appendChild(contentElem);\n      var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n      var inputLink = linkWrap.querySelector('.e-img-link');\n      var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n      this.checkBoxObj = new CheckBox({\n        label: linkOpenLabel,\n        checked: true,\n        enableRtl: this.parent.enableRtl,\n        cssClass: this.parent.getCssClass(),\n        change: function (e) {\n          if (e.checked) {\n            target_1 = '_blank';\n          } else {\n            target_1 = null;\n          }\n        }\n      });\n      this.checkBoxObj.isStringTemplate = true;\n      this.checkBoxObj.createElement = this.parent.createElement;\n      this.checkBoxObj.appendTo(linkTarget);\n      var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n      var imageLabel = this.checkBoxObj.checked ? this.i10n.getConstant('ImageLinkAriaLabel') : null;\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var linkargs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        selectParent: e.selectParent,\n        link: inputLink,\n        target: target_1,\n        ariaLabel: imageLabel\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n        content: linkWrap,\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertlink(linkargs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-link' + this.parent.getCssClass(true),\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog'\n      });\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n      if (!isNullOrUndefined(inputDetails)) {\n        inputLink.value = inputDetails.url;\n        // eslint-disable-next-line\n        inputDetails.target ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n        this.dialogObj.header = inputDetails.header;\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.insertAltText = function (e) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    var altText = this.i10n.getConstant('altText');\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var altWrap = this.parent.createElement('div', {\n        className: 'e-img-altwrap' + this.parent.getCssClass(true)\n      });\n      var altHeader = this.i10n.getConstant('alternateHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var getAlt = e.selectNode[0].getAttribute('alt') === null ? '' : e.selectNode[0].getAttribute('alt');\n      var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' + '<input type=\"text\" spellcheck=\"false\"  class=\"e-input e-img-alt' + this.parent.getCssClass(true) + '\" placeholder=\"' + altText + '\"/>' + '</div>';\n      var contentElem = parseHtml(content);\n      contentElem.querySelector('input').setAttribute('value', getAlt);\n      altWrap.appendChild(contentElem);\n      var inputAlt = altWrap.querySelector('.e-img-alt');\n      var altArgs_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode,\n        alt: inputAlt\n      };\n      this.dialogObj.setProperties({\n        height: 'inherit',\n        width: '290px',\n        header: altHeader,\n        content: altWrap,\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertAlt(altArgs_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-alt' + this.parent.getCssClass(true),\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog'\n      });\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.insertAlt = function (e) {\n    if (!isNullOrUndefined(e.alt)) {\n      e.selection.restore();\n      if (this.parent.formatter.getUndoRedoStack().length === 0) {\n        this.parent.formatter.saveData();\n      }\n      var altText = e.alt.value;\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        altText: altText,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      this.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n  Image.prototype.insertlink = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var url = e.link.value;\n    if (url === '') {\n      addClass([e.link], 'e-error');\n      e.link.setSelectionRange(0, url.length);\n      e.link.focus();\n      return;\n    }\n    if (!this.isUrl(url)) {\n      url = 'http://' + url;\n    } else {\n      removeClass([e.link], 'e-error');\n    }\n    var proxy = e.selfImage;\n    if (proxy.parent.editorMode === 'HTML') {\n      e.selection.restore();\n    }\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    if (e.selectNode[0].parentElement.nodeName === 'A') {\n      proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n        url: url,\n        target: proxy.checkBoxObj.checked ? '_blank' : null,\n        ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('ImageLinkAriaLabel') : null,\n        selectNode: e.selectNode,\n        subCommand: e.args.item.subCommand\n      });\n      proxy.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n    proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n      url: url,\n      target: proxy.checkBoxObj.checked ? '_blank' : null,\n      ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('ImageLinkAriaLabel') : null,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand,\n      selection: e.selection\n    });\n    var captionEle = closest(e.selectNode[0], '.e-img-caption');\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n    if (captionEle) {\n      select('.e-img-inner', captionEle).focus();\n    }\n    proxy.dialogObj.hide({\n      returnValue: false\n    });\n  };\n  Image.prototype.isUrl = function (url) {\n    // eslint-disable-next-line\n    var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n    return regexp.test(url);\n  };\n  Image.prototype.deleteImg = function (e, keyCode) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var args = {\n      element: e.selectNode[0],\n      src: e.selectNode[0].getAttribute('src')\n    };\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    e.selection.restore();\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n      this.removeResizeEle();\n    }\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      captionClass: classes.CLS_CAPTION,\n      subCommand: e.args.item.subCommand\n    });\n    this.imageRemovePost(args.src);\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n    }\n    this.cancelResizeAction();\n    if (isNullOrUndefined(keyCode)) {\n      this.parent.trigger(events.afterImageDelete, args);\n    }\n  };\n  Image.prototype.imageRemovePost = function (src) {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    var proxy = this;\n    var absoluteUrl = '';\n    if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n      return;\n    }\n    if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n      absoluteUrl = src;\n    } else {\n      absoluteUrl = new URL(src, document.baseURI).href;\n    }\n    this.removingImgName = absoluteUrl.replace(/^.*[\\\\/]/, '');\n    var xhr = new XMLHttpRequest();\n    // eslint-disable-next-line @typescript-eslint/tslint/config\n    xhr.addEventListener('readystatechange', function () {\n      if (this.readyState === 4 && this.status === 200) {\n        proxy.triggerPost(this.response);\n      }\n    });\n    xhr.open('GET', absoluteUrl);\n    xhr.responseType = 'blob';\n    xhr.send();\n  };\n  Image.prototype.triggerPost = function (response) {\n    var removeUrl = this.parent.insertImageSettings.removeUrl;\n    if (isNOU(removeUrl) || removeUrl === '') {\n      return;\n    }\n    // eslint-disable-next-line @typescript-eslint/tslint/config\n    var file = new File([response], this.removingImgName);\n    var ajax = new Ajax(removeUrl, 'POST', true, null);\n    var formData = new FormData();\n    formData.append('UploadFiles', file);\n    ajax.send(formData);\n  };\n  Image.prototype.caption = function (e) {\n    var selectNode = e.selectNode[0];\n    if (selectNode.nodeName !== 'IMG') {\n      return;\n    }\n    e.selection.restore();\n    if (this.parent.formatter.getUndoRedoStack().length === 0) {\n      this.parent.formatter.saveData();\n    }\n    this.cancelResizeAction();\n    addClass([selectNode], 'e-rte-image');\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Caption';\n    if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n      detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n      if (Browser.isIE) {\n        this.contentModule.getEditPanel().focus();\n        e.selection.restore();\n      }\n      if (selectNode.parentElement.tagName === 'A') {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode.parentElement,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      } else {\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n          insertElement: selectNode,\n          selectNode: e.selectNode,\n          subCommand: subCommand\n        });\n      }\n    } else {\n      this.captionEle = this.parent.createElement('span', {\n        className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION + this.parent.getCssClass(true),\n        attrs: {\n          contenteditable: 'false',\n          draggable: 'false',\n          style: 'width:' + this.parent.insertImageSettings.width\n        }\n      });\n      var imgWrap = this.parent.createElement('span', {\n        className: 'e-img-wrap' + this.parent.getCssClass(true)\n      });\n      var imgInner = this.parent.createElement('span', {\n        className: 'e-img-inner' + this.parent.getCssClass(true),\n        attrs: {\n          contenteditable: 'true'\n        }\n      });\n      var parent_1 = e.selectNode[0].parentElement;\n      if (parent_1.tagName === 'A') {\n        parent_1.setAttribute('contenteditable', 'true');\n      }\n      imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n      imgWrap.appendChild(imgInner);\n      var imgCaption = this.i10n.getConstant('imageCaption');\n      imgInner.innerHTML = imgCaption;\n      this.captionEle.appendChild(imgWrap);\n      if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n        addClass([this.captionEle], classes.CLS_CAPINLINE);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n        addClass([this.captionEle], classes.CLS_IMGBREAK);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n        addClass([this.captionEle], classes.CLS_IMGLEFT);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n        addClass([this.captionEle], classes.CLS_IMGRIGHT);\n      }\n      if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n        addClass([this.captionEle], classes.CLS_IMGCENTER);\n      }\n      this.parent.formatter.process(this.parent, e.args, e.args, {\n        insertElement: this.captionEle,\n        selectNode: e.selectNode,\n        subCommand: subCommand\n      });\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n    }\n    if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n      this.quickToolObj.imageQTBar.hidePopup();\n      removeClass([selectNode], 'e-img-focus');\n    }\n  };\n  Image.prototype.imageSize = function (e) {\n    var _this = this;\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    this.imagDialog(e);\n    if (!isNullOrUndefined(this.dialogObj)) {\n      var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n      var linkUpdate = this.i10n.getConstant('dialogUpdate');\n      var dialogContent = this.imgsizeInput(e);\n      var selectObj_1 = {\n        args: e.args,\n        selfImage: this,\n        selection: e.selection,\n        selectNode: e.selectNode\n      };\n      this.dialogObj.setProperties({\n        height: Browser.isDevice ? '300px' : 'inherit',\n        width: '290px',\n        header: imgSizeHeader,\n        content: dialogContent,\n        buttons: [{\n          // eslint-disable-next-line\n          click: function (e) {\n            _this.insertSize(selectObj_1);\n          },\n          buttonModel: {\n            content: linkUpdate,\n            cssClass: 'e-flat e-update-size' + this.parent.getCssClass(true),\n            isPrimary: true\n          }\n        }],\n        cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog'\n      });\n      if (!isNOU(this.parent.cssClass)) {\n        this.dialogObj.setProperties({\n          cssClass: this.parent.cssClass\n        });\n      }\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      this.dialogObj.content.querySelector('input').focus();\n    }\n  };\n  Image.prototype.break = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Break';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.inline = function (e) {\n    if (e.selectNode[0].nodeName !== 'IMG') {\n      return;\n    }\n    var subCommand = e.args.item ? e.args.item.subCommand : 'Inline';\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.alignImage = function (e, type) {\n    var subCommand = e.args.item ? e.args.item.subCommand : type;\n    this.parent.formatter.process(this.parent, e.args, e.args, {\n      selectNode: e.selectNode,\n      subCommand: subCommand\n    });\n  };\n  Image.prototype.clearDialogObj = function () {\n    if (this.dialogObj) {\n      this.dialogObj.destroy();\n      detach(this.dialogObj.element);\n      this.dialogObj = null;\n    }\n  };\n  Image.prototype.imagDialog = function (e) {\n    var _this = this;\n    if (this.dialogObj) {\n      this.dialogObj.hide({\n        returnValue: true\n      });\n      return;\n    }\n    var imgDialog = this.parent.createElement('div', {\n      className: 'e-rte-img-dialog' + this.parent.getCssClass(true),\n      id: this.rteID + '_image'\n    });\n    this.parent.element.appendChild(imgDialog);\n    var imgInsert = this.i10n.getConstant('dialogInsert');\n    var imglinkCancel = this.i10n.getConstant('dialogCancel');\n    var imgHeader = this.i10n.getConstant('imageHeader');\n    var selection = e.selection;\n    var selectObj = {\n      selfImage: this,\n      selection: e.selection,\n      args: e.args,\n      selectParent: e.selectParent\n    };\n    var dialogModel = {\n      header: imgHeader,\n      cssClass: classes.CLS_RTE_ELEMENTS + this.parent.getCssClass(true),\n      enableRtl: this.parent.enableRtl,\n      locale: this.parent.locale,\n      showCloseIcon: true,\n      closeOnEscape: true,\n      width: Browser.isDevice ? '290px' : '340px',\n      isModal: Browser.isDevice,\n      buttons: [{\n        click: this.insertImageUrl.bind(selectObj),\n        buttonModel: {\n          content: imgInsert,\n          cssClass: 'e-flat e-insertImage' + this.parent.getCssClass(true),\n          isPrimary: true,\n          disabled: this.parent.editorMode === 'Markdown' ? false : true\n        }\n      }, {\n        click: function (e) {\n          _this.cancelDialog(e);\n        },\n        buttonModel: {\n          cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true),\n          content: imglinkCancel\n        }\n      }],\n      target: Browser.isDevice ? document.body : this.parent.element,\n      animationSettings: {\n        effect: 'None'\n      },\n      close: function (event) {\n        if (_this.isImgUploaded) {\n          _this.uploadObj.removing();\n        }\n        _this.parent.isBlur = false;\n        if (event && event.event.returnValue) {\n          if (_this.parent.editorMode === 'HTML') {\n            selection.restore();\n          } else {\n            _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n          }\n        }\n        _this.dialogObj.destroy();\n        detach(_this.dialogObj.element);\n        _this.dialogRenderObj.close(event);\n        _this.dialogObj = null;\n      }\n    };\n    var dialogContent = this.parent.createElement('div', {\n      className: 'e-img-content' + this.parent.getCssClass(true)\n    });\n    if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n      dialogContent.appendChild(this.imgUpload(e));\n    }\n    var linkHeader = this.parent.createElement('div', {\n      className: 'e-linkheader' + this.parent.getCssClass(true)\n    });\n    var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n    if (this.parent.editorMode === 'HTML') {\n      linkHeader.innerHTML = linkHeaderText;\n    } else {\n      linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n    }\n    dialogContent.appendChild(linkHeader);\n    dialogContent.appendChild(this.imageUrlPopup(e));\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n      dialogModel.content = dialogContent;\n    } else {\n      dialogModel.content = dialogContent;\n    }\n    this.dialogObj = this.dialogRenderObj.render(dialogModel);\n    this.dialogObj.createElement = this.parent.createElement;\n    this.dialogObj.appendTo(imgDialog);\n    if (isNullOrUndefined(this.dialogObj)) {\n      return;\n    }\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && e.name === 'insertImage') {\n      this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n    }\n    imgDialog.style.maxHeight = 'inherit';\n    if (this.quickToolObj) {\n      if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n        this.quickToolObj.imageQTBar.hidePopup();\n        if (!isNullOrUndefined(e.selectParent)) {\n          removeClass([e.selectParent[0]], 'e-img-focus');\n        }\n      }\n      if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n        this.quickToolObj.inlineQTBar.hidePopup();\n      }\n      if (this.quickToolObj.textQTBar && this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)) {\n        this.quickToolObj.textQTBar.hidePopup();\n      }\n    }\n  };\n  // eslint-disable-next-line\n  Image.prototype.cancelDialog = function (e) {\n    this.parent.isBlur = false;\n    this.dialogObj.hide({\n      returnValue: true\n    });\n    if (this.isImgUploaded) {\n      this.uploadObj.removing();\n    }\n  };\n  Image.prototype.onDocumentClick = function (e) {\n    var target = e.target;\n    if (target.nodeName === 'IMG') {\n      this.imgEle = target;\n    }\n    if (!this.parent) {\n      return;\n    }\n    if (target.nodeName !== '#document') {\n      this.parent.currentTarget = e.target;\n    }\n    if (!isNullOrUndefined(this.dialogObj) && (\n    // eslint-disable-next-line\n    !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() && !this.parent.getToolbarElement().contains(e.target) || this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) && !closest(target, '#' + this.parent.getID() + '_toolbar_Image') && !target.querySelector('#' + this.parent.getID() + '_toolbar_Image'))) {\n      /* eslint-disable */\n      if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {} else {\n        this.parent.notify(events.documentClickClosedBy, {\n          closedBy: \"outside click\"\n        });\n        this.dialogObj.hide({\n          returnValue: true\n        });\n        this.parent.isBlur = true;\n        dispatchEvent(this.parent.element, 'focusout');\n      }\n      /* eslint-enable */\n    }\n    if (!(this.parent.iframeSettings.enable && !isNOU(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') && e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj && this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n      this.cancelResizeAction();\n    }\n    if (this.contentModule.getEditPanel().querySelector('.e-img-resize') && !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')) {\n      if (target.tagName !== 'IMG') {\n        this.removeResizeEle();\n      }\n      if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n        this.imgEle.style.outline = '';\n      } else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n        this.prevSelectedImgEle.style.outline = '';\n      }\n    }\n    if (target.tagName !== 'IMG') {\n      var items = this.contentModule.getEditPanel().querySelectorAll('img');\n      for (var i = 0; i < items.length; i++) {\n        removeClass([items[i]], 'e-img-focus');\n        removeClass([items[i]], 'e-resize');\n        items[i].style.maxWidth = '';\n      }\n    }\n  };\n  Image.prototype.removeResizeEle = function () {\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n    detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n  };\n  Image.prototype.onWindowResize = function () {\n    if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n      this.cancelResizeAction();\n    }\n  };\n  // eslint-disable-next-line\n  Image.prototype.imageUrlPopup = function (e) {\n    var _this = this;\n    var imgUrl = this.parent.createElement('div', {\n      className: 'imgUrl' + this.parent.getCssClass(true)\n    });\n    var placeUrl = this.i10n.getConstant('imageUrl');\n    this.inputUrl = this.parent.createElement('input', {\n      className: 'e-input e-img-url' + this.parent.getCssClass(true),\n      attrs: {\n        placeholder: placeUrl,\n        spellcheck: 'false',\n        'aria-label': this.i10n.getConstant('imageLinkHeader')\n      }\n    });\n    this.inputUrl.addEventListener('input', function () {\n      if (!isNOU(_this.inputUrl)) {\n        if (_this.inputUrl.value.length === 0) {\n          _this.dialogObj.getButtons(0).element.disabled = true;\n        } else {\n          _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n        }\n      }\n    });\n    if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n      var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n      this.inputUrl.value = e.selectNode[0].src.match(regex) ? e.selectNode[0].src : '';\n    }\n    imgUrl.appendChild(this.inputUrl);\n    return imgUrl;\n  };\n  // eslint-disable-next-line\n  Image.prototype.insertImageUrl = function (e) {\n    var proxy = this.selfImage;\n    proxy.isImgUploaded = false;\n    var url = proxy.inputUrl.value;\n    if (proxy.parent.editorMode === 'Markdown' && url === '') {\n      url = 'http://';\n    }\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n      proxy.uploadUrl.cssClass = proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK;\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n      proxy.uploadUrl.url = '';\n      if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n        proxy.imgEle.style.outline = '';\n        proxy.removeResizeEle();\n      }\n    } else if (url !== '') {\n      if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n      // eslint-disable-next-line\n      this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n        proxy.contentModule.getEditPanel().focus();\n        var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n        this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n        this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      }\n      var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n      var matchUrl = !isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML' ? url.match(regex)[0] : '';\n      var value = {\n        cssClass: proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n        url: url,\n        selection: this.selection,\n        altText: matchUrl,\n        selectParent: this.selectParent,\n        width: {\n          width: proxy.parent.insertImageSettings.width,\n          minWidth: proxy.parent.insertImageSettings.minWidth,\n          maxWidth: proxy.parent.getInsertImgMaxWidth()\n        },\n        height: {\n          height: proxy.parent.insertImageSettings.height,\n          minHeight: proxy.parent.insertImageSettings.minHeight,\n          maxHeight: proxy.parent.insertImageSettings.maxHeight\n        }\n      };\n      proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n      proxy.dialogObj.hide({\n        returnValue: false\n      });\n    }\n  };\n  Image.prototype.imgsizeInput = function (e) {\n    var _this = this;\n    var selectNode = e.selectNode[0];\n    var imgHeight = this.i10n.getConstant('imageHeight');\n    var imgWidth = this.i10n.getConstant('imageWidth');\n    var imgSizeWrap = this.parent.createElement('div', {\n      className: 'e-img-sizewrap' + this.parent.getCssClass(true)\n    });\n    var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' || selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ? this.changedWidthValue : parseInt(selectNode.getClientRects()[0].width.toString(), 10).toString();\n    var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' || selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ? this.changedHeightValue : parseInt(selectNode.getClientRects()[0].height.toString(), 10).toString();\n    this.changedWidthValue = null;\n    this.changedHeightValue = null;\n    var content = '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\"><label>' + imgWidth + '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width' + this.parent.getCssClass(true) + '\"/></div>' + '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"> ' + '<input type=\"text\" id=\"imgheight\" class=\"e-img-height' + this.parent.getCssClass(true) + '\"/></div>';\n    var contentElem = parseHtml(content);\n    contentElem.getElementById('imgwidth').setAttribute('value', widthVal);\n    contentElem.getElementById('imgheight').setAttribute('value', heightVal);\n    imgSizeWrap.appendChild(contentElem);\n    this.widthNum = new TextBox({\n      value: formatUnit(widthVal),\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.getCssClass(),\n      input: function (e) {\n        _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    this.widthNum.createElement = this.parent.createElement;\n    this.widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n    this.heightNum = new TextBox({\n      value: formatUnit(heightVal),\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.getCssClass(),\n      input: function (e) {\n        _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n      }\n    });\n    this.heightNum.createElement = this.parent.createElement;\n    this.heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n    return imgSizeWrap;\n  };\n  Image.prototype.inputValue = function (value) {\n    if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1 || value.match(/(\\d+)/)) {\n      return value;\n    } else {\n      return 'auto';\n    }\n  };\n  Image.prototype.insertSize = function (e) {\n    e.selection.restore();\n    var proxy = e.selfImage;\n    if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n      proxy.parent.formatter.saveData();\n    }\n    var dialogEle = proxy.dialogObj.element;\n    this.changedWidthValue = this.inputWidthValue;\n    this.changedHeightValue = this.inputHeightValue;\n    var width = dialogEle.querySelector('.e-img-width').value;\n    var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n    proxy.parent.formatter.process(this.parent, e.args, e.args, {\n      width: width,\n      height: height,\n      selectNode: e.selectNode,\n      subCommand: e.args.item.subCommand\n    });\n    if (this.imgResizeDiv) {\n      proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n    }\n    proxy.dialogObj.hide({\n      returnValue: true\n    });\n  };\n  Image.prototype.insertImage = function (e) {\n    this.imagDialog(e);\n    if (!isNullOrUndefined(this.dialogObj)) {\n      this.dialogObj.element.style.maxHeight = 'inherit';\n      var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n      if (!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown' || this.parent.editorMode === 'HTML') {\n        document.getElementById(this.rteID + '_insertImage').focus();\n      } else {\n        dialogContent.querySelector('.e-img-url').focus();\n      }\n    }\n  };\n  Image.prototype.imgUpload = function (e) {\n    var _this = this;\n    var save;\n    var selectParent;\n    // eslint-disable-next-line\n    var proxy = this;\n    var iframe = proxy.parent.iframeSettings.enable;\n    if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n    // eslint-disable-next-line\n    + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']')) || iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib'))) {\n      this.contentModule.getEditPanel().focus();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n    } else {\n      save = e.selection;\n      selectParent = e.selectParent;\n    }\n    var uploadParentEle = this.parent.createElement('div', {\n      className: 'e-img-uploadwrap e-droparea' + this.parent.getCssClass(true)\n    });\n    var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n    var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n    var span = this.parent.createElement('span', {\n      className: 'e-droptext' + this.parent.getCssClass(true)\n    });\n    var spanMsg = this.parent.createElement('span', {\n      className: 'e-rte-upload-text' + this.parent.getCssClass(true),\n      innerHTML: Browser.isDevice ? deviceImgUpMsg : imgUpMsg\n    });\n    span.appendChild(spanMsg);\n    var btnEle = this.parent.createElement('button', {\n      className: 'e-browsebtn' + this.parent.getCssClass(true),\n      id: this.rteID + '_insertImage',\n      attrs: {\n        autofocus: 'true',\n        type: 'button'\n      }\n    });\n    span.appendChild(btnEle);\n    uploadParentEle.appendChild(span);\n    var browserMsg = this.i10n.getConstant('browse');\n    this.browseButton = new Button({\n      content: browserMsg,\n      enableRtl: this.parent.enableRtl\n    });\n    this.browseButton.isStringTemplate = true;\n    this.browseButton.createElement = this.parent.createElement;\n    this.browseButton.appendTo(btnEle);\n    var btnClick = Browser.isDevice ? span : btnEle;\n    EventHandler.add(btnClick, 'click', this.fileSelect, this);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      },\n      className: this.parent.getCssClass()\n    });\n    uploadParentEle.appendChild(uploadEle);\n    var altText;\n    var selectArgs;\n    var filesData;\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      dropArea: span,\n      multiple: false,\n      enableRtl: this.parent.enableRtl,\n      cssClass: this.parent.getCssClass(),\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      selected: function (e) {\n        proxy.isImgUploaded = true;\n        selectArgs = e;\n        // eslint-disable-next-line\n        filesData = e.filesData;\n        _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n          if (!selectArgs.cancel) {\n            _this.checkExtension(selectArgs.filesData[0]);\n            altText = selectArgs.filesData[0].name;\n            if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n              var reader_1 = new FileReader();\n              // eslint-disable-next-line\n              reader_1.addEventListener('load', function (e) {\n                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result : URL.createObjectURL(convertToBlob(reader_1.result));\n                proxy.uploadUrl = {\n                  url: url,\n                  selection: save,\n                  altText: altText,\n                  selectParent: selectParent,\n                  width: {\n                    width: proxy.parent.insertImageSettings.width,\n                    minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                  },\n                  height: {\n                    height: proxy.parent.insertImageSettings.height,\n                    minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                  }\n                };\n                proxy.inputUrl.setAttribute('disabled', 'true');\n                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes && !isNullOrUndefined(_this.dialogObj)) {\n                  _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n              });\n              reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n            }\n          }\n        });\n      },\n      beforeUpload: function (args) {\n        _this.parent.trigger(events.beforeImageUpload, args);\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          _this.parent.trigger(events.imageUploading, e);\n        }\n      },\n      success: function (e) {\n        _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n          if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n            var url = _this.parent.insertImageSettings.path + e.file.name;\n            // eslint-disable-next-line\n            var value = {\n              url: url,\n              selection: save\n            };\n            proxy.uploadUrl = {\n              url: url,\n              selection: save,\n              altText: altText,\n              selectParent: selectParent,\n              width: {\n                width: proxy.parent.insertImageSettings.width,\n                minWidth: proxy.parent.insertImageSettings.minWidth,\n                maxWidth: proxy.parent.getInsertImgMaxWidth()\n              },\n              height: {\n                height: proxy.parent.insertImageSettings.height,\n                minHeight: proxy.parent.insertImageSettings.minHeight,\n                maxHeight: proxy.parent.insertImageSettings.maxHeight\n              }\n            };\n            proxy.inputUrl.setAttribute('disabled', 'true');\n          }\n          if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n            _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n          }\n        });\n      },\n      failure: function (e) {\n        _this.parent.trigger(events.imageUploadFailed, e);\n      },\n      removing: function (removeEventArgs) {\n        // eslint-disable-next-line\n        _this.parent.trigger(events.imageRemoving, removeEventArgs, function (e) {\n          proxy.isImgUploaded = false;\n          _this.dialogObj.getButtons(0).element.disabled = true;\n          proxy.inputUrl.removeAttribute('disabled');\n          if (proxy.uploadUrl) {\n            proxy.uploadUrl.url = '';\n          }\n        });\n      }\n    });\n    this.uploadObj.isStringTemplate = true;\n    this.uploadObj.createElement = this.parent.createElement;\n    this.uploadObj.appendTo(uploadEle);\n    return uploadParentEle;\n  };\n  Image.prototype.checkExtension = function (e) {\n    if (this.uploadObj.allowedExtensions) {\n      if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n        this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n        this.isAllowedTypes = false;\n      } else {\n        this.isAllowedTypes = true;\n      }\n    }\n  };\n  Image.prototype.fileSelect = function () {\n    this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n    return false;\n  };\n  Image.prototype.dragStart = function (e) {\n    if (e.target.nodeName === 'IMG') {\n      this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n        if (actionBeginArgs.cancel) {\n          e.preventDefault();\n        } else {\n          e.dataTransfer.effectAllowed = 'copyMove';\n          e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n        }\n      });\n    } else {\n      return true;\n    }\n  };\n  Image.prototype.dragEnter = function (e) {\n    e.dataTransfer.dropEffect = 'copy';\n    e.preventDefault();\n  };\n  Image.prototype.dragOver = function (e) {\n    if (Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1 || Browser.isIE && e.dataTransfer.types[0] === 'Files') {\n      e.preventDefault();\n    } else {\n      return true;\n    }\n  };\n  /**\n   * Used to set range When drop an image\n   *\n   * @param {ImageDropEventArgs} args - specifies the image arguments.\n   * @returns {void}\n   */\n  Image.prototype.dragDrop = function (args) {\n    var _this = this;\n    this.parent.trigger(events.beforeImageDrop, args, function (e) {\n      var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n      var isImgOrFileDrop = imgElement && imgElement.tagName === 'IMG' || e.dataTransfer.files.length > 0;\n      if (!e.cancel && isImgOrFileDrop) {\n        _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n          if (actionBeginArgs.cancel) {\n            e.preventDefault();\n          } else {\n            if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') || _this.parent.inputElement.contentEditable === 'false') {\n              e.preventDefault();\n              return;\n            }\n            if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n              detach(_this.imgResizeDiv);\n            }\n            e.preventDefault();\n            var range = void 0;\n            if (_this.contentModule.getDocument().caretRangeFromPoint) {\n              //For chrome\n              range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n            } else if (e.rangeParent) {\n              //For mozilla firefox\n              range = _this.contentModule.getDocument().createRange();\n              range.setStart(e.rangeParent, e.rangeOffset);\n            } else {\n              range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n            }\n            _this.parent.notify(events.selectRange, {\n              range: range\n            });\n            var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n            if (uploadArea) {\n              return;\n            }\n            _this.insertDragImage(e);\n          }\n        });\n      } else {\n        if (isImgOrFileDrop) {\n          e.preventDefault();\n        }\n      }\n    });\n  };\n  /**\n   * Used to calculate range on internet explorer\n   *\n   * @param {number} x - specifies the x range.\n   * @param {number} y - specifies the y range.\n   * @returns {void}\n   */\n  Image.prototype.getDropRange = function (x, y) {\n    var startRange = this.contentModule.getDocument().createRange();\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n    var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n    var startNode = elem.childNodes.length > 0 ? elem.childNodes[0] : elem;\n    var startCharIndexCharacter = 0;\n    if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n      startRange.setStart(startNode, startCharIndexCharacter);\n      startRange.setEnd(startNode, startCharIndexCharacter);\n    } else {\n      var rangeRect = void 0;\n      do {\n        startCharIndexCharacter++;\n        startRange.setStart(startNode, startCharIndexCharacter);\n        startRange.setEnd(startNode, startCharIndexCharacter + 1);\n        rangeRect = startRange.getBoundingClientRect();\n      } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n    }\n    return startRange;\n  };\n  Image.prototype.insertDragImage = function (e) {\n    var _this = this;\n    e.preventDefault();\n    var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n    this.parent.notify(events.drop, {\n      args: e\n    });\n    if (activePopupElement) {\n      activePopupElement.classList.add(classes.CLS_HIDE);\n    }\n    var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n    if (e.dataTransfer.files.length > 0 && imgElement === null) {\n      //For external image drag and drop\n      if (e.dataTransfer.files.length > 1) {\n        return;\n      }\n      var imgFiles = e.dataTransfer.files;\n      var fileName = imgFiles[0].name;\n      var imgType = fileName.substring(fileName.lastIndexOf('.'));\n      var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n      for (var i = 0; i < allowedTypes.length; i++) {\n        if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n          if (this.parent.insertImageSettings.saveUrl) {\n            this.onSelect(e);\n          } else {\n            var args = {\n              args: e,\n              text: '',\n              file: imgFiles[0]\n            };\n            e.preventDefault();\n            this.imagePaste(args);\n          }\n        }\n      }\n    } else {\n      //For internal image drag and drop\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      if (imgElement && imgElement.tagName === 'IMG') {\n        if (imgElement.nextElementSibling) {\n          if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n            range.insertNode(imgElement.parentElement.parentElement);\n          } else {\n            range.insertNode(imgElement);\n          }\n        } else {\n          range.insertNode(imgElement);\n        }\n        imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n        var imgArgs_1 = {\n          elements: [imgElement]\n        };\n        imgElement.addEventListener('load', function () {\n          _this.parent.trigger(events.actionComplete, imgArgs_1);\n        });\n        this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n        var args = e;\n        this.resizeStart(args, imgElement);\n        this.hideImageQuickToolbar();\n      }\n    }\n  };\n  Image.prototype.onSelect = function (args) {\n    var _this = this;\n    // eslint-disable-next-line\n    var proxy = this;\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var parentElement = this.parent.createElement('ul', {\n      className: classes.CLS_UPLOAD_FILES\n    });\n    this.parent.element.appendChild(parentElement);\n    var validFiles = {\n      name: '',\n      size: 0,\n      status: '',\n      statusCode: '',\n      type: '',\n      rawFile: args.dataTransfer.files[0],\n      validationMessages: {}\n    };\n    var imageTag = this.parent.createElement('IMG');\n    imageTag.style.opacity = '0.5';\n    imageTag.classList.add(classes.CLS_RTE_IMAGE);\n    imageTag.classList.add(classes.CLS_IMGINLINE);\n    imageTag.classList.add(classes.CLS_RESIZE);\n    var file = validFiles.rawFile;\n    var reader = new FileReader();\n    reader.addEventListener('load', function () {\n      var url = URL.createObjectURL(convertToBlob(reader.result));\n      imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n    });\n    if (file) {\n      reader.readAsDataURL(file);\n    }\n    range.insertNode(imageTag);\n    this.uploadMethod(args, imageTag);\n    var e = {\n      elements: [imageTag]\n    };\n    imageTag.addEventListener('load', function () {\n      _this.parent.trigger(events.actionComplete, e);\n    });\n    detach(parentElement);\n  };\n  /**\n   * Rendering uploader and popup for drag and drop\n   *\n   * @param {DragEvent} dragEvent - specifies the event.\n   * @param {HTMLImageElement} imageElement - specifies the element.\n   * @returns {void}\n   */\n  Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n    var _this = this;\n    var isUploading = false;\n    // eslint-disable-next-line\n    var proxy = this;\n    var popupEle = this.parent.createElement('div');\n    this.parent.element.appendChild(popupEle);\n    var uploadEle = this.parent.createElement('input', {\n      id: this.rteID + '_upload',\n      attrs: {\n        type: 'File',\n        name: 'UploadFiles'\n      }\n    });\n    var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n    this.popupObj = new Popup(popupEle, {\n      relateTo: imageElement,\n      height: '85px',\n      width: '300px',\n      offsetY: offsetY,\n      content: uploadEle,\n      viewPortElement: this.parent.element,\n      position: {\n        X: 'center',\n        Y: 'top'\n      },\n      enableRtl: this.parent.enableRtl,\n      zIndex: 10001,\n      // eslint-disable-next-line\n      close: function (event) {\n        _this.parent.isBlur = false;\n        _this.popupObj.destroy();\n        detach(_this.popupObj.element);\n        _this.popupObj = null;\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n        }\n      }\n    });\n    this.popupObj.element.style.display = 'none';\n    addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n    addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n    if (!isNOU(this.parent.cssClass)) {\n      addClass([this.popupObj.element], this.parent.cssClass);\n    }\n    var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n    var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n    setTimeout(function () {\n      proxy.refreshPopup(imageElement);\n    }, timeOut);\n    this.uploadObj = new Uploader({\n      asyncSettings: {\n        saveUrl: this.parent.insertImageSettings.saveUrl,\n        removeUrl: this.parent.insertImageSettings.removeUrl\n      },\n      cssClass: classes.CLS_RTE_DIALOG_UPLOAD + this.parent.getCssClass(true),\n      dropArea: this.parent.element,\n      allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n      removing: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n        _this.popupObj.close();\n      },\n      canceling: function () {\n        _this.parent.inputElement.contentEditable = 'true';\n        isUploading = false;\n        detach(imageElement);\n        _this.popupObj.close();\n        _this.quickToolObj.imageQTBar.hidePopup();\n        setTimeout(function () {\n          _this.uploadObj.destroy();\n        }, 900);\n      },\n      beforeUpload: function (args) {\n        _this.parent.trigger(events.beforeImageUpload, args);\n        if (!_this.parent.inlineMode.enable) {\n          _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n        }\n      },\n      uploading: function (e) {\n        if (!_this.parent.isServerRendered) {\n          isUploading = true;\n          _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n            if (imageUploadingArgs.cancel) {\n              if (!isNullOrUndefined(imageElement)) {\n                detach(imageElement);\n              }\n              if (!isNullOrUndefined(_this.popupObj.element)) {\n                detach(_this.popupObj.element);\n              }\n            } else {\n              _this.parent.inputElement.contentEditable = 'false';\n            }\n          });\n        }\n      },\n      selected: function (e) {\n        if (isUploading) {\n          e.cancel = true;\n        }\n      },\n      failure: function (e) {\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadFailure(imageElement, args, e);\n        }, 900);\n      },\n      success: function (e) {\n        if (e.operation === 'cancel') {\n          return;\n        }\n        isUploading = false;\n        _this.parent.inputElement.contentEditable = 'true';\n        var args = {\n          args: dragEvent,\n          type: 'Images',\n          isNotify: undefined,\n          elements: imageElement\n        };\n        setTimeout(function () {\n          _this.uploadSuccess(imageElement, dragEvent, args, e);\n        }, 900);\n      }\n    });\n    this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n    this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n    range.selectNodeContents(imageElement);\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n  };\n  Image.prototype.refreshPopup = function (imageElement) {\n    var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop + imageElement.offsetTop : imageElement.offsetTop;\n    var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n    if (imgPosition > rtePosition) {\n      this.popupObj.relateTo = this.parent.inputElement;\n      this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n      this.popupObj.element.style.display = 'block';\n    } else {\n      if (this.popupObj) {\n        this.popupObj.refreshPosition(imageElement);\n        this.popupObj.element.style.display = 'block';\n      }\n    }\n  };\n  /**\n   * Called when drop image upload was failed\n   *\n   * @param {HTMLElement} imgEle - specifies the image element.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {Object} e - specfies the object.\n   * @returns {void}\n   */\n  Image.prototype.uploadFailure = function (imgEle, args, e) {\n    detach(imgEle);\n    if (this.popupObj) {\n      this.popupObj.close();\n    }\n    this.parent.trigger(events.imageUploadFailed, e);\n    this.uploadObj.destroy();\n  };\n  /**\n   * Called when drop image upload was successful\n   *\n   * @param {HTMLElement} imageElement - specifies the image element.\n   * @param {DragEvent} dragEvent - specifies the drag event.\n   * @param {IShowPopupArgs} args - specifies the arguments.\n   * @param {ImageSuccessEventArgs} e - specifies the success event.\n   * @returns {void}\n   */\n  Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n    var _this = this;\n    imageElement.style.opacity = '1';\n    imageElement.classList.add(classes.CLS_IMG_FOCUS);\n    e.element = imageElement;\n    this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n      if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n        var url = _this.parent.insertImageSettings.path + e.file.name;\n        imageElement.src = url;\n        imageElement.setAttribute('alt', e.file.name);\n      }\n    });\n    if (this.popupObj) {\n      this.popupObj.close();\n      this.uploadObj.destroy();\n    }\n    this.showImageQuickToolbar(args);\n    this.resizeStart(dragEvent, imageElement);\n  };\n  Image.prototype.imagePaste = function (args) {\n    var _this = this;\n    if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n      // eslint-disable-next-line\n      var proxy_1 = this;\n      var reader_2 = new FileReader();\n      args.args.preventDefault();\n      // eslint-disable-next-line\n      reader_2.addEventListener('load', function (e) {\n        var url = {\n          cssClass: proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK,\n          url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ? reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n          width: {\n            width: proxy_1.parent.insertImageSettings.width,\n            minWidth: proxy_1.parent.insertImageSettings.minWidth,\n            maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n          },\n          height: {\n            height: proxy_1.parent.insertImageSettings.height,\n            minHeight: proxy_1.parent.insertImageSettings.minHeight,\n            maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n          }\n        };\n        if (!isNullOrUndefined(args.callBack)) {\n          args.callBack(url);\n          return;\n        } else {\n          proxy_1.parent.formatter.process(proxy_1.parent, {\n            item: {\n              command: 'Images',\n              subCommand: 'Image'\n            }\n          }, args.args, url);\n          _this.showPopupToolBar(args, url);\n        }\n      });\n      reader_2.readAsDataURL(args.file);\n    }\n  };\n  Image.prototype.showPopupToolBar = function (e, url) {\n    var _this = this;\n    var imageSrc = 'img[src=\"' + url.url + '\"]';\n    var imageElement = this.parent.inputElement.querySelector(imageSrc);\n    this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n    var args = {\n      args: e.args,\n      type: 'Images',\n      isNotify: undefined,\n      elements: imageElement\n    };\n    if (imageElement) {\n      setTimeout(function () {\n        _this.showImageQuickToolbar(args);\n        _this.resizeStart(e.args, imageElement);\n      }, 0);\n    }\n  };\n  /* eslint-disable */\n  /**\n   * Destroys the ToolBar.\n   *\n   * @method destroy\n   * @returns {void}\n   * @hidden\n    */\n  /* eslint-enable */\n  Image.prototype.destroy = function () {\n    if (isNOU(this.parent)) {\n      return;\n    }\n    this.prevSelectedImgEle = undefined;\n    this.removeEventListener();\n  };\n  Image.prototype.moduleDestroy = function () {\n    this.parent = null;\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {void}\n   */\n  Image.prototype.getModuleName = function () {\n    return 'image';\n  };\n  return Image;\n}();\nexport { Image };","map":{"version":3,"names":["addClass","detach","EventHandler","isNullOrUndefined","select","Ajax","formatUnit","Browser","closest","removeClass","isNOU","events","classes","Uploader","TextBox","Popup","Button","CheckBox","RenderType","dispatchEvent","parseHtml","hasClass","convertToBlob","isIDevice","Image","parent","serviceLocator","isImgUploaded","isAllowedTypes","pageX","pageY","mouseX","deletedImg","rteID","element","id","i10n","getService","rendererFactory","dialogRenderObj","addEventListener","prototype","isDestroyed","on","keyDown","onKeyDown","keyUp","onKeyUp","insertImage","showImageDialog","showDialog","closeImageDialog","closeDialog","windowResize","onWindowResize","insertCompleted","showImageQuickToolbar","clearDialogObj","imageToolbarAction","onToolbarAction","imageCaption","caption","imageDelete","deleteImg","imageLink","insertImgLink","imageAlt","insertAltText","editAreaClick","editAreaClickHandler","iframeMouseDown","onIframeMouseDown","imageSize","dropDownSelect","alignmentSelect","initialEnd","afterRender","dynamicModule","paste","imagePaste","bindCssClass","setCssClass","destroy","removeEventListener","moduleDestroy","off","dropElement","iframeSettings","enable","inputElement","ownerDocument","dragDrop","bind","dragStart","dragEnter","dragOver","contentModule","remove","getEditPanel","touchEndEvent","imageClick","formatter","editorManager","observer","checkUndo","undoStack","insertImageSettings","resize","touchStartEvent","resizeStart","onDocumentClick","onCutHandler","getDocument","touchMoveEvent","resizing","updateCss","currentObj","e","cssClass","oldCssClass","setProperties","trim","replace","popupObj","checkBoxObj","widthNum","heightNum","uploadObj","dialogObj","hide","returnValue","getRenderer","Content","add","args","subCommand","toLowerCase","i","getUndoRedoStack","length","temp","createElement","contentElem","text","appendChild","cloneNode","img","querySelectorAll","querySelector","j","style","outline","clonedElement","fragment","document","createDocumentFragment","firstChild","resizeEnd","resizeBtnInit","imgEle","parentElement","cursor","isDevice","target","event","requestType","trigger","resizeStop","getPointX","window","pageYOffset","getBoundingClientRect","top","clientY","saveData","ele","_this","readonly","prevSelectedImgEle","tagName","preventDefaultResize","imgResizeDiv","contains","imageResize","classList","getPointY","preventDefault","stopImmediatePropagation","quickToolObj","imageQTBar","hidePopup","resizeBtnStat","topLeft","topRight","botLeft","botRight","resizeStartArgs","cancel","cancelResizeAction","setAttribute","focus","className","getCssClass","styles","imgResizePos","resizeImgDupPos","touches","pos","calcPos","left","imgWid","width","imgHgt","height","borWid","parseInt","slice","devWid","elem","ignoreOffset","parentOffset","elementOffset","doc","offsetParent","indexOf","getID","documentElement","body","position","parentNode","nodeType","offsetTop","offsetLeft","setAspectRatio","expectedX","expectedY","match","parseFloat","minWidth","resizeByPercent","original","offsetWidth","finalWidthByPerc","toString","getComputedStyle","pixToPerc","previousElementSibling","removeAttribute","currentWidth","right","outlineWidth","split","expected","parentEle","imgDupMouseMove","onResize","resizingArgs","getInsertImgMaxWidth","minHeight","maxHeight","offsetHeight","maxWidth","paddingLeft","mouseY","imgDupPos","notify","selectionRestore","item","fileManagerSettings","renderFileManager","openImgLink","editImgLink","removeImgLink","selectParent","process","url","href","selectNode","selectParentEle","linkUpdate","getConstant","inputDetails","header","btnText","isIE","selection","restore","isCapLink","captionEle","insertElement","originalEvent","range","save","selectNodeEle","isCursor","keyCodeValues","editorMode","nodeSelection","getRange","startContainer","endContainer","startOffset","endOffset","which","nodes","getNodeCollection","nodeName","push","code","isCursor_1","checkImageBack","checkImageDel","getParentNodeCollection","ctrlKey","key","action","prev","childNodes","removeResizeEle","setSelectionText","textContent","keyCode","event_1","command","close","src","imageRemovePost","CLS_CAPTION","CLS_CAPINLINE","nextElementSibling","CLS_IMGBREAK","parentElem","brElem","openDialog","handleSelectAll","imgFocusNodes","CLS_IMG_FOCUS","isInternal","name","member","markdownSelection","getSelectedText","module","getAttribute","afterImageDelete","previousSibling","nextSibling","alignImage","inline","break","imageWithLinkQTBarItemUpdate","separator","items","toolbarElement","display","newItems","addQTBarItem","Math","round","type","quickToolbarModule","elements","forEach","call","index","isNotify","setTimeout","Clear","setSelectionContents","showPopup","coordinates","hideImageQuickToolbar","showOnRightClick","quickToolbarSettings","isPopupOpen","selectionSave","imagDialog","linkWrap","linkUrl","content","linkTarget","inputLink","linkOpenLabel","label","checked","enableRtl","change","target_1","isStringTemplate","appendTo","imageLabel","linkargs_1","selfImage","link","ariaLabel","localeObj","buttons","click","insertlink","buttonModel","isPrimary","value","altText","altWrap","altHeader","getAlt","inputAlt","altArgs_1","alt","insertAlt","setSelectionRange","isUrl","proxy","regexp","test","captionClass","absoluteUrl","removeUrl","URL","baseURI","removingImgName","xhr","XMLHttpRequest","readyState","status","triggerPost","response","open","responseType","send","file","File","ajax","formData","FormData","append","CLS_RTE_CAPTION","attrs","contenteditable","draggable","imgWrap","imgInner","parent_1","imgCaption","innerHTML","CLS_IMGINLINE","CLS_IMGLEFT","CLS_IMGRIGHT","CLS_IMGCENTER","imgSizeHeader","dialogContent","imgsizeInput","selectObj_1","insertSize","imgDialog","imgInsert","imglinkCancel","imgHeader","selectObj","dialogModel","CLS_RTE_ELEMENTS","locale","showCloseIcon","closeOnEscape","isModal","insertImageUrl","disabled","cancelDialog","animationSettings","effect","removing","isBlur","path","imgUpload","linkHeader","linkHeaderText","imageUrlPopup","render","inlineQTBar","textQTBar","currentTarget","toolbarSettings","getToolbarElement","offsetX","clientWidth","offsetY","clientHeight","documentClickClosedBy","closedBy","imgUrl","placeUrl","inputUrl","placeholder","spellcheck","getButtons","regex","RegExp","uploadUrl","getPanel","matchUrl","imgHeight","imgWidth","imgSizeWrap","widthVal","changedWidthValue","getClientRects","heightVal","changedHeightValue","getElementById","input","inputWidthValue","inputValue","inputHeightValue","dialogEle","iframe","uploadParentEle","deviceImgUpMsg","imgUpMsg","span","spanMsg","btnEle","autofocus","browserMsg","browseButton","btnClick","fileSelect","uploadEle","selectArgs","filesData","asyncSettings","saveUrl","dropArea","multiple","allowedExtensions","allowedTypes","selected","imageSelected","checkExtension","reader_1","FileReader","saveFormat","result","createObjectURL","readAsDataURL","rawFile","beforeUpload","beforeImageUpload","uploading","isServerRendered","imageUploading","success","imageUploadSuccess","operation","failure","imageUploadFailed","removeEventArgs","imageRemoving","toLocaleLowerCase","getElementsByClassName","actionBegin","actionBeginArgs","dataTransfer","effectAllowed","CLS_RTE_DRAG_IMAGE","dropEffect","info","types","beforeImageDrop","imgElement","isImgOrFileDrop","files","contentEditable","CLS_IMG_RESIZE","caretRangeFromPoint","clientX","rangeParent","createRange","setStart","rangeOffset","getDropRange","selectRange","uploadArea","CLS_DROPAREA","insertDragImage","x","y","startRange","setRange","elementFromPoint","startNode","startCharIndexCharacter","setEnd","rangeRect","activePopupElement","CLS_POPUP_OPEN","drop","CLS_HIDE","imgFiles","fileName","imgType","substring","lastIndexOf","onSelect","CLS_IMG_INNER","insertNode","imgArgs_1","actionComplete","CLS_UPLOAD_FILES","validFiles","size","statusCode","validationMessages","imageTag","opacity","CLS_RTE_IMAGE","CLS_RESIZE","reader","uploadMethod","dragEvent","imageElement","isUploading","popupEle","relateTo","viewPortElement","X","Y","zIndex","inlineMode","toolbarModule","baseToolbar","toolbarObj","disable","CLS_RTE_UPLOAD_POPUP","timeOut","refreshPopup","CLS_RTE_DIALOG_UPLOAD","canceling","imageUploadingArgs","undefined","uploadFailure","uploadSuccess","selectNodeContents","imgPosition","rtePosition","refreshPosition","proxy_1","reader_2","callBack","showPopupToolBar","imageSrc","createQTBar","image","ImageToolbar","getModuleName"],"sources":["/Users/saleem/Desktop/KClient/Web App/Ver_3.6/User Interface/website_Source files/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/renderer/image-module.js"],"sourcesContent":["import { addClass, detach, EventHandler, isNullOrUndefined, select, Ajax, formatUnit } from '@syncfusion/ej2-base';\nimport { Browser, closest, removeClass, isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport * as classes from '../base/classes';\nimport { Uploader, TextBox } from '@syncfusion/ej2-inputs';\nimport { Popup } from '@syncfusion/ej2-popups';\nimport { Button, CheckBox } from '@syncfusion/ej2-buttons';\nimport { RenderType } from '../base/enum';\nimport { dispatchEvent, parseHtml, hasClass, convertToBlob } from '../base/util';\nimport { isIDevice } from '../../common/util';\n/**\n * `Image` module is used to handle image actions.\n */\nvar Image = /** @class */ (function () {\n    function Image(parent, serviceLocator) {\n        this.isImgUploaded = false;\n        this.isAllowedTypes = true;\n        this.pageX = null;\n        this.pageY = null;\n        this.mouseX = null;\n        this.deletedImg = [];\n        this.parent = parent;\n        this.rteID = parent.element.id;\n        this.i10n = serviceLocator.getService('rteLocale');\n        this.rendererFactory = serviceLocator.getService('rendererFactory');\n        this.dialogRenderObj = serviceLocator.getService('dialogRenderObject');\n        this.addEventListener();\n    }\n    Image.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.insertImage, this.insertImage, this);\n        this.parent.on(events.showImageDialog, this.showDialog, this);\n        this.parent.on(events.closeImageDialog, this.closeDialog, this);\n        this.parent.on(events.windowResize, this.onWindowResize, this);\n        this.parent.on(events.insertCompleted, this.showImageQuickToolbar, this);\n        this.parent.on(events.clearDialogObj, this.clearDialogObj, this);\n        this.parent.on(events.imageToolbarAction, this.onToolbarAction, this);\n        this.parent.on(events.imageCaption, this.caption, this);\n        this.parent.on(events.imageDelete, this.deleteImg, this);\n        this.parent.on(events.imageLink, this.insertImgLink, this);\n        this.parent.on(events.imageAlt, this.insertAltText, this);\n        this.parent.on(events.editAreaClick, this.editAreaClickHandler, this);\n        this.parent.on(events.iframeMouseDown, this.onIframeMouseDown, this);\n        this.parent.on(events.imageSize, this.imageSize, this);\n        this.parent.on(events.dropDownSelect, this.alignmentSelect, this);\n        this.parent.on(events.initialEnd, this.afterRender, this);\n        this.parent.on(events.dynamicModule, this.afterRender, this);\n        this.parent.on(events.paste, this.imagePaste, this);\n        this.parent.on(events.bindCssClass, this.setCssClass, this);\n        this.parent.on(events.destroy, this.removeEventListener, this);\n        this.parent.on(events.moduleDestroy, this.moduleDestroy, this);\n    };\n    Image.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.keyUp, this.onKeyUp);\n        this.parent.off(events.windowResize, this.onWindowResize);\n        this.parent.off(events.insertImage, this.insertImage);\n        this.parent.off(events.showImageDialog, this.showDialog);\n        this.parent.off(events.closeImageDialog, this.closeDialog);\n        this.parent.off(events.insertCompleted, this.showImageQuickToolbar);\n        this.parent.off(events.clearDialogObj, this.clearDialogObj);\n        this.parent.off(events.imageCaption, this.caption);\n        this.parent.off(events.imageToolbarAction, this.onToolbarAction);\n        this.parent.off(events.imageDelete, this.deleteImg);\n        this.parent.off(events.imageLink, this.insertImgLink);\n        this.parent.off(events.imageAlt, this.insertAltText);\n        this.parent.off(events.editAreaClick, this.editAreaClickHandler);\n        this.parent.off(events.iframeMouseDown, this.onIframeMouseDown);\n        this.parent.off(events.imageSize, this.imageSize);\n        this.parent.off(events.dropDownSelect, this.alignmentSelect);\n        this.parent.off(events.initialEnd, this.afterRender);\n        this.parent.off(events.dynamicModule, this.afterRender);\n        this.parent.off(events.paste, this.imagePaste);\n        this.parent.off(events.bindCssClass, this.setCssClass);\n        this.parent.off(events.destroy, this.removeEventListener);\n        this.parent.off(events.moduleDestroy, this.moduleDestroy);\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument\n            : this.parent.inputElement;\n        dropElement.removeEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.removeEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.removeEventListener('dragenter', this.dragEnter.bind(this), true);\n        dropElement.removeEventListener('dragover', this.dragOver.bind(this), true);\n        if (!isNullOrUndefined(this.contentModule)) {\n            EventHandler.remove(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick);\n            this.parent.formatter.editorManager.observer.off(events.checkUndo, this.undoStack);\n            if (this.parent.insertImageSettings.resize) {\n                EventHandler.remove(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart);\n                EventHandler.remove(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick);\n                EventHandler.remove(this.contentModule.getEditPanel(), 'cut', this.onCutHandler);\n                EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n            }\n        }\n    };\n    Image.prototype.updateCss = function (currentObj, e) {\n        if (currentObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass + ' ' + e.cssClass).trim() });\n            }\n            else {\n                currentObj.setProperties({ cssClass: (currentObj.cssClass.replace(e.oldCssClass, '').trim() + ' ' + e.cssClass).trim() });\n            }\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/tslint/config\n    Image.prototype.setCssClass = function (e) {\n        if (this.popupObj && e.cssClass) {\n            if (isNullOrUndefined(e.oldCssClass)) {\n                addClass([this.popupObj.element], e.cssClass);\n            }\n            else {\n                removeClass([this.popupObj.element], e.oldCssClass);\n                addClass([this.popupObj.element], e.cssClass);\n            }\n        }\n        this.updateCss(this.checkBoxObj, e);\n        this.updateCss(this.widthNum, e);\n        this.updateCss(this.heightNum, e);\n        this.updateCss(this.uploadObj, e);\n        this.updateCss(this.dialogObj, e);\n    };\n    Image.prototype.onIframeMouseDown = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    Image.prototype.afterRender = function () {\n        this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n        EventHandler.add(this.contentModule.getEditPanel(), Browser.touchEndEvent, this.imageClick, this);\n        if (this.parent.insertImageSettings.resize) {\n            EventHandler.add(this.parent.contentModule.getEditPanel(), Browser.touchStartEvent, this.resizeStart, this);\n            EventHandler.add(this.parent.element.ownerDocument, 'mousedown', this.onDocumentClick, this);\n            EventHandler.add(this.contentModule.getEditPanel(), 'cut', this.onCutHandler, this);\n        }\n        var dropElement = this.parent.iframeSettings.enable ? this.parent.inputElement.ownerDocument :\n            this.parent.inputElement;\n        dropElement.addEventListener('drop', this.dragDrop.bind(this), true);\n        dropElement.addEventListener('dragstart', this.dragStart.bind(this), true);\n        dropElement.addEventListener('dragenter', this.dragOver.bind(this), true);\n        dropElement.addEventListener('dragover', this.dragOver.bind(this), true);\n    };\n    Image.prototype.undoStack = function (args) {\n        if (args.subCommand.toLowerCase() === 'undo' || args.subCommand.toLowerCase() === 'redo') {\n            for (var i = 0; i < this.parent.formatter.getUndoRedoStack().length; i++) {\n                var temp = this.parent.createElement('div');\n                var contentElem = this.parent.formatter.getUndoRedoStack()[i].text;\n                temp.appendChild(contentElem.cloneNode(true));\n                var img = temp.querySelectorAll('img');\n                if (temp.querySelector('.e-img-resize') && img.length > 0) {\n                    for (var j = 0; j < img.length; j++) {\n                        img[j].style.outline = '';\n                    }\n                    detach(temp.querySelector('.e-img-resize'));\n                    var clonedElement = temp.cloneNode(true);\n                    var fragment = document.createDocumentFragment();\n                    while (clonedElement.firstChild) {\n                        fragment.appendChild(clonedElement.firstChild);\n                    }\n                    this.parent.formatter.getUndoRedoStack()[i].text = fragment;\n                }\n            }\n        }\n    };\n    Image.prototype.resizeEnd = function (e) {\n        this.resizeBtnInit();\n        this.imgEle.parentElement.style.cursor = 'auto';\n        if (Browser.isDevice) {\n            removeClass([e.target.parentElement], 'e-mob-span');\n        }\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.resizeStop, args);\n        /* eslint-disable */\n        var pageX = this.getPointX(e);\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + e.clientY : e.pageY;\n        /* eslint-enable */\n        this.parent.formatter.editorManager.observer.on(events.checkUndo, this.undoStack, this);\n        this.parent.formatter.saveData();\n    };\n    Image.prototype.resizeStart = function (e, ele) {\n        var _this = this;\n        if (this.parent.readonly) {\n            return;\n        }\n        var target = ele ? ele : e.target;\n        this.prevSelectedImgEle = this.imgEle;\n        if (target.tagName === 'IMG') {\n            this.parent.preventDefaultResize(e);\n            var img = target;\n            if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n                detach(this.imgResizeDiv);\n            }\n            this.imageResize(img);\n        }\n        if (target.classList.contains('e-rte-imageboxmark')) {\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            this.pageX = this.getPointX(e);\n            this.pageY = this.getPointY(e);\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.resizeBtnInit();\n            if (this.quickToolObj) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n            if (target.classList.contains('e-rte-topLeft')) {\n                this.resizeBtnStat.topLeft = true;\n            }\n            if (target.classList.contains('e-rte-topRight')) {\n                this.resizeBtnStat.topRight = true;\n            }\n            if (target.classList.contains('e-rte-botLeft')) {\n                this.resizeBtnStat.botLeft = true;\n            }\n            if (target.classList.contains('e-rte-botRight')) {\n                this.resizeBtnStat.botRight = true;\n            }\n            if (Browser.isDevice && this.contentModule.getEditPanel().contains(this.imgResizeDiv) &&\n                !this.imgResizeDiv.classList.contains('e-mob-span')) {\n                addClass([this.imgResizeDiv], 'e-mob-span');\n            }\n            else {\n                var args = { event: e, requestType: 'images' };\n                this.parent.trigger(events.resizeStart, args, function (resizeStartArgs) {\n                    if (resizeStartArgs.cancel) {\n                        _this.cancelResizeAction();\n                    }\n                });\n            }\n            EventHandler.add(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd, this);\n        }\n    };\n    Image.prototype.imageClick = function (e) {\n        if (Browser.isDevice) {\n            if ((e.target.tagName === 'IMG' &&\n                e.target.parentElement.tagName === 'A') ||\n                (e.target.tagName === 'IMG')) {\n                this.contentModule.getEditPanel().setAttribute('contenteditable', 'false');\n                e.target.focus();\n            }\n            else {\n                if (!this.parent.readonly) {\n                    this.contentModule.getEditPanel().setAttribute('contenteditable', 'true');\n                }\n            }\n        }\n        if (e.target.tagName === 'IMG' &&\n            e.target.parentElement.tagName === 'A') {\n            e.preventDefault();\n        }\n    };\n    Image.prototype.onCutHandler = function () {\n        if (this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n    };\n    Image.prototype.imageResize = function (e) {\n        this.resizeBtnInit();\n        this.imgEle = e;\n        addClass([this.imgEle], 'e-resize');\n        this.imgResizeDiv = this.parent.createElement('span', { className: 'e-img-resize' + this.parent.getCssClass(true), id: this.rteID + '_imgResize' });\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topLeft' + this.parent.getCssClass(true), styles: 'cursor: nwse-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-topRight' + this.parent.getCssClass(true), styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botLeft' + this.parent.getCssClass(true), styles: 'cursor: nesw-resize'\n        }));\n        this.imgResizeDiv.appendChild(this.parent.createElement('span', {\n            className: 'e-rte-imageboxmark e-rte-botRight' + this.parent.getCssClass(true), styles: 'cursor: nwse-resize'\n        }));\n        if (Browser.isDevice) {\n            addClass([this.imgResizeDiv], 'e-mob-rte');\n        }\n        e.style.outline = '2px solid #4a90e2';\n        this.imgResizePos(e, this.imgResizeDiv);\n        this.resizeImgDupPos(e);\n        this.contentModule.getEditPanel().appendChild(this.imgResizeDiv);\n        EventHandler.add(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing, this);\n    };\n    Image.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Image.prototype.getPointY = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageY;\n        }\n        else {\n            return e.pageY;\n        }\n    };\n    Image.prototype.imgResizePos = function (e, imgResizeDiv) {\n        var pos = this.calcPos(e);\n        var top = pos.top;\n        var left = pos.left;\n        var imgWid = e.getBoundingClientRect().width;\n        var imgHgt = e.getBoundingClientRect().height;\n        var borWid = (Browser.isDevice) ? (4 * parseInt((e.style.outline.slice(-3)), 10)) + 2 :\n            (2 * parseInt((e.style.outline.slice(-3)), 10)) + 2; //span border width + image outline width\n        var devWid = ((Browser.isDevice) ? 0 : 2); // span border width\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botLeft').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-botRight').style.top = ((imgHgt - borWid) + top) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.left = ((imgWid - (borWid - devWid)) + left) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topRight').style.top = (top - (borWid)) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.left = (left - borWid) + 'px';\n        imgResizeDiv.querySelector('.e-rte-topLeft').style.top = (top - borWid) + 'px';\n    };\n    Image.prototype.calcPos = function (elem) {\n        var ignoreOffset = ['TD', 'TH', 'TABLE', 'A'];\n        var parentOffset = { top: 0, left: 0 };\n        var elementOffset;\n        var doc = elem.ownerDocument;\n        var offsetParent = ((elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption') ||\n            ignoreOffset.indexOf(elem.offsetParent.tagName) > -1)) ?\n            closest(elem, '#' + this.parent.getID() + '_rte-edit-view') : elem.offsetParent) || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        if (elem.offsetParent && (elem.offsetParent.classList.contains('e-img-caption'))) {\n            elementOffset = elem.getBoundingClientRect();\n            return {\n                top: elementOffset.top - parentOffset.top,\n                left: elementOffset.left - parentOffset.left\n            };\n        }\n        else {\n            return {\n                top: elem.offsetTop,\n                left: elem.offsetLeft\n            };\n        }\n    };\n    Image.prototype.setAspectRatio = function (img, expectedX, expectedY, e) {\n        if (isNullOrUndefined(img.width)) {\n            return;\n        }\n        // eslint-disable-next-line security/detect-unsafe-regex\n        var width = img.style.width !== '' ? img.style.width.match(/^\\d+(\\.\\d*)?%$/g) ? parseFloat(img.style.width) :\n            parseInt(img.style.width, 10) : img.width;\n        var height = img.style.height !== '' ? parseInt(img.style.height, 10) : img.height;\n        if (width > height) {\n            img.style.minWidth = this.parent.insertImageSettings.minWidth === 0 ? '20px' : formatUnit(this.parent.insertImageSettings.minWidth);\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var original = img.offsetWidth + this.mouseX;\n                    var finalWidthByPerc = (original / img.offsetWidth) * (parseFloat(img.style.width).toString() === 'NaN' ? (img.offsetWidth / (parseFloat(getComputedStyle(this.parent.element).width)) * 100) : parseFloat(img.style.width));\n                    img.style.width = ((finalWidthByPerc > 3) ? finalWidthByPerc : 3) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((width / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width === '' && img.style.height !== '') {\n                img.style.height = expectedY + 'px';\n            }\n            else if (img.style.width !== '' && img.style.height === '') {\n                var currentWidth = ((width / height * expectedY) + width / height) <\n                    (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    ((width / height * expectedY) + width / height) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth.toString() + 'px';\n                img.style.height = expectedY + 'px';\n            }\n            else if (img.style.width !== '') {\n                var currentWidth = (width / height * expectedY) < (this.parent.inputElement.getBoundingClientRect().right - 32) ?\n                    (width / height * expectedY) : (this.parent.inputElement.getBoundingClientRect().right - 32);\n                img.style.width = currentWidth + 'px';\n                img.style.height = expectedY + 'px';\n            }\n            else {\n                if (this.parent.iframeSettings.enable) {\n                    img.setAttribute('width', (img.width + this.mouseX).toString());\n                }\n                else {\n                    var currentWidth = img.offsetWidth === 0 ? img.width + this.mouseX + parseInt(img.style.outlineWidth.split('p')[0], 10) : img.offsetWidth + this.mouseX;\n                    img.setAttribute('width', (currentWidth).toString());\n                }\n            }\n        }\n        else if (height > width) {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                if (parseInt('' + img.getBoundingClientRect().width + '', 10) !== 0 && parseInt('' + width + '', 10) !== 0) {\n                    var original = img.offsetWidth + this.mouseX;\n                    var finalWidthByPerc = (original / img.offsetWidth) * (parseFloat(img.style.width).toString() === 'NaN' ?\n                        (img.offsetWidth / (parseFloat(getComputedStyle(this.parent.element).width)) * 100) :\n                        parseFloat(img.style.width));\n                    img.style.width = ((finalWidthByPerc > 3) ? finalWidthByPerc : 3) + '%';\n                }\n                else {\n                    img.style.width = this.pixToPerc((expectedX / height * expectedY), (img.previousElementSibling || img.parentElement)) + '%';\n                }\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else if (img.style.width !== '') {\n                img.style.width = expectedX + 'px';\n                img.style.height = (height / width * expectedX) + 'px';\n            }\n            else {\n                img.setAttribute('width', this.resizeBtnStat.botRight ? (this.getPointX(e.event) - img.getBoundingClientRect().left).toString() : expectedX.toString());\n            }\n        }\n        else {\n            if (this.parent.insertImageSettings.resizeByPercent) {\n                img.style.width = this.pixToPerc(expectedX, (img.previousElementSibling || img.parentElement)) + '%';\n                img.style.height = null;\n                img.removeAttribute('height');\n            }\n            else {\n                img.style.width = ((expectedX >= 15) ? expectedX : 15) + 'px';\n                img.style.height = ((expectedX >= 15) ? expectedX : 15) + 'px';\n            }\n        }\n    };\n    Image.prototype.pixToPerc = function (expected, parentEle) {\n        return expected / parseFloat(getComputedStyle(parentEle).width) * 100;\n    };\n    Image.prototype.imgDupMouseMove = function (width, height, e) {\n        var _this = this;\n        var args = { event: e, requestType: 'images' };\n        this.parent.trigger(events.onResize, args, function (resizingArgs) {\n            if (resizingArgs.cancel) {\n                _this.cancelResizeAction();\n            }\n            else {\n                if ((parseInt(_this.parent.insertImageSettings.minWidth, 10) >= parseInt(width, 10) ||\n                    (parseInt(_this.parent.getInsertImgMaxWidth(), 10) <= parseInt(width, 10) &&\n                        isNOU(_this.imgEle.style.width)))) {\n                    return;\n                }\n                if (!_this.parent.insertImageSettings.resizeByPercent &&\n                    (parseInt(_this.parent.insertImageSettings.minHeight, 10) >= parseInt(height, 10) ||\n                        parseInt(_this.parent.insertImageSettings.maxHeight, 10) <= parseInt(height, 10))) {\n                    return;\n                }\n                _this.imgEle.parentElement.style.cursor = 'pointer';\n                _this.setAspectRatio(_this.imgEle, parseInt(width, 10), parseInt(height, 10), args);\n                _this.resizeImgDupPos(_this.imgEle);\n                _this.imgResizePos(_this.imgEle, _this.imgResizeDiv);\n            }\n        });\n    };\n    Image.prototype.resizing = function (e) {\n        if (!this.parent) {\n            this.cancelResizeAction();\n            return;\n        }\n        if (this.imgEle.offsetWidth >= this.parent.getInsertImgMaxWidth()) {\n            this.imgEle.style.maxHeight = this.imgEle.offsetHeight + 'px';\n        }\n        else if (isNOU(this.parent.insertImageSettings.maxHeight)) {\n            this.imgEle.style.maxHeight = '';\n        }\n        this.imgEle.style.maxWidth = (closest(this.imgEle, 'ol,ul') != null ? this.parent.getInsertImgMaxWidth() - parseInt((getComputedStyle(closest(this.imgEle, 'ol,ul')).paddingLeft), 0) : this.parent.getInsertImgMaxWidth()) + 'px';\n        var pageX = this.getPointX(e);\n        var pageY = this.getPointY(e);\n        var mouseX = (this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft) ? -(pageX - this.pageX) : (pageX - this.pageX);\n        var mouseY = (this.resizeBtnStat.botLeft || this.resizeBtnStat.topLeft) ? -(pageY - this.pageY) : (pageY - this.pageY);\n        var width = parseInt(this.imgDupPos.width, 10) + mouseX;\n        var height = parseInt(this.imgDupPos.height, 10) + mouseY;\n        this.mouseX = mouseX;\n        this.pageX = pageX;\n        this.pageY = pageY;\n        if (this.resizeBtnStat.botRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.botLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topRight) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n        else if (this.resizeBtnStat.topLeft) {\n            this.imgDupMouseMove(width + 'px', height + 'px', e);\n        }\n    };\n    Image.prototype.cancelResizeAction = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        if (this.imgEle && this.imgResizeDiv && this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            detach(this.imgResizeDiv);\n            this.imgEle.style.outline = '';\n            this.imgResizeDiv = null;\n            this.pageX = null;\n            this.pageY = null;\n        }\n    };\n    Image.prototype.resizeImgDupPos = function (e) {\n        this.imgDupPos = {\n            width: (e.style.width !== '' && (this.parent.insertImageSettings &&\n                !this.parent.insertImageSettings.resizeByPercent)) ? this.imgEle.style.width : e.width + 'px',\n            height: (e.style.height !== '') ? this.imgEle.style.height : e.height + 'px'\n        };\n    };\n    Image.prototype.resizeBtnInit = function () {\n        return this.resizeBtnStat = { botLeft: false, botRight: false, topRight: false, topLeft: false };\n    };\n    Image.prototype.onToolbarAction = function (args) {\n        if (isIDevice()) {\n            this.parent.notify(events.selectionRestore, {});\n        }\n        var item = args.args.item;\n        switch (item.subCommand) {\n            case 'Replace':\n                if (this.parent.fileManagerSettings.enable) {\n                    this.parent.notify(events.renderFileManager, args);\n                }\n                else {\n                    this.parent.notify(events.insertImage, args);\n                }\n                break;\n            case 'Caption':\n                this.parent.notify(events.imageCaption, args);\n                break;\n            case 'InsertLink':\n                this.parent.notify(events.imageLink, args);\n                break;\n            case 'AltText':\n                this.parent.notify(events.imageAlt, args);\n                break;\n            case 'Remove':\n                this.parent.notify(events.imageDelete, args);\n                break;\n            case 'Dimension':\n                this.parent.notify(events.imageSize, args);\n                break;\n            case 'OpenImageLink':\n                this.openImgLink(args);\n                break;\n            case 'EditImageLink':\n                this.editImgLink(args);\n                break;\n            case 'RemoveImageLink':\n                this.removeImgLink(args);\n                break;\n        }\n    };\n    Image.prototype.openImgLink = function (e) {\n        var target = e.selectParent[0].parentNode.target === '' ? '_self' : '_blank';\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            url: e.selectParent[0].parentNode.href, target: target, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n    };\n    Image.prototype.editImgLink = function (e) {\n        var selectParentEle = e.selectParent[0].parentNode;\n        var linkUpdate = this.i10n.getConstant('dialogUpdate');\n        var inputDetails = {\n            url: selectParentEle.href, target: selectParentEle.target,\n            header: 'Edit Link', btnText: linkUpdate\n        };\n        this.insertImgLink(e, inputDetails);\n    };\n    Image.prototype.removeImgLink = function (e) {\n        if (Browser.isIE) {\n            this.contentModule.getEditPanel().focus();\n        }\n        e.selection.restore();\n        var isCapLink = (this.contentModule.getEditPanel().contains(this.captionEle) && select('a', this.captionEle)) ?\n            true : false;\n        var selectParent = isCapLink ? [this.captionEle] : [e.selectNode[0].parentElement];\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            insertElement: e.selectNode[0], selectParent: selectParent, selection: e.selection,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            if (!isNullOrUndefined(e.selectParent)) {\n                removeClass([e.selectParent[0]], 'e-img-focus');\n            }\n        }\n        if (isCapLink) {\n            select('.e-img-inner', this.captionEle).focus();\n        }\n    };\n    Image.prototype.onKeyDown = function (event) {\n        var originalEvent = event.args;\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        this.deletedImg = [];\n        var isCursor;\n        var keyCodeValues = [27, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123,\n            44, 45, 9, 16, 17, 18, 19, 20, 33, 34, 35, 36, 37, 38, 39, 40, 91, 92, 93, 144, 145, 182, 183];\n        if (this.parent.editorMode === 'HTML') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            isCursor = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n        }\n        if (!isCursor && this.parent.editorMode === 'HTML' && keyCodeValues.indexOf(originalEvent.which) < 0) {\n            var nodes = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            for (var i = 0; i < nodes.length; i++) {\n                if (nodes[i].nodeName === 'IMG') {\n                    this.deletedImg.push(nodes[i]);\n                }\n            }\n        }\n        if (this.parent.editorMode === 'HTML' && ((originalEvent.which === 8 && originalEvent.code === 'Backspace') ||\n            (originalEvent.which === 46 && originalEvent.code === 'Delete'))) {\n            var isCursor_1 = range.startContainer === range.endContainer && range.startOffset === range.endOffset;\n            if ((originalEvent.which === 8 && originalEvent.code === 'Backspace' && isCursor_1)) {\n                this.checkImageBack(range);\n            }\n            else if ((originalEvent.which === 46 && originalEvent.code === 'Delete' && isCursor_1)) {\n                this.checkImageDel(range);\n            }\n        }\n        if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection) &&\n            originalEvent.code !== 'KeyK') {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            if (!originalEvent.ctrlKey && originalEvent.key && (originalEvent.key.length === 1 || originalEvent.action === 'enter') &&\n                (!isNOU(selectParentEle[0]) && selectParentEle[0].tagName === 'IMG') && selectParentEle[0].parentElement) {\n                var prev = selectParentEle[0].parentElement.childNodes[0];\n                if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                    this.removeResizeEle();\n                }\n                this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), prev, prev, prev.textContent.length, prev.textContent.length);\n                removeClass([selectParentEle[0]], 'e-img-focus');\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n        if (originalEvent.ctrlKey && (originalEvent.keyCode === 89 || originalEvent.keyCode === 90)) {\n            this.undoStack({ subCommand: (originalEvent.keyCode === 90 ? 'undo' : 'redo') });\n        }\n        if (originalEvent.keyCode === 8 || originalEvent.keyCode === 46) {\n            if (selectNodeEle && selectNodeEle[0].nodeName === 'IMG' && selectNodeEle.length < 1) {\n                if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)) {\n                    save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n                }\n                originalEvent.preventDefault();\n                var event_1 = {\n                    selectNode: selectNodeEle, selection: save, selectParent: selectParentEle,\n                    args: {\n                        item: { command: 'Images', subCommand: 'Remove' },\n                        originalEvent: originalEvent\n                    }\n                };\n                this.deleteImg(event_1, originalEvent.keyCode);\n            }\n            if (this.parent.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                this.removeResizeEle();\n            }\n        }\n        if (originalEvent.code === 'Backspace') {\n            originalEvent.action = 'backspace';\n        }\n        switch (originalEvent.action) {\n            case 'escape':\n                if (!isNullOrUndefined(this.dialogObj)) {\n                    this.dialogObj.close();\n                }\n                break;\n            case 'backspace':\n            case 'delete':\n                for (var i = 0; i < this.deletedImg.length; i++) {\n                    var src = this.deletedImg[i].src;\n                    this.imageRemovePost(src);\n                }\n                if (this.parent.editorMode !== 'Markdown') {\n                    if (range.startContainer.nodeType === 3) {\n                        if (originalEvent.code === 'Backspace') {\n                            if (range.startContainer.previousElementSibling && range.startOffset === 0 &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.previousElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.previousElementSibling);\n                            }\n                        }\n                        else {\n                            if (range.startContainer.nextElementSibling &&\n                                range.endContainer.textContent.length === range.endOffset &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPTION) &&\n                                range.startContainer.nextElementSibling.classList.contains(classes.CLS_CAPINLINE)) {\n                                detach(range.startContainer.nextElementSibling);\n                            }\n                        }\n                    }\n                    else if (range.startContainer.nodeType === 1) {\n                        if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE)) {\n                            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_CAPINLINE));\n                        }\n                        else if (range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK)) {\n                            detach(range.startContainer.querySelector('.' + classes.CLS_CAPTION + '.' + classes.CLS_IMGBREAK));\n                        }\n                        else if (range.startContainer.classList.contains('e-img-wrap') && closest(range.startContainer, '.' + classes.CLS_CAPTION)) {\n                            var parentElem = range.startContainer.parentElement.parentElement;\n                            detach(closest(range.startContainer, '.' + classes.CLS_CAPTION));\n                            if (parentElem && parentElem.textContent.trim() === '') {\n                                var brElem = this.parent.createElement('br');\n                                brElem.classList.add('e-rte-image-remove-focus');\n                                parentElem.appendChild(brElem);\n                            }\n                        }\n                    }\n                }\n                break;\n            case 'insert-image':\n                if (!isNullOrUndefined(this.parent.formatter.editorManager.nodeSelection)) {\n                    save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n                }\n                this.openDialog(true, originalEvent, save, selectNodeEle, selectParentEle);\n                originalEvent.preventDefault();\n                break;\n        }\n        if (originalEvent.ctrlKey && originalEvent.key === 'a') {\n            this.handleSelectAll();\n        }\n    };\n    Image.prototype.handleSelectAll = function () {\n        this.cancelResizeAction();\n        var imgFocusNodes = this.parent.inputElement.querySelectorAll('.' + classes.CLS_IMG_FOCUS);\n        removeClass(imgFocusNodes, classes.CLS_IMG_FOCUS);\n    };\n    Image.prototype.openDialog = function (isInternal, event, selection, ele, parentEle) {\n        var range;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        if (!isInternal && !isNOU(this.parent.formatter.editorManager.nodeSelection)) {\n            range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n            selectParentEle = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = selection;\n            selectNodeEle = ele;\n            selectParentEle = parentEle;\n        }\n        if (this.parent.editorMode === 'HTML') {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event,\n                    name: !isInternal ? 'showDialog' : null\n                },\n                selectNode: selectNodeEle,\n                selection: save,\n                selectParent: selectParentEle\n            });\n        }\n        else {\n            this.insertImage({\n                args: {\n                    item: { command: 'Images', subCommand: 'Image' },\n                    originalEvent: event,\n                    name: !isInternal ? 'showDialog' : null\n                },\n                member: 'image',\n                text: this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),\n                module: 'Markdown',\n                name: 'insertImage'\n            });\n        }\n    };\n    Image.prototype.showDialog = function () {\n        this.openDialog(false);\n        this.setCssClass({ cssClass: this.parent.getCssClass() });\n    };\n    Image.prototype.closeDialog = function () {\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.onKeyUp = function (event) {\n        if (!isNOU(this.deletedImg) && this.deletedImg.length > 0) {\n            for (var i = 0; i < this.deletedImg.length; i++) {\n                var args = {\n                    element: this.deletedImg[i],\n                    src: this.deletedImg[i].getAttribute('src')\n                };\n                this.parent.trigger(events.afterImageDelete, args);\n            }\n        }\n    };\n    Image.prototype.checkImageBack = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === 0 &&\n            !isNOU(range.startContainer.previousSibling) && range.startContainer.previousSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.previousSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset - 1]) &&\n            range.startContainer.childNodes[range.startOffset - 1].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset - 1]);\n        }\n    };\n    Image.prototype.checkImageDel = function (range) {\n        if (range.startContainer.nodeName === '#text' && range.startOffset === range.startContainer.textContent.length &&\n            !isNOU(range.startContainer.nextSibling) && range.startContainer.nextSibling.nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.nextSibling);\n        }\n        else if (range.startContainer.nodeName !== '#text' && !isNOU(range.startContainer.childNodes[range.startOffset]) &&\n            range.startContainer.childNodes[range.startOffset].nodeName === 'IMG') {\n            this.deletedImg.push(range.startContainer.childNodes[range.startOffset]);\n        }\n    };\n    Image.prototype.alignmentSelect = function (e) {\n        var item = e.item;\n        if (!document.body.contains(document.body.querySelector('.e-rte-quick-toolbar')) || item.command !== 'Images') {\n            return;\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var selectNodeEle = this.parent.formatter.editorManager.nodeSelection.getNodeCollection(range);\n        selectNodeEle = (selectNodeEle[0].nodeName === 'IMG') ? selectNodeEle : [this.imgEle];\n        var args = { args: e, selectNode: selectNodeEle };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        switch (item.subCommand) {\n            case 'JustifyLeft':\n                this.alignImage(args, 'JustifyLeft');\n                break;\n            case 'JustifyCenter':\n                this.alignImage(args, 'JustifyCenter');\n                break;\n            case 'JustifyRight':\n                this.alignImage(args, 'JustifyRight');\n                break;\n            case 'Inline':\n                this.inline(args);\n                break;\n            case 'Break':\n                this.break(args);\n                break;\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNodeEle[0]], 'e-img-focus');\n        }\n        this.cancelResizeAction();\n    };\n    Image.prototype.imageWithLinkQTBarItemUpdate = function () {\n        var separator;\n        var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n        for (var i = 0; i < items.length; i++) {\n            if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                addClass([items[i]], 'e-link-groups');\n                items[i].style.display = 'none';\n            }\n            else if (items[i].getAttribute('title') === 'Insert Link') {\n                items[i].style.display = '';\n            }\n            else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                // eslint-disable-next-line\n                separator = items[i];\n                detach(items[i]);\n            }\n        }\n        var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n        this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n    };\n    Image.prototype.showImageQuickToolbar = function (e) {\n        var _this = this;\n        if (e.type !== 'Images' || isNullOrUndefined(this.parent.quickToolbarModule)\n            || isNullOrUndefined(this.parent.quickToolbarModule.imageQTBar) || isNullOrUndefined(e.args)) {\n            return;\n        }\n        this.quickToolObj = this.parent.quickToolbarModule;\n        var args = e.args;\n        var target = e.elements;\n        [].forEach.call(e.elements, function (element, index) {\n            if (index === 0) {\n                target = element;\n            }\n        });\n        if (target && !closest(target, 'a')) {\n            this.imageWithLinkQTBarItemUpdate();\n        }\n        if (target.nodeName === 'IMG') {\n            addClass([target], ['e-img-focus']);\n        }\n        var pageY = (this.parent.iframeSettings.enable) ? window.pageYOffset +\n            this.parent.element.getBoundingClientRect().top + args.clientY : args.pageY;\n        if (this.parent.quickToolbarModule.imageQTBar) {\n            if (e.isNotify) {\n                setTimeout(function () {\n                    _this.parent.formatter.editorManager.nodeSelection.Clear(_this.contentModule.getDocument());\n                    _this.parent.formatter.editorManager.nodeSelection.setSelectionContents(_this.contentModule.getDocument(), target);\n                    _this.quickToolObj.imageQTBar.showPopup(args.pageX, pageY, target);\n                    _this.resizeStart(e.args, target);\n                }, 400);\n            }\n            else {\n                var coordinates = target.getBoundingClientRect();\n                this.quickToolObj.imageQTBar.showPopup(coordinates.left, coordinates.top, target, 'Image');\n            }\n        }\n    };\n    Image.prototype.hideImageQuickToolbar = function () {\n        if (!isNullOrUndefined(this.contentModule.getEditPanel().querySelector('.e-img-focus'))) {\n            removeClass([this.contentModule.getEditPanel().querySelector('.e-img-focus')], 'e-img-focus');\n            if (this.quickToolObj && this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n            }\n        }\n    };\n    Image.prototype.editAreaClickHandler = function (e) {\n        if (this.parent.readonly) {\n            this.hideImageQuickToolbar();\n            return;\n        }\n        var args = e.args;\n        var showOnRightClick = this.parent.quickToolbarSettings.showOnRightClick;\n        if (args.which === 2 || (showOnRightClick && args.which === 1) || (!showOnRightClick && args.which === 3)) {\n            if ((showOnRightClick && args.which === 1) && !isNullOrUndefined(args.target) &&\n                args.target.tagName === 'IMG') {\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), args.target);\n            }\n            return;\n        }\n        if (this.parent.editorMode === 'HTML' && this.parent.quickToolbarModule && this.parent.quickToolbarModule.imageQTBar) {\n            this.quickToolObj = this.parent.quickToolbarModule;\n            var target = args.target;\n            this.contentModule = this.rendererFactory.getRenderer(RenderType.Content);\n            var isPopupOpen = this.quickToolObj.imageQTBar.element.classList.contains('e-rte-pop');\n            if (target.nodeName === 'IMG' && this.parent.quickToolbarModule) {\n                if (isPopupOpen) {\n                    return;\n                }\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(), target);\n                if (isIDevice()) {\n                    this.parent.notify(events.selectionSave, e);\n                }\n                addClass([target], 'e-img-focus');\n                var items = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item');\n                var separator = void 0;\n                if (closest(target, 'a')) {\n                    for (var i = 0; i < items.length; i++) {\n                        if (items[i].getAttribute('title') === this.i10n.getConstant('openLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('editLink') ||\n                            items[i].getAttribute('title') === this.i10n.getConstant('removeLink')) {\n                            items[i].style.display = '';\n                            removeClass([items[i]], 'e-link-groups');\n                        }\n                        else if (items[i].getAttribute('title') === 'Insert Link') {\n                            items[i].style.display = 'none';\n                        }\n                        else if (items[i].classList.contains('e-rte-horizontal-separator')) {\n                            // eslint-disable-next-line\n                            separator = items[i];\n                            detach(items[i]);\n                        }\n                    }\n                    var newItems = this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll('.e-toolbar-item:not(.e-link-groups)');\n                    this.quickToolObj.imageQTBar.addQTBarItem(['-'], Math.round(newItems.length / 2));\n                }\n                else if (!closest(target, 'a')) {\n                    this.imageWithLinkQTBarItemUpdate();\n                }\n                this.showImageQuickToolbar({ args: args, type: 'Images', elements: [args.target] });\n            }\n            else {\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.insertImgLink = function (e, inputDetails) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var linkWrap = this.parent.createElement('div', { className: 'e-img-linkwrap' + this.parent.getCssClass(true) });\n            var linkUrl = this.i10n.getConstant('linkurl');\n            var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' +\n                '<input type=\"text\" data-role =\"none\" class=\"e-input e-img-link' + this.parent.getCssClass(true) + '\" spellcheck=\"false\" placeholder=\"' + linkUrl + '\"/></div>' +\n                '<div class=\"e-rte-label\"></div>' + '<div class=\"e-rte-field\">' +\n                '<input type=\"checkbox\" class=\"e-rte-linkTarget' + this.parent.getCssClass(true) + '\"  data-role =\"none\"></div>';\n            var contentElem = parseHtml(content);\n            linkWrap.appendChild(contentElem);\n            var linkTarget = linkWrap.querySelector('.e-rte-linkTarget');\n            var inputLink = linkWrap.querySelector('.e-img-link');\n            var linkOpenLabel = this.i10n.getConstant('linkOpenInNewWindow');\n            this.checkBoxObj = new CheckBox({\n                label: linkOpenLabel, checked: true, enableRtl: this.parent.enableRtl, cssClass: this.parent.getCssClass(),\n                change: function (e) {\n                    if (e.checked) {\n                        target_1 = '_blank';\n                    }\n                    else {\n                        target_1 = null;\n                    }\n                }\n            });\n            this.checkBoxObj.isStringTemplate = true;\n            this.checkBoxObj.createElement = this.parent.createElement;\n            this.checkBoxObj.appendTo(linkTarget);\n            var target_1 = this.checkBoxObj.checked ? '_blank' : null;\n            var imageLabel = this.checkBoxObj.checked ? this.i10n.getConstant('ImageLinkAriaLabel') : null;\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var linkargs_1 = {\n                args: e.args,\n                selfImage: this, selection: e.selection,\n                selectNode: e.selectNode, selectParent: e.selectParent, link: inputLink, target: target_1, ariaLabel: imageLabel\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit',\n                width: '290px',\n                header: this.parent.localeObj.getConstant('imageInsertLinkHeader'),\n                content: linkWrap,\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertlink(linkargs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-link' + this.parent.getCssClass(true), isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-link-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            if (!isNullOrUndefined(inputDetails)) {\n                inputLink.value = inputDetails.url;\n                // eslint-disable-next-line\n                (inputDetails.target) ? this.checkBoxObj.checked = true : this.checkBoxObj.checked = false;\n                this.dialogObj.header = inputDetails.header;\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAltText = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        var altText = this.i10n.getConstant('altText');\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var altWrap = this.parent.createElement('div', { className: 'e-img-altwrap' + this.parent.getCssClass(true) });\n            var altHeader = this.i10n.getConstant('alternateHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var getAlt = (e.selectNode[0].getAttribute('alt') === null) ? '' :\n                e.selectNode[0].getAttribute('alt');\n            var content = '<div class=\"e-rte-field' + this.parent.getCssClass(true) + '\">' +\n                '<input type=\"text\" spellcheck=\"false\"  class=\"e-input e-img-alt' + this.parent.getCssClass(true) + '\" placeholder=\"' + altText + '\"/>' +\n                '</div>';\n            var contentElem = parseHtml(content);\n            contentElem.querySelector('input').setAttribute('value', getAlt);\n            altWrap.appendChild(contentElem);\n            var inputAlt = altWrap.querySelector('.e-img-alt');\n            var altArgs_1 = {\n                args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode,\n                alt: inputAlt\n            };\n            this.dialogObj.setProperties({\n                height: 'inherit', width: '290px', header: altHeader, content: altWrap,\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertAlt(altArgs_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-alt' + this.parent.getCssClass(true), isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-alt-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.insertAlt = function (e) {\n        if (!isNullOrUndefined(e.alt)) {\n            e.selection.restore();\n            if (this.parent.formatter.getUndoRedoStack().length === 0) {\n                this.parent.formatter.saveData();\n            }\n            var altText = e.alt.value;\n            this.parent.formatter.process(this.parent, e.args, e.args, {\n                altText: altText, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            this.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.insertlink = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var url = e.link.value;\n        if (url === '') {\n            addClass([e.link], 'e-error');\n            e.link.setSelectionRange(0, url.length);\n            e.link.focus();\n            return;\n        }\n        if (!this.isUrl(url)) {\n            url = 'http://' + url;\n        }\n        else {\n            removeClass([e.link], 'e-error');\n        }\n        var proxy = e.selfImage;\n        if (proxy.parent.editorMode === 'HTML') {\n            e.selection.restore();\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (e.selectNode[0].parentElement.nodeName === 'A') {\n            proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n                url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('ImageLinkAriaLabel') : null, selectNode: e.selectNode,\n                subCommand: e.args.item.subCommand\n            });\n            proxy.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        proxy.parent.formatter.process(proxy.parent, e.args, e.args, {\n            url: url, target: proxy.checkBoxObj.checked ? '_blank' : null, ariaLabel: proxy.checkBoxObj.checked ? this.i10n.getConstant('ImageLinkAriaLabel') : null, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand, selection: e.selection\n        });\n        var captionEle = closest(e.selectNode[0], '.e-img-caption');\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        if (captionEle) {\n            select('.e-img-inner', captionEle).focus();\n        }\n        proxy.dialogObj.hide({ returnValue: false });\n    };\n    Image.prototype.isUrl = function (url) {\n        // eslint-disable-next-line\n        var regexp = /(ftp|http|https):\\/\\/(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(\\/|\\/([\\w#!:.?+=&%@!\\-\\/]))?/gi;\n        return regexp.test(url);\n    };\n    Image.prototype.deleteImg = function (e, keyCode) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var args = {\n            element: e.selectNode[0],\n            src: e.selectNode[0].getAttribute('src')\n        };\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        e.selection.restore();\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n            this.removeResizeEle();\n        }\n        this.parent.formatter.process(this.parent, e.args, e.args, {\n            selectNode: e.selectNode,\n            captionClass: classes.CLS_CAPTION,\n            subCommand: e.args.item.subCommand\n        });\n        this.imageRemovePost(args.src);\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n        }\n        this.cancelResizeAction();\n        if (isNullOrUndefined(keyCode)) {\n            this.parent.trigger(events.afterImageDelete, args);\n        }\n    };\n    Image.prototype.imageRemovePost = function (src) {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var proxy = this;\n        var absoluteUrl = '';\n        if (isNOU(this.parent.insertImageSettings.removeUrl) || this.parent.insertImageSettings.removeUrl === '') {\n            return;\n        }\n        if (src.indexOf('http://') > -1 || src.indexOf('https://') > -1) {\n            absoluteUrl = src;\n        }\n        else {\n            absoluteUrl = new URL(src, document.baseURI).href;\n        }\n        this.removingImgName = absoluteUrl.replace(/^.*[\\\\/]/, '');\n        var xhr = new XMLHttpRequest();\n        // eslint-disable-next-line @typescript-eslint/tslint/config\n        xhr.addEventListener('readystatechange', function () {\n            if (this.readyState === 4 && this.status === 200) {\n                proxy.triggerPost(this.response);\n            }\n        });\n        xhr.open('GET', absoluteUrl);\n        xhr.responseType = 'blob';\n        xhr.send();\n    };\n    Image.prototype.triggerPost = function (response) {\n        var removeUrl = this.parent.insertImageSettings.removeUrl;\n        if (isNOU(removeUrl) || removeUrl === '') {\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/tslint/config\n        var file = new File([response], this.removingImgName);\n        var ajax = new Ajax(removeUrl, 'POST', true, null);\n        var formData = new FormData();\n        formData.append('UploadFiles', file);\n        ajax.send(formData);\n    };\n    Image.prototype.caption = function (e) {\n        var selectNode = e.selectNode[0];\n        if (selectNode.nodeName !== 'IMG') {\n            return;\n        }\n        e.selection.restore();\n        if (this.parent.formatter.getUndoRedoStack().length === 0) {\n            this.parent.formatter.saveData();\n        }\n        this.cancelResizeAction();\n        addClass([selectNode], 'e-rte-image');\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Caption';\n        if (!isNullOrUndefined(closest(selectNode, '.' + classes.CLS_CAPTION))) {\n            detach(closest(selectNode, '.' + classes.CLS_CAPTION));\n            if (Browser.isIE) {\n                this.contentModule.getEditPanel().focus();\n                e.selection.restore();\n            }\n            if (selectNode.parentElement.tagName === 'A') {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode.parentElement, selectNode: e.selectNode, subCommand: subCommand });\n            }\n            else {\n                this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: selectNode, selectNode: e.selectNode, subCommand: subCommand });\n            }\n        }\n        else {\n            this.captionEle = this.parent.createElement('span', {\n                className: classes.CLS_CAPTION + ' ' + classes.CLS_RTE_CAPTION + this.parent.getCssClass(true),\n                attrs: { contenteditable: 'false', draggable: 'false', style: 'width:' + this.parent.insertImageSettings.width }\n            });\n            var imgWrap = this.parent.createElement('span', { className: 'e-img-wrap' + this.parent.getCssClass(true) });\n            var imgInner = this.parent.createElement('span', { className: 'e-img-inner' + this.parent.getCssClass(true),\n                attrs: { contenteditable: 'true' } });\n            var parent_1 = e.selectNode[0].parentElement;\n            if (parent_1.tagName === 'A') {\n                parent_1.setAttribute('contenteditable', 'true');\n            }\n            imgWrap.appendChild(parent_1.tagName === 'A' ? parent_1 : e.selectNode[0]);\n            imgWrap.appendChild(imgInner);\n            var imgCaption = this.i10n.getConstant('imageCaption');\n            imgInner.innerHTML = imgCaption;\n            this.captionEle.appendChild(imgWrap);\n            if (selectNode.classList.contains(classes.CLS_IMGINLINE)) {\n                addClass([this.captionEle], classes.CLS_CAPINLINE);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGBREAK)) {\n                addClass([this.captionEle], classes.CLS_IMGBREAK);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGLEFT)) {\n                addClass([this.captionEle], classes.CLS_IMGLEFT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGRIGHT)) {\n                addClass([this.captionEle], classes.CLS_IMGRIGHT);\n            }\n            if (selectNode.classList.contains(classes.CLS_IMGCENTER)) {\n                addClass([this.captionEle], classes.CLS_IMGCENTER);\n            }\n            this.parent.formatter.process(this.parent, e.args, e.args, { insertElement: this.captionEle, selectNode: e.selectNode, subCommand: subCommand });\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(), imgInner.childNodes[0], imgInner.childNodes[0], 0, imgInner.childNodes[0].textContent.length);\n        }\n        if (this.quickToolObj && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n            this.quickToolObj.imageQTBar.hidePopup();\n            removeClass([selectNode], 'e-img-focus');\n        }\n    };\n    Image.prototype.imageSize = function (e) {\n        var _this = this;\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            var imgSizeHeader = this.i10n.getConstant('imageSizeHeader');\n            var linkUpdate = this.i10n.getConstant('dialogUpdate');\n            var dialogContent = this.imgsizeInput(e);\n            var selectObj_1 = { args: e.args, selfImage: this, selection: e.selection, selectNode: e.selectNode };\n            this.dialogObj.setProperties({\n                height: (Browser.isDevice) ? '300px' : 'inherit', width: '290px', header: imgSizeHeader, content: dialogContent,\n                buttons: [{\n                        // eslint-disable-next-line\n                        click: function (e) {\n                            _this.insertSize(selectObj_1);\n                        },\n                        buttonModel: {\n                            content: linkUpdate, cssClass: 'e-flat e-update-size' + this.parent.getCssClass(true), isPrimary: true\n                        }\n                    }],\n                cssClass: this.dialogObj.cssClass + ' e-rte-img-size-dialog'\n            });\n            if (!isNOU(this.parent.cssClass)) {\n                this.dialogObj.setProperties({ cssClass: this.parent.cssClass });\n            }\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            this.dialogObj.content.querySelector('input').focus();\n        }\n    };\n    Image.prototype.break = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Break';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.inline = function (e) {\n        if (e.selectNode[0].nodeName !== 'IMG') {\n            return;\n        }\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : 'Inline';\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.alignImage = function (e, type) {\n        var subCommand = (e.args.item) ?\n            e.args.item.subCommand : type;\n        this.parent.formatter.process(this.parent, e.args, e.args, { selectNode: e.selectNode, subCommand: subCommand });\n    };\n    Image.prototype.clearDialogObj = function () {\n        if (this.dialogObj) {\n            this.dialogObj.destroy();\n            detach(this.dialogObj.element);\n            this.dialogObj = null;\n        }\n    };\n    Image.prototype.imagDialog = function (e) {\n        var _this = this;\n        if (this.dialogObj) {\n            this.dialogObj.hide({ returnValue: true });\n            return;\n        }\n        var imgDialog = this.parent.createElement('div', { className: 'e-rte-img-dialog' + this.parent.getCssClass(true), id: this.rteID + '_image' });\n        this.parent.element.appendChild(imgDialog);\n        var imgInsert = this.i10n.getConstant('dialogInsert');\n        var imglinkCancel = this.i10n.getConstant('dialogCancel');\n        var imgHeader = this.i10n.getConstant('imageHeader');\n        var selection = e.selection;\n        var selectObj = { selfImage: this, selection: e.selection, args: e.args, selectParent: e.selectParent };\n        var dialogModel = {\n            header: imgHeader,\n            cssClass: classes.CLS_RTE_ELEMENTS + this.parent.getCssClass(true),\n            enableRtl: this.parent.enableRtl,\n            locale: this.parent.locale,\n            showCloseIcon: true, closeOnEscape: true, width: (Browser.isDevice) ? '290px' : '340px',\n            isModal: Browser.isDevice,\n            buttons: [{\n                    click: this.insertImageUrl.bind(selectObj),\n                    buttonModel: { content: imgInsert, cssClass: 'e-flat e-insertImage' + this.parent.getCssClass(true), isPrimary: true, disabled: this.parent.editorMode === 'Markdown' ? false : true }\n                },\n                {\n                    click: function (e) {\n                        _this.cancelDialog(e);\n                    },\n                    buttonModel: { cssClass: 'e-flat e-cancel' + this.parent.getCssClass(true), content: imglinkCancel }\n                }],\n            target: (Browser.isDevice) ? document.body : this.parent.element,\n            animationSettings: { effect: 'None' },\n            close: function (event) {\n                if (_this.isImgUploaded) {\n                    _this.uploadObj.removing();\n                }\n                _this.parent.isBlur = false;\n                if (event && event.event.returnValue) {\n                    if (_this.parent.editorMode === 'HTML') {\n                        selection.restore();\n                    }\n                    else {\n                        _this.parent.formatter.editorManager.markdownSelection.restore(_this.parent.contentModule.getEditPanel());\n                    }\n                }\n                _this.dialogObj.destroy();\n                detach(_this.dialogObj.element);\n                _this.dialogRenderObj.close(event);\n                _this.dialogObj = null;\n            }\n        };\n        var dialogContent = this.parent.createElement('div', { className: 'e-img-content' + this.parent.getCssClass(true) });\n        if ((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n            || this.parent.editorMode === 'HTML') {\n            dialogContent.appendChild(this.imgUpload(e));\n        }\n        var linkHeader = this.parent.createElement('div', { className: 'e-linkheader' + this.parent.getCssClass(true) });\n        var linkHeaderText = this.i10n.getConstant('imageLinkHeader');\n        if (this.parent.editorMode === 'HTML') {\n            linkHeader.innerHTML = linkHeaderText;\n        }\n        else {\n            linkHeader.innerHTML = this.i10n.getConstant('mdimageLink');\n        }\n        dialogContent.appendChild(linkHeader);\n        dialogContent.appendChild(this.imageUrlPopup(e));\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            dialogModel.header = this.parent.localeObj.getConstant('editImageHeader');\n            dialogModel.content = dialogContent;\n        }\n        else {\n            dialogModel.content = dialogContent;\n        }\n        this.dialogObj = this.dialogRenderObj.render(dialogModel);\n        this.dialogObj.createElement = this.parent.createElement;\n        this.dialogObj.appendTo(imgDialog);\n        if (isNullOrUndefined(this.dialogObj)) {\n            return;\n        }\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG' && (e.name === 'insertImage')) {\n            this.dialogObj.element.querySelector('.e-insertImage').textContent = this.parent.localeObj.getConstant('dialogUpdate');\n        }\n        imgDialog.style.maxHeight = 'inherit';\n        if (this.quickToolObj) {\n            if (this.quickToolObj.imageQTBar && document.body.contains(this.quickToolObj.imageQTBar.element)) {\n                this.quickToolObj.imageQTBar.hidePopup();\n                if (!isNullOrUndefined(e.selectParent)) {\n                    removeClass([e.selectParent[0]], 'e-img-focus');\n                }\n            }\n            if (this.quickToolObj.inlineQTBar && document.body.contains(this.quickToolObj.inlineQTBar.element)) {\n                this.quickToolObj.inlineQTBar.hidePopup();\n            }\n            if (this.quickToolObj.textQTBar && this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)) {\n                this.quickToolObj.textQTBar.hidePopup();\n            }\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.cancelDialog = function (e) {\n        this.parent.isBlur = false;\n        this.dialogObj.hide({ returnValue: true });\n        if (this.isImgUploaded) {\n            this.uploadObj.removing();\n        }\n    };\n    Image.prototype.onDocumentClick = function (e) {\n        var target = e.target;\n        if (target.nodeName === 'IMG') {\n            this.imgEle = target;\n        }\n        if (!this.parent) {\n            return;\n        }\n        if (target.nodeName !== '#document') {\n            this.parent.currentTarget = e.target;\n        }\n        if (!isNullOrUndefined(this.dialogObj) && ((\n        // eslint-disable-next-line\n        !closest(target, '[id=' + \"'\" + this.dialogObj.element.id + \"'\" + ']') && this.parent.toolbarSettings.enable && this.parent.getToolbarElement() &&\n            !this.parent.getToolbarElement().contains(e.target)) ||\n            (this.parent.getToolbarElement() && this.parent.getToolbarElement().contains(e.target) &&\n                !closest(target, '#' + this.parent.getID() + '_toolbar_Image') &&\n                !target.querySelector('#' + this.parent.getID() + '_toolbar_Image')))) {\n            /* eslint-disable */\n            if (e.offsetX > e.target.clientWidth || e.offsetY > e.target.clientHeight) {\n            }\n            else {\n                this.parent.notify(events.documentClickClosedBy, { closedBy: \"outside click\" });\n                this.dialogObj.hide({ returnValue: true });\n                this.parent.isBlur = true;\n                dispatchEvent(this.parent.element, 'focusout');\n            }\n            /* eslint-enable */\n        }\n        if (!(this.parent.iframeSettings.enable && !isNOU(this.parent.currentTarget) && this.parent.currentTarget.nodeName === 'IMG') &&\n            e.target.tagName !== 'IMG' && this.imgResizeDiv && !(this.quickToolObj &&\n            this.quickToolObj.imageQTBar && this.quickToolObj.imageQTBar.element.contains(e.target)) &&\n            this.contentModule.getEditPanel().contains(this.imgResizeDiv)) {\n            this.cancelResizeAction();\n        }\n        if (this.contentModule.getEditPanel().querySelector('.e-img-resize') && !(this.parent.iframeSettings.enable && this.parent.currentTarget.nodeName === 'IMG')) {\n            if (target.tagName !== 'IMG') {\n                this.removeResizeEle();\n            }\n            if (target.tagName !== 'IMG' && !isNOU(this.imgEle)) {\n                this.imgEle.style.outline = '';\n            }\n            else if (!isNOU(this.prevSelectedImgEle) && this.prevSelectedImgEle !== target) {\n                this.prevSelectedImgEle.style.outline = '';\n            }\n        }\n        if (target.tagName !== 'IMG') {\n            var items = this.contentModule.getEditPanel().querySelectorAll('img');\n            for (var i = 0; i < items.length; i++) {\n                removeClass([items[i]], 'e-img-focus');\n                removeClass([items[i]], 'e-resize');\n                items[i].style.maxWidth = '';\n            }\n        }\n    };\n    Image.prototype.removeResizeEle = function () {\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(this.contentModule.getDocument(), Browser.touchEndEvent, this.resizeEnd);\n        detach(this.contentModule.getEditPanel().querySelector('.e-img-resize'));\n    };\n    Image.prototype.onWindowResize = function () {\n        if (!isNOU(this.contentModule) && !isNOU(this.contentModule.getEditPanel().querySelector('.e-img-resize'))) {\n            this.cancelResizeAction();\n        }\n    };\n    // eslint-disable-next-line\n    Image.prototype.imageUrlPopup = function (e) {\n        var _this = this;\n        var imgUrl = this.parent.createElement('div', { className: 'imgUrl' + this.parent.getCssClass(true) });\n        var placeUrl = this.i10n.getConstant('imageUrl');\n        this.inputUrl = this.parent.createElement('input', {\n            className: 'e-input e-img-url' + this.parent.getCssClass(true),\n            attrs: { placeholder: placeUrl, spellcheck: 'false', 'aria-label': this.i10n.getConstant('imageLinkHeader') }\n        });\n        this.inputUrl.addEventListener('input', function () {\n            if (!isNOU(_this.inputUrl)) {\n                if (_this.inputUrl.value.length === 0) {\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                }\n                else {\n                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                }\n            }\n        });\n        if (e.selectNode && e.selectNode[0].nodeName === 'IMG') {\n            var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n            this.inputUrl.value = e.selectNode[0].src.match(regex) ? e.selectNode[0].src : '';\n        }\n        imgUrl.appendChild(this.inputUrl);\n        return imgUrl;\n    };\n    // eslint-disable-next-line\n    Image.prototype.insertImageUrl = function (e) {\n        var proxy = this.selfImage;\n        proxy.isImgUploaded = false;\n        var url = proxy.inputUrl.value;\n        if (proxy.parent.editorMode === 'Markdown' && url === '') {\n            url = 'http://';\n        }\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        if (!isNullOrUndefined(proxy.uploadUrl) && proxy.uploadUrl.url !== '') {\n            proxy.uploadUrl.cssClass = (proxy.parent.insertImageSettings.display === 'inline' ?\n                classes.CLS_IMGINLINE : classes.CLS_IMGBREAK);\n            proxy.dialogObj.hide({ returnValue: false });\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, proxy.uploadUrl);\n            proxy.uploadUrl.url = '';\n            if (proxy.contentModule.getEditPanel().querySelector('.e-img-resize')) {\n                proxy.imgEle.style.outline = '';\n                proxy.removeResizeEle();\n            }\n        }\n        else if (url !== '') {\n            if (proxy.parent.editorMode === 'HTML' && isNullOrUndefined(closest(\n            // eslint-disable-next-line\n            this.selection.range.startContainer.parentNode, '[id=' + \"'\" + proxy.contentModule.getPanel().id + \"'\" + ']'))) {\n                proxy.contentModule.getEditPanel().focus();\n                var range = proxy.parent.formatter.editorManager.nodeSelection.getRange(proxy.contentModule.getDocument());\n                this.selection = proxy.parent.formatter.editorManager.nodeSelection.save(range, proxy.contentModule.getDocument());\n                this.selectParent = proxy.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            }\n            var regex = /[\\w-]+.(jpg|png|jpeg|gif)/g;\n            var matchUrl = (!isNullOrUndefined(url.match(regex)) && proxy.parent.editorMode === 'HTML') ? url.match(regex)[0] : '';\n            var value = {\n                cssClass: (proxy.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                url: url, selection: this.selection, altText: matchUrl,\n                selectParent: this.selectParent, width: {\n                    width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                    maxWidth: proxy.parent.getInsertImgMaxWidth()\n                },\n                height: {\n                    height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                    maxHeight: proxy.parent.insertImageSettings.maxHeight\n                }\n            };\n            proxy.parent.formatter.process(proxy.parent, this.args, this.args.originalEvent, value);\n            proxy.dialogObj.hide({ returnValue: false });\n        }\n    };\n    Image.prototype.imgsizeInput = function (e) {\n        var _this = this;\n        var selectNode = e.selectNode[0];\n        var imgHeight = this.i10n.getConstant('imageHeight');\n        var imgWidth = this.i10n.getConstant('imageWidth');\n        var imgSizeWrap = this.parent.createElement('div', { className: 'e-img-sizewrap' + this.parent.getCssClass(true) });\n        var widthVal = isNullOrUndefined(this.changedWidthValue) && (selectNode.style.width.toString() === 'auto' ||\n            selectNode.style.width !== '') ? selectNode.style.width : !isNullOrUndefined(this.changedWidthValue) ?\n            this.changedWidthValue : (parseInt(selectNode.getClientRects()[0].width.toString(), 10)).toString();\n        var heightVal = isNullOrUndefined(this.changedHeightValue) && (selectNode.style.height.toString() === 'auto' ||\n            selectNode.style.height !== '') ? selectNode.style.height : !isNullOrUndefined(this.changedHeightValue) ?\n            this.changedHeightValue : (parseInt(selectNode.getClientRects()[0].height.toString(), 10)).toString();\n        this.changedWidthValue = null;\n        this.changedHeightValue = null;\n        var content = '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\"><label>' + imgWidth +\n            '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"><input type=\"text\" id=\"imgwidth\" class=\"e-img-width' + this.parent.getCssClass(true) + '\"/></div>' +\n            '<div class=\"e-rte-label' + this.parent.getCssClass(true) + '\">' + '<label>' + imgHeight + '</label></div><div class=\"e-rte-field' + this.parent.getCssClass(true) + '\"> ' +\n            '<input type=\"text\" id=\"imgheight\" class=\"e-img-height' + this.parent.getCssClass(true) + '\"/></div>';\n        var contentElem = parseHtml(content);\n        contentElem.getElementById('imgwidth').setAttribute('value', widthVal);\n        contentElem.getElementById('imgheight').setAttribute('value', heightVal);\n        imgSizeWrap.appendChild(contentElem);\n        this.widthNum = new TextBox({\n            value: formatUnit(widthVal),\n            enableRtl: this.parent.enableRtl,\n            cssClass: this.parent.getCssClass(),\n            input: function (e) {\n                _this.inputWidthValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        this.widthNum.createElement = this.parent.createElement;\n        this.widthNum.appendTo(imgSizeWrap.querySelector('#imgwidth'));\n        this.heightNum = new TextBox({\n            value: formatUnit(heightVal),\n            enableRtl: this.parent.enableRtl,\n            cssClass: this.parent.getCssClass(),\n            input: function (e) {\n                _this.inputHeightValue = formatUnit(_this.inputValue(e.value));\n            }\n        });\n        this.heightNum.createElement = this.parent.createElement;\n        this.heightNum.appendTo(imgSizeWrap.querySelector('#imgheight'));\n        return imgSizeWrap;\n    };\n    Image.prototype.inputValue = function (value) {\n        if (value === 'auto' || value.indexOf('%') !== -1 || value.indexOf('px') !== -1\n            || value.match(/(\\d+)/)) {\n            return value;\n        }\n        else {\n            return 'auto';\n        }\n    };\n    Image.prototype.insertSize = function (e) {\n        e.selection.restore();\n        var proxy = e.selfImage;\n        if (proxy.parent.formatter.getUndoRedoStack().length === 0) {\n            proxy.parent.formatter.saveData();\n        }\n        var dialogEle = proxy.dialogObj.element;\n        this.changedWidthValue = this.inputWidthValue;\n        this.changedHeightValue = this.inputHeightValue;\n        var width = dialogEle.querySelector('.e-img-width').value;\n        var height = dialogEle.parentElement.querySelector('.e-img-height').value;\n        proxy.parent.formatter.process(this.parent, e.args, e.args, {\n            width: width, height: height, selectNode: e.selectNode,\n            subCommand: e.args.item.subCommand\n        });\n        if (this.imgResizeDiv) {\n            proxy.imgResizePos(e.selectNode[0], this.imgResizeDiv);\n        }\n        proxy.dialogObj.hide({ returnValue: true });\n    };\n    Image.prototype.insertImage = function (e) {\n        this.imagDialog(e);\n        if (!isNullOrUndefined(this.dialogObj)) {\n            this.dialogObj.element.style.maxHeight = 'inherit';\n            var dialogContent = this.dialogObj.element.querySelector('.e-img-content');\n            if (((!isNullOrUndefined(this.parent.insertImageSettings.path) && this.parent.editorMode === 'Markdown')\n                || this.parent.editorMode === 'HTML')) {\n                document.getElementById(this.rteID + '_insertImage').focus();\n            }\n            else {\n                dialogContent.querySelector('.e-img-url').focus();\n            }\n        }\n    };\n    Image.prototype.imgUpload = function (e) {\n        var _this = this;\n        var save;\n        var selectParent;\n        // eslint-disable-next-line\n        var proxy = this;\n        var iframe = proxy.parent.iframeSettings.enable;\n        if (proxy.parent.editorMode === 'HTML' && (!iframe && isNullOrUndefined(closest(e.selection.range.startContainer.parentNode, '[id='\n            // eslint-disable-next-line\n            + \"'\" + this.parent.contentModule.getPanel().id + \"'\" + ']'))\n            || (iframe && !hasClass(e.selection.range.startContainer.parentNode.ownerDocument.querySelector('body'), 'e-lib')))) {\n            this.contentModule.getEditPanel().focus();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            save = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n        }\n        else {\n            save = e.selection;\n            selectParent = e.selectParent;\n        }\n        var uploadParentEle = this.parent.createElement('div', { className: 'e-img-uploadwrap e-droparea' + this.parent.getCssClass(true) });\n        var deviceImgUpMsg = this.i10n.getConstant('imageDeviceUploadMessage');\n        var imgUpMsg = this.i10n.getConstant('imageUploadMessage');\n        var span = this.parent.createElement('span', { className: 'e-droptext' + this.parent.getCssClass(true) });\n        var spanMsg = this.parent.createElement('span', {\n            className: 'e-rte-upload-text' + this.parent.getCssClass(true), innerHTML: ((Browser.isDevice) ? deviceImgUpMsg : imgUpMsg)\n        });\n        span.appendChild(spanMsg);\n        var btnEle = this.parent.createElement('button', {\n            className: 'e-browsebtn' + this.parent.getCssClass(true), id: this.rteID + '_insertImage', attrs: { autofocus: 'true', type: 'button' }\n        });\n        span.appendChild(btnEle);\n        uploadParentEle.appendChild(span);\n        var browserMsg = this.i10n.getConstant('browse');\n        this.browseButton = new Button({ content: browserMsg, enableRtl: this.parent.enableRtl });\n        this.browseButton.isStringTemplate = true;\n        this.browseButton.createElement = this.parent.createElement;\n        this.browseButton.appendTo(btnEle);\n        var btnClick = (Browser.isDevice) ? span : btnEle;\n        EventHandler.add(btnClick, 'click', this.fileSelect, this);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }, className: this.parent.getCssClass()\n        });\n        uploadParentEle.appendChild(uploadEle);\n        var altText;\n        var selectArgs;\n        var filesData;\n        this.uploadObj = new Uploader({\n            asyncSettings: { saveUrl: this.parent.insertImageSettings.saveUrl, removeUrl: this.parent.insertImageSettings.removeUrl },\n            dropArea: span, multiple: false, enableRtl: this.parent.enableRtl, cssClass: this.parent.getCssClass(),\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            selected: function (e) {\n                proxy.isImgUploaded = true;\n                selectArgs = e;\n                // eslint-disable-next-line\n                filesData = e.filesData;\n                _this.parent.trigger(events.imageSelected, selectArgs, function (selectArgs) {\n                    if (!selectArgs.cancel) {\n                        _this.checkExtension(selectArgs.filesData[0]);\n                        altText = selectArgs.filesData[0].name;\n                        if (_this.parent.editorMode === 'HTML' && isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                            var reader_1 = new FileReader();\n                            // eslint-disable-next-line\n                            reader_1.addEventListener('load', function (e) {\n                                var url = _this.parent.insertImageSettings.saveFormat === 'Base64' ? reader_1.result :\n                                    URL.createObjectURL(convertToBlob(reader_1.result));\n                                proxy.uploadUrl = {\n                                    url: url, selection: save, altText: altText,\n                                    selectParent: selectParent,\n                                    width: {\n                                        width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                        maxWidth: proxy.parent.getInsertImgMaxWidth()\n                                    }, height: {\n                                        height: proxy.parent.insertImageSettings.height,\n                                        minHeight: proxy.parent.insertImageSettings.minHeight,\n                                        maxHeight: proxy.parent.insertImageSettings.maxHeight\n                                    }\n                                };\n                                proxy.inputUrl.setAttribute('disabled', 'true');\n                                if (isNullOrUndefined(proxy.parent.insertImageSettings.saveUrl) && _this.isAllowedTypes\n                                    && !isNullOrUndefined(_this.dialogObj)) {\n                                    _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                                }\n                            });\n                            reader_1.readAsDataURL(selectArgs.filesData[0].rawFile);\n                        }\n                    }\n                });\n            },\n            beforeUpload: function (args) {\n                _this.parent.trigger(events.beforeImageUpload, args);\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    _this.parent.trigger(events.imageUploading, e);\n                }\n            },\n            success: function (e) {\n                _this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n                    if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                        var url = _this.parent.insertImageSettings.path + e.file.name;\n                        // eslint-disable-next-line\n                        var value = { url: url, selection: save };\n                        proxy.uploadUrl = {\n                            url: url, selection: save, altText: altText, selectParent: selectParent,\n                            width: {\n                                width: proxy.parent.insertImageSettings.width, minWidth: proxy.parent.insertImageSettings.minWidth,\n                                maxWidth: proxy.parent.getInsertImgMaxWidth()\n                            }, height: {\n                                height: proxy.parent.insertImageSettings.height, minHeight: proxy.parent.insertImageSettings.minHeight,\n                                maxHeight: proxy.parent.insertImageSettings.maxHeight\n                            }\n                        };\n                        proxy.inputUrl.setAttribute('disabled', 'true');\n                    }\n                    if (e.operation === 'upload' && !isNullOrUndefined(_this.dialogObj)) {\n                        _this.dialogObj.getButtons(0).element.removeAttribute('disabled');\n                    }\n                });\n            },\n            failure: function (e) {\n                _this.parent.trigger(events.imageUploadFailed, e);\n            },\n            removing: function (removeEventArgs) {\n                // eslint-disable-next-line\n                _this.parent.trigger(events.imageRemoving, removeEventArgs, function (e) {\n                    proxy.isImgUploaded = false;\n                    _this.dialogObj.getButtons(0).element.disabled = true;\n                    proxy.inputUrl.removeAttribute('disabled');\n                    if (proxy.uploadUrl) {\n                        proxy.uploadUrl.url = '';\n                    }\n                });\n            }\n        });\n        this.uploadObj.isStringTemplate = true;\n        this.uploadObj.createElement = this.parent.createElement;\n        this.uploadObj.appendTo(uploadEle);\n        return uploadParentEle;\n    };\n    Image.prototype.checkExtension = function (e) {\n        if (this.uploadObj.allowedExtensions) {\n            if (this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(('.' + e.type).toLocaleLowerCase()) === -1) {\n                this.dialogObj.getButtons(0).element.setAttribute('disabled', 'disabled');\n                this.isAllowedTypes = false;\n            }\n            else {\n                this.isAllowedTypes = true;\n            }\n        }\n    };\n    Image.prototype.fileSelect = function () {\n        this.dialogObj.element.getElementsByClassName('e-file-select-wrap')[0].querySelector('button').click();\n        return false;\n    };\n    Image.prototype.dragStart = function (e) {\n        if (e.target.nodeName === 'IMG') {\n            this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                if (actionBeginArgs.cancel) {\n                    e.preventDefault();\n                }\n                else {\n                    e.dataTransfer.effectAllowed = 'copyMove';\n                    e.target.classList.add(classes.CLS_RTE_DRAG_IMAGE);\n                }\n            });\n        }\n        else {\n            return true;\n        }\n    };\n    Image.prototype.dragEnter = function (e) {\n        e.dataTransfer.dropEffect = 'copy';\n        e.preventDefault();\n    };\n    Image.prototype.dragOver = function (e) {\n        if ((Browser.info.name === 'edge' && e.dataTransfer.items[0].type.split('/')[0].indexOf('image') > -1) ||\n            (Browser.isIE && e.dataTransfer.types[0] === 'Files')) {\n            e.preventDefault();\n        }\n        else {\n            return true;\n        }\n    };\n    /**\n     * Used to set range When drop an image\n     *\n     * @param {ImageDropEventArgs} args - specifies the image arguments.\n     * @returns {void}\n     */\n    Image.prototype.dragDrop = function (args) {\n        var _this = this;\n        this.parent.trigger(events.beforeImageDrop, args, function (e) {\n            var imgElement = _this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n            var isImgOrFileDrop = (imgElement && imgElement.tagName === 'IMG') || e.dataTransfer.files.length > 0;\n            if (!e.cancel && isImgOrFileDrop) {\n                _this.parent.trigger(events.actionBegin, e, function (actionBeginArgs) {\n                    if (actionBeginArgs.cancel) {\n                        e.preventDefault();\n                    }\n                    else {\n                        if (closest(e.target, '#' + _this.parent.getID() + '_toolbar') ||\n                            _this.parent.inputElement.contentEditable === 'false') {\n                            e.preventDefault();\n                            return;\n                        }\n                        if (_this.parent.element.querySelector('.' + classes.CLS_IMG_RESIZE)) {\n                            detach(_this.imgResizeDiv);\n                        }\n                        e.preventDefault();\n                        var range = void 0;\n                        if (_this.contentModule.getDocument().caretRangeFromPoint) { //For chrome\n                            range = _this.contentModule.getDocument().caretRangeFromPoint(e.clientX, e.clientY);\n                        }\n                        else if ((e.rangeParent)) { //For mozilla firefox\n                            range = _this.contentModule.getDocument().createRange();\n                            range.setStart(e.rangeParent, e.rangeOffset);\n                        }\n                        else {\n                            range = _this.getDropRange(e.clientX, e.clientY); //For internet explorer\n                        }\n                        _this.parent.notify(events.selectRange, { range: range });\n                        var uploadArea = _this.parent.element.querySelector('.' + classes.CLS_DROPAREA);\n                        if (uploadArea) {\n                            return;\n                        }\n                        _this.insertDragImage(e);\n                    }\n                });\n            }\n            else {\n                if (isImgOrFileDrop) {\n                    e.preventDefault();\n                }\n            }\n        });\n    };\n    /**\n     * Used to calculate range on internet explorer\n     *\n     * @param {number} x - specifies the x range.\n     * @param {number} y - specifies the y range.\n     * @returns {void}\n     */\n    Image.prototype.getDropRange = function (x, y) {\n        var startRange = this.contentModule.getDocument().createRange();\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), startRange);\n        var elem = this.contentModule.getDocument().elementFromPoint(x, y);\n        var startNode = (elem.childNodes.length > 0 ? elem.childNodes[0] : elem);\n        var startCharIndexCharacter = 0;\n        if (this.parent.inputElement.firstChild.innerHTML === '<br>') {\n            startRange.setStart(startNode, startCharIndexCharacter);\n            startRange.setEnd(startNode, startCharIndexCharacter);\n        }\n        else {\n            var rangeRect = void 0;\n            do {\n                startCharIndexCharacter++;\n                startRange.setStart(startNode, startCharIndexCharacter);\n                startRange.setEnd(startNode, startCharIndexCharacter + 1);\n                rangeRect = startRange.getBoundingClientRect();\n            } while (rangeRect.left < x && startCharIndexCharacter < startNode.length - 1);\n        }\n        return startRange;\n    };\n    Image.prototype.insertDragImage = function (e) {\n        var _this = this;\n        e.preventDefault();\n        var activePopupElement = this.parent.element.querySelector('' + classes.CLS_POPUP_OPEN);\n        this.parent.notify(events.drop, { args: e });\n        if (activePopupElement) {\n            activePopupElement.classList.add(classes.CLS_HIDE);\n        }\n        var imgElement = this.parent.inputElement.ownerDocument.querySelector('.' + classes.CLS_RTE_DRAG_IMAGE);\n        if (e.dataTransfer.files.length > 0 && imgElement === null) { //For external image drag and drop\n            if (e.dataTransfer.files.length > 1) {\n                return;\n            }\n            var imgFiles = e.dataTransfer.files;\n            var fileName = imgFiles[0].name;\n            var imgType = fileName.substring(fileName.lastIndexOf('.'));\n            var allowedTypes = this.parent.insertImageSettings.allowedTypes;\n            for (var i = 0; i < allowedTypes.length; i++) {\n                if (imgType.toLocaleLowerCase() === allowedTypes[i].toLowerCase()) {\n                    if (this.parent.insertImageSettings.saveUrl) {\n                        this.onSelect(e);\n                    }\n                    else {\n                        var args = { args: e, text: '', file: imgFiles[0] };\n                        e.preventDefault();\n                        this.imagePaste(args);\n                    }\n                }\n            }\n        }\n        else { //For internal image drag and drop\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            if (imgElement && imgElement.tagName === 'IMG') {\n                if (imgElement.nextElementSibling) {\n                    if (imgElement.nextElementSibling.classList.contains(classes.CLS_IMG_INNER)) {\n                        range.insertNode(imgElement.parentElement.parentElement);\n                    }\n                    else {\n                        range.insertNode(imgElement);\n                    }\n                }\n                else {\n                    range.insertNode(imgElement);\n                }\n                imgElement.classList.remove(classes.CLS_RTE_DRAG_IMAGE);\n                var imgArgs_1 = { elements: [imgElement] };\n                imgElement.addEventListener('load', function () {\n                    _this.parent.trigger(events.actionComplete, imgArgs_1);\n                });\n                this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());\n                var args = e;\n                this.resizeStart(args, imgElement);\n                this.hideImageQuickToolbar();\n            }\n        }\n    };\n    Image.prototype.onSelect = function (args) {\n        var _this = this;\n        // eslint-disable-next-line\n        var proxy = this;\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var parentElement = this.parent.createElement('ul', { className: classes.CLS_UPLOAD_FILES });\n        this.parent.element.appendChild(parentElement);\n        var validFiles = {\n            name: '',\n            size: 0,\n            status: '',\n            statusCode: '',\n            type: '',\n            rawFile: args.dataTransfer.files[0],\n            validationMessages: {}\n        };\n        var imageTag = this.parent.createElement('IMG');\n        imageTag.style.opacity = '0.5';\n        imageTag.classList.add(classes.CLS_RTE_IMAGE);\n        imageTag.classList.add(classes.CLS_IMGINLINE);\n        imageTag.classList.add(classes.CLS_RESIZE);\n        var file = validFiles.rawFile;\n        var reader = new FileReader();\n        reader.addEventListener('load', function () {\n            var url = URL.createObjectURL(convertToBlob(reader.result));\n            imageTag.src = proxy.parent.insertImageSettings.saveFormat === 'Blob' ? url : reader.result;\n        });\n        if (file) {\n            reader.readAsDataURL(file);\n        }\n        range.insertNode(imageTag);\n        this.uploadMethod(args, imageTag);\n        var e = { elements: [imageTag] };\n        imageTag.addEventListener('load', function () {\n            _this.parent.trigger(events.actionComplete, e);\n        });\n        detach(parentElement);\n    };\n    /**\n     * Rendering uploader and popup for drag and drop\n     *\n     * @param {DragEvent} dragEvent - specifies the event.\n     * @param {HTMLImageElement} imageElement - specifies the element.\n     * @returns {void}\n     */\n    Image.prototype.uploadMethod = function (dragEvent, imageElement) {\n        var _this = this;\n        var isUploading = false;\n        // eslint-disable-next-line\n        var proxy = this;\n        var popupEle = this.parent.createElement('div');\n        this.parent.element.appendChild(popupEle);\n        var uploadEle = this.parent.createElement('input', {\n            id: this.rteID + '_upload', attrs: { type: 'File', name: 'UploadFiles' }\n        });\n        var offsetY = this.parent.iframeSettings.enable ? -50 : -90;\n        this.popupObj = new Popup(popupEle, {\n            relateTo: imageElement,\n            height: '85px',\n            width: '300px',\n            offsetY: offsetY,\n            content: uploadEle,\n            viewPortElement: this.parent.element,\n            position: { X: 'center', Y: 'top' },\n            enableRtl: this.parent.enableRtl,\n            zIndex: 10001,\n            // eslint-disable-next-line\n            close: function (event) {\n                _this.parent.isBlur = false;\n                _this.popupObj.destroy();\n                detach(_this.popupObj.element);\n                _this.popupObj = null;\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(false);\n                }\n            }\n        });\n        this.popupObj.element.style.display = 'none';\n        addClass([this.popupObj.element], classes.CLS_POPUP_OPEN);\n        addClass([this.popupObj.element], classes.CLS_RTE_UPLOAD_POPUP);\n        if (!isNOU(this.parent.cssClass)) {\n            addClass([this.popupObj.element], this.parent.cssClass);\n        }\n        var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n        var timeOut = dragEvent.dataTransfer.files[0].size > 1000000 ? 300 : 100;\n        setTimeout(function () {\n            proxy.refreshPopup(imageElement);\n        }, timeOut);\n        this.uploadObj = new Uploader({\n            asyncSettings: {\n                saveUrl: this.parent.insertImageSettings.saveUrl,\n                removeUrl: this.parent.insertImageSettings.removeUrl\n            },\n            cssClass: classes.CLS_RTE_DIALOG_UPLOAD + this.parent.getCssClass(true),\n            dropArea: this.parent.element,\n            allowedExtensions: this.parent.insertImageSettings.allowedTypes.toString(),\n            removing: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n            },\n            canceling: function () {\n                _this.parent.inputElement.contentEditable = 'true';\n                isUploading = false;\n                detach(imageElement);\n                _this.popupObj.close();\n                _this.quickToolObj.imageQTBar.hidePopup();\n                setTimeout(function () {\n                    _this.uploadObj.destroy();\n                }, 900);\n            },\n            beforeUpload: function (args) {\n                _this.parent.trigger(events.beforeImageUpload, args);\n                if (!_this.parent.inlineMode.enable) {\n                    _this.parent.toolbarModule.baseToolbar.toolbarObj.disable(true);\n                }\n            },\n            uploading: function (e) {\n                if (!_this.parent.isServerRendered) {\n                    isUploading = true;\n                    _this.parent.trigger(events.imageUploading, e, function (imageUploadingArgs) {\n                        if (imageUploadingArgs.cancel) {\n                            if (!isNullOrUndefined(imageElement)) {\n                                detach(imageElement);\n                            }\n                            if (!isNullOrUndefined(_this.popupObj.element)) {\n                                detach(_this.popupObj.element);\n                            }\n                        }\n                        else {\n                            _this.parent.inputElement.contentEditable = 'false';\n                        }\n                    });\n                }\n            },\n            selected: function (e) {\n                if (isUploading) {\n                    e.cancel = true;\n                }\n            },\n            failure: function (e) {\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadFailure(imageElement, args, e);\n                }, 900);\n            },\n            success: function (e) {\n                if (e.operation === 'cancel') {\n                    return;\n                }\n                isUploading = false;\n                _this.parent.inputElement.contentEditable = 'true';\n                var args = {\n                    args: dragEvent,\n                    type: 'Images',\n                    isNotify: undefined,\n                    elements: imageElement\n                };\n                setTimeout(function () {\n                    _this.uploadSuccess(imageElement, dragEvent, args, e);\n                }, 900);\n            }\n        });\n        this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);\n        this.popupObj.element.querySelector('.e-rte-dialog-upload .e-file-select-wrap').style.display = 'none';\n        range.selectNodeContents(imageElement);\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(), range);\n    };\n    Image.prototype.refreshPopup = function (imageElement) {\n        var imgPosition = this.parent.iframeSettings.enable ? this.parent.element.offsetTop +\n            imageElement.offsetTop : imageElement.offsetTop;\n        var rtePosition = this.parent.element.offsetTop + this.parent.element.offsetHeight;\n        if (imgPosition > rtePosition) {\n            this.popupObj.relateTo = this.parent.inputElement;\n            this.popupObj.offsetY = this.parent.iframeSettings.enable ? -30 : -65;\n            this.popupObj.element.style.display = 'block';\n        }\n        else {\n            if (this.popupObj) {\n                this.popupObj.refreshPosition(imageElement);\n                this.popupObj.element.style.display = 'block';\n            }\n        }\n    };\n    /**\n     * Called when drop image upload was failed\n     *\n     * @param {HTMLElement} imgEle - specifies the image element.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {Object} e - specfies the object.\n     * @returns {void}\n     */\n    Image.prototype.uploadFailure = function (imgEle, args, e) {\n        detach(imgEle);\n        if (this.popupObj) {\n            this.popupObj.close();\n        }\n        this.parent.trigger(events.imageUploadFailed, e);\n        this.uploadObj.destroy();\n    };\n    /**\n     * Called when drop image upload was successful\n     *\n     * @param {HTMLElement} imageElement - specifies the image element.\n     * @param {DragEvent} dragEvent - specifies the drag event.\n     * @param {IShowPopupArgs} args - specifies the arguments.\n     * @param {ImageSuccessEventArgs} e - specifies the success event.\n     * @returns {void}\n     */\n    Image.prototype.uploadSuccess = function (imageElement, dragEvent, args, e) {\n        var _this = this;\n        imageElement.style.opacity = '1';\n        imageElement.classList.add(classes.CLS_IMG_FOCUS);\n        e.element = imageElement;\n        this.parent.trigger(events.imageUploadSuccess, e, function (e) {\n            if (!isNullOrUndefined(_this.parent.insertImageSettings.path)) {\n                var url = _this.parent.insertImageSettings.path + e.file.name;\n                imageElement.src = url;\n                imageElement.setAttribute('alt', e.file.name);\n            }\n        });\n        if (this.popupObj) {\n            this.popupObj.close();\n            this.uploadObj.destroy();\n        }\n        this.showImageQuickToolbar(args);\n        this.resizeStart(dragEvent, imageElement);\n    };\n    Image.prototype.imagePaste = function (args) {\n        var _this = this;\n        if (args.text.length === 0 && !isNullOrUndefined(args.file)) {\n            // eslint-disable-next-line\n            var proxy_1 = this;\n            var reader_2 = new FileReader();\n            args.args.preventDefault();\n            // eslint-disable-next-line\n            reader_2.addEventListener('load', function (e) {\n                var url = {\n                    cssClass: (proxy_1.parent.insertImageSettings.display === 'inline' ? classes.CLS_IMGINLINE : classes.CLS_IMGBREAK),\n                    url: _this.parent.insertImageSettings.saveFormat === 'Base64' || !isNullOrUndefined(args.callBack) ?\n                        reader_2.result : URL.createObjectURL(convertToBlob(reader_2.result)),\n                    width: {\n                        width: proxy_1.parent.insertImageSettings.width, minWidth: proxy_1.parent.insertImageSettings.minWidth,\n                        maxWidth: proxy_1.parent.getInsertImgMaxWidth()\n                    },\n                    height: {\n                        height: proxy_1.parent.insertImageSettings.height, minHeight: proxy_1.parent.insertImageSettings.minHeight,\n                        maxHeight: proxy_1.parent.insertImageSettings.maxHeight\n                    }\n                };\n                if (!isNullOrUndefined(args.callBack)) {\n                    args.callBack(url);\n                    return;\n                }\n                else {\n                    proxy_1.parent.formatter.process(proxy_1.parent, { item: { command: 'Images', subCommand: 'Image' } }, args.args, url);\n                    _this.showPopupToolBar(args, url);\n                }\n            });\n            reader_2.readAsDataURL(args.file);\n        }\n    };\n    Image.prototype.showPopupToolBar = function (e, url) {\n        var _this = this;\n        var imageSrc = 'img[src=\"' + url.url + '\"]';\n        var imageElement = this.parent.inputElement.querySelector(imageSrc);\n        this.parent.quickToolbarModule.createQTBar('Image', 'MultiRow', this.parent.quickToolbarSettings.image, RenderType.ImageToolbar);\n        var args = {\n            args: e.args,\n            type: 'Images',\n            isNotify: undefined,\n            elements: imageElement\n        };\n        if (imageElement) {\n            setTimeout(function () {\n                _this.showImageQuickToolbar(args);\n                _this.resizeStart(e.args, imageElement);\n            }, 0);\n        }\n    };\n    /* eslint-disable */\n    /**\n     * Destroys the ToolBar.\n     *\n     * @method destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    /* eslint-enable */\n    Image.prototype.destroy = function () {\n        if (isNOU(this.parent)) {\n            return;\n        }\n        this.prevSelectedImgEle = undefined;\n        this.removeEventListener();\n    };\n    Image.prototype.moduleDestroy = function () {\n        this.parent = null;\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {void}\n     */\n    Image.prototype.getModuleName = function () {\n        return 'image';\n    };\n    return Image;\n}());\nexport { Image };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}