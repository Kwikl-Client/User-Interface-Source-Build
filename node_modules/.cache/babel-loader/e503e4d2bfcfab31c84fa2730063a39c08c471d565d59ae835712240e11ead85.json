{"ast":null,"code":"import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach, EventHandler } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\nimport * as CONSTANT from '../base/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\nvar HtmlEditor = /** @class */function () {\n  function HtmlEditor(parent, serviceLocator) {\n    this.rangeCollection = [];\n    this.isImageDelete = false;\n    this.parent = parent;\n    this.locator = serviceLocator;\n    this.renderFactory = this.locator.getService('rendererFactory');\n    this.xhtmlValidation = new XhtmlValidation(parent);\n    this.addEventListener();\n  }\n  /**\n   * Destroys the Markdown.\n   *\n   * @function destroy\n   * @returns {void}\n   * @hidden\n    */\n  HtmlEditor.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n  /**\n   * @param {string} value - specifies the string value\n   * @returns {void}\n   * @hidden\n    */\n  HtmlEditor.prototype.sanitizeHelper = function (value) {\n    value = sanitizeHelper(value, this.parent);\n    return value;\n  };\n  HtmlEditor.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.nodeSelectionObj = new NodeSelection();\n    this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n    this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n    this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n    this.parent.on(events.keyDown, this.onKeyDown, this);\n    this.parent.on(events.keyUp, this.onKeyUp, this);\n    this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n    this.parent.on(events.initialEnd, this.render, this);\n    this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n    this.parent.on(events.destroy, this.destroy, this);\n    this.parent.on(events.selectAll, this.selectAll, this);\n    this.parent.on(events.selectRange, this.selectRange, this);\n    this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n    this.parent.on(events.selectionSave, this.onSelectionSave, this);\n    this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n    this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n    this.parent.on(events.paste, this.onPaste, this);\n    this.parent.on(events.tableclass, this.isTableClassAdded, this);\n    this.parent.on(events.onHandleFontsizeChange, this.onHandleFontsizeChange, this);\n  };\n  HtmlEditor.prototype.updateReadOnly = function () {\n    if (this.parent.readonly) {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'false'\n      });\n      addClass([this.parent.element], classes.CLS_RTE_READONLY);\n    } else {\n      attributes(this.parent.contentModule.getEditPanel(), {\n        contenteditable: 'true'\n      });\n      removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n    }\n  };\n  HtmlEditor.prototype.onSelectionSave = function () {\n    var currentDocument = this.contentRenderer.getDocument();\n    var range = this.nodeSelectionObj.getRange(currentDocument);\n    this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n  };\n  HtmlEditor.prototype.onSelectionRestore = function (e) {\n    this.parent.isBlur = false;\n    if (isNOU(this.saveSelection) || isNOU(closest(this.saveSelection.range.startContainer.parentElement, \".e-img-caption\")) ? true : !(closest(this.saveSelection.range.startContainer.parentElement, \".e-img-caption\").getAttribute(\"contenteditable\") == \"false\")) {\n      this.contentRenderer.getEditPanel().focus();\n    }\n    if (isNullOrUndefined(e.items) || e.items) {\n      this.saveSelection.restore();\n    }\n  };\n  HtmlEditor.prototype.isTableClassAdded = function () {\n    var tableElement = this.parent.inputElement.querySelectorAll('table');\n    for (var i = 0; i < tableElement.length; i++) {\n      if (!tableElement[i].classList.contains('e-rte-table') && !tableElement[i].classList.contains('e-rte-paste-table')) {\n        tableElement[i].classList.add('e-rte-table');\n      }\n    }\n  };\n  HtmlEditor.prototype.onHandleFontsizeChange = function (e) {\n    var keyboardArgs = e.args;\n    var args = {\n      name: 'dropDownSelect'\n    };\n    args.item = {\n      command: 'Font',\n      subCommand: 'FontSize'\n    };\n    var items = this.parent.fontSize.items;\n    var activeElem;\n    if (this.parent.toolbarModule && this.parent.toolbarModule.dropDownModule && this.parent.toolbarModule.dropDownModule.fontSizeDropDown && !isNOU(this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent) && this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent !== '') {\n      activeElem = this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent;\n    } else {\n      var fontSizeValue = void 0;\n      var selection = this.parent.contentModule.getDocument().getSelection();\n      if (selection && selection.focusNode && selection.focusNode.parentElement) {\n        fontSizeValue = document.defaultView.getComputedStyle(selection.focusNode.parentElement, null).getPropertyValue('font-size');\n      } else {\n        fontSizeValue = this.parent.fontSize.width;\n      }\n      fontSizeValue = isNOU(fontSizeValue) ? this.parent.fontSize.width : fontSizeValue;\n      var actualTxtFontValues = fontSizeValue.match(/^([\\d.]+)(\\D+)$/);\n      var size_1 = parseInt(actualTxtFontValues[1], 10);\n      var unit = actualTxtFontValues[2];\n      var defaultFontValues = items[0].value.match(/^([\\d.]+)(\\D+)$/);\n      if (defaultFontValues[2] === unit) {\n        var index = items.findIndex(function (_a) {\n          var value = _a.value;\n          return parseInt(value, 10) >= size_1;\n        });\n        activeElem = items[index].text;\n      } else {\n        var convertedSize_1 = this.convertFontSize(size_1, unit, defaultFontValues[2]);\n        var index = items.findIndex(function (_a) {\n          var value = _a.value;\n          return parseInt(value, 10) >= convertedSize_1;\n        });\n        activeElem = items[index].text;\n      }\n    }\n    var fontIndex = items.findIndex(function (size) {\n      return size.text === activeElem;\n    });\n    if (keyboardArgs.action === 'increase-fontsize' && fontIndex !== -1) {\n      if (fontIndex >= items.length - 1) {\n        var fontValues = items[fontIndex].value.match(/^([\\d.]+)(\\D+)$/);\n        if (fontValues) {\n          var size = parseInt(fontValues[1], 10);\n          var unit = fontValues[2];\n          var roundedSize = size % 10 === 0 ? Math.ceil((size + 1) / 10) * 10 : Math.ceil(size / 10) * 10;\n          args.item.value = roundedSize.toLocaleString() + unit;\n          args.item.text = roundedSize.toLocaleString() + ' ' + unit;\n        }\n        this.parent.fontSize.items.push(args.item);\n      } else {\n        args.item.value = items[fontIndex + 1].value;\n        args.item.text = items[fontIndex + 1].text;\n      }\n    } else if (keyboardArgs.action === 'decrease-fontsize' && fontIndex !== -1 && fontIndex > 0) {\n      args.item.value = items[fontIndex - 1].value;\n      args.item.text = items[fontIndex - 1].text;\n    } else {\n      if (fontIndex >= 0 && fontIndex < items.length && items[fontIndex]) {\n        args.item.value = items[fontIndex].value;\n        args.item.text = items[fontIndex].text;\n      }\n    }\n    this.parent.formatter.process(this.parent, args, keyboardArgs);\n  };\n  HtmlEditor.prototype.convertFontSize = function (value, originalUnit, targetUnit) {\n    if (CONSTANT.supportedUnits.indexOf(originalUnit) !== -1 || CONSTANT.supportedUnits.indexOf(targetUnit) !== -1) {\n      originalUnit = 'px';\n    }\n    var convertedValue = value * CONSTANT.conversionFactors[originalUnit][targetUnit];\n    return convertedValue;\n  };\n  HtmlEditor.prototype.onKeyUp = function (e) {\n    var args = e.args;\n    var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n    var range = this.parent.getRange();\n    // eslint-disable-next-line\n    var regEx = new RegExp(String.fromCharCode(8203), 'g');\n    var pointer;\n    var isRootParent = false;\n    if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n      pointer = range.startOffset;\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      range.startContainer.nodeName === '#text' ? range.startContainer.parentElement !== this.parent.inputElement ? range.startContainer.parentElement.classList.add('currentStartMark') : isRootParent = true : range.startContainer.classList.add('currentStartMark');\n      if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n        var previousLength_1 = range.startContainer.textContent.length;\n        var previousRange = range.startOffset;\n        range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n        pointer = previousRange === 0 ? previousRange : previousRange - (previousLength_1 - range.startContainer.textContent.length);\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n      var previousLength = this.parent.inputElement.innerHTML.length;\n      var currentLength = this.parent.inputElement.innerHTML.replace(regEx, '').length;\n      var focusNode = range.startContainer;\n      if (previousLength > currentLength && !isRootParent) {\n        if (focusNode.textContent.trim().length !== 0 && focusNode.previousSibling) {\n          var tempSpan = document.createElement('span');\n          tempSpan.className = 'tempSpan';\n          range.insertNode(tempSpan);\n        }\n        var currentChild = this.parent.inputElement.firstChild;\n        while (!isNOU(currentChild) && currentChild.textContent.replace(regEx, '').trim().length > 0) {\n          currentChild.innerHTML = currentChild.innerHTML.replace(regEx, '');\n          currentChild = currentChild.nextElementSibling;\n        }\n        var tempSpanToRemove = this.parent.inputElement.querySelector('.tempSpan');\n        if (tempSpanToRemove && tempSpanToRemove.previousSibling && focusNode.textContent.trim().length !== 0) {\n          focusNode = tempSpanToRemove.previousSibling;\n          pointer = tempSpanToRemove.previousSibling.textContent.length;\n          var parentElement = tempSpanToRemove.parentNode;\n          parentElement.removeChild(tempSpanToRemove);\n          tempSpanToRemove = null;\n        }\n        var currentChildNode = this.parent.inputElement.querySelector('.currentStartMark').childNodes;\n        if (currentChildNode.length > 1) {\n          for (var i = 0; i < currentChildNode.length; i++) {\n            if (currentChildNode[i].nodeName === '#text' && currentChildNode[i].textContent.length === 0) {\n              detach(currentChildNode[i]);\n              i--;\n            }\n            if (!isNOU(currentChildNode[i]) && focusNode.textContent.replace(regEx, '') === currentChildNode[i].textContent) {\n              pointer = focusNode.textContent.length > 1 ? focusNode.textContent === currentChildNode[i].textContent ? pointer : pointer - (focusNode.textContent.length - focusNode.textContent.replace(regEx, '').length) : focusNode.textContent.length;\n              focusNode = currentChildNode[i];\n            }\n          }\n        } else if (currentChildNode.length === 1) {\n          if (focusNode.textContent.replace(regEx, '') === currentChildNode[0].textContent) {\n            focusNode = currentChildNode[0];\n          }\n        }\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), focusNode, pointer);\n      }\n      var currentElem = this.parent.inputElement.querySelector('.currentStartMark');\n      if (!isNOU(currentElem)) {\n        currentElem.classList.remove('currentStartMark');\n        if (currentElem.getAttribute('class').trim() === '') {\n          currentElem.removeAttribute('class');\n        }\n      }\n      if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) && range.startContainer.parentElement === range.startContainer.previousSibling.parentElement && range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 && range.startContainer.previousSibling.textContent.length <= 1) {\n        range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n      }\n      if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n        pointer = range.startOffset;\n        range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n      }\n    }\n  };\n  HtmlEditor.prototype.onKeyDown = function (e) {\n    var _this = this;\n    var currentRange;\n    var args = e.args;\n    if (Browser.info.name === 'chrome') {\n      currentRange = this.parent.getRange();\n      this.backSpaceCleanup(e, currentRange);\n      this.deleteCleanup(e, currentRange);\n    }\n    if (args.keyCode === 9 && this.parent.enableTabKey) {\n      if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n        if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') || closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n          args.preventDefault();\n          if (!args.shiftKey) {\n            InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n            this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n          } else if (this.rangeCollection.length > 0 && this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n            var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n            this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n            InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n            this.rangeCollection.pop();\n          }\n        }\n      }\n    }\n    if (e.args.action === 'space' || e.args.action === 'enter' || e.args.keyCode === 13) {\n      this.spaceLink(e.args);\n      if (this.parent.editorMode === 'HTML' && !this.parent.readonly) {\n        var currentLength = this.parent.getText().trim().replace(/(\\r\\n|\\n|\\r|\\t)/gm, '').replace(/\\u200B/g, '').length;\n        var selectionLength = this.parent.getSelection().length;\n        var totalLength = currentLength - selectionLength + 1;\n        if (!(this.parent.maxLength === -1 || totalLength <= this.parent.maxLength) && e.args.keyCode === 13) {\n          e.args.preventDefault();\n          return;\n        } else {\n          this.parent.notify(events.enterHandler, {\n            args: e.args\n          });\n          var newRange = this.parent.getRange();\n          if (!isNOU(newRange.startContainer) && newRange.startContainer === this.parent.inputElement.lastChild && newRange.startContainer.nodeName !== '#text' && this.parent.height !== 'auto') {\n            newRange.startContainer.scrollIntoView({\n              block: \"end\",\n              inline: \"nearest\"\n            });\n          }\n        }\n      }\n    }\n    if (e.args.action === 'space') {\n      var currentRange_1 = this.parent.getRange();\n      var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n      var orderedList_1 = this.isOrderedList(editorValue);\n      var unOrderedList = this.isUnOrderedList(editorValue);\n      if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n        var eventArgs_1 = {\n          callBack: null,\n          event: e.args,\n          name: 'keydown-handler'\n        };\n        var actionBeginArgs = {\n          cancel: false,\n          item: {\n            command: 'Lists',\n            subCommand: orderedList_1 ? 'OL' : 'UL'\n          },\n          name: 'actionBegin',\n          originalEvent: e.args,\n          requestType: orderedList_1 ? 'OL' : 'UL'\n        };\n        this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n          if (!actionBeginArgs.cancel) {\n            _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n            _this.parent.trigger(events.actionComplete, {\n              editorMode: _this.parent.editorMode,\n              elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n              event: e.args,\n              name: events.actionComplete,\n              range: _this.parent.getRange(),\n              requestType: orderedList_1 ? 'OL' : 'UL'\n            });\n          }\n        });\n      }\n    }\n    if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) || !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.rangeElement = null;\n      this.oldRangeElement = null;\n      this.deleteRangeElement = null;\n      this.deleteOldRangeElement = null;\n      if (!this.isImageDelete) {\n        args.preventDefault();\n      }\n      args.preventDefault();\n    }\n  };\n  HtmlEditor.prototype.isOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < olListStartRegex.length; i++) {\n        if (olListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n  HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n    editorValue = editorValue.replace(/\\u200B/g, '');\n    var ulListStartRegex = [/^[*]$/, /^[-]$/];\n    if (!isNullOrUndefined(editorValue)) {\n      for (var i = 0; i < ulListStartRegex.length; i++) {\n        if (ulListStartRegex[i].test(editorValue)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  };\n  HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n    var isLiElement = false;\n    var isPreviousNotContentEditable = true;\n    if (!isNOU(currentRange.startContainer.previousSibling) && currentRange.startContainer.previousSibling.nodeName === 'SPAN') {\n      isPreviousNotContentEditable = currentRange.startContainer.previousSibling.contentEditable === 'false' ? false : true;\n    }\n    if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 && currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH' && isPreviousNotContentEditable) {\n      var checkNode = currentRange.startContainer.nodeName === '#text' ? currentRange.startContainer.parentElement : currentRange.startContainer;\n      if (!this.parent.formatter.editorManager.domNode.isBlockNode(checkNode) && !isNOU(checkNode.previousSibling) && checkNode.previousSibling.nodeName === 'BR' || !isNOU(currentRange.startContainer.previousSibling) && currentRange.startContainer.previousSibling.nodeName === 'BR') {\n        return;\n      }\n      this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n      if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n        var liElement = this.getRangeLiNode(currentRange.startContainer);\n        if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n          this.oldRangeElement = liElement.previousElementSibling.lastElementChild.nodeName === 'BR' ? liElement.previousElementSibling : liElement.previousElementSibling.lastElementChild;\n          if (!isNullOrUndefined(liElement.lastElementChild) && liElement.lastElementChild.nodeName !== 'BR') {\n            this.rangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.rangeElement = liElement;\n          }\n        }\n      } else if (this.rangeElement === this.parent.inputElement || this.rangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.rangeElement.previousElementSibling) && this.rangeElement.previousElementSibling.tagName === 'TABLE') {\n        return;\n      } else {\n        this.oldRangeElement = this.rangeElement.previousElementSibling;\n      }\n      if (isNullOrUndefined(this.oldRangeElement)) {\n        return;\n      } else {\n        if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n          this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild ? this.oldRangeElement.lastElementChild.lastElementChild : this.oldRangeElement.lastElementChild;\n        }\n        var lastNode = this.oldRangeElement.lastChild;\n        while (lastNode.nodeType !== 3 && lastNode.nodeName !== '#text' && lastNode.nodeName !== 'BR') {\n          lastNode = lastNode.lastChild;\n        }\n        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),\n        // eslint-disable-next-line\n        lastNode, lastNode.textContent.length);\n        if (this.oldRangeElement.querySelectorAll('BR').length === 1) {\n          detach(this.oldRangeElement.querySelector('BR'));\n        }\n        if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n          while (this.rangeElement.firstChild) {\n            this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n          }\n          // eslint-disable-next-line\n          !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n          this.oldRangeElement.normalize();\n        }\n      }\n    }\n  };\n  HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n    var isLiElement = false;\n    var liElement;\n    var rootElement;\n    if (e.args.code === 'Delete' && e.args.keyCode === 46 && this.parent.contentModule.getText().trim().replace(/(\\r\\n|\\n|\\r|\\t)/gm, '').replace(/\\u200B/g, '').length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n      this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n      if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n        liElement = this.getRangeLiNode(currentRange.startContainer);\n        if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0 && !liElement.nextElementSibling.querySelector('BR')) {\n          if (!isNullOrUndefined(liElement.lastElementChild)) {\n            this.deleteRangeElement = liElement.lastElementChild;\n            isLiElement = true;\n          } else {\n            this.deleteRangeElement = liElement;\n          }\n        } else {\n          this.deleteRangeElement = this.getRangeElement(liElement);\n        }\n      } else if (this.deleteRangeElement.nodeType === 3 || this.deleteRangeElement.tagName === 'TABLE' || !isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE') {\n        return;\n      }\n      if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n        if (!isNullOrUndefined(liElement)) {\n          if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n            this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n          } else {\n            this.deleteOldRangeElement = rootElement.nextElementSibling;\n          }\n        } else {\n          this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n        }\n        if (isNullOrUndefined(this.deleteOldRangeElement)) {\n          return;\n        } else {\n          if (currentRange.startOffset === 0 && currentRange.endOffset === 1 && this.deleteRangeElement.childNodes[0].nodeName === 'IMG') {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement, 0, 1);\n            this.isImageDelete = true;\n          } else {\n            this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n            this.isImageDelete = false;\n          }\n          var brNode = this.deleteRangeElement.querySelector('BR');\n          if (brNode && brNode.classList.contains('e-rte-image-remove-focus')) {\n            removeClass([brNode], ['e-rte-image-focus']);\n            return;\n          } else if (brNode) {\n            detach(brNode);\n          }\n          if (!isNullOrUndefined(this.deleteRangeElement) && this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL' && this.deleteOldRangeElement !== this.deleteRangeElement) {\n            while (this.deleteOldRangeElement.firstChild) {\n              this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n            }\n            if (!isLiElement) {\n              detach(this.deleteOldRangeElement);\n            } else {\n              detach(this.deleteOldRangeElement.parentElement);\n            }\n            this.deleteRangeElement.normalize();\n          } else {\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n          }\n        }\n      } else {\n        this.deleteRangeElement = null;\n      }\n    }\n  };\n  HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n    var position = 0;\n    if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n      var preCaretRange = currentRange.cloneRange();\n      preCaretRange.selectNodeContents(element);\n      preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n      position = preCaretRange.toString().length;\n    }\n    return position;\n  };\n  HtmlEditor.prototype.getRangeElement = function (element) {\n    var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ? element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling : element : element.lastElementChild : element;\n    return rangeElement;\n  };\n  HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n    // eslint-disable-next-line\n    for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n      if (rangeBlockNode.parentElement === this.parent.inputElement) {\n        break;\n      } else {\n        rangeBlockNode = rangeBlockNode.parentElement;\n      }\n    }\n    return rangeBlockNode;\n  };\n  HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n    var node = rangeLiNode.parentElement;\n    while (node !== this.parent.inputElement) {\n      if (node.nodeType === 1 && node.tagName === 'LI') {\n        break;\n      }\n      node = node.parentElement;\n    }\n    return node;\n  };\n  HtmlEditor.prototype.onPaste = function (e) {\n    // eslint-disable-next-line\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n    if (e.text.match(regex)) {\n      if (e.isWordPaste) {\n        return;\n      }\n      e.args.preventDefault();\n      var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n      // eslint-disable-next-line\n      var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n      // eslint-disable-next-line\n      var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n      var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n      var enterSplitText = e.text.split('\\n');\n      var contentInnerElem = '';\n      for (var i = 0; i < enterSplitText.length; i++) {\n        if (enterSplitText[i].trim() === '') {\n          contentInnerElem += getDefaultValue(this.parent);\n        } else {\n          var contentWithSpace = '';\n          var spaceBetweenContent = true;\n          var spaceSplit = enterSplitText[i].split(' ');\n          for (var j = 0; j < spaceSplit.length; j++) {\n            if (spaceSplit[j].trim() === '') {\n              contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n            } else {\n              spaceBetweenContent = false;\n              contentWithSpace += spaceSplit[j] + ' ';\n            }\n          }\n          if (i === 0) {\n            contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n          } else {\n            contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n          }\n        }\n      }\n      var divElement = this.parent.createElement('div');\n      divElement.setAttribute('class', 'pasteContent');\n      divElement.style.display = 'inline';\n      divElement.innerHTML = contentInnerElem.replace('&para', '&amp;para');\n      var paraElem = divElement.querySelectorAll('span, p');\n      for (var i = 0; i < paraElem.length; i++) {\n        var splitTextContent = paraElem[i].innerHTML.split(' ');\n        var resultSplitContent = '';\n        for (var j = 0; j < splitTextContent.length; j++) {\n          if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n            resultSplitContent += '<a class=\"e-rte-anchor\" href=\"' + splitTextContent[j] + '\" title=\"' + splitTextContent[j] + '\" target=\"_blank\"' + ' aria-label=\"' + this.parent.serviceLocator.getService('rteLocale').getConstant(\"linkAriaLabel\") + '\">' + splitTextContent[j] + ' </a>';\n          } else {\n            resultSplitContent += splitTextContent[j] + ' ';\n          }\n        }\n        paraElem[i].innerHTML = resultSplitContent.trim();\n      }\n      if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n        e.callBack(divElement.innerHTML);\n      } else {\n        this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n      }\n    }\n  };\n  HtmlEditor.prototype.spaceLink = function (e) {\n    var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n    var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n    var text = range.startContainer.textContent.substr(0, range.endOffset);\n    var splitText = text.split(' ');\n    var urlText = splitText[splitText.length - 1];\n    var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n    urlText = urlText.slice(0, urlTextRange);\n    // eslint-disable-next-line\n    var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n    if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n      var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n      var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n      var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n      var value = {\n        url: url,\n        selection: selection,\n        selectParent: selectParent,\n        text: urlText,\n        title: '',\n        target: '_blank'\n      };\n      this.parent.formatter.process(this.parent, {\n        item: {\n          'command': 'Links',\n          'subCommand': 'CreateLink'\n        }\n      }, e, value);\n    }\n  };\n  HtmlEditor.prototype.mouseOutHandler = function () {\n    if (!isNOU(this.tooltipTargetEle)) {\n      this.tooltipTargetEle.setAttribute('title', this.tooltipTargetEle.getAttribute('data-title'));\n    } else {\n      var currentDocument = this.parent.iframeSettings.enable ? this.parent.contentModule.getPanel().ownerDocument : this.parent.contentModule.getDocument();\n      this.tooltipTargetEle = currentDocument.querySelector('[data-title]');\n      this.tooltipTargetEle.setAttribute('title', this.tooltipTargetEle.getAttribute('data-title'));\n    }\n    this.tooltipTargetEle.removeAttribute('data-title');\n    EventHandler.remove(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler);\n  };\n  HtmlEditor.prototype.onToolbarClick = function (args) {\n    var _this = this;\n    var save;\n    var selectNodeEle;\n    var selectParentEle;\n    var item = args.item;\n    var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n    var currentDocument = this.parent.iframeSettings.enable ? this.parent.contentModule.getPanel().ownerDocument : this.parent.contentModule.getDocument();\n    this.tooltipTargetEle = closest(args.originalEvent.target, '[data-tooltip-id]');\n    if (!isNOU(this.tooltipTargetEle) && this.parent.showTooltip && !isNOU(currentDocument.querySelector('.e-tooltip-wrap'))) {\n      this.parent.notify(events.destroyTooltip, {\n        args: event\n      });\n      this.tooltipTargetEle.setAttribute('data-title', this.tooltipTargetEle.getAttribute('title'));\n      this.tooltipTargetEle.removeAttribute('title');\n      EventHandler.add(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler, this);\n    }\n    if (item.command !== 'FormatPainter') {\n      if (closestElement && !closestElement.classList.contains('e-rte-inline-popup') && !closestElement.classList.contains('e-rte-text-popup')) {\n        if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n          if (isIDevice() && item.command === 'Images') {\n            this.nodeSelectionObj.restore();\n          }\n          var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n          save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n          selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n          selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n        }\n        if (item.command === 'Images') {\n          this.parent.notify(events.imageToolbarAction, {\n            member: 'image',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n        }\n        if (item.command === 'Audios') {\n          this.parent.notify(events.audioToolbarAction, {\n            member: 'audio',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n        }\n        if (item.command === 'Videos') {\n          this.parent.notify(events.videoToolbarAction, {\n            member: 'video',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n        }\n        if (item.command === 'Links') {\n          this.parent.notify(events.linkToolbarAction, {\n            member: 'link',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n        }\n        if (item.command === 'Table') {\n          this.parent.notify(events.tableToolbarAction, {\n            member: 'table',\n            args: args,\n            selectNode: selectNodeEle,\n            selection: save,\n            selectParent: selectParentEle\n          });\n        }\n      } else {\n        var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n        var imageDialog = document.getElementById(this.parent.getID() + '_image');\n        if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' || item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n          var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n          if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n            save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n          }\n          selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n          selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n        }\n        switch (item.subCommand) {\n          case 'Maximize':\n            this.parent.notify(events.enableFullScreen, {\n              args: args\n            });\n            break;\n          case 'Minimize':\n            this.parent.notify(events.disableFullScreen, {\n              args: args\n            });\n            break;\n          case 'CreateLink':\n            this.parent.notify(events.insertLink, {\n              member: 'link',\n              args: args,\n              selectNode: selectNodeEle,\n              selection: save,\n              selectParent: selectParentEle\n            });\n            break;\n          case 'RemoveLink':\n            this.parent.notify(events.unLink, {\n              member: 'link',\n              args: args,\n              selectNode: selectNodeEle,\n              selection: save,\n              selectParent: selectParentEle\n            });\n            break;\n          case 'Print':\n            this.parent.print();\n            break;\n          case 'Image':\n            this.parent.notify(events.insertImage, {\n              member: 'image',\n              args: args,\n              selectNode: selectNodeEle,\n              selection: save,\n              selectParent: selectParentEle\n            });\n            break;\n          case 'Audio':\n            this.parent.notify(events.insertAudio, {\n              member: 'audio',\n              args: args,\n              selectNode: selectNodeEle,\n              selection: save,\n              selectParent: selectParentEle\n            });\n            break;\n          case 'Video':\n            this.parent.notify(events.insertVideo, {\n              member: 'video',\n              args: args,\n              selectNode: selectNodeEle,\n              selection: save,\n              selectParent: selectParentEle\n            });\n            break;\n          case 'CreateTable':\n            this.parent.notify(events.createTable, {\n              member: 'table',\n              args: args,\n              selection: save\n            });\n            break;\n          case 'SourceCode':\n            this.parent.notify(events.sourceCode, {\n              member: 'viewSource',\n              args: args\n            });\n            break;\n          case 'Preview':\n            this.parent.notify(events.updateSource, {\n              member: 'updateSource',\n              args: args\n            });\n            break;\n          case 'FontColor':\n          case 'BackgroundColor':\n            break;\n          case 'File':\n            this.parent.notify(events.renderFileManager, {\n              member: 'fileManager',\n              args: args,\n              selectNode: selectNodeEle,\n              selection: save,\n              selectParent: selectParentEle\n            });\n            break;\n          case 'EmojiPicker':\n            this.parent.notify(events.emojiPicker, {\n              member: 'emojiPicker',\n              args: args\n            });\n            break;\n          default:\n            this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n            break;\n        }\n      }\n    } else {\n      if (args.originalEvent.detail === 1) {\n        clearTimeout(this.clickTimeout);\n        this.clickTimeout = setTimeout(function () {\n          _this.parent.notify(events.formatPainterClick, {\n            member: 'formatPainter',\n            args: args\n          });\n        }, 200);\n      } else {\n        clearTimeout(this.clickTimeout);\n        this.parent.notify(events.formatPainterDoubleClick, {\n          member: 'formatPainter',\n          args: args\n        });\n      }\n    }\n  };\n  HtmlEditor.prototype.renderColorPicker = function (args) {\n    this.colorPickerModule.renderColorPickerInput(args);\n  };\n  HtmlEditor.prototype.instantiateRenderer = function () {\n    if (this.parent.iframeSettings.enable) {\n      this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n    } else {\n      this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n    }\n  };\n  HtmlEditor.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n    this.parent.off(events.initialEnd, this.render);\n    this.parent.off(events.modelChanged, this.onPropertyChanged);\n    this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n    this.parent.off(events.renderColorPicker, this.renderColorPicker);\n    this.parent.off(events.destroy, this.destroy);\n    this.parent.off(events.keyDown, this.onKeyDown);\n    this.parent.off(events.initialLoad, this.instantiateRenderer);\n    this.parent.off(events.selectAll, this.selectAll);\n    this.parent.off(events.selectRange, this.selectRange);\n    this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n    this.parent.off(events.selectionSave, this.onSelectionSave);\n    this.parent.off(events.selectionRestore, this.onSelectionRestore);\n    this.parent.off(events.readOnlyMode, this.updateReadOnly);\n    this.parent.off(events.paste, this.onPaste);\n    this.parent.off(events.tableclass, this.isTableClassAdded);\n  };\n  HtmlEditor.prototype.render = function () {\n    this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n    var editElement = this.contentRenderer.getEditPanel();\n    var option = {\n      undoRedoSteps: this.parent.undoRedoSteps,\n      undoRedoTimer: this.parent.undoRedoTimer\n    };\n    if (isNullOrUndefined(this.parent.formatter)) {\n      var formatterClass = new HTMLFormatter({\n        currentDocument: this.contentRenderer.getDocument(),\n        element: editElement,\n        options: option,\n        formatPainterSettings: this.parent.formatPainterSettings\n      });\n      this.parent.setProperties({\n        formatter: formatterClass\n      }, true);\n    } else {\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n    if (this.parent.enableXhtml) {\n      this.parent.notify(events.xhtmlValidation, {});\n    }\n    if (this.parent.toolbarSettings.enable) {\n      this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n    }\n    if (this.parent.inlineMode.enable) {\n      if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n        editElement.style.fontFamily = this.parent.fontFamily.default;\n      }\n      if (!isNullOrUndefined(this.parent.fontSize.default)) {\n        editElement.style.fontSize = this.parent.fontSize.default;\n      }\n    }\n    this.parent.notify(events.bindOnEnd, {});\n  };\n  /**\n   * Called internally if any of the property value changed.\n   *\n   * @param {RichTextEditorModel} e - specifies the editor model\n   * @returns {void}\n   * @hidden\n    */\n  HtmlEditor.prototype.onPropertyChanged = function (e) {\n    // On property code change here\n    if (!isNOU(e) && !isNOU(e.newProp.toolbarSettings) && !isNOU(e.newProp.toolbarSettings.enable)) {\n      this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n    }\n    if (!isNullOrUndefined(e.newProp.formatter)) {\n      var editElement = this.contentRenderer.getEditPanel();\n      var option = {\n        undoRedoSteps: this.parent.undoRedoSteps,\n        undoRedoTimer: this.parent.undoRedoTimer\n      };\n      this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n    }\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} - returns the string value\n   * @hidden\n   */\n  HtmlEditor.prototype.getModuleName = function () {\n    return 'htmlEditor';\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n  HtmlEditor.prototype.selectAll = function () {\n    var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n    if (nodes.length > 0) {\n      this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n    }\n  };\n  /**\n   * For selecting all content in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @private\n   * @hidden\n   */\n  HtmlEditor.prototype.selectRange = function (e) {\n    this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n  };\n  /**\n   * For get a selected text in RTE\n   *\n   * @param {NotifyArgs} e - specifies the notified arguments\n   * @returns {void}\n   * @hidden\n   */\n  HtmlEditor.prototype.getSelectedHtml = function (e) {\n    e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n  };\n  return HtmlEditor;\n}();\nexport { HtmlEditor };","map":{"version":3,"names":["events","isNullOrUndefined","closest","attributes","removeClass","addClass","Browser","detach","EventHandler","isNOU","HTMLFormatter","RenderType","classes","HtmlToolbarStatus","IframeContentRender","ContentRender","ColorPickerInput","NodeSelection","InsertHtml","getTextNodesUnder","sanitizeHelper","getDefaultValue","isIDevice","XhtmlValidation","ON_BEGIN","CONSTANT","HtmlEditor","parent","serviceLocator","rangeCollection","isImageDelete","locator","renderFactory","getService","xhtmlValidation","addEventListener","prototype","destroy","removeEventListener","value","isDestroyed","nodeSelectionObj","colorPickerModule","on","initialLoad","instantiateRenderer","htmlToolbarClick","onToolbarClick","keyDown","onKeyDown","keyUp","onKeyUp","renderColorPicker","initialEnd","render","modelChanged","onPropertyChanged","selectAll","selectRange","getSelectedHtml","selectionSave","onSelectionSave","selectionRestore","onSelectionRestore","readOnlyMode","updateReadOnly","paste","onPaste","tableclass","isTableClassAdded","onHandleFontsizeChange","readonly","contentModule","getEditPanel","contenteditable","element","CLS_RTE_READONLY","currentDocument","contentRenderer","getDocument","range","getRange","saveSelection","save","e","isBlur","startContainer","parentElement","getAttribute","focus","items","restore","tableElement","inputElement","querySelectorAll","i","length","classList","contains","add","keyboardArgs","args","name","item","command","subCommand","fontSize","activeElem","toolbarModule","dropDownModule","fontSizeDropDown","textContent","fontSizeValue","selection","getSelection","focusNode","document","defaultView","getComputedStyle","getPropertyValue","width","actualTxtFontValues","match","size_1","parseInt","unit","defaultFontValues","index","findIndex","_a","text","convertedSize_1","convertFontSize","fontIndex","size","action","fontValues","roundedSize","Math","ceil","toLocaleString","push","formatter","process","originalUnit","targetUnit","supportedUnits","indexOf","convertedValue","conversionFactors","restrictKeys","regEx","RegExp","String","fromCharCode","pointer","isRootParent","keyCode","shiftKey","ctrlKey","altKey","startOffset","nodeName","charCodeAt","previousLength_1","previousRange","replace","editorManager","nodeSelection","setCursorPoint","previousLength","innerHTML","currentLength","trim","previousSibling","tempSpan","createElement","className","insertNode","currentChild","firstChild","nextElementSibling","tempSpanToRemove","querySelector","parentNode","removeChild","currentChildNode","childNodes","currentElem","remove","removeAttribute","endContainer","endOffset","_this","currentRange","info","backSpaceCleanup","deleteCleanup","enableTabKey","target","getParentNodeCollection","preventDefault","Insert","textCont","setSelectionText","createTextNode","pop","spaceLink","editorMode","getText","selectionLength","totalLength","maxLength","notify","enterHandler","newRange","lastChild","height","scrollIntoView","block","inline","currentRange_1","editorValue","slice","orderedList_1","isOrderedList","unOrderedList","isUnOrderedList","eventArgs_1","callBack","event","actionBeginArgs","cancel","originalEvent","requestType","trigger","actionBegin","observer","actionComplete","elements","domNode","blockNodes","rangeElement","oldRangeElement","deleteRangeElement","deleteOldRangeElement","tagName","olListStartRegex","test","ulListStartRegex","isLiElement","isPreviousNotContentEditable","contentEditable","code","checkNode","isBlockNode","getRootBlockNode","liElement","getRangeLiNode","previousElementSibling","childElementCount","lastElementChild","lastNode","nodeType","appendChild","normalize","rootElement","getRangeElement","getCaretIndex","brNode","position","rangeCount","preCaretRange","cloneRange","selectNodeContents","setEnd","toString","rangeBlockNode","rangeLiNode","node","regex","isWordPaste","httpRegex","wwwRegex","enterSplitText","split","contentInnerElem","contentWithSpace","spaceBetweenContent","spaceSplit","j","divElement","setAttribute","style","display","paraElem","splitTextContent","resultSplitContent","getConstant","pasteCleanupModule","execCommand","selectNodeEle","substr","splitText","urlText","urlTextRange","url","selectParent","title","mouseOutHandler","tooltipTargetEle","iframeSettings","enable","getPanel","ownerDocument","selectParentEle","closestElement","showTooltip","destroyTooltip","getNodeCollection","imageToolbarAction","member","selectNode","audioToolbarAction","videoToolbarAction","linkToolbarAction","tableToolbarAction","linkDialog","getElementById","getID","imageDialog","enableFullScreen","disableFullScreen","insertLink","unLink","print","insertImage","insertAudio","insertVideo","createTable","sourceCode","updateSource","renderFileManager","emojiPicker","detail","clearTimeout","clickTimeout","setTimeout","formatPainterClick","formatPainterDoubleClick","renderColorPickerInput","addRenderer","Content","off","getRenderer","editElement","option","undoRedoSteps","undoRedoTimer","formatterClass","options","formatPainterSettings","setProperties","updateFormatter","enableXhtml","toolbarSettings","toolbarUpdate","inlineMode","fontFamily","default","bindOnEnd","newProp","getModuleName","nodes","setRange"],"sources":["/Users/saleem/Desktop/KClient/Web App/Ver_3.6/User Interface/website_Source files/node_modules/@syncfusion/ej2-richtexteditor/src/rich-text-editor/actions/html-editor.js"],"sourcesContent":["import * as events from '../base/constant';\nimport { isNullOrUndefined, closest, attributes, removeClass, addClass, Browser, detach, EventHandler } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined as isNOU } from '@syncfusion/ej2-base';\nimport { HTMLFormatter } from '../formatter/html-formatter';\nimport { RenderType } from '../base/enum';\nimport * as classes from '../base/classes';\nimport { HtmlToolbarStatus } from './html-toolbar-status';\nimport { IframeContentRender } from '../renderer/iframe-content-renderer';\nimport { ContentRender } from '../renderer/content-renderer';\nimport { ColorPickerInput } from './color-picker';\nimport { NodeSelection } from '../../selection/selection';\nimport { InsertHtml } from '../../editor-manager/plugin/inserthtml';\nimport { getTextNodesUnder, sanitizeHelper, getDefaultValue } from '../base/util';\nimport { isIDevice } from '../../common/util';\nimport { XhtmlValidation } from './xhtml-validation';\nimport { ON_BEGIN } from './../../common/constant';\nimport * as CONSTANT from '../base/constant';\n/**\n * `HtmlEditor` module is used to HTML editor\n */\nvar HtmlEditor = /** @class */ (function () {\n    function HtmlEditor(parent, serviceLocator) {\n        this.rangeCollection = [];\n        this.isImageDelete = false;\n        this.parent = parent;\n        this.locator = serviceLocator;\n        this.renderFactory = this.locator.getService('rendererFactory');\n        this.xhtmlValidation = new XhtmlValidation(parent);\n        this.addEventListener();\n    }\n    /**\n     * Destroys the Markdown.\n     *\n     * @function destroy\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    /**\n     * @param {string} value - specifies the string value\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.sanitizeHelper = function (value) {\n        value = sanitizeHelper(value, this.parent);\n        return value;\n    };\n    HtmlEditor.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.nodeSelectionObj = new NodeSelection();\n        this.colorPickerModule = new ColorPickerInput(this.parent, this.locator);\n        this.parent.on(events.initialLoad, this.instantiateRenderer, this);\n        this.parent.on(events.htmlToolbarClick, this.onToolbarClick, this);\n        this.parent.on(events.keyDown, this.onKeyDown, this);\n        this.parent.on(events.keyUp, this.onKeyUp, this);\n        this.parent.on(events.renderColorPicker, this.renderColorPicker, this);\n        this.parent.on(events.initialEnd, this.render, this);\n        this.parent.on(events.modelChanged, this.onPropertyChanged, this);\n        this.parent.on(events.destroy, this.destroy, this);\n        this.parent.on(events.selectAll, this.selectAll, this);\n        this.parent.on(events.selectRange, this.selectRange, this);\n        this.parent.on(events.getSelectedHtml, this.getSelectedHtml, this);\n        this.parent.on(events.selectionSave, this.onSelectionSave, this);\n        this.parent.on(events.selectionRestore, this.onSelectionRestore, this);\n        this.parent.on(events.readOnlyMode, this.updateReadOnly, this);\n        this.parent.on(events.paste, this.onPaste, this);\n        this.parent.on(events.tableclass, this.isTableClassAdded, this);\n        this.parent.on(events.onHandleFontsizeChange, this.onHandleFontsizeChange, this);\n    };\n    HtmlEditor.prototype.updateReadOnly = function () {\n        if (this.parent.readonly) {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'false' });\n            addClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n        else {\n            attributes(this.parent.contentModule.getEditPanel(), { contenteditable: 'true' });\n            removeClass([this.parent.element], classes.CLS_RTE_READONLY);\n        }\n    };\n    HtmlEditor.prototype.onSelectionSave = function () {\n        var currentDocument = this.contentRenderer.getDocument();\n        var range = this.nodeSelectionObj.getRange(currentDocument);\n        this.saveSelection = this.nodeSelectionObj.save(range, currentDocument);\n    };\n    HtmlEditor.prototype.onSelectionRestore = function (e) {\n        this.parent.isBlur = false;\n        if (isNOU(this.saveSelection) || isNOU(closest(this.saveSelection.range.startContainer.parentElement, \".e-img-caption\")) ? true : !(closest(this.saveSelection.range.startContainer.parentElement, \".e-img-caption\").getAttribute(\"contenteditable\") == \"false\")) {\n            this.contentRenderer.getEditPanel().focus();\n        }\n        if (isNullOrUndefined(e.items) || e.items) {\n            this.saveSelection.restore();\n        }\n    };\n    HtmlEditor.prototype.isTableClassAdded = function () {\n        var tableElement = this.parent.inputElement.querySelectorAll('table');\n        for (var i = 0; i < tableElement.length; i++) {\n            if (!tableElement[i].classList.contains('e-rte-table') && !tableElement[i].classList.contains('e-rte-paste-table')) {\n                tableElement[i].classList.add('e-rte-table');\n            }\n        }\n    };\n    HtmlEditor.prototype.onHandleFontsizeChange = function (e) {\n        var keyboardArgs = e.args;\n        var args = { name: 'dropDownSelect' };\n        args.item = {\n            command: 'Font',\n            subCommand: 'FontSize'\n        };\n        var items = this.parent.fontSize.items;\n        var activeElem;\n        if (this.parent.toolbarModule && this.parent.toolbarModule.dropDownModule &&\n            this.parent.toolbarModule.dropDownModule.fontSizeDropDown && !isNOU(this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent) && this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent !== '') {\n            activeElem = this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent;\n        }\n        else {\n            var fontSizeValue = void 0;\n            var selection = this.parent.contentModule.getDocument().getSelection();\n            if (selection && selection.focusNode && selection.focusNode.parentElement) {\n                fontSizeValue = document.defaultView.getComputedStyle(selection.focusNode.parentElement, null).getPropertyValue('font-size');\n            }\n            else {\n                fontSizeValue = this.parent.fontSize.width;\n            }\n            fontSizeValue = isNOU(fontSizeValue) ? this.parent.fontSize.width : fontSizeValue;\n            var actualTxtFontValues = fontSizeValue.match(/^([\\d.]+)(\\D+)$/);\n            var size_1 = parseInt(actualTxtFontValues[1], 10);\n            var unit = actualTxtFontValues[2];\n            var defaultFontValues = items[0].value.match(/^([\\d.]+)(\\D+)$/);\n            if (defaultFontValues[2] === unit) {\n                var index = items.findIndex(function (_a) {\n                    var value = _a.value;\n                    return parseInt(value, 10) >= size_1;\n                });\n                activeElem = items[index].text;\n            }\n            else {\n                var convertedSize_1 = this.convertFontSize(size_1, unit, defaultFontValues[2]);\n                var index = items.findIndex(function (_a) {\n                    var value = _a.value;\n                    return parseInt(value, 10) >= convertedSize_1;\n                });\n                activeElem = items[index].text;\n            }\n        }\n        var fontIndex = items.findIndex(function (size) { return size.text === activeElem; });\n        if (keyboardArgs.action === 'increase-fontsize' && fontIndex !== -1) {\n            if (fontIndex >= items.length - 1) {\n                var fontValues = items[fontIndex].value.match(/^([\\d.]+)(\\D+)$/);\n                if (fontValues) {\n                    var size = parseInt(fontValues[1], 10);\n                    var unit = fontValues[2];\n                    var roundedSize = size % 10 === 0 ? Math.ceil((size + 1) / 10) * 10 : Math.ceil(size / 10) * 10;\n                    args.item.value = roundedSize.toLocaleString() + unit;\n                    args.item.text = roundedSize.toLocaleString() + ' ' + unit;\n                }\n                this.parent.fontSize.items.push(args.item);\n            }\n            else {\n                args.item.value = items[fontIndex + 1].value;\n                args.item.text = items[fontIndex + 1].text;\n            }\n        }\n        else if (keyboardArgs.action === 'decrease-fontsize' && fontIndex !== -1 && fontIndex > 0) {\n            args.item.value = items[fontIndex - 1].value;\n            args.item.text = items[fontIndex - 1].text;\n        }\n        else {\n            if (fontIndex >= 0 && fontIndex < items.length && items[fontIndex]) {\n                args.item.value = items[fontIndex].value;\n                args.item.text = items[fontIndex].text;\n            }\n        }\n        this.parent.formatter.process(this.parent, args, keyboardArgs);\n    };\n    HtmlEditor.prototype.convertFontSize = function (value, originalUnit, targetUnit) {\n        if (CONSTANT.supportedUnits.indexOf(originalUnit) !== -1 || CONSTANT.supportedUnits.indexOf(targetUnit) !== -1) {\n            originalUnit = 'px';\n        }\n        var convertedValue = value * CONSTANT.conversionFactors[originalUnit][targetUnit];\n        return convertedValue;\n    };\n    HtmlEditor.prototype.onKeyUp = function (e) {\n        var args = e.args;\n        var restrictKeys = [8, 9, 13, 16, 17, 18, 20, 27, 37, 38, 39, 40, 44, 45, 46, 91,\n            112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123];\n        var range = this.parent.getRange();\n        // eslint-disable-next-line\n        var regEx = new RegExp(String.fromCharCode(8203), 'g');\n        var pointer;\n        var isRootParent = false;\n        if (restrictKeys.indexOf(args.keyCode) < 0 && !args.shiftKey && !args.ctrlKey && !args.altKey) {\n            pointer = range.startOffset;\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            range.startContainer.nodeName === '#text' ? range.startContainer.parentElement !== this.parent.inputElement ? range.startContainer.parentElement.classList.add('currentStartMark')\n                : isRootParent = true : range.startContainer.classList.add('currentStartMark');\n            if (range.startContainer.textContent.charCodeAt(0) === 8203) {\n                var previousLength_1 = range.startContainer.textContent.length;\n                var previousRange = range.startOffset;\n                range.startContainer.textContent = range.startContainer.textContent.replace(regEx, '');\n                pointer = previousRange === 0 ? previousRange : previousRange - (previousLength_1 - range.startContainer.textContent.length);\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n            var previousLength = this.parent.inputElement.innerHTML.length;\n            var currentLength = this.parent.inputElement.innerHTML.replace(regEx, '').length;\n            var focusNode = range.startContainer;\n            if (previousLength > currentLength && !isRootParent) {\n                if (focusNode.textContent.trim().length !== 0 && focusNode.previousSibling) {\n                    var tempSpan = document.createElement('span');\n                    tempSpan.className = 'tempSpan';\n                    range.insertNode(tempSpan);\n                }\n                var currentChild = this.parent.inputElement.firstChild;\n                while (!isNOU(currentChild) && currentChild.textContent.replace(regEx, '').trim().length > 0) {\n                    currentChild.innerHTML = currentChild.innerHTML.replace(regEx, '');\n                    currentChild = currentChild.nextElementSibling;\n                }\n                var tempSpanToRemove = this.parent.inputElement.querySelector('.tempSpan');\n                if (tempSpanToRemove && tempSpanToRemove.previousSibling && focusNode.textContent.trim().length !== 0) {\n                    focusNode = tempSpanToRemove.previousSibling;\n                    pointer = tempSpanToRemove.previousSibling.textContent.length;\n                    var parentElement = tempSpanToRemove.parentNode;\n                    parentElement.removeChild(tempSpanToRemove);\n                    tempSpanToRemove = null;\n                }\n                var currentChildNode = this.parent.inputElement.querySelector('.currentStartMark').childNodes;\n                if (currentChildNode.length > 1) {\n                    for (var i = 0; i < currentChildNode.length; i++) {\n                        if (currentChildNode[i].nodeName === '#text' && currentChildNode[i].textContent.length === 0) {\n                            detach(currentChildNode[i]);\n                            i--;\n                        }\n                        if (!isNOU(currentChildNode[i]) && focusNode.textContent.replace(regEx, '') === currentChildNode[i].textContent) {\n                            pointer = focusNode.textContent.length > 1 ?\n                                (focusNode.textContent === currentChildNode[i].textContent ? pointer :\n                                    pointer - (focusNode.textContent.length - focusNode.textContent.replace(regEx, '').length)) :\n                                focusNode.textContent.length;\n                            focusNode = currentChildNode[i];\n                        }\n                    }\n                }\n                else if (currentChildNode.length === 1) {\n                    if (focusNode.textContent.replace(regEx, '') === currentChildNode[0].textContent) {\n                        focusNode = currentChildNode[0];\n                    }\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), focusNode, pointer);\n            }\n            var currentElem = this.parent.inputElement.querySelector('.currentStartMark');\n            if (!isNOU(currentElem)) {\n                currentElem.classList.remove('currentStartMark');\n                if (currentElem.getAttribute('class').trim() === '') {\n                    currentElem.removeAttribute('class');\n                }\n            }\n            if (!isNOU(range.startContainer.previousSibling) && !isNOU(range.startContainer.previousSibling.parentElement) &&\n                range.startContainer.parentElement === range.startContainer.previousSibling.parentElement &&\n                range.startContainer.previousSibling.textContent.charCodeAt(0) === 8203 &&\n                range.startContainer.previousSibling.textContent.length <= 1) {\n                range.startContainer.previousSibling.textContent = range.startContainer.previousSibling.textContent.replace(regEx, '');\n            }\n            if (range.endContainer.textContent.charCodeAt(range.endOffset) === 8203) {\n                pointer = range.startOffset;\n                range.endContainer.textContent = range.endContainer.textContent.replace(regEx, '');\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), range.startContainer, pointer);\n            }\n        }\n    };\n    HtmlEditor.prototype.onKeyDown = function (e) {\n        var _this = this;\n        var currentRange;\n        var args = e.args;\n        if (Browser.info.name === 'chrome') {\n            currentRange = this.parent.getRange();\n            this.backSpaceCleanup(e, currentRange);\n            this.deleteCleanup(e, currentRange);\n        }\n        if (args.keyCode === 9 && this.parent.enableTabKey) {\n            if (!isNOU(args.target) && isNullOrUndefined(closest(args.target, '.e-rte-toolbar'))) {\n                var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n                var parentNode = this.nodeSelectionObj.getParentNodeCollection(range);\n                if (!((parentNode[0].nodeName === 'LI' || closest(parentNode[0], 'li') ||\n                    closest(parentNode[0], 'table')) && range.startOffset === 0)) {\n                    args.preventDefault();\n                    if (!args.shiftKey) {\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), '&nbsp;&nbsp;&nbsp;&nbsp;');\n                        this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));\n                    }\n                    else if (this.rangeCollection.length > 0 &&\n                        this.rangeCollection[this.rangeCollection.length - 1].startContainer.textContent.length === 4) {\n                        var textCont = this.rangeCollection[this.rangeCollection.length - 1].startContainer;\n                        this.nodeSelectionObj.setSelectionText(this.contentRenderer.getDocument(), textCont, textCont, 0, textCont.textContent.length);\n                        InsertHtml.Insert(this.contentRenderer.getDocument(), document.createTextNode(''));\n                        this.rangeCollection.pop();\n                    }\n                }\n            }\n        }\n        if (e.args.action === 'space' ||\n            e.args.action === 'enter' ||\n            e.args.keyCode === 13) {\n            this.spaceLink(e.args);\n            if (this.parent.editorMode === 'HTML' && !this.parent.readonly) {\n                var currentLength = this.parent.getText().trim().replace(/(\\r\\n|\\n|\\r|\\t)/gm, '').replace(/\\u200B/g, '').length;\n                var selectionLength = this.parent.getSelection().length;\n                var totalLength = (currentLength - selectionLength) + 1;\n                if (!(this.parent.maxLength === -1 || totalLength <= this.parent.maxLength) &&\n                    e.args.keyCode === 13) {\n                    e.args.preventDefault();\n                    return;\n                }\n                else {\n                    this.parent.notify(events.enterHandler, { args: e.args });\n                    var newRange = this.parent.getRange();\n                    if (!isNOU(newRange.startContainer) && newRange.startContainer === this.parent.inputElement.lastChild && newRange.startContainer.nodeName !== '#text' && this.parent.height !== 'auto') {\n                        newRange.startContainer.scrollIntoView({ block: \"end\", inline: \"nearest\" });\n                    }\n                }\n            }\n        }\n        if (e.args.action === 'space') {\n            var currentRange_1 = this.parent.getRange();\n            var editorValue = currentRange_1.startContainer.textContent.slice(0, currentRange_1.startOffset);\n            var orderedList_1 = this.isOrderedList(editorValue);\n            var unOrderedList = this.isUnOrderedList(editorValue);\n            if (orderedList_1 && !unOrderedList || unOrderedList && !orderedList_1) {\n                var eventArgs_1 = {\n                    callBack: null,\n                    event: e.args,\n                    name: 'keydown-handler'\n                };\n                var actionBeginArgs = {\n                    cancel: false,\n                    item: { command: 'Lists', subCommand: orderedList_1 ? 'OL' : 'UL' },\n                    name: 'actionBegin',\n                    originalEvent: e.args,\n                    requestType: orderedList_1 ? 'OL' : 'UL'\n                };\n                this.parent.trigger(events.actionBegin, actionBeginArgs, function (actionBeginArgs) {\n                    if (!actionBeginArgs.cancel) {\n                        _this.parent.formatter.editorManager.observer.notify(ON_BEGIN, eventArgs_1);\n                        _this.parent.trigger(events.actionComplete, {\n                            editorMode: _this.parent.editorMode,\n                            elements: _this.parent.formatter.editorManager.domNode.blockNodes(),\n                            event: e.args,\n                            name: events.actionComplete,\n                            range: _this.parent.getRange(),\n                            requestType: orderedList_1 ? 'OL' : 'UL'\n                        });\n                    }\n                });\n            }\n        }\n        if (Browser.info.name === 'chrome' && (!isNullOrUndefined(this.rangeElement) && !isNullOrUndefined(this.oldRangeElement) ||\n            !isNullOrUndefined(this.deleteRangeElement) && !isNullOrUndefined(this.deleteOldRangeElement)) &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.rangeElement = null;\n            this.oldRangeElement = null;\n            this.deleteRangeElement = null;\n            this.deleteOldRangeElement = null;\n            if (!this.isImageDelete) {\n                args.preventDefault();\n            }\n            args.preventDefault();\n        }\n    };\n    HtmlEditor.prototype.isOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var olListStartRegex = [/^[1]+[.]+$/, /^[i]+[.]+$/, /^[a]+[.]+$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < olListStartRegex.length; i++) {\n                if (olListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.isUnOrderedList = function (editorValue) {\n        editorValue = editorValue.replace(/\\u200B/g, '');\n        var ulListStartRegex = [/^[*]$/, /^[-]$/];\n        if (!isNullOrUndefined(editorValue)) {\n            for (var i = 0; i < ulListStartRegex.length; i++) {\n                if (ulListStartRegex[i].test(editorValue)) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    };\n    HtmlEditor.prototype.backSpaceCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        var isPreviousNotContentEditable = true;\n        if (!isNOU(currentRange.startContainer.previousSibling) &&\n            currentRange.startContainer.previousSibling.nodeName === 'SPAN') {\n            isPreviousNotContentEditable = currentRange.startContainer.previousSibling.contentEditable === 'false' ? false : true;\n        }\n        if (e.args.code === 'Backspace' && e.args.keyCode === 8 && currentRange.startOffset === 0 &&\n            currentRange.endOffset === 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.textContent.length > 0 &&\n            currentRange.startContainer.parentElement.tagName !== 'TD' && currentRange.startContainer.parentElement.tagName !== 'TH' &&\n            isPreviousNotContentEditable) {\n            var checkNode = currentRange.startContainer.nodeName === '#text' ? currentRange.startContainer.parentElement : currentRange.startContainer;\n            if ((!this.parent.formatter.editorManager.domNode.isBlockNode(checkNode) &&\n                !isNOU(checkNode.previousSibling) && checkNode.previousSibling.nodeName === 'BR') ||\n                (!isNOU(currentRange.startContainer.previousSibling) && currentRange.startContainer.previousSibling.nodeName === 'BR')) {\n                return;\n            }\n            this.rangeElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.rangeElement.tagName === 'OL' || this.rangeElement.tagName === 'UL') {\n                var liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.previousElementSibling && liElement.previousElementSibling.childElementCount > 0) {\n                    this.oldRangeElement = liElement.previousElementSibling.lastElementChild.nodeName === 'BR' ?\n                        liElement.previousElementSibling : liElement.previousElementSibling.lastElementChild;\n                    if (!isNullOrUndefined(liElement.lastElementChild) && liElement.lastElementChild.nodeName !== 'BR') {\n                        this.rangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.rangeElement = liElement;\n                    }\n                }\n            }\n            else if (this.rangeElement === this.parent.inputElement || this.rangeElement.tagName === 'TABLE' ||\n                (!isNullOrUndefined(this.rangeElement.previousElementSibling) && this.rangeElement.previousElementSibling.tagName === 'TABLE')) {\n                return;\n            }\n            else {\n                this.oldRangeElement = this.rangeElement.previousElementSibling;\n            }\n            if (isNullOrUndefined(this.oldRangeElement)) {\n                return;\n            }\n            else {\n                if (this.oldRangeElement.tagName === 'OL' || this.oldRangeElement.tagName === 'UL') {\n                    this.oldRangeElement = this.oldRangeElement.lastElementChild.lastElementChild\n                        ? this.oldRangeElement.lastElementChild.lastElementChild :\n                        this.oldRangeElement.lastElementChild;\n                }\n                var lastNode = this.oldRangeElement.lastChild;\n                while (lastNode.nodeType !== 3 && lastNode.nodeName !== '#text' &&\n                    lastNode.nodeName !== 'BR') {\n                    lastNode = lastNode.lastChild;\n                }\n                this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), \n                // eslint-disable-next-line\n                lastNode, lastNode.textContent.length);\n                if (this.oldRangeElement.querySelectorAll('BR').length === 1) {\n                    detach(this.oldRangeElement.querySelector('BR'));\n                }\n                if (!isNullOrUndefined(this.rangeElement) && this.oldRangeElement !== this.rangeElement) {\n                    while (this.rangeElement.firstChild) {\n                        this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);\n                    }\n                    // eslint-disable-next-line\n                    !isLiElement ? detach(this.rangeElement) : detach(this.rangeElement.parentElement);\n                    this.oldRangeElement.normalize();\n                }\n            }\n        }\n    };\n    HtmlEditor.prototype.deleteCleanup = function (e, currentRange) {\n        var isLiElement = false;\n        var liElement;\n        var rootElement;\n        if (e.args.code === 'Delete' && e.args.keyCode === 46 &&\n            this.parent.contentModule.getText().trim().replace(/(\\r\\n|\\n|\\r|\\t)/gm, '').replace(/\\u200B/g, '').length !== 0 && this.parent.getSelection().length === 0 && currentRange.startContainer.parentElement.tagName !== 'TD' &&\n            currentRange.startContainer.parentElement.tagName !== 'TH') {\n            this.deleteRangeElement = rootElement = this.getRootBlockNode(currentRange.startContainer);\n            if (this.deleteRangeElement.tagName === 'OL' || this.deleteRangeElement.tagName === 'UL') {\n                liElement = this.getRangeLiNode(currentRange.startContainer);\n                if (liElement.nextElementSibling && liElement.nextElementSibling.childElementCount > 0\n                    && !liElement.nextElementSibling.querySelector('BR')) {\n                    if (!isNullOrUndefined(liElement.lastElementChild)) {\n                        this.deleteRangeElement = liElement.lastElementChild;\n                        isLiElement = true;\n                    }\n                    else {\n                        this.deleteRangeElement = liElement;\n                    }\n                }\n                else {\n                    this.deleteRangeElement = this.getRangeElement(liElement);\n                }\n            }\n            else if (this.deleteRangeElement.nodeType === 3 || (this.deleteRangeElement.tagName === 'TABLE' ||\n                (!isNullOrUndefined(this.deleteRangeElement.nextElementSibling) && this.deleteRangeElement.nextElementSibling.tagName === 'TABLE'))) {\n                return;\n            }\n            if (this.getCaretIndex(currentRange, this.deleteRangeElement) === this.deleteRangeElement.textContent.length) {\n                if (!isNullOrUndefined(liElement)) {\n                    if (isLiElement || !isNullOrUndefined(liElement.nextElementSibling)) {\n                        this.deleteOldRangeElement = this.getRangeElement(liElement.nextElementSibling);\n                    }\n                    else {\n                        this.deleteOldRangeElement = rootElement.nextElementSibling;\n                    }\n                }\n                else {\n                    this.deleteOldRangeElement = this.deleteRangeElement.nextElementSibling;\n                }\n                if (isNullOrUndefined(this.deleteOldRangeElement)) {\n                    return;\n                }\n                else {\n                    if (currentRange.startOffset === 0 && currentRange.endOffset === 1 &&\n                        this.deleteRangeElement.childNodes[0].nodeName === 'IMG') {\n                        this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement, 0, 1);\n                        this.isImageDelete = true;\n                    }\n                    else {\n                        this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(), this.deleteRangeElement, this.deleteRangeElement.childNodes.length);\n                        this.isImageDelete = false;\n                    }\n                    var brNode = this.deleteRangeElement.querySelector('BR');\n                    if (brNode && brNode.classList.contains('e-rte-image-remove-focus')) {\n                        removeClass([brNode], ['e-rte-image-focus']);\n                        return;\n                    }\n                    else if (brNode) {\n                        detach(brNode);\n                    }\n                    if (!isNullOrUndefined(this.deleteRangeElement) && (this.deleteOldRangeElement.tagName !== 'OL' && this.deleteOldRangeElement.tagName !== 'UL')\n                        && this.deleteOldRangeElement !== this.deleteRangeElement) {\n                        while (this.deleteOldRangeElement.firstChild) {\n                            this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);\n                        }\n                        if (!isLiElement) {\n                            detach(this.deleteOldRangeElement);\n                        }\n                        else {\n                            detach(this.deleteOldRangeElement.parentElement);\n                        }\n                        this.deleteRangeElement.normalize();\n                    }\n                    else {\n                        this.deleteRangeElement = null;\n                        this.deleteOldRangeElement = null;\n                    }\n                }\n            }\n            else {\n                this.deleteRangeElement = null;\n            }\n        }\n    };\n    HtmlEditor.prototype.getCaretIndex = function (currentRange, element) {\n        var position = 0;\n        if (this.parent.contentModule.getDocument().getSelection().rangeCount !== 0) {\n            var preCaretRange = currentRange.cloneRange();\n            preCaretRange.selectNodeContents(element);\n            preCaretRange.setEnd(currentRange.endContainer, currentRange.endOffset);\n            position = preCaretRange.toString().length;\n        }\n        return position;\n    };\n    HtmlEditor.prototype.getRangeElement = function (element) {\n        var rangeElement = element.lastElementChild ? element.lastElementChild.tagName === 'BR' ?\n            element.lastElementChild.previousElementSibling ? element.lastElementChild.previousElementSibling\n                : element : element.lastElementChild : element;\n        return rangeElement;\n    };\n    HtmlEditor.prototype.getRootBlockNode = function (rangeBlockNode) {\n        // eslint-disable-next-line\n        for (; rangeBlockNode && this.parent && this.parent.inputElement !== rangeBlockNode; rangeBlockNode = rangeBlockNode) {\n            if (rangeBlockNode.parentElement === this.parent.inputElement) {\n                break;\n            }\n            else {\n                rangeBlockNode = rangeBlockNode.parentElement;\n            }\n        }\n        return rangeBlockNode;\n    };\n    HtmlEditor.prototype.getRangeLiNode = function (rangeLiNode) {\n        var node = rangeLiNode.parentElement;\n        while (node !== this.parent.inputElement) {\n            if (node.nodeType === 1 && node.tagName === 'LI') {\n                break;\n            }\n            node = node.parentElement;\n        }\n        return node;\n    };\n    HtmlEditor.prototype.onPaste = function (e) {\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (e.text.match(regex)) {\n            if (e.isWordPaste) {\n                return;\n            }\n            e.args.preventDefault();\n            var range = this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var saveSelection = this.parent.formatter.editorManager.nodeSelection.save(range, this.parent.contentModule.getDocument());\n            // eslint-disable-next-line\n            var httpRegex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)))/gi);\n            var wwwRegex = new RegExp(/([^\\S]|^)(((www\\.))(\\S+))/gi);\n            var enterSplitText = e.text.split('\\n');\n            var contentInnerElem = '';\n            for (var i = 0; i < enterSplitText.length; i++) {\n                if (enterSplitText[i].trim() === '') {\n                    contentInnerElem += getDefaultValue(this.parent);\n                }\n                else {\n                    var contentWithSpace = '';\n                    var spaceBetweenContent = true;\n                    var spaceSplit = enterSplitText[i].split(' ');\n                    for (var j = 0; j < spaceSplit.length; j++) {\n                        if (spaceSplit[j].trim() === '') {\n                            contentWithSpace += spaceBetweenContent ? '&nbsp;' : ' ';\n                        }\n                        else {\n                            spaceBetweenContent = false;\n                            contentWithSpace += spaceSplit[j] + ' ';\n                        }\n                    }\n                    if (i === 0) {\n                        contentInnerElem += '<span>' + contentWithSpace.trim() + '</span>';\n                    }\n                    else {\n                        contentInnerElem += '<p>' + contentWithSpace.trim() + '</p>';\n                    }\n                }\n            }\n            var divElement = this.parent.createElement('div');\n            divElement.setAttribute('class', 'pasteContent');\n            divElement.style.display = 'inline';\n            divElement.innerHTML = contentInnerElem.replace('&para', '&amp;para');\n            var paraElem = divElement.querySelectorAll('span, p');\n            for (var i = 0; i < paraElem.length; i++) {\n                var splitTextContent = paraElem[i].innerHTML.split(' ');\n                var resultSplitContent = '';\n                for (var j = 0; j < splitTextContent.length; j++) {\n                    if (splitTextContent[j].match(httpRegex) || splitTextContent[j].match(wwwRegex)) {\n                        resultSplitContent += '<a class=\"e-rte-anchor\" href=\"' + splitTextContent[j] +\n                            '\" title=\"' + splitTextContent[j] + '\" target=\"_blank\"' + ' aria-label=\"' + this.parent.serviceLocator.getService('rteLocale').getConstant(\"linkAriaLabel\") + '\">' + splitTextContent[j] + ' </a>';\n                    }\n                    else {\n                        resultSplitContent += splitTextContent[j] + ' ';\n                    }\n                }\n                paraElem[i].innerHTML = resultSplitContent.trim();\n            }\n            if (!isNullOrUndefined(this.parent.pasteCleanupModule)) {\n                e.callBack(divElement.innerHTML);\n            }\n            else {\n                this.parent.formatter.editorManager.execCommand('insertHTML', null, null, null, divElement);\n            }\n        }\n    };\n    HtmlEditor.prototype.spaceLink = function (e) {\n        var range = this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());\n        var selectNodeEle = this.nodeSelectionObj.getParentNodeCollection(range);\n        var text = range.startContainer.textContent.substr(0, range.endOffset);\n        var splitText = text.split(' ');\n        var urlText = splitText[splitText.length - 1];\n        var urlTextRange = range.startOffset - (text.length - splitText[splitText.length - 1].length);\n        urlText = urlText.slice(0, urlTextRange);\n        // eslint-disable-next-line\n        var regex = new RegExp(/([^\\S]|^)(((https?\\:\\/\\/)|(www\\.))(\\S+))/gi);\n        if (selectNodeEle[0].nodeName !== 'A' && urlText.match(regex)) {\n            var selection = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n            var url = urlText.indexOf('http') > -1 ? urlText : 'http://' + urlText;\n            var selectParent = this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(range);\n            var value = {\n                url: url,\n                selection: selection, selectParent: selectParent,\n                text: urlText,\n                title: '',\n                target: '_blank'\n            };\n            this.parent.formatter.process(this.parent, {\n                item: {\n                    'command': 'Links',\n                    'subCommand': 'CreateLink'\n                }\n            }, e, value);\n        }\n    };\n    HtmlEditor.prototype.mouseOutHandler = function () {\n        if (!isNOU(this.tooltipTargetEle)) {\n            this.tooltipTargetEle.setAttribute('title', this.tooltipTargetEle.getAttribute('data-title'));\n        }\n        else {\n            var currentDocument = this.parent.iframeSettings.enable ? this.parent.contentModule.getPanel().ownerDocument :\n                this.parent.contentModule.getDocument();\n            this.tooltipTargetEle = currentDocument.querySelector('[data-title]');\n            this.tooltipTargetEle.setAttribute('title', this.tooltipTargetEle.getAttribute('data-title'));\n        }\n        this.tooltipTargetEle.removeAttribute('data-title');\n        EventHandler.remove(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler);\n    };\n    HtmlEditor.prototype.onToolbarClick = function (args) {\n        var _this = this;\n        var save;\n        var selectNodeEle;\n        var selectParentEle;\n        var item = args.item;\n        var closestElement = closest(args.originalEvent.target, '.e-rte-quick-popup');\n        var currentDocument = this.parent.iframeSettings.enable ? this.parent.contentModule.getPanel().ownerDocument :\n            this.parent.contentModule.getDocument();\n        this.tooltipTargetEle = closest(args.originalEvent.target, '[data-tooltip-id]');\n        if (!isNOU(this.tooltipTargetEle) && this.parent.showTooltip && !isNOU(currentDocument.querySelector('.e-tooltip-wrap'))) {\n            this.parent.notify(events.destroyTooltip, { args: event });\n            this.tooltipTargetEle.setAttribute('data-title', this.tooltipTargetEle.getAttribute('title'));\n            this.tooltipTargetEle.removeAttribute('title');\n            EventHandler.add(this.tooltipTargetEle, 'mouseout', this.mouseOutHandler, this);\n        }\n        if (item.command !== 'FormatPainter') {\n            if (closestElement && !closestElement.classList.contains('e-rte-inline-popup') && !closestElement.classList.contains('e-rte-text-popup')) {\n                if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                    item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                    if (isIDevice() && item.command === 'Images') {\n                        this.nodeSelectionObj.restore();\n                    }\n                    var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                    save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                    selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                    selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n                }\n                if (item.command === 'Images') {\n                    this.parent.notify(events.imageToolbarAction, {\n                        member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                }\n                if (item.command === 'Audios') {\n                    this.parent.notify(events.audioToolbarAction, {\n                        member: 'audio', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                }\n                if (item.command === 'Videos') {\n                    this.parent.notify(events.videoToolbarAction, {\n                        member: 'video', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                }\n                if (item.command === 'Links') {\n                    this.parent.notify(events.linkToolbarAction, {\n                        member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                }\n                if (item.command === 'Table') {\n                    this.parent.notify(events.tableToolbarAction, {\n                        member: 'table', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                    });\n                }\n            }\n            else {\n                var linkDialog = document.getElementById(this.parent.getID() + '_rtelink');\n                var imageDialog = document.getElementById(this.parent.getID() + '_image');\n                if (!(item.subCommand === 'SourceCode' || item.subCommand === 'Preview' ||\n                    item.subCommand === 'FontColor' || item.subCommand === 'BackgroundColor')) {\n                    var range = this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());\n                    if (isNullOrUndefined(linkDialog) && isNullOrUndefined(imageDialog)) {\n                        save = this.nodeSelectionObj.save(range, this.parent.contentModule.getDocument());\n                    }\n                    selectNodeEle = this.nodeSelectionObj.getNodeCollection(range);\n                    selectParentEle = this.nodeSelectionObj.getParentNodeCollection(range);\n                }\n                switch (item.subCommand) {\n                    case 'Maximize':\n                        this.parent.notify(events.enableFullScreen, { args: args });\n                        break;\n                    case 'Minimize':\n                        this.parent.notify(events.disableFullScreen, { args: args });\n                        break;\n                    case 'CreateLink':\n                        this.parent.notify(events.insertLink, {\n                            member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                        });\n                        break;\n                    case 'RemoveLink':\n                        this.parent.notify(events.unLink, {\n                            member: 'link', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                        });\n                        break;\n                    case 'Print':\n                        this.parent.print();\n                        break;\n                    case 'Image':\n                        this.parent.notify(events.insertImage, {\n                            member: 'image', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                        });\n                        break;\n                    case 'Audio':\n                        this.parent.notify(events.insertAudio, {\n                            member: 'audio', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                        });\n                        break;\n                    case 'Video':\n                        this.parent.notify(events.insertVideo, {\n                            member: 'video', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                        });\n                        break;\n                    case 'CreateTable':\n                        this.parent.notify(events.createTable, {\n                            member: 'table', args: args, selection: save\n                        });\n                        break;\n                    case 'SourceCode':\n                        this.parent.notify(events.sourceCode, { member: 'viewSource', args: args });\n                        break;\n                    case 'Preview':\n                        this.parent.notify(events.updateSource, { member: 'updateSource', args: args });\n                        break;\n                    case 'FontColor':\n                    case 'BackgroundColor':\n                        break;\n                    case 'File':\n                        this.parent.notify(events.renderFileManager, {\n                            member: 'fileManager', args: args, selectNode: selectNodeEle, selection: save, selectParent: selectParentEle\n                        });\n                        break;\n                    case 'EmojiPicker':\n                        this.parent.notify(events.emojiPicker, { member: 'emojiPicker', args: args });\n                        break;\n                    default:\n                        this.parent.formatter.process(this.parent, args, args.originalEvent, null);\n                        break;\n                }\n            }\n        }\n        else {\n            if (args.originalEvent.detail === 1) {\n                clearTimeout(this.clickTimeout);\n                this.clickTimeout = setTimeout(function () {\n                    _this.parent.notify(events.formatPainterClick, {\n                        member: 'formatPainter', args: args\n                    });\n                }, 200);\n            }\n            else {\n                clearTimeout(this.clickTimeout);\n                this.parent.notify(events.formatPainterDoubleClick, {\n                    member: 'formatPainter', args: args\n                });\n            }\n        }\n    };\n    HtmlEditor.prototype.renderColorPicker = function (args) {\n        this.colorPickerModule.renderColorPickerInput(args);\n    };\n    HtmlEditor.prototype.instantiateRenderer = function () {\n        if (this.parent.iframeSettings.enable) {\n            this.renderFactory.addRenderer(RenderType.Content, new IframeContentRender(this.parent, this.locator));\n        }\n        else {\n            this.renderFactory.addRenderer(RenderType.Content, new ContentRender(this.parent, this.locator));\n        }\n    };\n    HtmlEditor.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.initialEnd, this.render);\n        this.parent.off(events.modelChanged, this.onPropertyChanged);\n        this.parent.off(events.htmlToolbarClick, this.onToolbarClick);\n        this.parent.off(events.renderColorPicker, this.renderColorPicker);\n        this.parent.off(events.destroy, this.destroy);\n        this.parent.off(events.keyDown, this.onKeyDown);\n        this.parent.off(events.initialLoad, this.instantiateRenderer);\n        this.parent.off(events.selectAll, this.selectAll);\n        this.parent.off(events.selectRange, this.selectRange);\n        this.parent.off(events.getSelectedHtml, this.getSelectedHtml);\n        this.parent.off(events.selectionSave, this.onSelectionSave);\n        this.parent.off(events.selectionRestore, this.onSelectionRestore);\n        this.parent.off(events.readOnlyMode, this.updateReadOnly);\n        this.parent.off(events.paste, this.onPaste);\n        this.parent.off(events.tableclass, this.isTableClassAdded);\n    };\n    HtmlEditor.prototype.render = function () {\n        this.contentRenderer = this.renderFactory.getRenderer(RenderType.Content);\n        var editElement = this.contentRenderer.getEditPanel();\n        var option = { undoRedoSteps: this.parent.undoRedoSteps, undoRedoTimer: this.parent.undoRedoTimer };\n        if (isNullOrUndefined(this.parent.formatter)) {\n            var formatterClass = new HTMLFormatter({\n                currentDocument: this.contentRenderer.getDocument(),\n                element: editElement,\n                options: option,\n                formatPainterSettings: this.parent.formatPainterSettings\n            });\n            this.parent.setProperties({ formatter: formatterClass }, true);\n        }\n        else {\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n        if (this.parent.enableXhtml) {\n            this.parent.notify(events.xhtmlValidation, {});\n        }\n        if (this.parent.toolbarSettings.enable) {\n            this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n        }\n        if (this.parent.inlineMode.enable) {\n            if (!isNullOrUndefined(this.parent.fontFamily.default)) {\n                editElement.style.fontFamily = this.parent.fontFamily.default;\n            }\n            if (!isNullOrUndefined(this.parent.fontSize.default)) {\n                editElement.style.fontSize = this.parent.fontSize.default;\n            }\n        }\n        this.parent.notify(events.bindOnEnd, {});\n    };\n    /**\n     * Called internally if any of the property value changed.\n     *\n     * @param {RichTextEditorModel} e - specifies the editor model\n     * @returns {void}\n     * @hidden\n\n     */\n    HtmlEditor.prototype.onPropertyChanged = function (e) {\n        // On property code change here\n        if (!isNOU(e) && !isNOU(e.newProp.toolbarSettings) && !isNOU(e.newProp.toolbarSettings.enable)) {\n            this.toolbarUpdate = new HtmlToolbarStatus(this.parent);\n        }\n        if (!isNullOrUndefined(e.newProp.formatter)) {\n            var editElement = this.contentRenderer.getEditPanel();\n            var option = { undoRedoSteps: this.parent.undoRedoSteps,\n                undoRedoTimer: this.parent.undoRedoTimer };\n            this.parent.formatter.updateFormatter(editElement, this.contentRenderer.getDocument(), option);\n        }\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} - returns the string value\n     * @hidden\n     */\n    HtmlEditor.prototype.getModuleName = function () {\n        return 'htmlEditor';\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectAll = function () {\n        var nodes = getTextNodesUnder(this.parent.contentModule.getDocument(), this.parent.contentModule.getEditPanel());\n        if (nodes.length > 0) {\n            this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(), nodes[0], nodes[nodes.length - 1], 0, nodes[nodes.length - 1].textContent.length);\n        }\n    };\n    /**\n     * For selecting all content in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @private\n     * @hidden\n     */\n    HtmlEditor.prototype.selectRange = function (e) {\n        this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(), e.range);\n    };\n    /**\n     * For get a selected text in RTE\n     *\n     * @param {NotifyArgs} e - specifies the notified arguments\n     * @returns {void}\n     * @hidden\n     */\n    HtmlEditor.prototype.getSelectedHtml = function (e) {\n        e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString());\n    };\n    return HtmlEditor;\n}());\nexport { HtmlEditor };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}