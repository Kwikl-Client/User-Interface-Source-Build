{"ast":null,"code":"/* eslint-disable */\nimport { createElement, Browser, isNullOrUndefined } from '@syncfusion/ej2-base';\n/**\n * The `TextSelection` module is used to handle the text selection of PDF viewer.\n */\nvar TextSelection = /** @class */function () {\n  /**\n   * @param pdfViewer\n   * @param pdfViewerBase\n   * @param pdfViewer\n   * @param pdfViewerBase\n   * @private\n   */\n  function TextSelection(pdfViewer, pdfViewerBase) {\n    var _this = this;\n    /**\n     * @private\n     */\n    this.isTextSelection = false;\n    /**\n     * @private\n     */\n    this.selectionStartPage = null;\n    this.isBackwardPropagatedSelection = false;\n    this.contextMenuHeight = 144;\n    this.backwardStart = 0;\n    /**\n     * @private\n     */\n    this.selectionRangeArray = [];\n    this.selectionAnchorTouch = null;\n    this.selectionFocusTouch = null;\n    // eslint-disable-next-line\n    this.scrollMoveTimer = 0;\n    this.isMouseLeaveSelection = false;\n    this.isTouchSelection = false;\n    this.previousScrollDifference = 0;\n    this.topStoreLeft = null;\n    this.topStoreRight = null;\n    this.isTextSearched = false;\n    this.isSelectionStartTriggered = false;\n    this.allTextContent = \"\";\n    this.onLeftTouchSelectElementTouchStart = function (event) {\n      _this.initiateSelectionByTouch();\n    };\n    this.onRightTouchSelectElementTouchStart = function (event) {\n      _this.initiateSelectionByTouch();\n    };\n    this.onLeftTouchSelectElementTouchEnd = function (event) {\n      _this.terminateSelectionByTouch(event);\n    };\n    this.onRightTouchSelectElementTouchEnd = function (event) {\n      _this.terminateSelectionByTouch(event);\n    };\n    this.onLeftTouchSelectElementTouchMove = function (event) {\n      var range;\n      var nodeElement;\n      event.preventDefault();\n      event.target.style.zIndex = '0';\n      var rightElement = _this.dropDivElementRight;\n      var isTouchedWithinViewerContainer = _this.isTouchedWithinContainer(event);\n      if (rightElement && isTouchedWithinViewerContainer) {\n        var dropBounds = rightElement.getBoundingClientRect();\n        var xTouch = event.changedTouches[0].clientX;\n        var yTouch = event.changedTouches[0].clientY;\n        event.target.style.zIndex = '1000';\n        nodeElement = _this.getNodeElement(range, xTouch, yTouch, event, nodeElement);\n        if (nodeElement) {\n          // eslint-disable-next-line max-len\n          var currentDifference = Math.sqrt((yTouch - dropBounds.top) * (yTouch - dropBounds.top) + (xTouch - dropBounds.left) * (xTouch - dropBounds.left));\n          var isCloserMovement = _this.isCloserTouchScroll(currentDifference);\n          var isTextSelected = false;\n          if (yTouch <= dropBounds.top) {\n            _this.dropElementLeft.style.transform = 'rotate(0deg)';\n            _this.dropElementRight.style.transform = 'rotate(-90deg)';\n            isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, xTouch, yTouch, false, 'left', isCloserMovement);\n          } else {\n            _this.dropElementLeft.style.transform = 'rotate(-90deg)';\n            _this.dropElementRight.style.transform = 'rotate(0deg)';\n            isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, xTouch, yTouch, true, 'left', isCloserMovement);\n          }\n          if (isTextSelected) {\n            var elementClientRect = _this.dropDivElementLeft.getBoundingClientRect();\n            var pageTopValue = _this.pdfViewerBase.pageSize[_this.pdfViewerBase.currentPageNumber - 1].top;\n            var topClientValue = _this.getClientValueTop(yTouch, _this.pdfViewerBase.currentPageNumber - 1);\n            // eslint-disable-next-line max-len\n            var currentPageLeft = _this.pdfViewerBase.getElement('_pageDiv_' + (_this.pdfViewerBase.currentPageNumber - 1)).getBoundingClientRect().left;\n            var currentRangeLeft = xTouch - currentPageLeft;\n            // eslint-disable-next-line max-len\n            _this.dropDivElementLeft.style.top = pageTopValue * _this.pdfViewerBase.getZoomFactor() + topClientValue + 'px';\n            _this.topStoreLeft = {\n              pageTop: pageTopValue,\n              topClientValue: _this.getMagnifiedValue(topClientValue),\n              pageNumber: _this.pdfViewerBase.currentPageNumber - 1,\n              left: _this.getMagnifiedValue(currentRangeLeft),\n              isHeightNeeded: false\n            };\n            // eslint-disable-next-line max-len\n            _this.dropDivElementLeft.style.left = xTouch - _this.pdfViewerBase.viewerContainer.getBoundingClientRect().left - elementClientRect.width / 2 + 'px';\n            _this.previousScrollDifference = currentDifference;\n          }\n        }\n      }\n    };\n    // eslint-disable-next-line\n    this.onRightTouchSelectElementTouchMove = function (event) {\n      var range;\n      var nodeElement;\n      event.preventDefault();\n      event.target.style.zIndex = '0';\n      var leftElement = _this.dropDivElementLeft;\n      var isTouchedWithinViewerContainer = _this.isTouchedWithinContainer(event);\n      if (leftElement && isTouchedWithinViewerContainer) {\n        var dropPosition = leftElement.getBoundingClientRect();\n        var touchX = event.changedTouches[0].clientX;\n        var touchY = event.changedTouches[0].clientY;\n        event.target.style.zIndex = '1000';\n        nodeElement = _this.getNodeElement(range, touchX, touchY, event, nodeElement);\n        if (nodeElement) {\n          // eslint-disable-next-line max-len\n          var currentDifference = Math.sqrt((touchY - dropPosition.top) * (touchY - dropPosition.top) + (touchX - dropPosition.left) * (touchX - dropPosition.left));\n          var isCloserMovement = _this.isCloserTouchScroll(currentDifference);\n          var isTextSelected = false;\n          if (touchY >= dropPosition.top) {\n            _this.dropElementRight.style.transform = 'rotate(-90deg)';\n            _this.dropElementLeft.style.transform = 'rotate(0deg)';\n            isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, touchX, touchY, true, 'right', isCloserMovement);\n          } else {\n            _this.dropElementRight.style.transform = 'rotate(0deg)';\n            _this.dropElementLeft.style.transform = 'rotate(-90deg)';\n            isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, touchX, touchY, false, 'right', isCloserMovement);\n          }\n          if (isTextSelected) {\n            var pageTopValue = _this.pdfViewerBase.pageSize[_this.pdfViewerBase.currentPageNumber - 1].top;\n            var topClientValue = _this.getClientValueTop(touchY, _this.pdfViewerBase.currentPageNumber - 1);\n            var elementClientRect = _this.dropDivElementRight.getBoundingClientRect();\n            _this.dropDivElementRight.style.top = pageTopValue * _this.pdfViewerBase.getZoomFactor() + topClientValue + 'px';\n            // eslint-disable-next-line max-len\n            var currentPageLeft = _this.pdfViewerBase.getElement('_pageDiv_' + (_this.pdfViewerBase.currentPageNumber - 1)).getBoundingClientRect().left;\n            var currentRangeLeft = touchX - currentPageLeft;\n            // eslint-disable-next-line max-len\n            _this.topStoreRight = {\n              pageTop: pageTopValue,\n              topClientValue: _this.getMagnifiedValue(topClientValue),\n              pageNumber: _this.pdfViewerBase.currentPageNumber - 1,\n              left: _this.getMagnifiedValue(currentRangeLeft),\n              isHeightNeeded: false\n            };\n            // eslint-disable-next-line max-len\n            _this.dropDivElementRight.style.left = touchX - _this.pdfViewerBase.viewerContainer.getBoundingClientRect().left - elementClientRect.width / 2 + 'px';\n            _this.previousScrollDifference = currentDifference;\n          }\n        }\n      }\n    };\n    this.pdfViewer = pdfViewer;\n    this.pdfViewerBase = pdfViewerBase;\n  }\n  /**\n   * @param target\n   * @param x\n   * @param y\n   * @param isExtended\n   * @private\n   */\n  TextSelection.prototype.textSelectionOnMouseMove = function (target, x, y, isExtended) {\n    var targetElement = target;\n    this.isTextSearched = true;\n    if (targetElement.nodeType === targetElement.TEXT_NODE) {\n      if (!this.isSelectionStartTriggered && !this.pdfViewerBase.getTextMarkupAnnotationMode()) {\n        this.pdfViewer.fireTextSelectionStart(this.pdfViewerBase.currentPageNumber);\n        this.isSelectionStartTriggered = true;\n      }\n      this.isBackwardPropagatedSelection = false;\n      var range = targetElement.ownerDocument.createRange();\n      var selection = window.getSelection();\n      if (selection.anchorNode !== null) {\n        var position = selection.anchorNode.compareDocumentPosition(selection.focusNode);\n        if (!position && selection.anchorOffset > selection.focusOffset || position === Node.DOCUMENT_POSITION_PRECEDING) {\n          this.isBackwardPropagatedSelection = true;\n        }\n      }\n      range.selectNodeContents(targetElement);\n      var currentPosition = 0;\n      var endPosition = range.endOffset;\n      while (currentPosition < endPosition) {\n        range.setStart(targetElement, currentPosition);\n        range.setEnd(targetElement, currentPosition + 1);\n        var rangeBounds = range.getBoundingClientRect();\n        var rightBounds = rangeBounds.right;\n        if (isExtended) {\n          // eslint-disable-next-line\n          rightBounds = parseInt(rangeBounds.right.toString());\n        }\n        // eslint-disable-next-line max-len\n        // eslint-disable-next-line\n        if (rangeBounds.left <= x && rightBounds >= x && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n          if (selection.anchorNode !== null && selection.anchorNode.parentNode.classList.contains('e-pv-text')) {\n            if (selection.anchorOffset > currentPosition) {\n              if (this.backwardStart != 0) {\n                range.setStart(selection.anchorNode, this.backwardStart);\n              } else {\n                range.setStart(selection.anchorNode, selection.anchorOffset + 1);\n              }\n            } else {\n              range.setStart(selection.anchorNode, selection.anchorOffset);\n            }\n          }\n          selection.removeAllRanges();\n          selection.addRange(range);\n          if (!this.isTextSelection) {\n            this.selectionStartPage = this.pdfViewerBase.currentPageNumber - 1;\n          }\n          this.isTextSelection = true;\n          // eslint-disable-next-line\n          var isIE = !!document.documentMode;\n          if (!isIE) {\n            if (this.isBackwardPropagatedSelection || range.endOffset > currentPosition) {\n              if (this.backwardStart != range.startOffset && range.startOffset >= currentPosition) {\n                this.backwardStart = range.endOffset;\n              }\n              if (currentPosition === 0 && range.endOffset != 1) {\n                selection.extend(targetElement, currentPosition);\n              } else {\n                selection.extend(targetElement, currentPosition + 1);\n              }\n            } else if (isExtended) {\n              selection.extend(targetElement, currentPosition);\n            } else {\n              selection.extend(targetElement, currentPosition + 1);\n            }\n          }\n          range.detach();\n        }\n        currentPosition += 1;\n      }\n      // eslint-disable-next-line\n      var annotationModule = this.pdfViewer.annotationModule;\n      // eslint-disable-next-line max-len\n      if (annotationModule && annotationModule.textMarkupAnnotationModule && annotationModule.textMarkupAnnotationModule.isEnableTextMarkupResizer(annotationModule.textMarkupAnnotationModule.currentTextMarkupAddMode)) {\n        // eslint-disable-next-line\n        var leftDivElement = document.getElementById(this.pdfViewer.element.id + '_droplet_left');\n        if (this.pdfViewerBase.isSelection && selection && selection.rangeCount > 0) {\n          // eslint-disable-next-line\n          var currentrange = selection.getRangeAt(0);\n          // eslint-disable-next-line\n          var rect = currentrange.getBoundingClientRect();\n          var left = rect.left;\n          var top_1 = rect.top;\n          this.pdfViewer.annotation.textMarkupAnnotationModule.updateLeftposition(left, top_1);\n          this.pdfViewerBase.isSelection = false;\n        } else if (leftDivElement && leftDivElement.style.display === 'none') {\n          this.pdfViewer.annotation.textMarkupAnnotationModule.updateLeftposition(x, y);\n        }\n        this.pdfViewer.annotation.textMarkupAnnotationModule.updatePosition(x, y);\n      }\n    } else {\n      for (var i = 0; i < targetElement.childNodes.length; i++) {\n        if (targetElement.childNodes[i].nodeType === targetElement.TEXT_NODE) {\n          var range = this.getSelectionRange(i, targetElement);\n          var rangeBounds = range.getBoundingClientRect();\n          // eslint-disable-next-line max-len\n          // eslint-disable-next-line\n          if (rangeBounds.left <= x && rangeBounds.right >= parseInt(x.toString()) && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n            range.detach();\n            this.textSelectionOnMouseMove(targetElement.childNodes[i], x, y, isExtended);\n          } else {\n            range.detach();\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @param target\n   * @param x\n   * @param y\n   * @param isforward\n   * @param target\n   * @param x\n   * @param y\n   * @param isforward\n   * @param target\n   * @param x\n   * @param y\n   * @param isforward\n   * @private\n   */\n  TextSelection.prototype.textSelectionOnDrag = function (target, x, y, isforward) {\n    var targetElement = target;\n    this.isTextSearched = true;\n    if (targetElement.nodeType === targetElement.TEXT_NODE) {\n      this.isBackwardPropagatedSelection = false;\n      var range = targetElement.ownerDocument.createRange();\n      var selection = window.getSelection();\n      if (selection.anchorNode !== null) {\n        var position = selection.anchorNode.compareDocumentPosition(selection.focusNode);\n        if (!position && selection.anchorOffset > selection.focusOffset || position === Node.DOCUMENT_POSITION_PRECEDING) {\n          this.isBackwardPropagatedSelection = true;\n        }\n      }\n      range.selectNodeContents(targetElement);\n      var currentPosition = 0;\n      var endPosition = range.endOffset;\n      while (currentPosition < endPosition) {\n        range.setStart(targetElement, currentPosition);\n        range.setEnd(targetElement, currentPosition + 1);\n        var rangeBounds = range.getBoundingClientRect();\n        // eslint-disable-next-line max-len\n        // eslint-disable-next-line\n        if (rangeBounds.left <= x && rangeBounds.right >= x && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n          if (isforward) {\n            // eslint-disable-next-line max-len\n            if (selection.anchorNode !== null && selection.anchorNode.parentNode.classList.contains('e-pv-text')) {\n              range.setStart(selection.anchorNode, selection.anchorOffset);\n            }\n            selection.removeAllRanges();\n            selection.addRange(range);\n            selection.extend(targetElement, currentPosition);\n          } else if (selection.focusNode) {\n            range.setEnd(selection.focusNode, selection.focusOffset);\n            selection.removeAllRanges();\n            selection.addRange(range);\n          }\n          if (!this.isTextSelection) {\n            this.selectionStartPage = this.pdfViewerBase.currentPageNumber - 1;\n          }\n          this.isTextSelection = true;\n          range.detach();\n          return true;\n        }\n        currentPosition += 1;\n      }\n      if (this.pdfViewerBase.isSelection) {\n        // eslint-disable-next-line\n        var currentrange = selection.getRangeAt(0);\n        // eslint-disable-next-line\n        var rect = currentrange.getBoundingClientRect();\n        var left = rect.left;\n        var top_2 = rect.top;\n        this.pdfViewer.annotation.textMarkupAnnotationModule.updateLeftposition(left, top_2);\n        this.pdfViewerBase.isSelection = false;\n      }\n      this.pdfViewer.annotation.textMarkupAnnotationModule.updatePosition(x, y);\n    } else {\n      for (var i = 0; i < targetElement.childNodes.length; i++) {\n        if (targetElement.childNodes[i].nodeType === targetElement.TEXT_NODE) {\n          var range = this.getSelectionRange(i, targetElement);\n          var rangeBounds = range.getBoundingClientRect();\n          // eslint-disable-next-line max-len\n          // eslint-disable-next-line\n          if (rangeBounds.left <= x && rangeBounds.right >= x && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n            range.detach();\n            this.textSelectionOnDrag(targetElement.childNodes[i], x, y, isforward);\n          } else {\n            range.detach();\n          }\n        }\n      }\n    }\n    return null;\n  };\n  /**\n   * Select the target text region in the PDF document of the given bounds.\n   *\n   * @param  {number} pageNumbers - Specifies the page number\n   * @param  {IRectangle[]} bounds -  Specifies the bounds of the texts.\n   * @returns void\n   */\n  TextSelection.prototype.selectTextRegion = function (pageNumbers, bounds) {\n    // eslint-disable-next-line\n    var element = null;\n    var pageNumber = pageNumbers - 1;\n    for (var k = 0; k < bounds.length; k++) {\n      // eslint-disable-next-line\n      var bound = bounds[k];\n      var x = (bound.left ? bound.left : bound.Left) * this.pdfViewerBase.getZoomFactor();\n      var y = (bound.top ? bound.top : bound.Top) * this.pdfViewerBase.getZoomFactor();\n      var width = (bound.width ? bound.width : bound.Width) * this.pdfViewerBase.getZoomFactor();\n      var height = bound.height ? bound.height : bound.Height;\n      // eslint-disable-next-line\n      var textLayer = this.pdfViewerBase.getElement('_textLayer_' + pageNumber);\n      if (textLayer) {\n        // eslint-disable-next-line\n        var textDivs = textLayer.childNodes;\n        for (var n = 0; n < textDivs.length; n++) {\n          if (textDivs[n]) {\n            // eslint-disable-next-line\n            var rangebounds = textDivs[n].getBoundingClientRect();\n            var top_3 = this.getClientValueTop(rangebounds.top, pageNumber);\n            // eslint-disable-next-line max-len\n            var currentLeft = rangebounds.left - this.pdfViewerBase.getElement('_pageDiv_' + pageNumber).getBoundingClientRect().left;\n            var totalLeft = currentLeft + rangebounds.width;\n            // eslint-disable-next-line\n            var textDiVLeft = parseInt(textDivs[n].style.left);\n            // eslint-disable-next-line\n            var currentTop = parseInt(textDivs[n].style.top);\n            var isLeftBounds = this.checkLeftBounds(currentLeft, textDiVLeft, totalLeft, x);\n            var isTopBounds = this.checkTopBounds(top_3, currentTop, y);\n            if (isLeftBounds && isTopBounds) {\n              element = textDivs[n];\n              break;\n            }\n          }\n        }\n        if (element != null) {\n          // eslint-disable-next-line\n          var boundingRect = this.pdfViewerBase.getElement('_textLayer_' + pageNumber).getBoundingClientRect();\n          this.textSelectionOnMouseMove(element, x + boundingRect.left, y + boundingRect.top, false);\n          if (bounds.length - 1 === k) {\n            // eslint-disable-next-line max-len\n            this.textSelectionOnMouseMove(element, x + boundingRect.left + width, y + boundingRect.top, false);\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @param left\n   * @param textDiVLeft\n   * @param totalLeft\n   * @param x\n   * @private\n   */\n  TextSelection.prototype.checkLeftBounds = function (left, textDiVLeft, totalLeft, x) {\n    var isExists = false;\n    // eslint-disable-next-line max-len\n    // eslint-disable-next-line\n    if (left === parseInt(x.toString()) || parseInt(left.toString()) === parseInt(x.toString()) || left + 1 === parseInt(x.toString()) || left - 1 === parseInt(x.toString())\n    // eslint-disable-next-line\n    || textDiVLeft === parseInt(x.toString()) || textDiVLeft === x || totalLeft >= x && left <= x) {\n      isExists = true;\n    }\n    return isExists;\n  };\n  /**\n   * @param top\n   * @param currentTop\n   * @param y\n   * @param top\n   * @param currentTop\n   * @param y\n   * @private\n   */\n  TextSelection.prototype.checkTopBounds = function (top, currentTop, y) {\n    var isExists = false;\n    // eslint-disable-next-line max-len\n    // eslint-disable-next-line\n    if (top === parseInt(y.toString()) || parseInt(top.toString()) === parseInt(y.toString()) || parseInt((top + 1).toString()) === parseInt(y.toString()) || parseInt((top - 1).toString()) === parseInt(y.toString())\n    // eslint-disable-next-line\n    || currentTop === parseInt(y.toString()) || currentTop === y) {\n      isExists = true;\n    }\n    return isExists;\n  };\n  /**\n   * @param event\n   * @private\n   */\n  TextSelection.prototype.textSelectionOnMouseLeave = function (event) {\n    var _this = this;\n    event.preventDefault();\n    var viewerTop = this.pdfViewerBase.viewerContainer.offsetTop;\n    if (this.pdfViewer.magnificationModule) {\n      if (this.pdfViewer.magnificationModule.fitType === 'fitToPage') {\n        return;\n      }\n    }\n    if (event.clientY > viewerTop) {\n      this.scrollMoveTimer = setInterval(function () {\n        _this.scrollForwardOnSelection();\n      }, 500);\n    } else {\n      this.scrollMoveTimer = setInterval(function () {\n        _this.scrollBackwardOnSelection();\n      }, 500);\n    }\n  };\n  TextSelection.prototype.scrollForwardOnSelection = function () {\n    this.isMouseLeaveSelection = true;\n    this.pdfViewerBase.viewerContainer.scrollTop = this.pdfViewerBase.viewerContainer.scrollTop + 200;\n    this.stichSelectionOnScroll(this.pdfViewerBase.currentPageNumber - 1);\n  };\n  TextSelection.prototype.scrollBackwardOnSelection = function () {\n    this.isMouseLeaveSelection = true;\n    this.pdfViewerBase.viewerContainer.scrollTop = this.pdfViewerBase.viewerContainer.scrollTop - 200;\n    this.stichSelectionOnScroll(this.pdfViewerBase.currentPageNumber - 1);\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.clear = function () {\n    if (this.scrollMoveTimer) {\n      this.isMouseLeaveSelection = false;\n      clearInterval(this.scrollMoveTimer);\n    }\n  };\n  /**\n   * @param element\n   * @param x\n   * @param y\n   * @param isStoreSelection\n   * @param element\n   * @param x\n   * @param y\n   * @param isStoreSelection\n   * @param element\n   * @param x\n   * @param y\n   * @param isStoreSelection\n   * @private\n   */\n  // eslint-disable-next-line\n  TextSelection.prototype.selectAWord = function (element, x, y, isStoreSelection) {\n    if (element.nodeType === element.TEXT_NODE) {\n      var selection = window.getSelection();\n      var range = element.ownerDocument.createRange();\n      range.selectNodeContents(element);\n      var currentPosition = 0;\n      var endPosition = range.endOffset;\n      while (currentPosition < endPosition) {\n        range.setStart(element, currentPosition);\n        range.setEnd(element, currentPosition + 1);\n        var rangeBounds = range.getBoundingClientRect();\n        if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n          var textContent = element.textContent;\n          var indices = [];\n          var startPosition = void 0;\n          var endPos = void 0;\n          for (var i = 0; i < textContent.length; i++) {\n            if (textContent[i] === ' ') {\n              indices.push(i);\n            }\n          }\n          for (var j = 0; j < indices.length; j++) {\n            if (currentPosition === indices[j]) {\n              startPosition = indices[j];\n              endPos = indices[j];\n            }\n            if (indices[0] > currentPosition) {\n              startPosition = 0;\n              endPos = indices[j];\n              break;\n            }\n            if (currentPosition > indices[j] && currentPosition < indices[j + 1]) {\n              startPosition = indices[j];\n              endPos = indices[j + 1];\n            } else if (currentPosition > indices[j]) {\n              if (!indices[j + 1]) {\n                startPosition = indices[j];\n              }\n            }\n          }\n          if (!endPos) {\n            endPos = textContent.length;\n          }\n          if (startPosition === 0) {\n            range.setStart(element, startPosition);\n          } else {\n            range.setStart(element, startPosition + 1);\n          }\n          range.setEnd(element, endPos);\n          selection.removeAllRanges();\n          selection.addRange(range);\n          this.isTextSelection = true;\n          // eslint-disable-next-line max-len\n          var startParent = isNullOrUndefined(range.startContainer.parentElement) ? range.startContainer.parentNode : range.startContainer.parentElement;\n          // eslint-disable-next-line radix\n          this.selectionStartPage = parseInt(startParent.id.split('_text_')[1]);\n          if (isStoreSelection) {\n            // eslint-disable-next-line max-len\n            this.selectionAnchorTouch = {\n              anchorNode: selection.anchorNode.parentElement.id,\n              anchorOffset: selection.anchorOffset\n            };\n            this.selectionFocusTouch = {\n              focusNode: selection.focusNode.parentElement.id,\n              focusOffset: selection.focusOffset\n            };\n          }\n          if (!Browser.isIE) {\n            range.detach();\n          }\n          break;\n        }\n        currentPosition += 1;\n      }\n    } else {\n      for (var i = 0; i < element.childNodes.length; i++) {\n        var range = this.getSelectionRange(i, element);\n        var rangeBounds = range.getBoundingClientRect();\n        if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n          range.detach();\n          this.selectAWord(element.childNodes[i], x, y, isStoreSelection);\n        } else {\n          range.detach();\n        }\n      }\n    }\n  };\n  TextSelection.prototype.getSelectionRange = function (index, element) {\n    var range = element.childNodes[index].ownerDocument.createRange();\n    range.selectNodeContents(element.childNodes[index]);\n    return range;\n  };\n  /**\n   * @param event\n   * @private\n   */\n  TextSelection.prototype.selectEntireLine = function (event) {\n    var textIds = [];\n    var targetElement = event.target;\n    var targetRect = targetElement.getBoundingClientRect();\n    // eslint-disable-next-line\n    var targetcentre = parseInt((targetRect.top + targetRect.height / 2).toString());\n    // eslint-disable-next-line radix\n    var pageNumber = parseInt(event.target.id.split('_text_')[1]);\n    var textDivs = document.querySelectorAll('div[id*=\"' + this.pdfViewer.element.id + '_text_' + pageNumber + '\"]');\n    if (targetElement.classList.contains('e-pv-text')) {\n      this.pdfViewer.fireTextSelectionStart(pageNumber + 1);\n      for (var i = 0; i < textDivs.length; i++) {\n        var rect = textDivs[i].getBoundingClientRect();\n        // eslint-disable-next-line radix\n        var topValue = parseInt(rect.top.toString());\n        // eslint-disable-next-line radix\n        var bottomValue = parseInt(rect.bottom.toString());\n        if (topValue <= targetcentre && bottomValue > targetcentre && targetRect.bottom + 10 > bottomValue) {\n          var textId = textDivs[i].id;\n          if (textId !== '') {\n            textIds.push(textId);\n          }\n        }\n      }\n      var selection = window.getSelection();\n      selection.removeAllRanges();\n      var range = document.createRange();\n      var lengths = textIds.length - 1;\n      var d1 = document.getElementById(textIds[0]);\n      var d2 = document.getElementById(textIds[lengths]);\n      var childNodes = d2.childNodes.length;\n      if (childNodes > 0) {\n        range.setStart(d1.childNodes[0], 0);\n        range.setEnd(d2.childNodes[0], d2.textContent.length);\n      } else {\n        range.setStart(d1.childNodes[0], 0);\n        range.setEnd(d2, 1);\n      }\n      // eslint-disable-next-line radix\n      this.selectionStartPage = parseInt(range.startContainer.parentElement.id.split('_text_')[1]);\n      selection.addRange(range);\n      this.isTextSelection = true;\n      if (selection != null && this.pdfViewer.contextMenuSettings.contextMenuAction === 'MouseUp') {\n        this.calculateContextMenuPosition(event.clientY, event.clientY);\n      }\n    }\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.enableTextSelectionMode = function () {\n    this.pdfViewerBase.isTextSelectionDisabled = false;\n    if (!isNullOrUndefined(this.pdfViewerBase.viewerContainer)) {\n      this.pdfViewerBase.viewerContainer.classList.remove('e-disable-text-selection');\n      this.pdfViewerBase.viewerContainer.classList.add('e-enable-text-selection');\n      this.pdfViewerBase.viewerContainer.addEventListener('selectstart', function () {\n        return true;\n      });\n    }\n  };\n  TextSelection.prototype.clearTextSelection = function () {\n    if (this.isTextSelection) {\n      this.pdfViewerBase.textLayer.clearDivSelection();\n      if (window.getSelection) {\n        if (window.getSelection().removeAllRanges) {\n          window.getSelection().removeAllRanges();\n        }\n      }\n      if (this.pdfViewer.linkAnnotationModule) {\n        var lowerPageIndex = this.pdfViewerBase.currentPageNumber - 3;\n        lowerPageIndex = lowerPageIndex < 0 ? 0 : lowerPageIndex;\n        var higherPageIndex = this.pdfViewer.currentPageNumber + 1;\n        // eslint-disable-next-line max-len\n        higherPageIndex = higherPageIndex < this.pdfViewerBase.pageCount - 1 ? higherPageIndex : this.pdfViewerBase.pageCount - 1;\n        for (var i = lowerPageIndex; i <= higherPageIndex; i++) {\n          this.pdfViewer.linkAnnotationModule.modifyZindexForTextSelection(i, false);\n        }\n      }\n      if (this.pdfViewer.annotation && this.pdfViewer.annotation.textMarkupAnnotationModule) {\n        this.pdfViewer.annotation.textMarkupAnnotationModule.showHideDropletDiv(true);\n      }\n      this.selectionRangeArray = [];\n      this.isTextSelection = false;\n      this.isTouchSelection = false;\n      if (this.pdfViewer.textSearchModule) {\n        this.pdfViewer.textSearchModule.searchAfterSelection();\n      }\n      this.pdfViewerBase.contextMenuModule.close();\n      this.removeTouchElements();\n    }\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.removeTouchElements = function () {\n    if (this.dropDivElementLeft) {\n      this.dropDivElementLeft.parentElement.removeChild(this.dropDivElementLeft);\n      this.dropDivElementLeft = null;\n      this.dropElementLeft.style.transform = 'rotate(0deg)';\n    }\n    if (this.dropDivElementRight) {\n      this.dropDivElementRight.parentElement.removeChild(this.dropDivElementRight);\n      this.dropDivElementRight = null;\n      this.dropElementRight.style.transform = 'rotate(-90deg)';\n    }\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.resizeTouchElements = function () {\n    var viewerContainerLeft = this.pdfViewerBase.viewerContainer.getBoundingClientRect().left;\n    if (this.dropDivElementLeft) {\n      var elementClientRect = this.dropDivElementLeft.getBoundingClientRect();\n      var dropElementHeight = 0;\n      // eslint-disable-next-line max-len\n      var leftCurrentPagePosition = this.pdfViewerBase.getElement('_pageDiv_' + this.topStoreLeft.pageNumber).getBoundingClientRect();\n      this.dropDivElementLeft.style.left = parseFloat(this.topStoreLeft.left.toString()) * this.pdfViewerBase.getZoomFactor() + leftCurrentPagePosition.left - viewerContainerLeft - elementClientRect.width / 2 + 'px';\n      if (this.topStoreLeft.isHeightNeeded) {\n        dropElementHeight = elementClientRect.height / 2 * this.pdfViewerBase.getZoomFactor();\n      }\n      // eslint-disable-next-line max-len\n      this.dropDivElementLeft.style.top = parseFloat(this.topStoreLeft.pageTop.toString()) * this.pdfViewerBase.getZoomFactor() + parseFloat(this.topStoreLeft.topClientValue.toString()) * this.pdfViewerBase.getZoomFactor() + dropElementHeight + 'px';\n    }\n    if (this.dropDivElementRight) {\n      var elementClientRect = this.dropDivElementRight.getBoundingClientRect();\n      var dropElementHeight = 0;\n      // eslint-disable-next-line max-len\n      var rightCurrentPagePosition = this.pdfViewerBase.getElement('_pageDiv_' + this.topStoreRight.pageNumber).getBoundingClientRect();\n      this.dropDivElementRight.style.left = parseFloat(this.topStoreRight.left.toString()) * this.pdfViewerBase.getZoomFactor() + rightCurrentPagePosition.left - viewerContainerLeft - elementClientRect.width / 2 + 'px';\n      if (this.topStoreRight.isHeightNeeded) {\n        dropElementHeight = elementClientRect.height / 2 * this.pdfViewerBase.getZoomFactor();\n      }\n      // eslint-disable-next-line max-len\n      this.dropDivElementRight.style.top = parseFloat(this.topStoreRight.pageTop.toString()) * this.pdfViewerBase.getZoomFactor() + parseFloat(this.topStoreRight.topClientValue.toString()) * this.pdfViewerBase.getZoomFactor() + dropElementHeight + 'px';\n    }\n  };\n  /**\n   * @param event\n   * @private\n   */\n  TextSelection.prototype.textSelectionOnMouseup = function (event) {\n    this.clear();\n    if (window.getSelection().anchorNode !== null) {\n      this.isMouseLeaveSelection = false;\n      this.isSelectionStartTriggered = false;\n      this.maintainSelectionOnZoom(true, false);\n      this.fireTextSelectEnd();\n      var isTextSearch = this.pdfViewerBase.textLayer.getTextSearchStatus();\n      if (isTextSearch) {\n        this.pdfViewerBase.textLayer.clearDivSelection();\n        // eslint-disable-next-line\n        var indexes = this.pdfViewer.textSearchModule.getIndexes();\n        var lowerPageValue = parseFloat(indexes.lowerPageValue.toString());\n        var higherPageValue = parseFloat(indexes.higherPageValue.toString());\n        for (var i = lowerPageValue; i < higherPageValue; i++) {\n          this.applySelectionRangeOnScroll(i);\n        }\n        this.pdfViewer.textSearchModule.searchAfterSelection();\n      } else {\n        this.applySpanForSelection();\n      }\n      if (this.pdfViewer.linkAnnotationModule) {\n        this.pdfViewer.linkAnnotationModule.modifyZindexForTextSelection(this.pdfViewerBase.currentPageNumber - 1, false);\n      }\n      if (this.isTextSearched && this.pdfViewer.contextMenuSettings.contextMenuAction === 'MouseUp') {\n        this.calculateContextMenuPosition(event.clientY, event.clientX);\n        this.isTextSearched = false;\n      }\n    } else {\n      this.pdfViewerBase.textLayer.clearDivSelection();\n      if (this.pdfViewer.textSearchModule) {\n        this.pdfViewer.textSearchModule.searchAfterSelection();\n      }\n      this.pdfViewerBase.contextMenuModule.close();\n      this.removeTouchElements();\n    }\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.fireTextSelectEnd = function () {\n    if (this.selectionRangeArray.length !== 0) {\n      var selectEndPageIndex = 0;\n      var selectedText = '';\n      // eslint-disable-next-line\n      var selectedBounds = [];\n      for (var k = 0; k < this.selectionRangeArray.length; k++) {\n        selectedText += this.selectionRangeArray[k].textContent;\n        for (var j = 0; j < this.selectionRangeArray[k].rectangleBounds.length; j++) {\n          var currentBound = this.selectionRangeArray[k].rectangleBounds[j];\n          // eslint-disable-next-line max-len\n          selectedBounds.push({\n            left: currentBound.left,\n            right: currentBound.right,\n            top: currentBound.top,\n            bottom: currentBound.bottom,\n            width: currentBound.width,\n            height: currentBound.height,\n            pageIndex: this.selectionRangeArray[k].pageNumber + 1\n          });\n        }\n        if (this.selectionRangeArray[k].isBackward && k === 0) {\n          selectEndPageIndex = this.selectionRangeArray[k].pageNumber + 1;\n        } else if (!this.selectionRangeArray[k].isBackward && k === this.selectionRangeArray.length - 1) {\n          selectEndPageIndex = this.selectionRangeArray[k].pageNumber + 1;\n        }\n      }\n      this.pdfViewer.fireTextSelectionEnd(selectEndPageIndex, selectedText, selectedBounds);\n    }\n  };\n  /**\n   * @param isMaintainSelection\n   * @param isStich\n   * @param isMaintainSelection\n   * @param isStich\n   * @private\n   */\n  TextSelection.prototype.maintainSelectionOnZoom = function (isMaintainSelection, isStich) {\n    var selection = window.getSelection();\n    if (selection.type === 'Range' || !selection.type && !selection.isCollapsed) {\n      var isBackward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n      if (selection.anchorNode !== null) {\n        // eslint-disable-next-line radix\n        var anchorPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n        // eslint-disable-next-line radix\n        var focusPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n        if (this.isTouchSelection && isNaN(focusPageId)) {\n          var focusElement = selection.focusNode;\n          if (focusElement === this.pdfViewerBase.pageContainer) {\n            var lastChildNode = this.pdfViewerBase.pageContainer.lastChild;\n            if (lastChildNode.classList.contains('e-pv-touch-select-drop')) {\n              // eslint-disable-next-line radix\n              focusPageId = parseInt(lastChildNode.previousSibling.previousSibling.id.split('_pageDiv_')[1]);\n            } else if (lastChildNode.classList.contains('e-pv-page-div')) {\n              // eslint-disable-next-line radix\n              focusPageId = parseInt(lastChildNode.id.split('_pageDiv_')[1]);\n            }\n          }\n        }\n        if (!isBackward) {\n          for (var i = anchorPageId; i <= focusPageId; i++) {\n            this.maintainSelectionOnScroll(i, isStich);\n          }\n        } else {\n          for (var i = anchorPageId; i >= focusPageId; i--) {\n            this.maintainSelectionOnScroll(i, isStich);\n          }\n        }\n      }\n      if (!isMaintainSelection) {\n        selection.removeAllRanges();\n      }\n    }\n  };\n  /**\n   * @param pageNumber\n   * @private\n   */\n  TextSelection.prototype.isSelectionAvailableOnScroll = function (pageNumber) {\n    var isSelectionAvailable = false;\n    var ranges = this.selectionRangeArray;\n    for (var i = 0; i < ranges.length; i++) {\n      if (ranges[i] !== null) {\n        if (pageNumber === ranges[i].pageNumber) {\n          isSelectionAvailable = true;\n          if (this.isTouchSelection && !this.pdfViewerBase.getMagnified()) {\n            isSelectionAvailable = false;\n          }\n          break;\n        }\n      }\n    }\n    return isSelectionAvailable;\n  };\n  /**\n   * @param pageNumber\n   * @private\n   */\n  TextSelection.prototype.applySelectionRangeOnScroll = function (pageNumber) {\n    if (this.isMouseLeaveSelection) {\n      this.applySelectionMouseScroll(pageNumber);\n    } else {\n      this.applySelectionRange(pageNumber);\n    }\n  };\n  // eslint-disable-next-line\n  TextSelection.prototype.getSelectionRangeFromArray = function (pageNumber) {\n    var isSelectionAvailable = false;\n    var selectionRange = null;\n    var ranges = this.selectionRangeArray;\n    for (var i = 0; i < ranges.length; i++) {\n      if (ranges[i] !== null) {\n        if (pageNumber === ranges[i].pageNumber) {\n          selectionRange = ranges[i];\n          isSelectionAvailable = true;\n          break;\n        }\n      }\n    }\n    return {\n      isSelectionAvailable: isSelectionAvailable,\n      selectionRange: selectionRange\n    };\n  };\n  TextSelection.prototype.applySelectionRange = function (pageNumber) {\n    var selectionObject = this.getSelectionRangeFromArray(pageNumber);\n    var isSelectionAvailable = selectionObject.isSelectionAvailable;\n    var textLayer = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + pageNumber);\n    if (textLayer) {\n      if (isSelectionAvailable && textLayer.childNodes.length !== 0) {\n        var selectionRange = selectionObject.selectionRange;\n        var anchorOffsetDiv = void 0;\n        var focusOffsetDiv = void 0;\n        var anchorOffset = void 0;\n        var focusOffset = void 0;\n        if (selectionRange.isBackward) {\n          // eslint-disable-next-line radix\n          var startId = parseInt(selectionRange.endNode.split('_text_')[1].split('_')[1]);\n          // eslint-disable-next-line radix\n          var endId = parseInt(selectionRange.startNode.split('_text_')[1].split('_')[1]);\n          if (startId < endId) {\n            anchorOffsetDiv = startId;\n            anchorOffset = selectionRange.endOffset;\n            focusOffset = selectionRange.startOffset;\n            focusOffsetDiv = endId;\n          } else {\n            anchorOffsetDiv = endId;\n            anchorOffset = selectionRange.endOffset;\n            focusOffsetDiv = startId;\n            focusOffset = selectionRange.startOffset;\n          }\n        } else {\n          // eslint-disable-next-line radix\n          anchorOffsetDiv = parseInt(selectionRange.startNode.split('text_')[1].split('_')[1]);\n          // eslint-disable-next-line radix\n          focusOffsetDiv = parseInt(selectionRange.endNode.split('text_')[1].split('_')[1]);\n          anchorOffset = selectionRange.startOffset;\n          focusOffset = selectionRange.endOffset;\n        }\n        window.getSelection().removeAllRanges();\n        // eslint-disable-next-line max-len\n        this.pdfViewerBase.textLayer.applySpanForSelection(pageNumber, pageNumber, anchorOffsetDiv, focusOffsetDiv, anchorOffset, focusOffset);\n        if (this.pdfViewer.textSearchModule) {\n          this.pdfViewer.textSearchModule.searchAfterSelection();\n        }\n      }\n    }\n  };\n  TextSelection.prototype.applySelectionMouseScroll = function (pageNumber) {\n    var selectionObject = this.getSelectionRangeFromArray(pageNumber);\n    var isSelectionAvailable = selectionObject.isSelectionAvailable;\n    if (isSelectionAvailable) {\n      var selectionRange = selectionObject.selectionRange;\n      var selection = window.getSelection();\n      var anchorNode = document.getElementById(selectionRange.startNode).childNodes[0];\n      var focusNode = document.getElementById(selectionRange.endNode).childNodes[0];\n      var range = document.createRange();\n      if (selection.anchorNode === null) {\n        if (!selectionRange.isBackward) {\n          range.setStart(anchorNode, selectionRange.startOffset);\n          range.setEnd(focusNode, selectionRange.endOffset);\n        } else {\n          range.setStart(focusNode, selectionRange.endOffset);\n          range.setEnd(anchorNode, selectionRange.startOffset);\n        }\n      } else {\n        // eslint-disable-next-line\n        var anchorPageIndex = isNaN(parseInt(selection.anchorNode.parentElement.id.split('_text_')[1])) ? parseInt(selection.anchorNode.id.split('_pageDiv_')[1]) : parseInt(selection.anchorNode.parentElement.id.split('_text_')[1]);\n        if (isNaN(anchorPageIndex)) {\n          // eslint-disable-next-line radix\n          anchorPageIndex = parseInt(selection.anchorNode.id.split('_text_')[1]);\n        }\n        // eslint-disable-next-line\n        var focusPageIndex = isNaN(parseInt(selection.focusNode.parentElement.id.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_pageDiv_')[1]) : parseInt(selection.focusNode.parentElement.id.split('_text_')[1]);\n        // eslint-disable-next-line radix\n        var currentAnchorIndex = parseInt(selectionRange.startNode.split('_text_')[1]);\n        if (anchorPageIndex === focusPageIndex && anchorPageIndex === currentAnchorIndex) {\n          if (!selectionRange.isBackward) {\n            range.setStart(anchorNode, selectionRange.startOffset);\n            range.setEnd(focusNode, selectionRange.endOffset);\n          } else {\n            range.setStart(focusNode, selectionRange.endOffset);\n            range.setEnd(anchorNode, selectionRange.startOffset);\n          }\n        } else if (!isNaN(anchorPageIndex)) {\n          if (!isNaN(anchorPageIndex) && !selectionRange.isBackward) {\n            // eslint-disable-next-line max-len\n            if (anchorPageIndex < currentAnchorIndex && currentAnchorIndex < focusPageIndex && anchorPageIndex !== focusPageIndex) {\n              range.setStart(selection.anchorNode, selection.anchorOffset);\n              range.setEnd(selection.focusNode, selection.focusOffset);\n            } else if (anchorPageIndex < currentAnchorIndex) {\n              range.setStart(selection.anchorNode, selection.anchorOffset);\n              range.setEnd(focusNode, selectionRange.endOffset);\n            } else {\n              range.setStart(anchorNode, selectionRange.startOffset);\n              range.setEnd(selection.focusNode, selection.focusOffset);\n            }\n          } else {\n            var isBackward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n            // eslint-disable-next-line max-len\n            if (anchorPageIndex > currentAnchorIndex && currentAnchorIndex > focusPageIndex && anchorPageIndex !== focusPageIndex) {\n              if (!isBackward) {\n                range.setStart(selection.anchorNode, selection.anchorOffset);\n                range.setEnd(selection.focusNode, selection.focusOffset);\n              } else {\n                selection.extend(selection.focusNode, selection.focusOffset);\n              }\n              // eslint-disable-next-line max-len\n            } else if (anchorPageIndex < currentAnchorIndex && currentAnchorIndex < focusPageIndex && anchorPageIndex !== focusPageIndex) {\n              if (!isBackward) {\n                range.setStart(selection.anchorNode, selection.anchorOffset);\n                range.setEnd(selection.focusNode, selection.focusOffset);\n              } else {\n                selection.extend(selection.focusNode, selection.focusOffset);\n              }\n            } else if (anchorPageIndex < currentAnchorIndex) {\n              if (!isBackward) {\n                if (currentAnchorIndex !== this.selectionRangeArray[0].pageNumber) {\n                  range.setStart(selection.anchorNode, selection.anchorOffset);\n                  range.setEnd(focusNode, selectionRange.endOffset);\n                } else {\n                  range.setStart(selection.anchorNode, selection.anchorOffset);\n                  range.setEnd(anchorNode, selectionRange.startOffset);\n                }\n              } else {\n                if (currentAnchorIndex !== this.selectionRangeArray[0].pageNumber) {\n                  this.extendCurrentSelection(focusNode.parentElement, selectionRange.endOffset, selection, range);\n                } else {\n                  this.extendCurrentSelection(anchorNode.parentElement, selectionRange.startOffset, selection, range);\n                }\n              }\n            } else if (anchorPageIndex === currentAnchorIndex) {\n              if (currentAnchorIndex === focusPageIndex) {\n                range.setStart(anchorNode, selectionRange.startOffset);\n                range.setEnd(anchorNode, selectionRange.startOffset);\n                selection.removeAllRanges();\n                selection.addRange(range);\n                range = document.createRange();\n                selection.extend(focusNode, selectionRange.endOffset);\n              } else {\n                if (isBackward) {\n                  this.extendCurrentSelection(focusNode.parentElement, selectionRange.endOffset, selection, range);\n                } else {\n                  range.setStart(focusNode, selectionRange.endOffset);\n                  range.setEnd(selection.focusNode, selection.focusOffset);\n                }\n              }\n            } else if (focusPageIndex === currentAnchorIndex) {\n              if (isBackward) {\n                selection.extend(selection.focusNode, selection.focusOffset);\n              } else {\n                range.setStart(selection.anchorNode, selection.anchorOffset);\n                range.setEnd(selection.focusNode, selection.focusOffset);\n              }\n            } else if (anchorPageIndex > currentAnchorIndex) {\n              // eslint-disable-next-line radix\n              var currentAnchorOffset = parseInt(selectionRange.startNode.split('_' + currentAnchorIndex + '_')[1]);\n              // eslint-disable-next-line radix\n              var currentFocusOffset = parseInt(selectionRange.endNode.split('_' + currentAnchorIndex + '_')[1]);\n              if (isBackward) {\n                if (currentAnchorIndex !== this.selectionRangeArray[0].pageNumber) {\n                  if (currentAnchorOffset < currentFocusOffset) {\n                    this.extendCurrentSelection(anchorNode.parentElement, selectionRange.startOffset, selection, range);\n                  } else {\n                    range.setStart(focusNode.parentElement, selectionRange.endOffset);\n                    range.setEnd(selection.anchorNode, selection.anchorOffset);\n                  }\n                } else {\n                  this.extendCurrentSelection(focusNode.parentElement, selectionRange.endOffset, selection, range);\n                }\n              } else {\n                if (currentAnchorOffset < currentFocusOffset) {\n                  range.setStart(anchorNode, selectionRange.startOffset);\n                  range.setEnd(selection.focusNode, selection.focusOffset);\n                } else {\n                  range.setStart(focusNode, selectionRange.endOffset);\n                  range.setEnd(selection.focusNode, selection.focusOffset);\n                }\n              }\n            }\n          }\n        } else if (isNaN(anchorPageIndex)) {\n          if (!selectionRange.isBackward) {\n            range.setStart(anchorNode, selectionRange.startOffset);\n            range.setEnd(focusNode, selectionRange.endOffset);\n          } else {\n            range.setStart(focusNode, selectionRange.endOffset);\n            range.setEnd(anchorNode, selectionRange.startOffset);\n          }\n        }\n      }\n      if (range.toString() !== '') {\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n    }\n  };\n  /**\n   * @param pageNumber\n   * @param isStich\n   * @param pageNumber\n   * @param isStich\n   * @private\n   */\n  TextSelection.prototype.maintainSelectionOnScroll = function (pageNumber, isStich) {\n    var isSelectionAvailable = this.isSelectionAvailableOnScroll(pageNumber);\n    if (this.isTextSelection && !isSelectionAvailable) {\n      this.maintainSelection(pageNumber, isStich);\n    }\n  };\n  /**\n   * @param pageNumber\n   * @param isStich\n   * @private\n   */\n  TextSelection.prototype.maintainSelection = function (pageNumber, isStich) {\n    var selection = window.getSelection();\n    if (this.isTextSelection && (selection.type === 'Range' || !selection.type && !selection.isCollapsed)) {\n      // eslint-disable-next-line\n      var anchorPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n      // eslint-disable-next-line\n      var focusPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n      if (isNaN(focusPageId) && selection.anchorNode !== null) {\n        var backward_1 = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n        if (!backward_1) {\n          // eslint-disable-next-line radix\n          var lastChildNode = this.pdfViewerBase.pageContainer.lastChild;\n          if (lastChildNode.classList.contains('e-pv-touch-select-drop')) {\n            // eslint-disable-next-line radix\n            focusPageId = parseInt(lastChildNode.previousSibling.previousSibling.id.split('_pageDiv_')[1]);\n          } else {\n            // eslint-disable-next-line radix\n            focusPageId = parseInt(lastChildNode.id.split('_pageDiv_')[1]);\n          }\n        } else {\n          // eslint-disable-next-line radix\n          focusPageId = parseInt(this.pdfViewerBase.pageContainer.firstChild.id.split('_pageDiv_')[1]);\n        }\n      }\n      var backward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n      if (this.isTouchSelection && pageNumber > focusPageId && pageNumber > anchorPageId) {\n        return;\n      }\n      if (anchorPageId === focusPageId) {\n        var selectionObject = null;\n        var selectionBounds = this.getSelectionBounds(selection.getRangeAt(0), pageNumber);\n        var selectionRectBounds = this.getSelectionRectangleBounds(selection.getRangeAt(0), pageNumber);\n        // eslint-disable-next-line max-len\n        var anchorOffsetValue = this.getNodeElementFromNode(selection.anchorNode).childNodes.length === 1 ? selection.anchorOffset : this.getCorrectOffset(selection.anchorNode, selection.anchorOffset);\n        var focusOffsetValue = this.getNodeElementFromNode(selection.focusNode).childNodes.length === 1 ? selection.focusOffset : this.getCorrectOffset(selection.focusNode, selection.focusOffset);\n        selectionObject = {\n          isBackward: backward,\n          startNode: this.getNodeElementFromNode(selection.anchorNode).id,\n          startOffset: anchorOffsetValue,\n          endNode: this.getNodeElementFromNode(selection.focusNode).id,\n          // eslint-disable-next-line max-len\n          endOffset: focusOffsetValue,\n          textContent: this.allTextContent,\n          pageNumber: pageNumber,\n          bound: selectionBounds,\n          rectangleBounds: selectionRectBounds\n        };\n        this.pushSelectionRangeObject(selectionObject, pageNumber);\n      } else {\n        var selectionObject = this.createRangeObjectOnScroll(pageNumber, anchorPageId, focusPageId);\n        if (selectionObject) {\n          this.pushSelectionRangeObject(selectionObject, pageNumber);\n          if (isStich) {\n            this.stichSelection(backward, selection, pageNumber);\n          }\n        }\n      }\n    }\n  };\n  TextSelection.prototype.getCorrectOffset = function (node, offset) {\n    var offsetValue = 0;\n    var parentElement = this.getNodeElementFromNode(node);\n    for (var i = 0; i < parentElement.childNodes.length; i++) {\n      if (parentElement.childNodes[i] === node) {\n        offsetValue = offsetValue + offset;\n        break;\n      } else {\n        offsetValue = offsetValue + parentElement.childNodes[i].textContent.length;\n      }\n    }\n    return offsetValue;\n  };\n  TextSelection.prototype.pushSelectionRangeObject = function (selectionObject, pageNumber) {\n    if (this.isTouchSelection) {\n      var currentObject = this.selectionRangeArray.filter(\n      // eslint-disable-next-line\n      function (obj) {\n        return obj.pageNumber === pageNumber;\n      });\n      if (currentObject.length > 0) {\n        var currentObjectIndex = this.selectionRangeArray.indexOf(currentObject[0]);\n        this.selectionRangeArray.splice(currentObjectIndex, 1, selectionObject);\n        return;\n      }\n    }\n    var nextPageObject = this.selectionRangeArray.filter(\n    // eslint-disable-next-line\n    function (obj) {\n      return obj.pageNumber === pageNumber + 1;\n    });\n    if (nextPageObject.length === 0) {\n      if (this.isTouchSelection && this.selectionRangeArray.length !== 0) {\n        var prevPageObject = this.selectionRangeArray.filter(\n        // eslint-disable-next-line\n        function (obj) {\n          return obj.pageNumber === pageNumber - 1;\n        });\n        if (prevPageObject.length !== 0) {\n          var prevIndex = this.selectionRangeArray.indexOf(prevPageObject[0]);\n          this.selectionRangeArray.splice(prevIndex + 1, 0, selectionObject);\n        } else {\n          var firstObject = this.selectionRangeArray[0];\n          if (pageNumber < firstObject.pageNumber) {\n            this.selectionRangeArray.splice(0, 0, selectionObject);\n          } else {\n            this.selectionRangeArray.push(selectionObject);\n          }\n        }\n      } else {\n        this.selectionRangeArray.push(selectionObject);\n      }\n    } else {\n      var index = this.selectionRangeArray.indexOf(nextPageObject[0]);\n      this.selectionRangeArray.splice(index, 0, selectionObject);\n    }\n  };\n  TextSelection.prototype.extendCurrentSelection = function (element, offset, selection, range) {\n    var currentFocusOffset = selection.focusOffset;\n    var currentFocusElement = selection.focusNode.parentElement.id;\n    // eslint-disable-next-line\n    var focusPageId = isNaN(parseInt(currentFocusElement.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_pageDiv_')[1]) : parseInt(currentFocusElement.split('_text_')[1]);\n    // eslint-disable-next-line radix\n    if (isNaN(parseInt(currentFocusElement.split('_text_')[1]))) {\n      // eslint-disable-next-line\n      currentFocusElement = this.pdfViewerBase.getElement('_textLayer_' + (focusPageId + 1)).firstChild.id;\n    }\n    range.setStart(element.childNodes[0], offset);\n    range.setEnd(element.childNodes[0], offset);\n    selection.removeAllRanges();\n    selection.addRange(range);\n    selection.extend(document.getElementById(currentFocusElement).childNodes[0], currentFocusOffset);\n  };\n  TextSelection.prototype.stichSelection = function (backward, selection, pageNumber) {\n    var range = document.createRange();\n    var nextPageElement;\n    if (backward) {\n      nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber - 1));\n      if (nextPageElement) {\n        var lastElement = nextPageElement.lastChild;\n        if (lastElement) {\n          this.extendCurrentSelection(lastElement, this.getTextLastLength(lastElement), selection, range);\n        } else {\n          nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber - 2));\n          lastElement = nextPageElement.lastChild;\n          this.extendCurrentSelection(lastElement, this.getTextLastLength(lastElement), selection, range);\n        }\n      } else {\n        nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber + 1));\n        var lastElement = nextPageElement.firstChild;\n        this.extendCurrentSelection(lastElement, 0, selection, range);\n      }\n    } else {\n      nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber + 1));\n      if (nextPageElement) {\n        var firstElement = nextPageElement.firstChild;\n        if (!firstElement) {\n          nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber + 2));\n          firstElement = nextPageElement.firstChild;\n          range.setStart(firstElement.childNodes[0], 0);\n        } else {\n          range.setStart(firstElement.childNodes[0], 0);\n        }\n        range.setEnd(selection.focusNode, selection.focusOffset);\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n    }\n  };\n  /**\n   * @param currentPageNumber\n   * @private\n   */\n  TextSelection.prototype.textSelectionOnMouseWheel = function (currentPageNumber) {\n    this.isMouseLeaveSelection = true;\n    this.stichSelectionOnScroll(currentPageNumber);\n  };\n  /**\n   * @param currentPageNumber\n   * @private\n   */\n  TextSelection.prototype.stichSelectionOnScroll = function (currentPageNumber) {\n    var selection = window.getSelection();\n    if (this.isTextSelection) {\n      // eslint-disable-next-line radix\n      var anchorPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n      // eslint-disable-next-line radix\n      var focusPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n      var nextPageElement = void 0;\n      if (anchorPageId !== currentPageNumber && focusPageId !== currentPageNumber) {\n        var backward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n        if (!backward) {\n          nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (currentPageNumber - 1));\n          if (nextPageElement) {\n            var lastElement = nextPageElement.lastChild;\n            if (lastElement) {\n              if (lastElement.childNodes[0]) {\n                this.extendSelectionStich(lastElement.childNodes[0], this.getTextLastLength(lastElement), selection);\n              } else {\n                this.extendSelectionStich(lastElement, this.getTextLastLength(lastElement), selection);\n              }\n            } else {\n              nextPageElement = this.pdfViewerBase.getElement('_textLayer_' + currentPageNumber);\n              var lastElement_1 = nextPageElement.firstChild;\n              this.extendSelectionStich(lastElement_1.childNodes[0], 0, selection);\n            }\n          }\n        } else {\n          nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (currentPageNumber - 1));\n          if (nextPageElement) {\n            var lastElement = nextPageElement.firstChild;\n            if (lastElement) {\n              this.extendSelectionStich(lastElement.childNodes[0], 0, selection);\n            }\n          }\n        }\n      }\n      this.maintainSelectionArray();\n    }\n  };\n  TextSelection.prototype.extendSelectionStich = function (node, offset, selection) {\n    if (selection.extend) {\n      selection.extend(node, offset);\n    }\n  };\n  /**\n   * @param pageNumber\n   * @param anchorPageId\n   * @param focusPageId\n   * @param pageNumber\n   * @param anchorPageId\n   * @param focusPageId\n   * @private\n   */\n  TextSelection.prototype.createRangeObjectOnScroll = function (pageNumber, anchorPageId, focusPageId) {\n    var selectionObject = null;\n    var selection = window.getSelection();\n    if (selection.anchorNode !== null) {\n      var backward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n      var firstElement = void 0;\n      var lastElement = void 0;\n      var startOffset = void 0;\n      var endOffset = void 0;\n      var element = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + pageNumber);\n      if (element.childNodes) {\n        if (!backward) {\n          if (pageNumber === anchorPageId) {\n            firstElement = this.getNodeElementFromNode(selection.anchorNode);\n            // eslint-disable-next-line max-len\n            lastElement = element.lastChild;\n            startOffset = this.getCorrectOffset(selection.anchorNode, selection.anchorOffset);\n            endOffset = this.getTextLastLength(lastElement);\n          } else if (pageNumber > anchorPageId && pageNumber < focusPageId) {\n            // eslint-disable-next-line max-len\n            firstElement = element.firstChild;\n            // eslint-disable-next-line max-len\n            lastElement = element.lastChild;\n            startOffset = 0;\n            endOffset = this.getTextLastLength(lastElement);\n          } else if (pageNumber === focusPageId) {\n            // eslint-disable-next-line max-len\n            firstElement = element.firstChild;\n            var pageNumberIndex = this.getNodeElementFromNode(selection.focusNode).id.indexOf(focusPageId.toString());\n            if (pageNumberIndex !== -1) {\n              lastElement = this.getNodeElementFromNode(selection.focusNode);\n              endOffset = this.getCorrectOffset(selection.focusNode, selection.focusOffset);\n            } else {\n              // eslint-disable-next-line max-len\n              lastElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + focusPageId).lastChild;\n              endOffset = this.getTextLastLength(lastElement);\n            }\n            startOffset = 0;\n          }\n        } else {\n          if (pageNumber === anchorPageId) {\n            firstElement = this.getNodeElementFromNode(selection.anchorNode);\n            // eslint-disable-next-line max-len\n            lastElement = element.firstChild;\n            startOffset = this.getCorrectOffset(selection.anchorNode, selection.anchorOffset);\n            endOffset = 0;\n          } else if (pageNumber < anchorPageId && pageNumber > focusPageId) {\n            // eslint-disable-next-line max-len\n            firstElement = element.firstChild;\n            // eslint-disable-next-line max-len\n            lastElement = element.lastChild;\n            startOffset = 0;\n            endOffset = this.getTextLastLength(lastElement);\n          } else if (pageNumber === focusPageId) {\n            firstElement = this.getNodeElementFromNode(selection.focusNode);\n            // eslint-disable-next-line max-len\n            lastElement = element.lastChild;\n            startOffset = this.getCorrectOffset(selection.focusNode, selection.focusOffset);\n            endOffset = this.getTextLastLength(lastElement);\n          }\n        }\n        if (firstElement && lastElement) {\n          // eslint-disable-next-line max-len\n          var selectionRangeObject = this.getSelectionRangeObject(firstElement.id, startOffset, lastElement.id, endOffset, pageNumber);\n          var selectionString = selectionRangeObject.toString();\n          var selectionBound = this.getSelectionBounds(selectionRangeObject, pageNumber);\n          var selectionRectBounds = this.getSelectionRectangleBounds(selectionRangeObject, pageNumber);\n          // eslint-disable-next-line max-len\n          return selectionObject = {\n            isBackward: backward,\n            startNode: firstElement.id,\n            startOffset: startOffset,\n            endNode: lastElement.id,\n            endOffset: endOffset,\n            textContent: this.allTextContent,\n            pageNumber: pageNumber,\n            bound: selectionBound,\n            rectangleBounds: selectionRectBounds\n          };\n        } else {\n          return null;\n        }\n      }\n    }\n    return null;\n  };\n  TextSelection.prototype.getSelectionRangeObject = function (startNode, startOffset, endNode, endOffset, pageNumber) {\n    var startElement = document.getElementById(startNode);\n    var endElement = document.getElementById(endNode);\n    if (startElement.childNodes[0]) {\n      startElement = startElement.childNodes[0];\n    }\n    if (endElement.childNodes[0]) {\n      endElement = endElement.childNodes[0];\n    }\n    // eslint-disable-next-line radix\n    var currentAnchorOffset = parseInt(startNode.split('_' + pageNumber + '_')[1]);\n    // eslint-disable-next-line radix\n    var currentFocusOffset = parseInt(endNode.split('_' + pageNumber + '_')[1]);\n    var range = document.createRange();\n    if (currentAnchorOffset <= currentFocusOffset) {\n      range.setStart(startElement, startOffset);\n      range.setEnd(endElement, endOffset);\n    } else {\n      range.setStart(endElement, endOffset);\n      range.setEnd(startElement, startOffset);\n    }\n    return range;\n  };\n  TextSelection.prototype.getSelectionBounds = function (range, pageNumber) {\n    var startElement = this.getNodeElementFromNode(range.startContainer);\n    var endElement = this.getNodeElementFromNode(range.endContainer);\n    var bounds = null;\n    if (startElement !== endElement) {\n      var newStartRange = document.createRange();\n      // eslint-disable-next-line max-len\n      var startRange = this.createRangeForSelection(range.startContainer, range.endContainer, range.startOffset, range.endOffset, newStartRange);\n      bounds = this.normalizeBounds(startRange.getBoundingClientRect(), pageNumber);\n    } else {\n      bounds = this.normalizeBounds(range.getBoundingClientRect(), pageNumber);\n    }\n    return bounds;\n  };\n  TextSelection.prototype.getSelectionRectangleBounds = function (range, pageNumber) {\n    var selectionBounds = [];\n    var startElement = this.getNodeElementFromNode(range.startContainer);\n    var endElement = this.getNodeElementFromNode(range.endContainer);\n    var bounds = null;\n    var selectionTexts = [];\n    this.allTextContent = \"\";\n    if (startElement !== endElement) {\n      var startOffset = 0;\n      var endOffset = 0;\n      var currentId = 0;\n      var anchorPageId = this.pdfViewerBase.textLayer.getPageIndex(range.startContainer);\n      var anchorTextId = this.pdfViewerBase.textLayer.getTextIndex(range.startContainer, anchorPageId);\n      var focusPageId = this.pdfViewerBase.textLayer.getPageIndex(range.endContainer);\n      var focusTextId = this.pdfViewerBase.textLayer.getTextIndex(range.endContainer, focusPageId);\n      var textDivs = this.pdfViewerBase.getElement('_textLayer_' + focusPageId).childNodes;\n      if (pageNumber === anchorPageId) {\n        currentId = anchorTextId;\n      } else {\n        currentId = 0;\n      }\n      for (var j = currentId; j < textDivs.length; j++) {\n        var textElement = textDivs[j];\n        if (j === anchorTextId) {\n          startOffset = range.startOffset;\n        } else {\n          startOffset = 0;\n        }\n        if (j === focusTextId) {\n          endOffset = range.endOffset;\n        } else {\n          endOffset = textElement.textContent.length;\n        }\n        if (startOffset !== 0 || endOffset !== 0) {\n          var newRange = document.createRange();\n          for (var k = 0; k < textElement.childNodes.length; k++) {\n            var node = textElement.childNodes[k];\n            newRange.setStart(node, startOffset);\n            newRange.setEnd(node, endOffset);\n          }\n          var boundingRect = void 0;\n          if (this.pdfViewerBase.clientSideRendering) {\n            boundingRect = this.normalizeBounds(newRange.getBoundingClientRect(), pageNumber);\n            var pageDetails = this.pdfViewerBase.pageSize[pageNumber];\n            var textRotate = 0;\n            var pageRotation = this.getAngle(pageDetails.rotation);\n            if (textElement && textElement.style.transform !== '') {\n              if (textElement.style.transform.startsWith('rotate(90deg)')) {\n                textRotate = 90;\n              } else if (textElement.style.transform.startsWith('rotate(180deg)')) {\n                textRotate = 180;\n              } else if (textElement.style.transform.startsWith('rotate(-90deg)') || textElement.style.transform.startsWith('rotate(270deg)')) {\n                textRotate = 270;\n              } else {\n                textRotate = 0;\n              }\n            }\n            boundingRect.rotation = textRotate;\n          } else {\n            boundingRect = this.normalizeBounds(newRange.getBoundingClientRect(), pageNumber);\n          }\n          selectionBounds.push(boundingRect);\n          var textselection = newRange.toString();\n          selectionTexts.push(textselection);\n          newRange.detach();\n          if (textselection === '\\r\\n') {\n            if (j === focusTextId + 1) {\n              break;\n            }\n          } else if (j === focusTextId) {\n            break;\n          }\n        }\n      }\n      for (var i = 0; i < selectionTexts.length; i++) {\n        var text = selectionTexts[i];\n        // While copy and paste for space construct new line\n        if (i != 0 && text === ' ' && selectionTexts[i - 1].includes('\\r\\n') || i != selectionTexts.length - 1 && selectionTexts[i] === ' ' && selectionTexts[i + 1] === '\\r\\n') {\n          text = '';\n        }\n        if (text.slice(text.length - 2) !== '\\r\\n' || i === selectionTexts.length - 1) {\n          this.allTextContent += text;\n        } else {\n          this.allTextContent += text;\n        }\n      }\n    } else {\n      bounds = this.normalizeBounds(range.getBoundingClientRect(), pageNumber);\n      if (this.pdfViewerBase.clientSideRendering) {\n        var pageDetails = this.pdfViewerBase.pageSize[pageNumber];\n        var textRotate = 0;\n        var pageRotation = this.getAngle(pageDetails.rotation);\n        if (startElement && startElement.style.transform !== '') {\n          if (startElement.style.transform.startsWith('rotate(90deg)')) {\n            textRotate = 90;\n          } else if (startElement.style.transform.startsWith('rotate(180deg)')) {\n            textRotate = 180;\n          } else if (startElement.style.transform.startsWith('rotate(-90deg)') || startElement.style.transform.startsWith('rotate(270deg)')) {\n            textRotate = 270;\n          } else {\n            textRotate = 0;\n          }\n        }\n        bounds.rotation = textRotate;\n      }\n      this.allTextContent = range.toString();\n      selectionBounds.push(bounds);\n    }\n    return selectionBounds;\n  };\n  TextSelection.prototype.getAngle = function (rotation) {\n    var angle = 0;\n    if (rotation) {\n      switch (rotation) {\n        case 0:\n          angle = 0;\n          break;\n        case 1:\n          angle = 90;\n          break;\n        case 2:\n          angle = 180;\n          break;\n        case 3:\n          angle = 270;\n          break;\n      }\n    }\n    return angle;\n  };\n  ;\n  TextSelection.prototype.getTextId = function (elementId) {\n    var index = elementId.lastIndexOf('_');\n    var divId = elementId.substring(index + 1, elementId.length);\n    // eslint-disable-next-line radix\n    return parseInt(divId);\n  };\n  TextSelection.prototype.normalizeBounds = function (bound, pageNumber) {\n    var newBounds = null;\n    var currentPageElement = this.pdfViewerBase.getElement('_pageDiv_' + pageNumber);\n    if (this.pdfViewerBase.isMixedSizeDocument) {\n      var currentTextElement = this.pdfViewerBase.getElement('_textLayer_' + pageNumber);\n      if (currentTextElement) {\n        currentPageElement = currentTextElement;\n      }\n    }\n    var currentPageRect = currentPageElement.getBoundingClientRect();\n    newBounds = {\n      bottom: this.getMagnifiedValue(bound.bottom - currentPageRect.top),\n      height: this.getMagnifiedValue(bound.height),\n      left: this.getMagnifiedValue(bound.left - currentPageRect.left),\n      top: this.getMagnifiedValue(bound.top - currentPageRect.top),\n      right: this.getMagnifiedValue(bound.right - currentPageRect.left),\n      width: this.getMagnifiedValue(bound.width)\n    };\n    return newBounds;\n  };\n  TextSelection.prototype.getMagnifiedValue = function (value) {\n    return value / this.pdfViewerBase.getZoomFactor();\n  };\n  /**\n   * @param pageNumber\n   * @private\n   */\n  TextSelection.prototype.getCurrentSelectionBounds = function (pageNumber) {\n    var bound = null;\n    var ranges = this.selectionRangeArray;\n    for (var i = 0; i < ranges.length; i++) {\n      if (ranges[i] !== null) {\n        if (pageNumber === ranges[i].pageNumber) {\n          bound = ranges[i].bound;\n        }\n      }\n    }\n    return bound;\n  };\n  TextSelection.prototype.createRangeForSelection = function (start, end, startOffset, endOffset, range) {\n    range.setStart(start, startOffset);\n    range.setEnd(end, endOffset);\n    return range;\n  };\n  TextSelection.prototype.maintainSelectionArray = function () {\n    var _this = this;\n    if (this.selectionRangeArray.length !== 0) {\n      var selection = window.getSelection();\n      var isBackward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n      // eslint-disable-next-line\n      var anchorPage = isNaN(parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1])) ? parseInt(selection.anchorNode.id.split('_pageDiv_')[1]) : parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n      if (isNaN(anchorPage)) {\n        // eslint-disable-next-line radix\n        anchorPage = parseInt(selection.anchorNode.id.split('_text_')[1]);\n      }\n      // eslint-disable-next-line\n      var focusPage_1 = isNaN(parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_pageDiv_')[1]) : parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n      if (isNaN(focusPage_1)) {\n        // eslint-disable-next-line\n        focusPage_1 = isNaN(parseInt(selection.focusNode.id.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_textLayer_')[1]) : parseInt(selection.focusNode.id.split('_text_')[1]);\n      }\n      var arrayObject = [];\n      if (!isBackward) {\n        arrayObject = this.selectionRangeArray.filter(\n        // eslint-disable-next-line\n        function (obj) {\n          return !(_this.selectionStartPage <= obj.pageNumber && obj.pageNumber < focusPage_1);\n        });\n      } else {\n        arrayObject = this.selectionRangeArray.filter(\n        // eslint-disable-next-line\n        function (obj) {\n          return !(focusPage_1 < obj.pageNumber && obj.pageNumber <= _this.selectionStartPage);\n        });\n      }\n      if (arrayObject.length > 0) {\n        for (var i = 0; i < arrayObject.length; i++) {\n          var indexInArray = this.selectionRangeArray.indexOf(arrayObject[i]);\n          if (indexInArray !== -1) {\n            this.selectionRangeArray.splice(indexInArray, 1);\n          }\n        }\n        if (this.selectionRangeArray.length === 1) {\n          // eslint-disable-next-line max-len\n          if (this.selectionRangeArray[0].pageNumber === anchorPage || this.selectionRangeArray[0].pageNumber === focusPage_1) {\n            arrayObject = [];\n          }\n        }\n      }\n    }\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.applySpanForSelection = function () {\n    var selection = window.getSelection();\n    // eslint-disable-next-line max-len\n    if (selection.anchorNode === selection.focusNode && selection.anchorOffset === selection.focusOffset && !selection.isCollapsed) {\n      selection.removeAllRanges();\n    }\n    // eslint-disable-next-line max-len\n    if (selection.anchorNode !== null && this.pdfViewerBase.viewerContainer.contains(this.getNodeElementFromNode(selection.anchorNode))) {\n      var isBackWardSelection = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n      var anchorPageId = void 0;\n      var focusPageId = void 0;\n      var anchorOffsetDiv = void 0;\n      var focusOffsetDiv = void 0;\n      var anchorOffset = void 0;\n      var focusOffset = void 0;\n      if (isBackWardSelection) {\n        // eslint-disable-next-line radix\n        anchorPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n        // eslint-disable-next-line radix\n        focusPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n        // eslint-disable-next-line radix\n        anchorOffsetDiv = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1].split('_')[1]);\n        // eslint-disable-next-line radix\n        focusOffsetDiv = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1].split('_')[1]);\n        anchorOffset = selection.focusOffset;\n        focusOffset = selection.anchorOffset;\n      } else {\n        var anchorElement = this.getNodeElementFromNode(selection.anchorNode);\n        var focusElement = this.getNodeElementFromNode(selection.focusNode);\n        // eslint-disable-next-line\n        anchorPageId = anchorElement.id.indexOf('text_') !== -1 ? parseInt(anchorElement.id.split('text_')[1]) : parseInt(anchorElement.id.split('_textLayer_')[1]);\n        // eslint-disable-next-line\n        focusPageId = focusElement.id.indexOf('text_') !== -1 ? parseInt(focusElement.id.split('text_')[1]) : parseInt(focusElement.id.split('_textLayer_')[1]);\n        var isFocusChanged = false;\n        if (this.isTouchSelection) {\n          if (selection.focusNode === this.pdfViewerBase.pageContainer) {\n            var lastChildNode = this.pdfViewerBase.pageContainer.lastChild;\n            if (lastChildNode.classList.contains('e-pv-touch-select-drop')) {\n              var lastPageDiv = lastChildNode.previousSibling.previousSibling;\n              // eslint-disable-next-line radix\n              focusPageId = parseInt(lastPageDiv.id.split('_pageDiv_')[1]);\n              focusElement = this.pdfViewerBase.getElement('_textLayer_' + focusPageId).lastChild;\n              isFocusChanged = true;\n            } else if (lastChildNode.classList.contains('e-pv-page-div')) {\n              var lastPageDiv = lastChildNode;\n              // eslint-disable-next-line radix\n              focusPageId = parseInt(lastPageDiv.id.split('_pageDiv_')[1]);\n              focusElement = this.pdfViewerBase.getElement('_textLayer_' + focusPageId).lastChild;\n              isFocusChanged = true;\n            }\n          }\n        }\n        if (anchorElement.classList.contains('e-pv-maintaincontent')) {\n          anchorElement = this.getNodeElementFromNode(anchorElement);\n          // eslint-disable-next-line radix\n          anchorPageId = parseInt(anchorElement.id.split('text_')[1]);\n        }\n        if (focusElement.classList.contains('e-pv-maintaincontent')) {\n          focusElement = this.getNodeElementFromNode(focusElement);\n          // eslint-disable-next-line radix\n          focusPageId = parseInt(focusElement.id.split('text_')[1]);\n        }\n        if (anchorPageId === focusPageId) {\n          if (anchorElement.contains(focusElement)) {\n            anchorElement = focusElement;\n          }\n          if (focusElement.contains(anchorElement)) {\n            focusElement = anchorElement;\n          }\n        }\n        // eslint-disable-next-line radix\n        anchorOffsetDiv = anchorElement.id.split('text_')[1] ? parseInt(anchorElement.id.split('text_')[1].split('_')[1]) : null;\n        // eslint-disable-next-line radix\n        focusOffsetDiv = focusElement.id.split('text_')[1] ? parseInt(focusElement.id.split('text_')[1].split('_')[1]) : null;\n        anchorOffsetDiv = isNaN(anchorOffsetDiv) ? focusOffsetDiv : anchorOffsetDiv;\n        focusOffsetDiv = isNaN(focusOffsetDiv) ? anchorOffsetDiv : focusOffsetDiv;\n        anchorOffset = selection.anchorOffset;\n        focusOffset = !isFocusChanged ? selection.focusOffset : focusElement.textContent.length;\n      }\n      if (this.pdfViewerBase.checkIsNormalText()) {\n        selection.removeAllRanges();\n        this.pdfViewerBase.textLayer.clearDivSelection();\n        // eslint-disable-next-line max-len\n        this.pdfViewerBase.textLayer.applySpanForSelection(anchorPageId, focusPageId, anchorOffsetDiv, focusOffsetDiv, anchorOffset, focusOffset);\n      }\n      if (this.pdfViewer.textSearchModule) {\n        this.pdfViewer.textSearchModule.searchAfterSelection();\n      }\n    }\n  };\n  /**\n   * @param event\n   * @param x\n   * @param y\n   * @private\n   */\n  TextSelection.prototype.initiateTouchSelection = function (event, x, y) {\n    if (this.pdfViewerBase.isShapeBasedAnnotationsEnabled()) {\n      if (this.pdfViewer.selectedItems.annotations.length > 0) {\n        this.pdfViewer.clearSelection(this.pdfViewer.selectedItems.annotations[0].pageIndex);\n      }\n    }\n    // eslint-disable-next-line\n    var element = event.target;\n    var belowElements = document.elementsFromPoint(event.touches[0].clientX, event.touches[0].clientY);\n    if (belowElements.length !== 0) {\n      if (belowElements[0].classList.contains('e-pv-hyperlink') && belowElements[1].classList.contains('e-pv-text')) {\n        element = belowElements[1];\n      }\n    }\n    var pageNumber = parseFloat(element.id.split('_')[2]);\n    this.pdfViewer.fireTextSelectionStart(pageNumber + 1);\n    this.selectAWord(element, x, y, true);\n    this.createTouchSelectElement(event);\n    this.maintainSelectionOnZoom(true, false);\n    this.fireTextSelectEnd();\n    this.applySpanForSelection();\n  };\n  // eslint-disable-next-line\n  TextSelection.prototype.selectTextByTouch = function (element, x, y, isForwardSelection, target, isCloserMovement) {\n    var isTextSelected = false;\n    if (element.nodeType === element.TEXT_NODE) {\n      var rangeObject = element.ownerDocument.createRange();\n      var selection = window.getSelection();\n      rangeObject.selectNodeContents(element);\n      var currentPosition = 0;\n      var endPosition = rangeObject.endOffset;\n      while (currentPosition < endPosition) {\n        rangeObject.setStart(element, currentPosition);\n        rangeObject.setEnd(element, currentPosition + 1);\n        var rangeBounds = rangeObject.getBoundingClientRect();\n        if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n          if (selection.anchorNode != null) {\n            if (isForwardSelection) {\n              rangeObject.setStart(selection.anchorNode, selection.anchorOffset);\n            }\n            // eslint-disable-next-line max-len\n            rangeObject = this.setTouchSelectionStartPosition(selection, rangeObject, isForwardSelection, target, element, currentPosition, isCloserMovement);\n            if (isForwardSelection) {\n              selection.extend(element, currentPosition);\n            }\n            isTextSelected = true;\n          }\n          rangeObject.detach();\n          return isTextSelected;\n        }\n        currentPosition += 1;\n      }\n    } else {\n      for (var i = 0; i < element.childNodes.length; i++) {\n        var range = element.childNodes[i].ownerDocument.createRange();\n        range.selectNodeContents(element.childNodes[i]);\n        var rangeBounds = range.getBoundingClientRect();\n        if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n          range.detach();\n          return this.selectTextByTouch(element.childNodes[i], x, y, isForwardSelection, target, isCloserMovement);\n        } else {\n          range.detach();\n        }\n      }\n    }\n    return isTextSelected;\n  };\n  // eslint-disable-next-line\n  TextSelection.prototype.setTouchSelectionStartPosition = function (selection, range, isForwardSelection, target, element, currentPosition, isCloserMovement) {\n    if (isForwardSelection) {\n      if (target === 'left') {\n        // eslint-disable-next-line\n        var startNode = this.getTouchFocusElement(selection, true);\n        range.setStart(startNode.focusNode, startNode.focusOffset);\n        range.setEnd(element, currentPosition);\n        this.selectionAnchorTouch = {\n          anchorNode: range.endContainer.parentElement.id,\n          anchorOffset: range.endOffset\n        };\n      } else if (target === 'right') {\n        // eslint-disable-next-line\n        var startNode = this.getTouchAnchorElement(selection, false);\n        range.setStart(startNode.anchorNode, startNode.anchorOffset);\n        range.setEnd(element, currentPosition);\n        this.selectionFocusTouch = {\n          focusNode: range.endContainer.parentElement.id,\n          focusOffset: range.endOffset\n        };\n      }\n    } else {\n      if (target === 'left') {\n        if (!isCloserMovement) {\n          // eslint-disable-next-line\n          var startNode = this.getTouchFocusElement(selection, false);\n          range.setStart(element, currentPosition);\n          // eslint-disable-next-line radix\n          range.setEnd(startNode.focusNode, startNode.focusOffset);\n          if (range.toString() === '') {\n            range.setStart(element, currentPosition);\n            range.setEnd(selection.focusNode, selection.focusOffset);\n          }\n          this.selectionAnchorTouch = {\n            anchorNode: range.startContainer.parentElement.id,\n            anchorOffset: range.startOffset\n          };\n        } else {\n          range.setStart(element, currentPosition);\n          range.setEnd(selection.focusNode, selection.focusOffset);\n          this.selectionAnchorTouch = {\n            anchorNode: range.startContainer.parentElement.id,\n            anchorOffset: range.startOffset\n          };\n        }\n      } else if (target === 'right') {\n        // eslint-disable-next-line\n        var startNode = this.getTouchAnchorElement(selection, true);\n        range.setStart(element, currentPosition);\n        range.setEnd(startNode.anchorNode, startNode.anchorOffset);\n        if (range.toString() === '') {\n          range.setStart(startNode.anchorNode, startNode.anchorOffset);\n          range.setEnd(element, currentPosition);\n        }\n        this.selectionFocusTouch = {\n          focusNode: range.startContainer.parentElement.id,\n          focusOffset: range.startOffset\n        };\n      }\n    }\n    selection.removeAllRanges();\n    selection.addRange(range);\n    return range;\n  };\n  TextSelection.prototype.getTouchAnchorElement = function (selection, isCurrentFocus) {\n    var element = document.getElementById(this.selectionAnchorTouch.anchorNode.toString());\n    var startNode = null;\n    var offset = 0;\n    if (element) {\n      startNode = element.childNodes[0];\n      // eslint-disable-next-line radix\n      offset = parseInt(this.selectionAnchorTouch.anchorOffset.toString());\n    } else {\n      if (isCurrentFocus) {\n        startNode = selection.focusNode;\n        offset = selection.focusOffset;\n      } else {\n        startNode = selection.anchorNode;\n        offset = selection.anchorOffset;\n      }\n    }\n    return {\n      anchorNode: startNode,\n      anchorOffset: offset\n    };\n  };\n  TextSelection.prototype.getTouchFocusElement = function (selection, isCurrentAnchor) {\n    var element = document.getElementById(this.selectionFocusTouch.focusNode.toString());\n    var startNode = null;\n    var offset = 0;\n    if (element) {\n      startNode = element.childNodes[0];\n      // eslint-disable-next-line radix\n      offset = parseInt(this.selectionFocusTouch.focusOffset.toString());\n    } else {\n      if (isCurrentAnchor) {\n        startNode = selection.anchorNode;\n        offset = selection.anchorOffset;\n      } else {\n        startNode = selection.focusNode;\n        offset = selection.focusOffset;\n      }\n    }\n    return {\n      focusNode: startNode,\n      focusOffset: offset\n    };\n  };\n  TextSelection.prototype.createTouchSelectElement = function (event) {\n    var topMargin = 10;\n    this.isTouchSelection = true;\n    var selection = window.getSelection();\n    if (selection.type === 'Range') {\n      // eslint-disable-next-line max-len\n      this.dropDivElementLeft = createElement('div', {\n        id: this.pdfViewer.element.id + '_touchSelect_droplet_left',\n        className: 'e-pv-touch-select-drop'\n      });\n      // eslint-disable-next-line max-len\n      this.dropDivElementRight = createElement('div', {\n        id: this.pdfViewer.element.id + '_touchSelect_droplet_right',\n        className: 'e-pv-touch-select-drop'\n      });\n      this.dropElementLeft = createElement('div', {\n        className: 'e-pv-touch-ellipse'\n      });\n      this.dropElementLeft.style.transform = 'rotate(0deg)';\n      this.dropDivElementLeft.appendChild(this.dropElementLeft);\n      this.dropElementRight = createElement('div', {\n        className: 'e-pv-touch-ellipse'\n      });\n      this.dropElementRight.style.transform = 'rotate(-90deg)';\n      this.dropElementRight.style.margin = '0 9px 0 0';\n      this.dropDivElementRight.appendChild(this.dropElementRight);\n      this.pdfViewerBase.pageContainer.appendChild(this.dropDivElementLeft);\n      this.pdfViewerBase.pageContainer.appendChild(this.dropDivElementRight);\n      var range = selection.getRangeAt(0);\n      var rangePosition = range.getBoundingClientRect();\n      var dropElementRect = this.dropDivElementLeft.getBoundingClientRect();\n      // eslint-disable-next-line max-len\n      var pageTopValue = this.pdfViewerBase.pageSize[this.pdfViewerBase.currentPageNumber - 1].top;\n      var viewerLeftPosition = this.pdfViewerBase.viewerContainer.getBoundingClientRect().left;\n      var topClientValue = this.getClientValueTop(rangePosition.top, this.pdfViewerBase.currentPageNumber - 1);\n      // eslint-disable-next-line max-len\n      var topPositionValue = topClientValue + pageTopValue * this.pdfViewerBase.getZoomFactor() + dropElementRect.height / 2 * this.pdfViewerBase.getZoomFactor() + 'px';\n      this.dropDivElementLeft.style.top = topPositionValue;\n      this.dropDivElementLeft.style.left = rangePosition.left - (viewerLeftPosition + dropElementRect.width) + 'px';\n      this.dropDivElementRight.style.top = topPositionValue;\n      // eslint-disable-next-line max-len\n      this.dropDivElementRight.style.left = rangePosition.left + rangePosition.width - viewerLeftPosition + 'px';\n      var currentPageLeft = this.pdfViewerBase.getElement('_pageDiv_' + (this.pdfViewerBase.currentPageNumber - 1)).getBoundingClientRect().left;\n      var currentRangeLeft = rangePosition.left - currentPageLeft;\n      // eslint-disable-next-line max-len\n      this.topStoreLeft = {\n        pageTop: pageTopValue,\n        topClientValue: this.getMagnifiedValue(topClientValue),\n        pageNumber: this.pdfViewerBase.currentPageNumber - 1,\n        left: this.getMagnifiedValue(currentRangeLeft),\n        isHeightNeeded: true\n      };\n      // eslint-disable-next-line max-len\n      this.topStoreRight = {\n        pageTop: pageTopValue,\n        topClientValue: this.getMagnifiedValue(topClientValue),\n        pageNumber: this.pdfViewerBase.currentPageNumber - 1,\n        left: this.getMagnifiedValue(currentRangeLeft + rangePosition.width),\n        isHeightNeeded: true\n      };\n      this.dropDivElementLeft.addEventListener('touchstart', this.onLeftTouchSelectElementTouchStart);\n      this.dropDivElementLeft.addEventListener('touchmove', this.onLeftTouchSelectElementTouchMove);\n      this.dropDivElementLeft.addEventListener('touchend', this.onLeftTouchSelectElementTouchEnd);\n      this.dropDivElementRight.addEventListener('touchstart', this.onRightTouchSelectElementTouchStart);\n      this.dropDivElementRight.addEventListener('touchmove', this.onRightTouchSelectElementTouchMove);\n      this.dropDivElementRight.addEventListener('touchend', this.onRightTouchSelectElementTouchEnd);\n      // eslint-disable-next-line max-len\n      this.calculateContextMenuPosition(event.touches[0].clientY + this.dropDivElementLeft.clientHeight + topMargin, parseInt(this.dropDivElementLeft.style.left, 10) - topMargin);\n    }\n  };\n  /**\n   * @param top\n   * @param left\n   * @private\n   */\n  // eslint-disable-next-line\n  TextSelection.prototype.calculateContextMenuPosition = function (top, left) {\n    var _this = this;\n    var topMargin = 10;\n    if (Browser.isDevice && !this.pdfViewer.enableDesktopMode) {\n      // eslint-disable-next-line\n      var contextTop = top - this.contextMenuHeight;\n      if (contextTop < this.pdfViewerBase.toolbarHeight) {\n        top = top + this.contextMenuHeight;\n      } else {\n        top = contextTop;\n      }\n      if (top + this.contextMenuHeight > window.innerHeight) {\n        top = top - this.contextMenuHeight;\n      }\n    }\n    if (this.pdfViewer.contextMenuSettings.contextMenuAction === 'MouseUp') {\n      left = left - 50;\n    }\n    var proxy = this;\n    setTimeout(function () {\n      var leftValue = 35;\n      var selectedContent = document.getElementsByClassName(\"e-pv-maintaincontent\")[0] ? document.getElementsByClassName(\"e-pv-maintaincontent\")[0].getBoundingClientRect() : null;\n      if (selectedContent) {\n        if (selectedContent.bottom + proxy.contextMenuHeight + proxy.pdfViewerBase.toolbarHeight > window.innerHeight) {\n          top = selectedContent.top - (proxy.contextMenuHeight + proxy.pdfViewerBase.toolbarHeight - topMargin);\n        } else {\n          top = selectedContent.bottom + proxy.pdfViewerBase.toolbarHeight - topMargin;\n        }\n        left = selectedContent.left - leftValue;\n        var toolbarModule = _this.pdfViewer.toolbarModule ? _this.pdfViewer.toolbarModule.annotationToolbarModule : 'null';\n        if (!toolbarModule || !toolbarModule.textMarkupToolbarElement || toolbarModule.textMarkupToolbarElement.children.length === 0) {\n          // eslint-disable-next-line max-len\n          proxy.pdfViewerBase.contextMenuModule.open(top, left, proxy.pdfViewerBase.viewerContainer);\n        }\n      }\n    });\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.initiateSelectionByTouch = function () {\n    this.pdfViewerBase.textLayer.clearDivSelection();\n    this.pdfViewerBase.contextMenuModule.close();\n    var lowerPageIndex = this.pdfViewerBase.currentPageNumber - 3;\n    lowerPageIndex = lowerPageIndex < 0 ? 0 : lowerPageIndex;\n    var higherPageIndex = this.pdfViewer.currentPageNumber + 1;\n    // eslint-disable-next-line max-len\n    higherPageIndex = higherPageIndex < this.pdfViewerBase.pageCount - 1 ? higherPageIndex : this.pdfViewerBase.pageCount - 1;\n    for (var i = lowerPageIndex; i <= higherPageIndex; i++) {\n      var textLayer = this.pdfViewerBase.getElement('_textLayer_' + i);\n      if (textLayer) {\n        if (textLayer.childNodes !== null) {\n          this.applySelectionMouseScroll(i);\n        }\n      }\n    }\n    if (this.selectionRangeArray.length > 0) {\n      this.pdfViewer.fireTextSelectionStart(this.selectionRangeArray[0].pageNumber + 1);\n    }\n  };\n  // eslint-disable-next-line\n  TextSelection.prototype.terminateSelectionByTouch = function (event) {\n    var topMargin = 10;\n    this.maintainSelectionOnZoom(true, false);\n    this.applySpanForSelection();\n    if (this.pdfViewerBase.getTextMarkupAnnotationMode()) {\n      // eslint-disable-next-line max-len\n      this.pdfViewer.annotationModule.textMarkupAnnotationModule.drawTextMarkupAnnotations(this.pdfViewer.annotationModule.textMarkupAnnotationModule.currentTextMarkupAddMode);\n    } else {\n      this.fireTextSelectEnd();\n      var top_4 = event.changedTouches[0].clientY + event.currentTarget.clientHeight;\n      var spanBounds = this.getSpanBounds();\n      if (spanBounds.bottom + this.contextMenuHeight + this.pdfViewerBase.toolbarHeight > window.innerHeight) {\n        top_4 = spanBounds.top - (this.contextMenuHeight + this.pdfViewerBase.toolbarHeight);\n      } else {\n        top_4 = spanBounds.bottom + this.pdfViewerBase.toolbarHeight - topMargin;\n      }\n      this.pdfViewerBase.contextMenuModule.open(top_4, (spanBounds.right - spanBounds.left) / 2, this.pdfViewerBase.viewerContainer);\n    }\n  };\n  TextSelection.prototype.getSpanBounds = function () {\n    var spanWidth = [];\n    var spanRight = [];\n    var spanLeft = [];\n    var spanHeight = 0;\n    var selectedContent = document.getElementsByClassName(\"e-pv-maintaincontent\");\n    if (selectedContent.length > 0) {\n      for (var i = 0; i < selectedContent.length; i++) {\n        var spanElement = selectedContent[i].getBoundingClientRect();\n        spanHeight = spanHeight + spanElement.height;\n        spanWidth.push(spanElement.width);\n        spanRight.push(spanElement.right);\n        spanLeft.push(spanElement.left);\n      }\n      // eslint-disable-next-line max-len\n      return {\n        top: selectedContent[0].getBoundingClientRect().top,\n        bottom: selectedContent[selectedContent.length - 1].getBoundingClientRect().bottom,\n        left: Math.min.apply(null, spanLeft),\n        right: Math.max.apply(null, spanRight),\n        width: Math.max.apply(null, spanWidth),\n        height: spanHeight\n      };\n    }\n  };\n  TextSelection.prototype.getNodeElement = function (range, touchX, touchY, event, nodeElement) {\n    if (document.caretRangeFromPoint) {\n      range = document.caretRangeFromPoint(touchX, touchY);\n      nodeElement = this.onTouchElementScroll(range, nodeElement, touchY, event);\n      // eslint-disable-next-line\n    } else if (document.caretPositionFromPoint) {\n      // eslint-disable-next-line\n      var start = document.caretPositionFromPoint(touchX, touchY);\n      // eslint-disable-next-line\n      var end = document.caretPositionFromPoint(touchX, touchY);\n      range = document.createRange();\n      range.setStart(start.offsetNode, start.offset);\n      range.setEnd(end.offsetNode, end.offset);\n      nodeElement = this.onTouchElementScroll(range, nodeElement, touchY, event);\n    }\n    return nodeElement;\n  };\n  TextSelection.prototype.isTouchedWithinContainer = function (event) {\n    var elements = document.elementsFromPoint(event.touches[0].clientX, event.touches[0].clientY);\n    var isTouchedWithinContainer = false;\n    if (elements.length !== 0) {\n      isTouchedWithinContainer = true;\n    }\n    return isTouchedWithinContainer;\n  };\n  TextSelection.prototype.onTouchElementScroll = function (range, nodeElement, touchY, event) {\n    var viewerScrollTop = this.pdfViewerBase.viewerContainer.scrollTop;\n    if (range != null) {\n      nodeElement = range.startContainer;\n      var isScrollBar = this.isScrolledOnScrollBar(event);\n      if (!this.pdfViewerBase.viewerContainer.contains(nodeElement.parentElement) || isScrollBar) {\n        if (touchY < this.pdfViewerBase.viewerContainer.clientHeight) {\n          this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop - 30;\n        } else {\n          this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop + 30;\n        }\n      }\n    } else {\n      if (touchY < this.pdfViewerBase.viewerContainer.clientHeight) {\n        this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop - 30;\n      } else {\n        this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop + 30;\n      }\n    }\n    return nodeElement;\n  };\n  TextSelection.prototype.isCloserTouchScroll = function (currentDifference) {\n    var isForwardMovement = false;\n    if (this.previousScrollDifference > currentDifference) {\n      isForwardMovement = true;\n    }\n    return isForwardMovement;\n  };\n  TextSelection.prototype.getClientValueTop = function (clientValue, pageNumber) {\n    if (this.pdfViewerBase.getElement('_pageDiv_' + pageNumber)) {\n      // eslint-disable-next-line max-len\n      return clientValue - this.pdfViewerBase.getElement('_pageDiv_' + pageNumber).getBoundingClientRect().top;\n    } else {\n      return clientValue;\n    }\n  };\n  TextSelection.prototype.isScrolledOnScrollBar = function (event) {\n    var isScrollBar = false;\n    // eslint-disable-next-line max-len\n    if (event.touches && this.pdfViewerBase.viewerContainer.clientHeight + this.pdfViewerBase.viewerContainer.offsetTop < event.touches[0].clientY && event.touches[0].clientY < this.pdfViewerBase.viewerContainer.offsetHeight + this.pdfViewerBase.viewerContainer.offsetTop) {\n      isScrollBar = true;\n    }\n    return isScrollBar;\n  };\n  TextSelection.prototype.getTextLastLength = function (element) {\n    if (element) {\n      return element.textContent.length;\n    } else {\n      return 0;\n    }\n  };\n  TextSelection.prototype.getNodeElementFromNode = function (node) {\n    if (node.parentElement) {\n      return node.parentElement;\n    } else {\n      return node.parentNode;\n    }\n  };\n  /**\n   * Copy the selected text in the PDF Document.\n   *\n   * @returns void\n   */\n  TextSelection.prototype.copyText = function () {\n    var selectionText = '';\n    this.maintainSelectionOnZoom(true, false);\n    if (this.selectionRangeArray.length > 0) {\n      for (var i = 0; i < this.selectionRangeArray.length; i++) {\n        selectionText += this.selectionRangeArray[i].textContent;\n      }\n    }\n    if (selectionText.length > 0) {\n      if (this.pdfViewer.annotation) {\n        this.pdfViewer.annotation.isShapeCopied = false;\n      }\n      var textArea = document.createElement('textarea');\n      textArea.contentEditable = 'true';\n      textArea.textContent = selectionText;\n      // eslint-disable-next-line max-len\n      if (this.pdfViewer.annotation && this.pdfViewer.annotation.freeTextAnnotationModule) {\n        this.pdfViewer.annotation.freeTextAnnotationModule.selectedText = selectionText;\n      }\n      textArea.style.position = 'fixed';\n      document.body.appendChild(textArea);\n      textArea.select();\n      try {\n        document.execCommand('copy');\n      } catch (ex) {\n        console.warn('Copy to clipboard failed.', ex);\n      } finally {\n        if (textArea) {\n          document.body.removeChild(textArea);\n        }\n      }\n    }\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.destroy = function () {\n    this.clear();\n  };\n  /**\n   * @private\n   */\n  TextSelection.prototype.getModuleName = function () {\n    return 'TextSelection';\n  };\n  return TextSelection;\n}();\nexport { TextSelection };","map":{"version":3,"names":["createElement","Browser","isNullOrUndefined","TextSelection","pdfViewer","pdfViewerBase","_this","isTextSelection","selectionStartPage","isBackwardPropagatedSelection","contextMenuHeight","backwardStart","selectionRangeArray","selectionAnchorTouch","selectionFocusTouch","scrollMoveTimer","isMouseLeaveSelection","isTouchSelection","previousScrollDifference","topStoreLeft","topStoreRight","isTextSearched","isSelectionStartTriggered","allTextContent","onLeftTouchSelectElementTouchStart","event","initiateSelectionByTouch","onRightTouchSelectElementTouchStart","onLeftTouchSelectElementTouchEnd","terminateSelectionByTouch","onRightTouchSelectElementTouchEnd","onLeftTouchSelectElementTouchMove","range","nodeElement","preventDefault","target","style","zIndex","rightElement","dropDivElementRight","isTouchedWithinViewerContainer","isTouchedWithinContainer","dropBounds","getBoundingClientRect","xTouch","changedTouches","clientX","yTouch","clientY","getNodeElement","currentDifference","Math","sqrt","top","left","isCloserMovement","isCloserTouchScroll","isTextSelected","dropElementLeft","transform","dropElementRight","selectTextByTouch","parentElement","elementClientRect","dropDivElementLeft","pageTopValue","pageSize","currentPageNumber","topClientValue","getClientValueTop","currentPageLeft","getElement","currentRangeLeft","getZoomFactor","pageTop","getMagnifiedValue","pageNumber","isHeightNeeded","viewerContainer","width","onRightTouchSelectElementTouchMove","leftElement","dropPosition","touchX","touchY","prototype","textSelectionOnMouseMove","x","y","isExtended","targetElement","nodeType","TEXT_NODE","getTextMarkupAnnotationMode","fireTextSelectionStart","ownerDocument","createRange","selection","window","getSelection","anchorNode","position","compareDocumentPosition","focusNode","anchorOffset","focusOffset","Node","DOCUMENT_POSITION_PRECEDING","selectNodeContents","currentPosition","endPosition","endOffset","setStart","setEnd","rangeBounds","rightBounds","right","parseInt","toString","bottom","parentNode","classList","contains","removeAllRanges","addRange","isIE","document","documentMode","startOffset","extend","detach","annotationModule","textMarkupAnnotationModule","isEnableTextMarkupResizer","currentTextMarkupAddMode","leftDivElement","getElementById","element","id","isSelection","rangeCount","currentrange","getRangeAt","rect","top_1","annotation","updateLeftposition","display","updatePosition","i","childNodes","length","getSelectionRange","textSelectionOnDrag","isforward","top_2","selectTextRegion","pageNumbers","bounds","k","bound","Left","Top","Width","height","Height","textLayer","textDivs","n","rangebounds","top_3","currentLeft","totalLeft","textDiVLeft","currentTop","isLeftBounds","checkLeftBounds","isTopBounds","checkTopBounds","boundingRect","isExists","textSelectionOnMouseLeave","viewerTop","offsetTop","magnificationModule","fitType","setInterval","scrollForwardOnSelection","scrollBackwardOnSelection","scrollTop","stichSelectionOnScroll","clear","clearInterval","selectAWord","isStoreSelection","textContent","indices","startPosition","endPos","push","j","startParent","startContainer","split","index","selectEntireLine","textIds","targetRect","targetcentre","querySelectorAll","topValue","bottomValue","textId","lengths","d1","d2","contextMenuSettings","contextMenuAction","calculateContextMenuPosition","enableTextSelectionMode","isTextSelectionDisabled","remove","add","addEventListener","clearTextSelection","clearDivSelection","linkAnnotationModule","lowerPageIndex","higherPageIndex","pageCount","modifyZindexForTextSelection","showHideDropletDiv","textSearchModule","searchAfterSelection","contextMenuModule","close","removeTouchElements","removeChild","resizeTouchElements","viewerContainerLeft","dropElementHeight","leftCurrentPagePosition","parseFloat","rightCurrentPagePosition","textSelectionOnMouseup","maintainSelectionOnZoom","fireTextSelectEnd","isTextSearch","getTextSearchStatus","indexes","getIndexes","lowerPageValue","higherPageValue","applySelectionRangeOnScroll","applySpanForSelection","selectEndPageIndex","selectedText","selectedBounds","rectangleBounds","currentBound","pageIndex","isBackward","fireTextSelectionEnd","isMaintainSelection","isStich","type","isCollapsed","isBackWardSelection","anchorPageId","getNodeElementFromNode","focusPageId","isNaN","focusElement","pageContainer","lastChildNode","lastChild","previousSibling","maintainSelectionOnScroll","isSelectionAvailableOnScroll","isSelectionAvailable","ranges","getMagnified","applySelectionMouseScroll","applySelectionRange","getSelectionRangeFromArray","selectionRange","selectionObject","anchorOffsetDiv","focusOffsetDiv","startId","endNode","endId","startNode","anchorPageIndex","focusPageIndex","currentAnchorIndex","extendCurrentSelection","currentAnchorOffset","currentFocusOffset","maintainSelection","backward_1","firstChild","backward","selectionBounds","getSelectionBounds","selectionRectBounds","getSelectionRectangleBounds","anchorOffsetValue","getCorrectOffset","focusOffsetValue","pushSelectionRangeObject","createRangeObjectOnScroll","stichSelection","node","offset","offsetValue","currentObject","filter","obj","currentObjectIndex","indexOf","splice","nextPageObject","prevPageObject","prevIndex","firstObject","currentFocusElement","nextPageElement","lastElement","getTextLastLength","firstElement","textSelectionOnMouseWheel","extendSelectionStich","lastElement_1","maintainSelectionArray","pageNumberIndex","selectionRangeObject","getSelectionRangeObject","selectionString","selectionBound","startElement","endElement","endContainer","newStartRange","startRange","createRangeForSelection","normalizeBounds","selectionTexts","currentId","getPageIndex","anchorTextId","getTextIndex","focusTextId","textElement","newRange","clientSideRendering","pageDetails","textRotate","pageRotation","getAngle","rotation","startsWith","textselection","text","includes","slice","angle","getTextId","elementId","lastIndexOf","divId","substring","newBounds","currentPageElement","isMixedSizeDocument","currentTextElement","currentPageRect","value","getCurrentSelectionBounds","start","end","anchorPage","focusPage_1","arrayObject","indexInArray","anchorElement","isFocusChanged","lastPageDiv","checkIsNormalText","initiateTouchSelection","isShapeBasedAnnotationsEnabled","selectedItems","annotations","clearSelection","belowElements","elementsFromPoint","touches","createTouchSelectElement","isForwardSelection","rangeObject","setTouchSelectionStartPosition","getTouchFocusElement","getTouchAnchorElement","isCurrentFocus","isCurrentAnchor","topMargin","className","appendChild","margin","rangePosition","dropElementRect","viewerLeftPosition","topPositionValue","clientHeight","isDevice","enableDesktopMode","contextTop","toolbarHeight","innerHeight","proxy","setTimeout","leftValue","selectedContent","getElementsByClassName","toolbarModule","annotationToolbarModule","textMarkupToolbarElement","children","open","drawTextMarkupAnnotations","top_4","currentTarget","spanBounds","getSpanBounds","spanWidth","spanRight","spanLeft","spanHeight","spanElement","min","apply","max","caretRangeFromPoint","onTouchElementScroll","caretPositionFromPoint","offsetNode","elements","viewerScrollTop","isScrollBar","isScrolledOnScrollBar","isForwardMovement","clientValue","offsetHeight","copyText","selectionText","isShapeCopied","textArea","contentEditable","freeTextAnnotationModule","body","select","execCommand","ex","console","warn","destroy","getModuleName"],"sources":["/Users/saleem/Desktop/KClient/Web App/Ver_3.6/User Interface/website_Source files/node_modules/@syncfusion/ej2-pdfviewer/src/pdfviewer/text-selection/text-selection.js"],"sourcesContent":["/* eslint-disable */\nimport { createElement, Browser, isNullOrUndefined } from '@syncfusion/ej2-base';\n/**\n * The `TextSelection` module is used to handle the text selection of PDF viewer.\n */\nvar TextSelection = /** @class */ (function () {\n    /**\n     * @param pdfViewer\n     * @param pdfViewerBase\n     * @param pdfViewer\n     * @param pdfViewerBase\n     * @private\n     */\n    function TextSelection(pdfViewer, pdfViewerBase) {\n        var _this = this;\n        /**\n         * @private\n         */\n        this.isTextSelection = false;\n        /**\n         * @private\n         */\n        this.selectionStartPage = null;\n        this.isBackwardPropagatedSelection = false;\n        this.contextMenuHeight = 144;\n        this.backwardStart = 0;\n        /**\n         * @private\n         */\n        this.selectionRangeArray = [];\n        this.selectionAnchorTouch = null;\n        this.selectionFocusTouch = null;\n        // eslint-disable-next-line\n        this.scrollMoveTimer = 0;\n        this.isMouseLeaveSelection = false;\n        this.isTouchSelection = false;\n        this.previousScrollDifference = 0;\n        this.topStoreLeft = null;\n        this.topStoreRight = null;\n        this.isTextSearched = false;\n        this.isSelectionStartTriggered = false;\n        this.allTextContent = \"\";\n        this.onLeftTouchSelectElementTouchStart = function (event) {\n            _this.initiateSelectionByTouch();\n        };\n        this.onRightTouchSelectElementTouchStart = function (event) {\n            _this.initiateSelectionByTouch();\n        };\n        this.onLeftTouchSelectElementTouchEnd = function (event) {\n            _this.terminateSelectionByTouch(event);\n        };\n        this.onRightTouchSelectElementTouchEnd = function (event) {\n            _this.terminateSelectionByTouch(event);\n        };\n        this.onLeftTouchSelectElementTouchMove = function (event) {\n            var range;\n            var nodeElement;\n            event.preventDefault();\n            event.target.style.zIndex = '0';\n            var rightElement = _this.dropDivElementRight;\n            var isTouchedWithinViewerContainer = _this.isTouchedWithinContainer(event);\n            if (rightElement && isTouchedWithinViewerContainer) {\n                var dropBounds = rightElement.getBoundingClientRect();\n                var xTouch = event.changedTouches[0].clientX;\n                var yTouch = event.changedTouches[0].clientY;\n                event.target.style.zIndex = '1000';\n                nodeElement = _this.getNodeElement(range, xTouch, yTouch, event, nodeElement);\n                if (nodeElement) {\n                    // eslint-disable-next-line max-len\n                    var currentDifference = Math.sqrt((yTouch - dropBounds.top) * (yTouch - dropBounds.top) + (xTouch - dropBounds.left) * (xTouch - dropBounds.left));\n                    var isCloserMovement = _this.isCloserTouchScroll(currentDifference);\n                    var isTextSelected = false;\n                    if (yTouch <= dropBounds.top) {\n                        _this.dropElementLeft.style.transform = 'rotate(0deg)';\n                        _this.dropElementRight.style.transform = 'rotate(-90deg)';\n                        isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, xTouch, yTouch, false, 'left', isCloserMovement);\n                    }\n                    else {\n                        _this.dropElementLeft.style.transform = 'rotate(-90deg)';\n                        _this.dropElementRight.style.transform = 'rotate(0deg)';\n                        isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, xTouch, yTouch, true, 'left', isCloserMovement);\n                    }\n                    if (isTextSelected) {\n                        var elementClientRect = _this.dropDivElementLeft.getBoundingClientRect();\n                        var pageTopValue = _this.pdfViewerBase.pageSize[_this.pdfViewerBase.currentPageNumber - 1].top;\n                        var topClientValue = _this.getClientValueTop(yTouch, _this.pdfViewerBase.currentPageNumber - 1);\n                        // eslint-disable-next-line max-len\n                        var currentPageLeft = _this.pdfViewerBase.getElement('_pageDiv_' + (_this.pdfViewerBase.currentPageNumber - 1)).getBoundingClientRect().left;\n                        var currentRangeLeft = xTouch - currentPageLeft;\n                        // eslint-disable-next-line max-len\n                        _this.dropDivElementLeft.style.top = pageTopValue * _this.pdfViewerBase.getZoomFactor() + topClientValue + 'px';\n                        _this.topStoreLeft = { pageTop: pageTopValue, topClientValue: _this.getMagnifiedValue(topClientValue), pageNumber: _this.pdfViewerBase.currentPageNumber - 1, left: _this.getMagnifiedValue(currentRangeLeft), isHeightNeeded: false };\n                        // eslint-disable-next-line max-len\n                        _this.dropDivElementLeft.style.left = xTouch - _this.pdfViewerBase.viewerContainer.getBoundingClientRect().left - (elementClientRect.width / 2) + 'px';\n                        _this.previousScrollDifference = currentDifference;\n                    }\n                }\n            }\n        };\n        // eslint-disable-next-line\n        this.onRightTouchSelectElementTouchMove = function (event) {\n            var range;\n            var nodeElement;\n            event.preventDefault();\n            event.target.style.zIndex = '0';\n            var leftElement = _this.dropDivElementLeft;\n            var isTouchedWithinViewerContainer = _this.isTouchedWithinContainer(event);\n            if (leftElement && isTouchedWithinViewerContainer) {\n                var dropPosition = leftElement.getBoundingClientRect();\n                var touchX = event.changedTouches[0].clientX;\n                var touchY = event.changedTouches[0].clientY;\n                event.target.style.zIndex = '1000';\n                nodeElement = _this.getNodeElement(range, touchX, touchY, event, nodeElement);\n                if (nodeElement) {\n                    // eslint-disable-next-line max-len\n                    var currentDifference = Math.sqrt((touchY - dropPosition.top) * (touchY - dropPosition.top) + (touchX - dropPosition.left) * (touchX - dropPosition.left));\n                    var isCloserMovement = _this.isCloserTouchScroll(currentDifference);\n                    var isTextSelected = false;\n                    if (touchY >= dropPosition.top) {\n                        _this.dropElementRight.style.transform = 'rotate(-90deg)';\n                        _this.dropElementLeft.style.transform = 'rotate(0deg)';\n                        isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, touchX, touchY, true, 'right', isCloserMovement);\n                    }\n                    else {\n                        _this.dropElementRight.style.transform = 'rotate(0deg)';\n                        _this.dropElementLeft.style.transform = 'rotate(-90deg)';\n                        isTextSelected = _this.selectTextByTouch(nodeElement.parentElement, touchX, touchY, false, 'right', isCloserMovement);\n                    }\n                    if (isTextSelected) {\n                        var pageTopValue = _this.pdfViewerBase.pageSize[_this.pdfViewerBase.currentPageNumber - 1].top;\n                        var topClientValue = _this.getClientValueTop(touchY, _this.pdfViewerBase.currentPageNumber - 1);\n                        var elementClientRect = _this.dropDivElementRight.getBoundingClientRect();\n                        _this.dropDivElementRight.style.top = pageTopValue * _this.pdfViewerBase.getZoomFactor() + topClientValue + 'px';\n                        // eslint-disable-next-line max-len\n                        var currentPageLeft = _this.pdfViewerBase.getElement('_pageDiv_' + (_this.pdfViewerBase.currentPageNumber - 1)).getBoundingClientRect().left;\n                        var currentRangeLeft = touchX - currentPageLeft;\n                        // eslint-disable-next-line max-len\n                        _this.topStoreRight = { pageTop: pageTopValue, topClientValue: _this.getMagnifiedValue(topClientValue), pageNumber: _this.pdfViewerBase.currentPageNumber - 1, left: _this.getMagnifiedValue(currentRangeLeft), isHeightNeeded: false };\n                        // eslint-disable-next-line max-len\n                        _this.dropDivElementRight.style.left = touchX - _this.pdfViewerBase.viewerContainer.getBoundingClientRect().left - (elementClientRect.width / 2) + 'px';\n                        _this.previousScrollDifference = currentDifference;\n                    }\n                }\n            }\n        };\n        this.pdfViewer = pdfViewer;\n        this.pdfViewerBase = pdfViewerBase;\n    }\n    /**\n     * @param target\n     * @param x\n     * @param y\n     * @param isExtended\n     * @private\n     */\n    TextSelection.prototype.textSelectionOnMouseMove = function (target, x, y, isExtended) {\n        var targetElement = target;\n        this.isTextSearched = true;\n        if (targetElement.nodeType === targetElement.TEXT_NODE) {\n            if (!this.isSelectionStartTriggered && !this.pdfViewerBase.getTextMarkupAnnotationMode()) {\n                this.pdfViewer.fireTextSelectionStart(this.pdfViewerBase.currentPageNumber);\n                this.isSelectionStartTriggered = true;\n            }\n            this.isBackwardPropagatedSelection = false;\n            var range = targetElement.ownerDocument.createRange();\n            var selection = window.getSelection();\n            if (selection.anchorNode !== null) {\n                var position = selection.anchorNode.compareDocumentPosition(selection.focusNode);\n                if (!position && selection.anchorOffset > selection.focusOffset || position === Node.DOCUMENT_POSITION_PRECEDING) {\n                    this.isBackwardPropagatedSelection = true;\n                }\n            }\n            range.selectNodeContents(targetElement);\n            var currentPosition = 0;\n            var endPosition = range.endOffset;\n            while (currentPosition < endPosition) {\n                range.setStart(targetElement, currentPosition);\n                range.setEnd(targetElement, currentPosition + 1);\n                var rangeBounds = range.getBoundingClientRect();\n                var rightBounds = rangeBounds.right;\n                if (isExtended) {\n                    // eslint-disable-next-line\n                    rightBounds = parseInt(rangeBounds.right.toString());\n                }\n                // eslint-disable-next-line max-len\n                // eslint-disable-next-line\n                if (rangeBounds.left <= x && rightBounds >= x && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n                    if (selection.anchorNode !== null && selection.anchorNode.parentNode.classList.contains('e-pv-text')) {\n                        if (selection.anchorOffset > currentPosition) {\n                            if (this.backwardStart != 0) {\n                                range.setStart(selection.anchorNode, this.backwardStart);\n                            }\n                            else {\n                                range.setStart(selection.anchorNode, selection.anchorOffset + 1);\n                            }\n                        }\n                        else {\n                            range.setStart(selection.anchorNode, selection.anchorOffset);\n                        }\n                    }\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                    if (!this.isTextSelection) {\n                        this.selectionStartPage = this.pdfViewerBase.currentPageNumber - 1;\n                    }\n                    this.isTextSelection = true;\n                    // eslint-disable-next-line\n                    var isIE = !!document.documentMode;\n                    if (!isIE) {\n                        if (this.isBackwardPropagatedSelection || range.endOffset > currentPosition) {\n                            if (this.backwardStart != range.startOffset && range.startOffset >= currentPosition) {\n                                this.backwardStart = range.endOffset;\n                            }\n                            if (currentPosition === 0 && range.endOffset != 1) {\n                                selection.extend(targetElement, currentPosition);\n                            }\n                            else {\n                                selection.extend(targetElement, currentPosition + 1);\n                            }\n                        }\n                        else if (isExtended) {\n                            selection.extend(targetElement, currentPosition);\n                        }\n                        else {\n                            selection.extend(targetElement, currentPosition + 1);\n                        }\n                    }\n                    range.detach();\n                }\n                currentPosition += 1;\n            }\n            // eslint-disable-next-line\n            var annotationModule = this.pdfViewer.annotationModule;\n            // eslint-disable-next-line max-len\n            if (annotationModule && annotationModule.textMarkupAnnotationModule && annotationModule.textMarkupAnnotationModule.isEnableTextMarkupResizer(annotationModule.textMarkupAnnotationModule.currentTextMarkupAddMode)) {\n                // eslint-disable-next-line\n                var leftDivElement = document.getElementById(this.pdfViewer.element.id + '_droplet_left');\n                if (this.pdfViewerBase.isSelection && selection && selection.rangeCount > 0) {\n                    // eslint-disable-next-line\n                    var currentrange = selection.getRangeAt(0);\n                    // eslint-disable-next-line\n                    var rect = currentrange.getBoundingClientRect();\n                    var left = rect.left;\n                    var top_1 = rect.top;\n                    this.pdfViewer.annotation.textMarkupAnnotationModule.updateLeftposition(left, top_1);\n                    this.pdfViewerBase.isSelection = false;\n                }\n                else if ((leftDivElement && leftDivElement.style.display === 'none')) {\n                    this.pdfViewer.annotation.textMarkupAnnotationModule.updateLeftposition(x, y);\n                }\n                this.pdfViewer.annotation.textMarkupAnnotationModule.updatePosition(x, y);\n            }\n        }\n        else {\n            for (var i = 0; i < targetElement.childNodes.length; i++) {\n                if (targetElement.childNodes[i].nodeType === targetElement.TEXT_NODE) {\n                    var range = this.getSelectionRange(i, targetElement);\n                    var rangeBounds = range.getBoundingClientRect();\n                    // eslint-disable-next-line max-len\n                    // eslint-disable-next-line\n                    if (rangeBounds.left <= x && rangeBounds.right >= parseInt(x.toString()) && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n                        range.detach();\n                        this.textSelectionOnMouseMove(targetElement.childNodes[i], x, y, isExtended);\n                    }\n                    else {\n                        range.detach();\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @param target\n     * @param x\n     * @param y\n     * @param isforward\n     * @param target\n     * @param x\n     * @param y\n     * @param isforward\n     * @param target\n     * @param x\n     * @param y\n     * @param isforward\n     * @private\n     */\n    TextSelection.prototype.textSelectionOnDrag = function (target, x, y, isforward) {\n        var targetElement = target;\n        this.isTextSearched = true;\n        if (targetElement.nodeType === targetElement.TEXT_NODE) {\n            this.isBackwardPropagatedSelection = false;\n            var range = targetElement.ownerDocument.createRange();\n            var selection = window.getSelection();\n            if (selection.anchorNode !== null) {\n                var position = selection.anchorNode.compareDocumentPosition(selection.focusNode);\n                if (!position && selection.anchorOffset > selection.focusOffset || position === Node.DOCUMENT_POSITION_PRECEDING) {\n                    this.isBackwardPropagatedSelection = true;\n                }\n            }\n            range.selectNodeContents(targetElement);\n            var currentPosition = 0;\n            var endPosition = range.endOffset;\n            while (currentPosition < endPosition) {\n                range.setStart(targetElement, currentPosition);\n                range.setEnd(targetElement, currentPosition + 1);\n                var rangeBounds = range.getBoundingClientRect();\n                // eslint-disable-next-line max-len\n                // eslint-disable-next-line\n                if (rangeBounds.left <= x && rangeBounds.right >= x && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n                    if (isforward) {\n                        // eslint-disable-next-line max-len\n                        if (selection.anchorNode !== null && selection.anchorNode.parentNode.classList.contains('e-pv-text')) {\n                            range.setStart(selection.anchorNode, selection.anchorOffset);\n                        }\n                        selection.removeAllRanges();\n                        selection.addRange(range);\n                        selection.extend(targetElement, currentPosition);\n                    }\n                    else if (selection.focusNode) {\n                        range.setEnd(selection.focusNode, selection.focusOffset);\n                        selection.removeAllRanges();\n                        selection.addRange(range);\n                    }\n                    if (!this.isTextSelection) {\n                        this.selectionStartPage = this.pdfViewerBase.currentPageNumber - 1;\n                    }\n                    this.isTextSelection = true;\n                    range.detach();\n                    return true;\n                }\n                currentPosition += 1;\n            }\n            if (this.pdfViewerBase.isSelection) {\n                // eslint-disable-next-line\n                var currentrange = selection.getRangeAt(0);\n                // eslint-disable-next-line\n                var rect = currentrange.getBoundingClientRect();\n                var left = rect.left;\n                var top_2 = rect.top;\n                this.pdfViewer.annotation.textMarkupAnnotationModule.updateLeftposition(left, top_2);\n                this.pdfViewerBase.isSelection = false;\n            }\n            this.pdfViewer.annotation.textMarkupAnnotationModule.updatePosition(x, y);\n        }\n        else {\n            for (var i = 0; i < targetElement.childNodes.length; i++) {\n                if (targetElement.childNodes[i].nodeType === targetElement.TEXT_NODE) {\n                    var range = this.getSelectionRange(i, targetElement);\n                    var rangeBounds = range.getBoundingClientRect();\n                    // eslint-disable-next-line max-len\n                    // eslint-disable-next-line\n                    if (rangeBounds.left <= x && rangeBounds.right >= x && parseInt(rangeBounds.top.toString()) <= y && rangeBounds.bottom >= y) {\n                        range.detach();\n                        this.textSelectionOnDrag(targetElement.childNodes[i], x, y, isforward);\n                    }\n                    else {\n                        range.detach();\n                    }\n                }\n            }\n        }\n        return null;\n    };\n    /**\n     * Select the target text region in the PDF document of the given bounds.\n     *\n     * @param  {number} pageNumbers - Specifies the page number\n     * @param  {IRectangle[]} bounds -  Specifies the bounds of the texts.\n     * @returns void\n     */\n    TextSelection.prototype.selectTextRegion = function (pageNumbers, bounds) {\n        // eslint-disable-next-line\n        var element = null;\n        var pageNumber = (pageNumbers - 1);\n        for (var k = 0; k < bounds.length; k++) {\n            // eslint-disable-next-line\n            var bound = bounds[k];\n            var x = (bound.left ? bound.left : bound.Left) * this.pdfViewerBase.getZoomFactor();\n            var y = (bound.top ? bound.top : bound.Top) * this.pdfViewerBase.getZoomFactor();\n            var width = (bound.width ? bound.width : bound.Width) * this.pdfViewerBase.getZoomFactor();\n            var height = bound.height ? bound.height : bound.Height;\n            // eslint-disable-next-line\n            var textLayer = this.pdfViewerBase.getElement('_textLayer_' + pageNumber);\n            if (textLayer) {\n                // eslint-disable-next-line\n                var textDivs = textLayer.childNodes;\n                for (var n = 0; n < textDivs.length; n++) {\n                    if (textDivs[n]) {\n                        // eslint-disable-next-line\n                        var rangebounds = textDivs[n].getBoundingClientRect();\n                        var top_3 = this.getClientValueTop(rangebounds.top, pageNumber);\n                        // eslint-disable-next-line max-len\n                        var currentLeft = rangebounds.left - this.pdfViewerBase.getElement('_pageDiv_' + pageNumber).getBoundingClientRect().left;\n                        var totalLeft = currentLeft + rangebounds.width;\n                        // eslint-disable-next-line\n                        var textDiVLeft = parseInt(textDivs[n].style.left);\n                        // eslint-disable-next-line\n                        var currentTop = parseInt(textDivs[n].style.top);\n                        var isLeftBounds = this.checkLeftBounds(currentLeft, textDiVLeft, totalLeft, x);\n                        var isTopBounds = this.checkTopBounds(top_3, currentTop, y);\n                        if (isLeftBounds && isTopBounds) {\n                            element = textDivs[n];\n                            break;\n                        }\n                    }\n                }\n                if (element != null) {\n                    // eslint-disable-next-line\n                    var boundingRect = this.pdfViewerBase.getElement('_textLayer_' + pageNumber).getBoundingClientRect();\n                    this.textSelectionOnMouseMove(element, x + boundingRect.left, y + boundingRect.top, false);\n                    if ((bounds.length - 1) === k) {\n                        // eslint-disable-next-line max-len\n                        this.textSelectionOnMouseMove(element, x + boundingRect.left + width, y + boundingRect.top, false);\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @param left\n     * @param textDiVLeft\n     * @param totalLeft\n     * @param x\n     * @private\n     */\n    TextSelection.prototype.checkLeftBounds = function (left, textDiVLeft, totalLeft, x) {\n        var isExists = false;\n        // eslint-disable-next-line max-len\n        // eslint-disable-next-line\n        if (left === parseInt(x.toString()) || parseInt(left.toString()) === parseInt(x.toString()) || (left + 1) === parseInt(x.toString()) || (left - 1) === parseInt(x.toString())\n            // eslint-disable-next-line\n            || textDiVLeft === parseInt(x.toString()) || textDiVLeft === x || (totalLeft >= x && left <= x)) {\n            isExists = true;\n        }\n        return isExists;\n    };\n    /**\n     * @param top\n     * @param currentTop\n     * @param y\n     * @param top\n     * @param currentTop\n     * @param y\n     * @private\n     */\n    TextSelection.prototype.checkTopBounds = function (top, currentTop, y) {\n        var isExists = false;\n        // eslint-disable-next-line max-len\n        // eslint-disable-next-line\n        if ((top === parseInt(y.toString()) || parseInt(top.toString()) === parseInt(y.toString()) || parseInt((top + 1).toString()) === parseInt(y.toString()) || parseInt((top - 1).toString()) === parseInt(y.toString())\n            // eslint-disable-next-line\n            || currentTop === parseInt(y.toString()) || currentTop === y)) {\n            isExists = true;\n        }\n        return isExists;\n    };\n    /**\n     * @param event\n     * @private\n     */\n    TextSelection.prototype.textSelectionOnMouseLeave = function (event) {\n        var _this = this;\n        event.preventDefault();\n        var viewerTop = this.pdfViewerBase.viewerContainer.offsetTop;\n        if (this.pdfViewer.magnificationModule) {\n            if (this.pdfViewer.magnificationModule.fitType === 'fitToPage') {\n                return;\n            }\n        }\n        if (event.clientY > viewerTop) {\n            this.scrollMoveTimer = setInterval(function () {\n                _this.scrollForwardOnSelection();\n            }, 500);\n        }\n        else {\n            this.scrollMoveTimer = setInterval(function () {\n                _this.scrollBackwardOnSelection();\n            }, 500);\n        }\n    };\n    TextSelection.prototype.scrollForwardOnSelection = function () {\n        this.isMouseLeaveSelection = true;\n        this.pdfViewerBase.viewerContainer.scrollTop = this.pdfViewerBase.viewerContainer.scrollTop + 200;\n        this.stichSelectionOnScroll(this.pdfViewerBase.currentPageNumber - 1);\n    };\n    TextSelection.prototype.scrollBackwardOnSelection = function () {\n        this.isMouseLeaveSelection = true;\n        this.pdfViewerBase.viewerContainer.scrollTop = this.pdfViewerBase.viewerContainer.scrollTop - 200;\n        this.stichSelectionOnScroll(this.pdfViewerBase.currentPageNumber - 1);\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.clear = function () {\n        if (this.scrollMoveTimer) {\n            this.isMouseLeaveSelection = false;\n            clearInterval(this.scrollMoveTimer);\n        }\n    };\n    /**\n     * @param element\n     * @param x\n     * @param y\n     * @param isStoreSelection\n     * @param element\n     * @param x\n     * @param y\n     * @param isStoreSelection\n     * @param element\n     * @param x\n     * @param y\n     * @param isStoreSelection\n     * @private\n     */\n    // eslint-disable-next-line\n    TextSelection.prototype.selectAWord = function (element, x, y, isStoreSelection) {\n        if (element.nodeType === element.TEXT_NODE) {\n            var selection = window.getSelection();\n            var range = element.ownerDocument.createRange();\n            range.selectNodeContents(element);\n            var currentPosition = 0;\n            var endPosition = range.endOffset;\n            while (currentPosition < endPosition) {\n                range.setStart(element, currentPosition);\n                range.setEnd(element, currentPosition + 1);\n                var rangeBounds = range.getBoundingClientRect();\n                if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n                    var textContent = element.textContent;\n                    var indices = [];\n                    var startPosition = void 0;\n                    var endPos = void 0;\n                    for (var i = 0; i < textContent.length; i++) {\n                        if (textContent[i] === ' ') {\n                            indices.push(i);\n                        }\n                    }\n                    for (var j = 0; j < indices.length; j++) {\n                        if (currentPosition === indices[j]) {\n                            startPosition = indices[j];\n                            endPos = indices[j];\n                        }\n                        if (indices[0] > currentPosition) {\n                            startPosition = 0;\n                            endPos = indices[j];\n                            break;\n                        }\n                        if (currentPosition > indices[j] && currentPosition < indices[j + 1]) {\n                            startPosition = indices[j];\n                            endPos = indices[j + 1];\n                        }\n                        else if (currentPosition > indices[j]) {\n                            if (!indices[j + 1]) {\n                                startPosition = indices[j];\n                            }\n                        }\n                    }\n                    if (!endPos) {\n                        endPos = textContent.length;\n                    }\n                    if (startPosition === 0) {\n                        range.setStart(element, startPosition);\n                    }\n                    else {\n                        range.setStart(element, startPosition + 1);\n                    }\n                    range.setEnd(element, endPos);\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                    this.isTextSelection = true;\n                    // eslint-disable-next-line max-len\n                    var startParent = isNullOrUndefined(range.startContainer.parentElement) ? range.startContainer.parentNode : range.startContainer.parentElement;\n                    // eslint-disable-next-line radix\n                    this.selectionStartPage = parseInt(startParent.id.split('_text_')[1]);\n                    if (isStoreSelection) {\n                        // eslint-disable-next-line max-len\n                        this.selectionAnchorTouch = { anchorNode: selection.anchorNode.parentElement.id, anchorOffset: selection.anchorOffset };\n                        this.selectionFocusTouch = { focusNode: selection.focusNode.parentElement.id, focusOffset: selection.focusOffset };\n                    }\n                    if (!Browser.isIE) {\n                        range.detach();\n                    }\n                    break;\n                }\n                currentPosition += 1;\n            }\n        }\n        else {\n            for (var i = 0; i < element.childNodes.length; i++) {\n                var range = this.getSelectionRange(i, element);\n                var rangeBounds = range.getBoundingClientRect();\n                if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n                    range.detach();\n                    this.selectAWord(element.childNodes[i], x, y, isStoreSelection);\n                }\n                else {\n                    range.detach();\n                }\n            }\n        }\n    };\n    TextSelection.prototype.getSelectionRange = function (index, element) {\n        var range = element.childNodes[index].ownerDocument.createRange();\n        range.selectNodeContents(element.childNodes[index]);\n        return range;\n    };\n    /**\n     * @param event\n     * @private\n     */\n    TextSelection.prototype.selectEntireLine = function (event) {\n        var textIds = [];\n        var targetElement = event.target;\n        var targetRect = targetElement.getBoundingClientRect();\n        // eslint-disable-next-line\n        var targetcentre = parseInt((targetRect.top + (targetRect.height / 2)).toString());\n        // eslint-disable-next-line radix\n        var pageNumber = parseInt(event.target.id.split('_text_')[1]);\n        var textDivs = document.querySelectorAll('div[id*=\"' + this.pdfViewer.element.id + '_text_' + pageNumber + '\"]');\n        if (targetElement.classList.contains('e-pv-text')) {\n            this.pdfViewer.fireTextSelectionStart(pageNumber + 1);\n            for (var i = 0; i < textDivs.length; i++) {\n                var rect = textDivs[i].getBoundingClientRect();\n                // eslint-disable-next-line radix\n                var topValue = parseInt(rect.top.toString());\n                // eslint-disable-next-line radix\n                var bottomValue = parseInt(rect.bottom.toString());\n                if ((topValue <= targetcentre && bottomValue > targetcentre) && (targetRect.bottom + 10 > bottomValue)) {\n                    var textId = textDivs[i].id;\n                    if (textId !== '') {\n                        textIds.push(textId);\n                    }\n                }\n            }\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            var range = document.createRange();\n            var lengths = (textIds.length - 1);\n            var d1 = document.getElementById(textIds[0]);\n            var d2 = document.getElementById(textIds[lengths]);\n            var childNodes = d2.childNodes.length;\n            if (childNodes > 0) {\n                range.setStart(d1.childNodes[0], 0);\n                range.setEnd(d2.childNodes[0], d2.textContent.length);\n            }\n            else {\n                range.setStart(d1.childNodes[0], 0);\n                range.setEnd(d2, 1);\n            }\n            // eslint-disable-next-line radix\n            this.selectionStartPage = parseInt(range.startContainer.parentElement.id.split('_text_')[1]);\n            selection.addRange(range);\n            this.isTextSelection = true;\n            if (selection != null && this.pdfViewer.contextMenuSettings.contextMenuAction === 'MouseUp') {\n                this.calculateContextMenuPosition(event.clientY, event.clientY);\n            }\n        }\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.enableTextSelectionMode = function () {\n        this.pdfViewerBase.isTextSelectionDisabled = false;\n        if (!isNullOrUndefined(this.pdfViewerBase.viewerContainer)) {\n            this.pdfViewerBase.viewerContainer.classList.remove('e-disable-text-selection');\n            this.pdfViewerBase.viewerContainer.classList.add('e-enable-text-selection');\n            this.pdfViewerBase.viewerContainer.addEventListener('selectstart', function () {\n                return true;\n            });\n        }\n    };\n    TextSelection.prototype.clearTextSelection = function () {\n        if (this.isTextSelection) {\n            this.pdfViewerBase.textLayer.clearDivSelection();\n            if (window.getSelection) {\n                if (window.getSelection().removeAllRanges) {\n                    window.getSelection().removeAllRanges();\n                }\n            }\n            if (this.pdfViewer.linkAnnotationModule) {\n                var lowerPageIndex = this.pdfViewerBase.currentPageNumber - 3;\n                lowerPageIndex = (lowerPageIndex < 0) ? 0 : lowerPageIndex;\n                var higherPageIndex = this.pdfViewer.currentPageNumber + 1;\n                // eslint-disable-next-line max-len\n                higherPageIndex = (higherPageIndex < (this.pdfViewerBase.pageCount - 1)) ? higherPageIndex : (this.pdfViewerBase.pageCount - 1);\n                for (var i = lowerPageIndex; i <= higherPageIndex; i++) {\n                    this.pdfViewer.linkAnnotationModule.modifyZindexForTextSelection(i, false);\n                }\n            }\n            if (this.pdfViewer.annotation && this.pdfViewer.annotation.textMarkupAnnotationModule) {\n                this.pdfViewer.annotation.textMarkupAnnotationModule.showHideDropletDiv(true);\n            }\n            this.selectionRangeArray = [];\n            this.isTextSelection = false;\n            this.isTouchSelection = false;\n            if (this.pdfViewer.textSearchModule) {\n                this.pdfViewer.textSearchModule.searchAfterSelection();\n            }\n            this.pdfViewerBase.contextMenuModule.close();\n            this.removeTouchElements();\n        }\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.removeTouchElements = function () {\n        if (this.dropDivElementLeft) {\n            this.dropDivElementLeft.parentElement.removeChild(this.dropDivElementLeft);\n            this.dropDivElementLeft = null;\n            this.dropElementLeft.style.transform = 'rotate(0deg)';\n        }\n        if (this.dropDivElementRight) {\n            this.dropDivElementRight.parentElement.removeChild(this.dropDivElementRight);\n            this.dropDivElementRight = null;\n            this.dropElementRight.style.transform = 'rotate(-90deg)';\n        }\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.resizeTouchElements = function () {\n        var viewerContainerLeft = this.pdfViewerBase.viewerContainer.getBoundingClientRect().left;\n        if (this.dropDivElementLeft) {\n            var elementClientRect = this.dropDivElementLeft.getBoundingClientRect();\n            var dropElementHeight = 0;\n            // eslint-disable-next-line max-len\n            var leftCurrentPagePosition = this.pdfViewerBase.getElement('_pageDiv_' + this.topStoreLeft.pageNumber).getBoundingClientRect();\n            this.dropDivElementLeft.style.left = parseFloat(this.topStoreLeft.left.toString()) * this.pdfViewerBase.getZoomFactor() + leftCurrentPagePosition.left - viewerContainerLeft - (elementClientRect.width / 2) + 'px';\n            if (this.topStoreLeft.isHeightNeeded) {\n                dropElementHeight = (elementClientRect.height / 2) * this.pdfViewerBase.getZoomFactor();\n            }\n            // eslint-disable-next-line max-len\n            this.dropDivElementLeft.style.top = parseFloat(this.topStoreLeft.pageTop.toString()) * this.pdfViewerBase.getZoomFactor() + parseFloat(this.topStoreLeft.topClientValue.toString()) * this.pdfViewerBase.getZoomFactor() + dropElementHeight + 'px';\n        }\n        if (this.dropDivElementRight) {\n            var elementClientRect = this.dropDivElementRight.getBoundingClientRect();\n            var dropElementHeight = 0;\n            // eslint-disable-next-line max-len\n            var rightCurrentPagePosition = this.pdfViewerBase.getElement('_pageDiv_' + this.topStoreRight.pageNumber).getBoundingClientRect();\n            this.dropDivElementRight.style.left = parseFloat(this.topStoreRight.left.toString()) * this.pdfViewerBase.getZoomFactor() + rightCurrentPagePosition.left - viewerContainerLeft - (elementClientRect.width / 2) + 'px';\n            if (this.topStoreRight.isHeightNeeded) {\n                dropElementHeight = (elementClientRect.height / 2) * this.pdfViewerBase.getZoomFactor();\n            }\n            // eslint-disable-next-line max-len\n            this.dropDivElementRight.style.top = parseFloat(this.topStoreRight.pageTop.toString()) * this.pdfViewerBase.getZoomFactor() + parseFloat(this.topStoreRight.topClientValue.toString()) * this.pdfViewerBase.getZoomFactor() + dropElementHeight + 'px';\n        }\n    };\n    /**\n     * @param event\n     * @private\n     */\n    TextSelection.prototype.textSelectionOnMouseup = function (event) {\n        this.clear();\n        if (window.getSelection().anchorNode !== null) {\n            this.isMouseLeaveSelection = false;\n            this.isSelectionStartTriggered = false;\n            this.maintainSelectionOnZoom(true, false);\n            this.fireTextSelectEnd();\n            var isTextSearch = this.pdfViewerBase.textLayer.getTextSearchStatus();\n            if (isTextSearch) {\n                this.pdfViewerBase.textLayer.clearDivSelection();\n                // eslint-disable-next-line\n                var indexes = this.pdfViewer.textSearchModule.getIndexes();\n                var lowerPageValue = parseFloat(indexes.lowerPageValue.toString());\n                var higherPageValue = parseFloat(indexes.higherPageValue.toString());\n                for (var i = lowerPageValue; i < higherPageValue; i++) {\n                    this.applySelectionRangeOnScroll(i);\n                }\n                this.pdfViewer.textSearchModule.searchAfterSelection();\n            }\n            else {\n                this.applySpanForSelection();\n            }\n            if (this.pdfViewer.linkAnnotationModule) {\n                this.pdfViewer.linkAnnotationModule.modifyZindexForTextSelection(this.pdfViewerBase.currentPageNumber - 1, false);\n            }\n            if (this.isTextSearched && this.pdfViewer.contextMenuSettings.contextMenuAction === 'MouseUp') {\n                this.calculateContextMenuPosition(event.clientY, event.clientX);\n                this.isTextSearched = false;\n            }\n        }\n        else {\n            this.pdfViewerBase.textLayer.clearDivSelection();\n            if (this.pdfViewer.textSearchModule) {\n                this.pdfViewer.textSearchModule.searchAfterSelection();\n            }\n            this.pdfViewerBase.contextMenuModule.close();\n            this.removeTouchElements();\n        }\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.fireTextSelectEnd = function () {\n        if (this.selectionRangeArray.length !== 0) {\n            var selectEndPageIndex = 0;\n            var selectedText = '';\n            // eslint-disable-next-line\n            var selectedBounds = [];\n            for (var k = 0; k < this.selectionRangeArray.length; k++) {\n                selectedText += this.selectionRangeArray[k].textContent;\n                for (var j = 0; j < this.selectionRangeArray[k].rectangleBounds.length; j++) {\n                    var currentBound = this.selectionRangeArray[k].rectangleBounds[j];\n                    // eslint-disable-next-line max-len\n                    selectedBounds.push({ left: currentBound.left, right: currentBound.right, top: currentBound.top, bottom: currentBound.bottom, width: currentBound.width, height: currentBound.height, pageIndex: this.selectionRangeArray[k].pageNumber + 1 });\n                }\n                if (this.selectionRangeArray[k].isBackward && k === 0) {\n                    selectEndPageIndex = this.selectionRangeArray[k].pageNumber + 1;\n                }\n                else if (!this.selectionRangeArray[k].isBackward && k === this.selectionRangeArray.length - 1) {\n                    selectEndPageIndex = this.selectionRangeArray[k].pageNumber + 1;\n                }\n            }\n            this.pdfViewer.fireTextSelectionEnd(selectEndPageIndex, selectedText, selectedBounds);\n        }\n    };\n    /**\n     * @param isMaintainSelection\n     * @param isStich\n     * @param isMaintainSelection\n     * @param isStich\n     * @private\n     */\n    TextSelection.prototype.maintainSelectionOnZoom = function (isMaintainSelection, isStich) {\n        var selection = window.getSelection();\n        if (selection.type === 'Range' || (!selection.type && !selection.isCollapsed)) {\n            var isBackward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n            if (selection.anchorNode !== null) {\n                // eslint-disable-next-line radix\n                var anchorPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n                // eslint-disable-next-line radix\n                var focusPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n                if (this.isTouchSelection && isNaN(focusPageId)) {\n                    var focusElement = selection.focusNode;\n                    if (focusElement === this.pdfViewerBase.pageContainer) {\n                        var lastChildNode = this.pdfViewerBase.pageContainer.lastChild;\n                        if (lastChildNode.classList.contains('e-pv-touch-select-drop')) {\n                            // eslint-disable-next-line radix\n                            focusPageId = parseInt(lastChildNode.previousSibling.previousSibling.id.split('_pageDiv_')[1]);\n                        }\n                        else if (lastChildNode.classList.contains('e-pv-page-div')) {\n                            // eslint-disable-next-line radix\n                            focusPageId = parseInt(lastChildNode.id.split('_pageDiv_')[1]);\n                        }\n                    }\n                }\n                if (!isBackward) {\n                    for (var i = anchorPageId; i <= focusPageId; i++) {\n                        this.maintainSelectionOnScroll(i, isStich);\n                    }\n                }\n                else {\n                    for (var i = anchorPageId; i >= focusPageId; i--) {\n                        this.maintainSelectionOnScroll(i, isStich);\n                    }\n                }\n            }\n            if (!isMaintainSelection) {\n                selection.removeAllRanges();\n            }\n        }\n    };\n    /**\n     * @param pageNumber\n     * @private\n     */\n    TextSelection.prototype.isSelectionAvailableOnScroll = function (pageNumber) {\n        var isSelectionAvailable = false;\n        var ranges = this.selectionRangeArray;\n        for (var i = 0; i < ranges.length; i++) {\n            if (ranges[i] !== null) {\n                if (pageNumber === ranges[i].pageNumber) {\n                    isSelectionAvailable = true;\n                    if (this.isTouchSelection && !this.pdfViewerBase.getMagnified()) {\n                        isSelectionAvailable = false;\n                    }\n                    break;\n                }\n            }\n        }\n        return isSelectionAvailable;\n    };\n    /**\n     * @param pageNumber\n     * @private\n     */\n    TextSelection.prototype.applySelectionRangeOnScroll = function (pageNumber) {\n        if (this.isMouseLeaveSelection) {\n            this.applySelectionMouseScroll(pageNumber);\n        }\n        else {\n            this.applySelectionRange(pageNumber);\n        }\n    };\n    // eslint-disable-next-line\n    TextSelection.prototype.getSelectionRangeFromArray = function (pageNumber) {\n        var isSelectionAvailable = false;\n        var selectionRange = null;\n        var ranges = this.selectionRangeArray;\n        for (var i = 0; i < ranges.length; i++) {\n            if (ranges[i] !== null) {\n                if (pageNumber === ranges[i].pageNumber) {\n                    selectionRange = ranges[i];\n                    isSelectionAvailable = true;\n                    break;\n                }\n            }\n        }\n        return { isSelectionAvailable: isSelectionAvailable, selectionRange: selectionRange };\n    };\n    TextSelection.prototype.applySelectionRange = function (pageNumber) {\n        var selectionObject = this.getSelectionRangeFromArray(pageNumber);\n        var isSelectionAvailable = selectionObject.isSelectionAvailable;\n        var textLayer = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + pageNumber);\n        if (textLayer) {\n            if (isSelectionAvailable && textLayer.childNodes.length !== 0) {\n                var selectionRange = selectionObject.selectionRange;\n                var anchorOffsetDiv = void 0;\n                var focusOffsetDiv = void 0;\n                var anchorOffset = void 0;\n                var focusOffset = void 0;\n                if (selectionRange.isBackward) {\n                    // eslint-disable-next-line radix\n                    var startId = parseInt(selectionRange.endNode.split('_text_')[1].split('_')[1]);\n                    // eslint-disable-next-line radix\n                    var endId = parseInt(selectionRange.startNode.split('_text_')[1].split('_')[1]);\n                    if (startId < endId) {\n                        anchorOffsetDiv = startId;\n                        anchorOffset = selectionRange.endOffset;\n                        focusOffset = selectionRange.startOffset;\n                        focusOffsetDiv = endId;\n                    }\n                    else {\n                        anchorOffsetDiv = endId;\n                        anchorOffset = selectionRange.endOffset;\n                        focusOffsetDiv = startId;\n                        focusOffset = selectionRange.startOffset;\n                    }\n                }\n                else {\n                    // eslint-disable-next-line radix\n                    anchorOffsetDiv = parseInt(selectionRange.startNode.split('text_')[1].split('_')[1]);\n                    // eslint-disable-next-line radix\n                    focusOffsetDiv = parseInt(selectionRange.endNode.split('text_')[1].split('_')[1]);\n                    anchorOffset = selectionRange.startOffset;\n                    focusOffset = selectionRange.endOffset;\n                }\n                window.getSelection().removeAllRanges();\n                // eslint-disable-next-line max-len\n                this.pdfViewerBase.textLayer.applySpanForSelection(pageNumber, pageNumber, anchorOffsetDiv, focusOffsetDiv, anchorOffset, focusOffset);\n                if (this.pdfViewer.textSearchModule) {\n                    this.pdfViewer.textSearchModule.searchAfterSelection();\n                }\n            }\n        }\n    };\n    TextSelection.prototype.applySelectionMouseScroll = function (pageNumber) {\n        var selectionObject = this.getSelectionRangeFromArray(pageNumber);\n        var isSelectionAvailable = selectionObject.isSelectionAvailable;\n        if (isSelectionAvailable) {\n            var selectionRange = selectionObject.selectionRange;\n            var selection = window.getSelection();\n            var anchorNode = document.getElementById(selectionRange.startNode).childNodes[0];\n            var focusNode = document.getElementById(selectionRange.endNode).childNodes[0];\n            var range = document.createRange();\n            if (selection.anchorNode === null) {\n                if (!selectionRange.isBackward) {\n                    range.setStart(anchorNode, selectionRange.startOffset);\n                    range.setEnd(focusNode, selectionRange.endOffset);\n                }\n                else {\n                    range.setStart(focusNode, selectionRange.endOffset);\n                    range.setEnd(anchorNode, selectionRange.startOffset);\n                }\n            }\n            else {\n                // eslint-disable-next-line\n                var anchorPageIndex = isNaN(parseInt(selection.anchorNode.parentElement.id.split('_text_')[1])) ? parseInt(selection.anchorNode.id.split('_pageDiv_')[1]) : parseInt(selection.anchorNode.parentElement.id.split('_text_')[1]);\n                if (isNaN(anchorPageIndex)) {\n                    // eslint-disable-next-line radix\n                    anchorPageIndex = parseInt(selection.anchorNode.id.split('_text_')[1]);\n                }\n                // eslint-disable-next-line\n                var focusPageIndex = isNaN(parseInt(selection.focusNode.parentElement.id.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_pageDiv_')[1]) : parseInt(selection.focusNode.parentElement.id.split('_text_')[1]);\n                // eslint-disable-next-line radix\n                var currentAnchorIndex = parseInt(selectionRange.startNode.split('_text_')[1]);\n                if ((anchorPageIndex === focusPageIndex) && (anchorPageIndex === currentAnchorIndex)) {\n                    if (!selectionRange.isBackward) {\n                        range.setStart(anchorNode, selectionRange.startOffset);\n                        range.setEnd(focusNode, selectionRange.endOffset);\n                    }\n                    else {\n                        range.setStart(focusNode, selectionRange.endOffset);\n                        range.setEnd(anchorNode, selectionRange.startOffset);\n                    }\n                }\n                else if (!isNaN(anchorPageIndex)) {\n                    if (!isNaN(anchorPageIndex) && !selectionRange.isBackward) {\n                        // eslint-disable-next-line max-len\n                        if (anchorPageIndex < currentAnchorIndex && currentAnchorIndex < focusPageIndex && anchorPageIndex !== focusPageIndex) {\n                            range.setStart(selection.anchorNode, selection.anchorOffset);\n                            range.setEnd(selection.focusNode, selection.focusOffset);\n                        }\n                        else if (anchorPageIndex < currentAnchorIndex) {\n                            range.setStart(selection.anchorNode, selection.anchorOffset);\n                            range.setEnd(focusNode, selectionRange.endOffset);\n                        }\n                        else {\n                            range.setStart(anchorNode, selectionRange.startOffset);\n                            range.setEnd(selection.focusNode, selection.focusOffset);\n                        }\n                    }\n                    else {\n                        var isBackward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n                        // eslint-disable-next-line max-len\n                        if (anchorPageIndex > currentAnchorIndex && currentAnchorIndex > focusPageIndex && anchorPageIndex !== focusPageIndex) {\n                            if (!isBackward) {\n                                range.setStart(selection.anchorNode, selection.anchorOffset);\n                                range.setEnd(selection.focusNode, selection.focusOffset);\n                            }\n                            else {\n                                selection.extend(selection.focusNode, selection.focusOffset);\n                            }\n                            // eslint-disable-next-line max-len\n                        }\n                        else if (anchorPageIndex < currentAnchorIndex && currentAnchorIndex < focusPageIndex && anchorPageIndex !== focusPageIndex) {\n                            if (!isBackward) {\n                                range.setStart(selection.anchorNode, selection.anchorOffset);\n                                range.setEnd(selection.focusNode, selection.focusOffset);\n                            }\n                            else {\n                                selection.extend(selection.focusNode, selection.focusOffset);\n                            }\n                        }\n                        else if (anchorPageIndex < currentAnchorIndex) {\n                            if (!isBackward) {\n                                if (currentAnchorIndex !== this.selectionRangeArray[0].pageNumber) {\n                                    range.setStart(selection.anchorNode, selection.anchorOffset);\n                                    range.setEnd(focusNode, selectionRange.endOffset);\n                                }\n                                else {\n                                    range.setStart(selection.anchorNode, selection.anchorOffset);\n                                    range.setEnd(anchorNode, selectionRange.startOffset);\n                                }\n                            }\n                            else {\n                                if (currentAnchorIndex !== this.selectionRangeArray[0].pageNumber) {\n                                    this.extendCurrentSelection(focusNode.parentElement, selectionRange.endOffset, selection, range);\n                                }\n                                else {\n                                    this.extendCurrentSelection(anchorNode.parentElement, selectionRange.startOffset, selection, range);\n                                }\n                            }\n                        }\n                        else if (anchorPageIndex === currentAnchorIndex) {\n                            if (currentAnchorIndex === focusPageIndex) {\n                                range.setStart(anchorNode, selectionRange.startOffset);\n                                range.setEnd(anchorNode, selectionRange.startOffset);\n                                selection.removeAllRanges();\n                                selection.addRange(range);\n                                range = document.createRange();\n                                selection.extend(focusNode, selectionRange.endOffset);\n                            }\n                            else {\n                                if (isBackward) {\n                                    this.extendCurrentSelection(focusNode.parentElement, selectionRange.endOffset, selection, range);\n                                }\n                                else {\n                                    range.setStart(focusNode, selectionRange.endOffset);\n                                    range.setEnd(selection.focusNode, selection.focusOffset);\n                                }\n                            }\n                        }\n                        else if (focusPageIndex === currentAnchorIndex) {\n                            if (isBackward) {\n                                selection.extend(selection.focusNode, selection.focusOffset);\n                            }\n                            else {\n                                range.setStart(selection.anchorNode, selection.anchorOffset);\n                                range.setEnd(selection.focusNode, selection.focusOffset);\n                            }\n                        }\n                        else if (anchorPageIndex > currentAnchorIndex) {\n                            // eslint-disable-next-line radix\n                            var currentAnchorOffset = parseInt(selectionRange.startNode.split('_' + currentAnchorIndex + '_')[1]);\n                            // eslint-disable-next-line radix\n                            var currentFocusOffset = parseInt(selectionRange.endNode.split('_' + currentAnchorIndex + '_')[1]);\n                            if (isBackward) {\n                                if (currentAnchorIndex !== this.selectionRangeArray[0].pageNumber) {\n                                    if (currentAnchorOffset < currentFocusOffset) {\n                                        this.extendCurrentSelection(anchorNode.parentElement, selectionRange.startOffset, selection, range);\n                                    }\n                                    else {\n                                        range.setStart(focusNode.parentElement, selectionRange.endOffset);\n                                        range.setEnd(selection.anchorNode, selection.anchorOffset);\n                                    }\n                                }\n                                else {\n                                    this.extendCurrentSelection(focusNode.parentElement, selectionRange.endOffset, selection, range);\n                                }\n                            }\n                            else {\n                                if (currentAnchorOffset < currentFocusOffset) {\n                                    range.setStart(anchorNode, selectionRange.startOffset);\n                                    range.setEnd(selection.focusNode, selection.focusOffset);\n                                }\n                                else {\n                                    range.setStart(focusNode, selectionRange.endOffset);\n                                    range.setEnd(selection.focusNode, selection.focusOffset);\n                                }\n                            }\n                        }\n                    }\n                }\n                else if (isNaN(anchorPageIndex)) {\n                    if (!selectionRange.isBackward) {\n                        range.setStart(anchorNode, selectionRange.startOffset);\n                        range.setEnd(focusNode, selectionRange.endOffset);\n                    }\n                    else {\n                        range.setStart(focusNode, selectionRange.endOffset);\n                        range.setEnd(anchorNode, selectionRange.startOffset);\n                    }\n                }\n            }\n            if (range.toString() !== '') {\n                selection.removeAllRanges();\n                selection.addRange(range);\n            }\n        }\n    };\n    /**\n     * @param pageNumber\n     * @param isStich\n     * @param pageNumber\n     * @param isStich\n     * @private\n     */\n    TextSelection.prototype.maintainSelectionOnScroll = function (pageNumber, isStich) {\n        var isSelectionAvailable = this.isSelectionAvailableOnScroll(pageNumber);\n        if (this.isTextSelection && !isSelectionAvailable) {\n            this.maintainSelection(pageNumber, isStich);\n        }\n    };\n    /**\n     * @param pageNumber\n     * @param isStich\n     * @private\n     */\n    TextSelection.prototype.maintainSelection = function (pageNumber, isStich) {\n        var selection = window.getSelection();\n        if (this.isTextSelection && (selection.type === 'Range' || (!selection.type && !selection.isCollapsed))) {\n            // eslint-disable-next-line\n            var anchorPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n            // eslint-disable-next-line\n            var focusPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n            if (isNaN(focusPageId) && selection.anchorNode !== null) {\n                var backward_1 = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n                if (!backward_1) {\n                    // eslint-disable-next-line radix\n                    var lastChildNode = this.pdfViewerBase.pageContainer.lastChild;\n                    if (lastChildNode.classList.contains('e-pv-touch-select-drop')) {\n                        // eslint-disable-next-line radix\n                        focusPageId = parseInt(lastChildNode.previousSibling.previousSibling.id.split('_pageDiv_')[1]);\n                    }\n                    else {\n                        // eslint-disable-next-line radix\n                        focusPageId = parseInt(lastChildNode.id.split('_pageDiv_')[1]);\n                    }\n                }\n                else {\n                    // eslint-disable-next-line radix\n                    focusPageId = parseInt(this.pdfViewerBase.pageContainer.firstChild.id.split('_pageDiv_')[1]);\n                }\n            }\n            var backward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n            if (this.isTouchSelection && pageNumber > focusPageId && pageNumber > anchorPageId) {\n                return;\n            }\n            if (anchorPageId === focusPageId) {\n                var selectionObject = null;\n                var selectionBounds = this.getSelectionBounds(selection.getRangeAt(0), pageNumber);\n                var selectionRectBounds = this.getSelectionRectangleBounds(selection.getRangeAt(0), pageNumber);\n                // eslint-disable-next-line max-len\n                var anchorOffsetValue = (this.getNodeElementFromNode(selection.anchorNode).childNodes.length === 1) ? selection.anchorOffset : this.getCorrectOffset(selection.anchorNode, selection.anchorOffset);\n                var focusOffsetValue = (this.getNodeElementFromNode(selection.focusNode).childNodes.length === 1) ? selection.focusOffset : this.getCorrectOffset(selection.focusNode, selection.focusOffset);\n                selectionObject = {\n                    isBackward: backward, startNode: this.getNodeElementFromNode(selection.anchorNode).id,\n                    startOffset: anchorOffsetValue, endNode: this.getNodeElementFromNode(selection.focusNode).id,\n                    // eslint-disable-next-line max-len\n                    endOffset: focusOffsetValue, textContent: this.allTextContent, pageNumber: pageNumber, bound: selectionBounds, rectangleBounds: selectionRectBounds\n                };\n                this.pushSelectionRangeObject(selectionObject, pageNumber);\n            }\n            else {\n                var selectionObject = this.createRangeObjectOnScroll(pageNumber, anchorPageId, focusPageId);\n                if (selectionObject) {\n                    this.pushSelectionRangeObject(selectionObject, pageNumber);\n                    if (isStich) {\n                        this.stichSelection(backward, selection, pageNumber);\n                    }\n                }\n            }\n        }\n    };\n    TextSelection.prototype.getCorrectOffset = function (node, offset) {\n        var offsetValue = 0;\n        var parentElement = this.getNodeElementFromNode(node);\n        for (var i = 0; i < parentElement.childNodes.length; i++) {\n            if (parentElement.childNodes[i] === node) {\n                offsetValue = offsetValue + offset;\n                break;\n            }\n            else {\n                offsetValue = offsetValue + parentElement.childNodes[i].textContent.length;\n            }\n        }\n        return offsetValue;\n    };\n    TextSelection.prototype.pushSelectionRangeObject = function (selectionObject, pageNumber) {\n        if (this.isTouchSelection) {\n            var currentObject = this.selectionRangeArray.filter(\n            // eslint-disable-next-line\n            function (obj) {\n                return (obj.pageNumber === pageNumber);\n            });\n            if (currentObject.length > 0) {\n                var currentObjectIndex = this.selectionRangeArray.indexOf(currentObject[0]);\n                this.selectionRangeArray.splice(currentObjectIndex, 1, selectionObject);\n                return;\n            }\n        }\n        var nextPageObject = this.selectionRangeArray.filter(\n        // eslint-disable-next-line\n        function (obj) {\n            return (obj.pageNumber === (pageNumber + 1));\n        });\n        if (nextPageObject.length === 0) {\n            if (this.isTouchSelection && this.selectionRangeArray.length !== 0) {\n                var prevPageObject = this.selectionRangeArray.filter(\n                // eslint-disable-next-line\n                function (obj) {\n                    return (obj.pageNumber === (pageNumber - 1));\n                });\n                if (prevPageObject.length !== 0) {\n                    var prevIndex = this.selectionRangeArray.indexOf(prevPageObject[0]);\n                    this.selectionRangeArray.splice(prevIndex + 1, 0, selectionObject);\n                }\n                else {\n                    var firstObject = this.selectionRangeArray[0];\n                    if (pageNumber < firstObject.pageNumber) {\n                        this.selectionRangeArray.splice(0, 0, selectionObject);\n                    }\n                    else {\n                        this.selectionRangeArray.push(selectionObject);\n                    }\n                }\n            }\n            else {\n                this.selectionRangeArray.push(selectionObject);\n            }\n        }\n        else {\n            var index = this.selectionRangeArray.indexOf(nextPageObject[0]);\n            this.selectionRangeArray.splice(index, 0, selectionObject);\n        }\n    };\n    TextSelection.prototype.extendCurrentSelection = function (element, offset, selection, range) {\n        var currentFocusOffset = selection.focusOffset;\n        var currentFocusElement = selection.focusNode.parentElement.id;\n        // eslint-disable-next-line\n        var focusPageId = isNaN(parseInt(currentFocusElement.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_pageDiv_')[1]) : parseInt(currentFocusElement.split('_text_')[1]);\n        // eslint-disable-next-line radix\n        if (isNaN(parseInt(currentFocusElement.split('_text_')[1]))) {\n            // eslint-disable-next-line\n            currentFocusElement = this.pdfViewerBase.getElement('_textLayer_' + (focusPageId + 1)).firstChild.id;\n        }\n        range.setStart(element.childNodes[0], offset);\n        range.setEnd(element.childNodes[0], offset);\n        selection.removeAllRanges();\n        selection.addRange(range);\n        selection.extend(document.getElementById(currentFocusElement).childNodes[0], currentFocusOffset);\n    };\n    TextSelection.prototype.stichSelection = function (backward, selection, pageNumber) {\n        var range = document.createRange();\n        var nextPageElement;\n        if (backward) {\n            nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber - 1));\n            if (nextPageElement) {\n                var lastElement = nextPageElement.lastChild;\n                if (lastElement) {\n                    this.extendCurrentSelection(lastElement, this.getTextLastLength(lastElement), selection, range);\n                }\n                else {\n                    nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber - 2));\n                    lastElement = nextPageElement.lastChild;\n                    this.extendCurrentSelection(lastElement, this.getTextLastLength(lastElement), selection, range);\n                }\n            }\n            else {\n                nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber + 1));\n                var lastElement = nextPageElement.firstChild;\n                this.extendCurrentSelection(lastElement, 0, selection, range);\n            }\n        }\n        else {\n            nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber + 1));\n            if (nextPageElement) {\n                var firstElement = nextPageElement.firstChild;\n                if (!firstElement) {\n                    nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (pageNumber + 2));\n                    firstElement = nextPageElement.firstChild;\n                    range.setStart(firstElement.childNodes[0], 0);\n                }\n                else {\n                    range.setStart(firstElement.childNodes[0], 0);\n                }\n                range.setEnd(selection.focusNode, selection.focusOffset);\n                selection.removeAllRanges();\n                selection.addRange(range);\n            }\n        }\n    };\n    /**\n     * @param currentPageNumber\n     * @private\n     */\n    TextSelection.prototype.textSelectionOnMouseWheel = function (currentPageNumber) {\n        this.isMouseLeaveSelection = true;\n        this.stichSelectionOnScroll(currentPageNumber);\n    };\n    /**\n     * @param currentPageNumber\n     * @private\n     */\n    TextSelection.prototype.stichSelectionOnScroll = function (currentPageNumber) {\n        var selection = window.getSelection();\n        if (this.isTextSelection) {\n            // eslint-disable-next-line radix\n            var anchorPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n            // eslint-disable-next-line radix\n            var focusPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n            var nextPageElement = void 0;\n            if (anchorPageId !== currentPageNumber && focusPageId !== currentPageNumber) {\n                var backward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n                if (!backward) {\n                    nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (currentPageNumber - 1));\n                    if (nextPageElement) {\n                        var lastElement = nextPageElement.lastChild;\n                        if (lastElement) {\n                            if (lastElement.childNodes[0]) {\n                                this.extendSelectionStich(lastElement.childNodes[0], this.getTextLastLength(lastElement), selection);\n                            }\n                            else {\n                                this.extendSelectionStich(lastElement, this.getTextLastLength(lastElement), selection);\n                            }\n                        }\n                        else {\n                            nextPageElement = this.pdfViewerBase.getElement('_textLayer_' + currentPageNumber);\n                            var lastElement_1 = nextPageElement.firstChild;\n                            this.extendSelectionStich(lastElement_1.childNodes[0], 0, selection);\n                        }\n                    }\n                }\n                else {\n                    nextPageElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + (currentPageNumber - 1));\n                    if (nextPageElement) {\n                        var lastElement = nextPageElement.firstChild;\n                        if (lastElement) {\n                            this.extendSelectionStich(lastElement.childNodes[0], 0, selection);\n                        }\n                    }\n                }\n            }\n            this.maintainSelectionArray();\n        }\n    };\n    TextSelection.prototype.extendSelectionStich = function (node, offset, selection) {\n        if (selection.extend) {\n            selection.extend(node, offset);\n        }\n    };\n    /**\n     * @param pageNumber\n     * @param anchorPageId\n     * @param focusPageId\n     * @param pageNumber\n     * @param anchorPageId\n     * @param focusPageId\n     * @private\n     */\n    TextSelection.prototype.createRangeObjectOnScroll = function (pageNumber, anchorPageId, focusPageId) {\n        var selectionObject = null;\n        var selection = window.getSelection();\n        if (selection.anchorNode !== null) {\n            var backward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n            var firstElement = void 0;\n            var lastElement = void 0;\n            var startOffset = void 0;\n            var endOffset = void 0;\n            var element = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + pageNumber);\n            if (element.childNodes) {\n                if (!backward) {\n                    if (pageNumber === anchorPageId) {\n                        firstElement = this.getNodeElementFromNode(selection.anchorNode);\n                        // eslint-disable-next-line max-len\n                        lastElement = element.lastChild;\n                        startOffset = this.getCorrectOffset(selection.anchorNode, selection.anchorOffset);\n                        endOffset = this.getTextLastLength(lastElement);\n                    }\n                    else if (pageNumber > anchorPageId && pageNumber < focusPageId) {\n                        // eslint-disable-next-line max-len\n                        firstElement = element.firstChild;\n                        // eslint-disable-next-line max-len\n                        lastElement = element.lastChild;\n                        startOffset = 0;\n                        endOffset = this.getTextLastLength(lastElement);\n                    }\n                    else if (pageNumber === focusPageId) {\n                        // eslint-disable-next-line max-len\n                        firstElement = element.firstChild;\n                        var pageNumberIndex = this.getNodeElementFromNode(selection.focusNode).id.indexOf(focusPageId.toString());\n                        if (pageNumberIndex !== -1) {\n                            lastElement = this.getNodeElementFromNode(selection.focusNode);\n                            endOffset = this.getCorrectOffset(selection.focusNode, selection.focusOffset);\n                        }\n                        else {\n                            // eslint-disable-next-line max-len\n                            lastElement = document.getElementById(this.pdfViewer.element.id + '_textLayer_' + focusPageId).lastChild;\n                            endOffset = this.getTextLastLength(lastElement);\n                        }\n                        startOffset = 0;\n                    }\n                }\n                else {\n                    if (pageNumber === anchorPageId) {\n                        firstElement = this.getNodeElementFromNode(selection.anchorNode);\n                        // eslint-disable-next-line max-len\n                        lastElement = element.firstChild;\n                        startOffset = this.getCorrectOffset(selection.anchorNode, selection.anchorOffset);\n                        endOffset = 0;\n                    }\n                    else if (pageNumber < anchorPageId && pageNumber > focusPageId) {\n                        // eslint-disable-next-line max-len\n                        firstElement = element.firstChild;\n                        // eslint-disable-next-line max-len\n                        lastElement = element.lastChild;\n                        startOffset = 0;\n                        endOffset = this.getTextLastLength(lastElement);\n                    }\n                    else if (pageNumber === focusPageId) {\n                        firstElement = this.getNodeElementFromNode(selection.focusNode);\n                        // eslint-disable-next-line max-len\n                        lastElement = element.lastChild;\n                        startOffset = this.getCorrectOffset(selection.focusNode, selection.focusOffset);\n                        endOffset = this.getTextLastLength(lastElement);\n                    }\n                }\n                if (firstElement && lastElement) {\n                    // eslint-disable-next-line max-len\n                    var selectionRangeObject = this.getSelectionRangeObject(firstElement.id, startOffset, lastElement.id, endOffset, pageNumber);\n                    var selectionString = selectionRangeObject.toString();\n                    var selectionBound = this.getSelectionBounds(selectionRangeObject, pageNumber);\n                    var selectionRectBounds = this.getSelectionRectangleBounds(selectionRangeObject, pageNumber);\n                    // eslint-disable-next-line max-len\n                    return selectionObject = { isBackward: backward, startNode: firstElement.id, startOffset: startOffset, endNode: lastElement.id, endOffset: endOffset, textContent: this.allTextContent, pageNumber: pageNumber, bound: selectionBound, rectangleBounds: selectionRectBounds };\n                }\n                else {\n                    return null;\n                }\n            }\n        }\n        return null;\n    };\n    TextSelection.prototype.getSelectionRangeObject = function (startNode, startOffset, endNode, endOffset, pageNumber) {\n        var startElement = document.getElementById(startNode);\n        var endElement = document.getElementById(endNode);\n        if (startElement.childNodes[0]) {\n            startElement = startElement.childNodes[0];\n        }\n        if (endElement.childNodes[0]) {\n            endElement = endElement.childNodes[0];\n        }\n        // eslint-disable-next-line radix\n        var currentAnchorOffset = parseInt(startNode.split('_' + pageNumber + '_')[1]);\n        // eslint-disable-next-line radix\n        var currentFocusOffset = parseInt(endNode.split('_' + pageNumber + '_')[1]);\n        var range = document.createRange();\n        if (currentAnchorOffset <= currentFocusOffset) {\n            range.setStart(startElement, startOffset);\n            range.setEnd(endElement, endOffset);\n        }\n        else {\n            range.setStart(endElement, endOffset);\n            range.setEnd(startElement, startOffset);\n        }\n        return range;\n    };\n    TextSelection.prototype.getSelectionBounds = function (range, pageNumber) {\n        var startElement = this.getNodeElementFromNode(range.startContainer);\n        var endElement = this.getNodeElementFromNode(range.endContainer);\n        var bounds = null;\n        if (startElement !== endElement) {\n            var newStartRange = document.createRange();\n            // eslint-disable-next-line max-len\n            var startRange = this.createRangeForSelection(range.startContainer, range.endContainer, range.startOffset, range.endOffset, newStartRange);\n            bounds = this.normalizeBounds(startRange.getBoundingClientRect(), pageNumber);\n        }\n        else {\n            bounds = this.normalizeBounds(range.getBoundingClientRect(), pageNumber);\n        }\n        return bounds;\n    };\n    TextSelection.prototype.getSelectionRectangleBounds = function (range, pageNumber) {\n        var selectionBounds = [];\n        var startElement = this.getNodeElementFromNode(range.startContainer);\n        var endElement = this.getNodeElementFromNode(range.endContainer);\n        var bounds = null;\n        var selectionTexts = [];\n        this.allTextContent = \"\";\n        if (startElement !== endElement) {\n            var startOffset = 0;\n            var endOffset = 0;\n            var currentId = 0;\n            var anchorPageId = this.pdfViewerBase.textLayer.getPageIndex(range.startContainer);\n            var anchorTextId = this.pdfViewerBase.textLayer.getTextIndex(range.startContainer, anchorPageId);\n            var focusPageId = this.pdfViewerBase.textLayer.getPageIndex(range.endContainer);\n            var focusTextId = this.pdfViewerBase.textLayer.getTextIndex(range.endContainer, focusPageId);\n            var textDivs = this.pdfViewerBase.getElement('_textLayer_' + focusPageId).childNodes;\n            if (pageNumber === anchorPageId) {\n                currentId = anchorTextId;\n            }\n            else {\n                currentId = 0;\n            }\n            for (var j = currentId; j < textDivs.length; j++) {\n                var textElement = textDivs[j];\n                if (j === anchorTextId) {\n                    startOffset = range.startOffset;\n                }\n                else {\n                    startOffset = 0;\n                }\n                if (j === focusTextId) {\n                    endOffset = range.endOffset;\n                }\n                else {\n                    endOffset = textElement.textContent.length;\n                }\n                if (startOffset !== 0 || endOffset !== 0) {\n                    var newRange = document.createRange();\n                    for (var k = 0; k < textElement.childNodes.length; k++) {\n                        var node = textElement.childNodes[k];\n                        newRange.setStart(node, startOffset);\n                        newRange.setEnd(node, endOffset);\n                    }\n                    var boundingRect = void 0;\n                    if (this.pdfViewerBase.clientSideRendering) {\n                        boundingRect = this.normalizeBounds(newRange.getBoundingClientRect(), pageNumber);\n                        var pageDetails = this.pdfViewerBase.pageSize[pageNumber];\n                        var textRotate = 0;\n                        var pageRotation = this.getAngle(pageDetails.rotation);\n                        if (textElement && textElement.style.transform !== '') {\n                            if (textElement.style.transform.startsWith('rotate(90deg)')) {\n                                textRotate = 90;\n                            }\n                            else if (textElement.style.transform.startsWith('rotate(180deg)')) {\n                                textRotate = 180;\n                            }\n                            else if (textElement.style.transform.startsWith('rotate(-90deg)') || textElement.style.transform.startsWith('rotate(270deg)')) {\n                                textRotate = 270;\n                            }\n                            else {\n                                textRotate = 0;\n                            }\n                        }\n                        boundingRect.rotation = textRotate;\n                    }\n                    else {\n                        boundingRect = this.normalizeBounds(newRange.getBoundingClientRect(), pageNumber);\n                    }\n                    selectionBounds.push(boundingRect);\n                    var textselection = newRange.toString();\n                    selectionTexts.push(textselection);\n                    newRange.detach();\n                    if (textselection === '\\r\\n') {\n                        if (j === focusTextId + 1) {\n                            break;\n                        }\n                    }\n                    else if (j === focusTextId) {\n                        break;\n                    }\n                }\n            }\n            for (var i = 0; i < selectionTexts.length; i++) {\n                var text = selectionTexts[i];\n                // While copy and paste for space construct new line\n                if ((i != 0 && text === ' ' && selectionTexts[i - 1].includes('\\r\\n')) || (i != selectionTexts.length - 1 && selectionTexts[i] === ' ' && selectionTexts[i + 1] === '\\r\\n')) {\n                    text = '';\n                }\n                if (text.slice(text.length - 2) !== '\\r\\n' || i === selectionTexts.length - 1) {\n                    this.allTextContent += text;\n                }\n                else {\n                    this.allTextContent += text;\n                }\n            }\n        }\n        else {\n            bounds = this.normalizeBounds(range.getBoundingClientRect(), pageNumber);\n            if (this.pdfViewerBase.clientSideRendering) {\n                var pageDetails = this.pdfViewerBase.pageSize[pageNumber];\n                var textRotate = 0;\n                var pageRotation = this.getAngle(pageDetails.rotation);\n                if (startElement && startElement.style.transform !== '') {\n                    if (startElement.style.transform.startsWith('rotate(90deg)')) {\n                        textRotate = 90;\n                    }\n                    else if (startElement.style.transform.startsWith('rotate(180deg)')) {\n                        textRotate = 180;\n                    }\n                    else if (startElement.style.transform.startsWith('rotate(-90deg)') || startElement.style.transform.startsWith('rotate(270deg)')) {\n                        textRotate = 270;\n                    }\n                    else {\n                        textRotate = 0;\n                    }\n                }\n                bounds.rotation = textRotate;\n            }\n            this.allTextContent = range.toString();\n            selectionBounds.push(bounds);\n        }\n        return selectionBounds;\n    };\n    TextSelection.prototype.getAngle = function (rotation) {\n        var angle = 0;\n        if (rotation) {\n            switch (rotation) {\n                case 0:\n                    angle = 0;\n                    break;\n                case 1:\n                    angle = 90;\n                    break;\n                case 2:\n                    angle = 180;\n                    break;\n                case 3:\n                    angle = 270;\n                    break;\n            }\n        }\n        return angle;\n    };\n    ;\n    TextSelection.prototype.getTextId = function (elementId) {\n        var index = elementId.lastIndexOf('_');\n        var divId = elementId.substring(index + 1, elementId.length);\n        // eslint-disable-next-line radix\n        return parseInt(divId);\n    };\n    TextSelection.prototype.normalizeBounds = function (bound, pageNumber) {\n        var newBounds = null;\n        var currentPageElement = this.pdfViewerBase.getElement('_pageDiv_' + pageNumber);\n        if (this.pdfViewerBase.isMixedSizeDocument) {\n            var currentTextElement = this.pdfViewerBase.getElement('_textLayer_' + pageNumber);\n            if (currentTextElement) {\n                currentPageElement = currentTextElement;\n            }\n        }\n        var currentPageRect = currentPageElement.getBoundingClientRect();\n        newBounds = {\n            bottom: this.getMagnifiedValue(bound.bottom - currentPageRect.top), height: this.getMagnifiedValue(bound.height),\n            left: this.getMagnifiedValue(bound.left - currentPageRect.left), top: this.getMagnifiedValue(bound.top - currentPageRect.top),\n            right: this.getMagnifiedValue(bound.right - currentPageRect.left), width: this.getMagnifiedValue(bound.width)\n        };\n        return newBounds;\n    };\n    TextSelection.prototype.getMagnifiedValue = function (value) {\n        return value / this.pdfViewerBase.getZoomFactor();\n    };\n    /**\n     * @param pageNumber\n     * @private\n     */\n    TextSelection.prototype.getCurrentSelectionBounds = function (pageNumber) {\n        var bound = null;\n        var ranges = this.selectionRangeArray;\n        for (var i = 0; i < ranges.length; i++) {\n            if (ranges[i] !== null) {\n                if (pageNumber === ranges[i].pageNumber) {\n                    bound = ranges[i].bound;\n                }\n            }\n        }\n        return bound;\n    };\n    TextSelection.prototype.createRangeForSelection = function (start, end, startOffset, endOffset, range) {\n        range.setStart(start, startOffset);\n        range.setEnd(end, endOffset);\n        return range;\n    };\n    TextSelection.prototype.maintainSelectionArray = function () {\n        var _this = this;\n        if (this.selectionRangeArray.length !== 0) {\n            var selection = window.getSelection();\n            var isBackward = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n            // eslint-disable-next-line\n            var anchorPage = isNaN(parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1])) ? parseInt(selection.anchorNode.id.split('_pageDiv_')[1]) : parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n            if (isNaN(anchorPage)) {\n                // eslint-disable-next-line radix\n                anchorPage = parseInt(selection.anchorNode.id.split('_text_')[1]);\n            }\n            // eslint-disable-next-line\n            var focusPage_1 = isNaN(parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_pageDiv_')[1]) : parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n            if (isNaN(focusPage_1)) {\n                // eslint-disable-next-line\n                focusPage_1 = isNaN(parseInt(selection.focusNode.id.split('_text_')[1])) ? parseInt(selection.focusNode.id.split('_textLayer_')[1]) : parseInt(selection.focusNode.id.split('_text_')[1]);\n            }\n            var arrayObject = [];\n            if (!isBackward) {\n                arrayObject = this.selectionRangeArray.filter(\n                // eslint-disable-next-line\n                function (obj) {\n                    return (!((_this.selectionStartPage <= obj.pageNumber) && (obj.pageNumber < focusPage_1)));\n                });\n            }\n            else {\n                arrayObject = this.selectionRangeArray.filter(\n                // eslint-disable-next-line\n                function (obj) {\n                    return (!((focusPage_1 < obj.pageNumber) && (obj.pageNumber <= _this.selectionStartPage)));\n                });\n            }\n            if (arrayObject.length > 0) {\n                for (var i = 0; i < arrayObject.length; i++) {\n                    var indexInArray = this.selectionRangeArray.indexOf(arrayObject[i]);\n                    if (indexInArray !== -1) {\n                        this.selectionRangeArray.splice(indexInArray, 1);\n                    }\n                }\n                if (this.selectionRangeArray.length === 1) {\n                    // eslint-disable-next-line max-len\n                    if (this.selectionRangeArray[0].pageNumber === anchorPage || this.selectionRangeArray[0].pageNumber === focusPage_1) {\n                        arrayObject = [];\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.applySpanForSelection = function () {\n        var selection = window.getSelection();\n        // eslint-disable-next-line max-len\n        if (selection.anchorNode === selection.focusNode && selection.anchorOffset === selection.focusOffset && !selection.isCollapsed) {\n            selection.removeAllRanges();\n        }\n        // eslint-disable-next-line max-len\n        if (selection.anchorNode !== null && this.pdfViewerBase.viewerContainer.contains(this.getNodeElementFromNode(selection.anchorNode))) {\n            var isBackWardSelection = this.pdfViewerBase.textLayer.isBackWardSelection(selection);\n            var anchorPageId = void 0;\n            var focusPageId = void 0;\n            var anchorOffsetDiv = void 0;\n            var focusOffsetDiv = void 0;\n            var anchorOffset = void 0;\n            var focusOffset = void 0;\n            if (isBackWardSelection) {\n                // eslint-disable-next-line radix\n                anchorPageId = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1]);\n                // eslint-disable-next-line radix\n                focusPageId = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1]);\n                // eslint-disable-next-line radix\n                anchorOffsetDiv = parseInt(this.getNodeElementFromNode(selection.focusNode).id.split('_text_')[1].split('_')[1]);\n                // eslint-disable-next-line radix\n                focusOffsetDiv = parseInt(this.getNodeElementFromNode(selection.anchorNode).id.split('_text_')[1].split('_')[1]);\n                anchorOffset = selection.focusOffset;\n                focusOffset = selection.anchorOffset;\n            }\n            else {\n                var anchorElement = this.getNodeElementFromNode(selection.anchorNode);\n                var focusElement = this.getNodeElementFromNode(selection.focusNode);\n                // eslint-disable-next-line\n                anchorPageId = (anchorElement.id.indexOf('text_') !== -1) ? parseInt(anchorElement.id.split('text_')[1]) : parseInt(anchorElement.id.split('_textLayer_')[1]);\n                // eslint-disable-next-line\n                focusPageId = (focusElement.id.indexOf('text_') !== -1) ? parseInt(focusElement.id.split('text_')[1]) : parseInt(focusElement.id.split('_textLayer_')[1]);\n                var isFocusChanged = false;\n                if (this.isTouchSelection) {\n                    if (selection.focusNode === this.pdfViewerBase.pageContainer) {\n                        var lastChildNode = this.pdfViewerBase.pageContainer.lastChild;\n                        if (lastChildNode.classList.contains('e-pv-touch-select-drop')) {\n                            var lastPageDiv = lastChildNode.previousSibling.previousSibling;\n                            // eslint-disable-next-line radix\n                            focusPageId = parseInt(lastPageDiv.id.split('_pageDiv_')[1]);\n                            focusElement = this.pdfViewerBase.getElement('_textLayer_' + focusPageId).lastChild;\n                            isFocusChanged = true;\n                        }\n                        else if (lastChildNode.classList.contains('e-pv-page-div')) {\n                            var lastPageDiv = lastChildNode;\n                            // eslint-disable-next-line radix\n                            focusPageId = parseInt(lastPageDiv.id.split('_pageDiv_')[1]);\n                            focusElement = this.pdfViewerBase.getElement('_textLayer_' + focusPageId).lastChild;\n                            isFocusChanged = true;\n                        }\n                    }\n                }\n                if (anchorElement.classList.contains('e-pv-maintaincontent')) {\n                    anchorElement = this.getNodeElementFromNode(anchorElement);\n                    // eslint-disable-next-line radix\n                    anchorPageId = parseInt(anchorElement.id.split('text_')[1]);\n                }\n                if (focusElement.classList.contains('e-pv-maintaincontent')) {\n                    focusElement = this.getNodeElementFromNode(focusElement);\n                    // eslint-disable-next-line radix\n                    focusPageId = parseInt(focusElement.id.split('text_')[1]);\n                }\n                if (anchorPageId === focusPageId) {\n                    if (anchorElement.contains(focusElement)) {\n                        anchorElement = focusElement;\n                    }\n                    if (focusElement.contains(anchorElement)) {\n                        focusElement = anchorElement;\n                    }\n                }\n                // eslint-disable-next-line radix\n                anchorOffsetDiv = (anchorElement.id.split('text_')[1]) ? parseInt(anchorElement.id.split('text_')[1].split('_')[1]) : null;\n                // eslint-disable-next-line radix\n                focusOffsetDiv = (focusElement.id.split('text_')[1]) ? parseInt(focusElement.id.split('text_')[1].split('_')[1]) : null;\n                anchorOffsetDiv = isNaN(anchorOffsetDiv) ? focusOffsetDiv : anchorOffsetDiv;\n                focusOffsetDiv = isNaN(focusOffsetDiv) ? anchorOffsetDiv : focusOffsetDiv;\n                anchorOffset = selection.anchorOffset;\n                focusOffset = !isFocusChanged ? selection.focusOffset : focusElement.textContent.length;\n            }\n            if (this.pdfViewerBase.checkIsNormalText()) {\n                selection.removeAllRanges();\n                this.pdfViewerBase.textLayer.clearDivSelection();\n                // eslint-disable-next-line max-len\n                this.pdfViewerBase.textLayer.applySpanForSelection(anchorPageId, focusPageId, anchorOffsetDiv, focusOffsetDiv, anchorOffset, focusOffset);\n            }\n            if (this.pdfViewer.textSearchModule) {\n                this.pdfViewer.textSearchModule.searchAfterSelection();\n            }\n        }\n    };\n    /**\n     * @param event\n     * @param x\n     * @param y\n     * @private\n     */\n    TextSelection.prototype.initiateTouchSelection = function (event, x, y) {\n        if (this.pdfViewerBase.isShapeBasedAnnotationsEnabled()) {\n            if (this.pdfViewer.selectedItems.annotations.length > 0) {\n                this.pdfViewer.clearSelection(this.pdfViewer.selectedItems.annotations[0].pageIndex);\n            }\n        }\n        // eslint-disable-next-line\n        var element = event.target;\n        var belowElements = document.elementsFromPoint(event.touches[0].clientX, event.touches[0].clientY);\n        if (belowElements.length !== 0) {\n            if (belowElements[0].classList.contains('e-pv-hyperlink') && belowElements[1].classList.contains('e-pv-text')) {\n                element = belowElements[1];\n            }\n        }\n        var pageNumber = parseFloat(element.id.split('_')[2]);\n        this.pdfViewer.fireTextSelectionStart(pageNumber + 1);\n        this.selectAWord(element, x, y, true);\n        this.createTouchSelectElement(event);\n        this.maintainSelectionOnZoom(true, false);\n        this.fireTextSelectEnd();\n        this.applySpanForSelection();\n    };\n    // eslint-disable-next-line\n    TextSelection.prototype.selectTextByTouch = function (element, x, y, isForwardSelection, target, isCloserMovement) {\n        var isTextSelected = false;\n        if (element.nodeType === element.TEXT_NODE) {\n            var rangeObject = element.ownerDocument.createRange();\n            var selection = window.getSelection();\n            rangeObject.selectNodeContents(element);\n            var currentPosition = 0;\n            var endPosition = rangeObject.endOffset;\n            while (currentPosition < endPosition) {\n                rangeObject.setStart(element, currentPosition);\n                rangeObject.setEnd(element, currentPosition + 1);\n                var rangeBounds = rangeObject.getBoundingClientRect();\n                if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n                    if (selection.anchorNode != null) {\n                        if (isForwardSelection) {\n                            rangeObject.setStart(selection.anchorNode, selection.anchorOffset);\n                        }\n                        // eslint-disable-next-line max-len\n                        rangeObject = this.setTouchSelectionStartPosition(selection, rangeObject, isForwardSelection, target, element, currentPosition, isCloserMovement);\n                        if (isForwardSelection) {\n                            selection.extend(element, currentPosition);\n                        }\n                        isTextSelected = true;\n                    }\n                    rangeObject.detach();\n                    return isTextSelected;\n                }\n                currentPosition += 1;\n            }\n        }\n        else {\n            for (var i = 0; i < element.childNodes.length; i++) {\n                var range = element.childNodes[i].ownerDocument.createRange();\n                range.selectNodeContents(element.childNodes[i]);\n                var rangeBounds = range.getBoundingClientRect();\n                if (rangeBounds.left <= x && rangeBounds.right >= x && rangeBounds.top <= y && rangeBounds.bottom >= y) {\n                    range.detach();\n                    return (this.selectTextByTouch(element.childNodes[i], x, y, isForwardSelection, target, isCloserMovement));\n                }\n                else {\n                    range.detach();\n                }\n            }\n        }\n        return isTextSelected;\n    };\n    // eslint-disable-next-line\n    TextSelection.prototype.setTouchSelectionStartPosition = function (selection, range, isForwardSelection, target, element, currentPosition, isCloserMovement) {\n        if (isForwardSelection) {\n            if (target === 'left') {\n                // eslint-disable-next-line\n                var startNode = this.getTouchFocusElement(selection, true);\n                range.setStart(startNode.focusNode, startNode.focusOffset);\n                range.setEnd(element, currentPosition);\n                this.selectionAnchorTouch = { anchorNode: range.endContainer.parentElement.id, anchorOffset: range.endOffset };\n            }\n            else if (target === 'right') {\n                // eslint-disable-next-line\n                var startNode = this.getTouchAnchorElement(selection, false);\n                range.setStart(startNode.anchorNode, startNode.anchorOffset);\n                range.setEnd(element, currentPosition);\n                this.selectionFocusTouch = { focusNode: range.endContainer.parentElement.id, focusOffset: range.endOffset };\n            }\n        }\n        else {\n            if (target === 'left') {\n                if (!isCloserMovement) {\n                    // eslint-disable-next-line\n                    var startNode = this.getTouchFocusElement(selection, false);\n                    range.setStart(element, currentPosition);\n                    // eslint-disable-next-line radix\n                    range.setEnd(startNode.focusNode, startNode.focusOffset);\n                    if (range.toString() === '') {\n                        range.setStart(element, currentPosition);\n                        range.setEnd(selection.focusNode, selection.focusOffset);\n                    }\n                    this.selectionAnchorTouch = { anchorNode: range.startContainer.parentElement.id, anchorOffset: range.startOffset };\n                }\n                else {\n                    range.setStart(element, currentPosition);\n                    range.setEnd(selection.focusNode, selection.focusOffset);\n                    this.selectionAnchorTouch = { anchorNode: range.startContainer.parentElement.id, anchorOffset: range.startOffset };\n                }\n            }\n            else if (target === 'right') {\n                // eslint-disable-next-line\n                var startNode = this.getTouchAnchorElement(selection, true);\n                range.setStart(element, currentPosition);\n                range.setEnd(startNode.anchorNode, startNode.anchorOffset);\n                if (range.toString() === '') {\n                    range.setStart(startNode.anchorNode, startNode.anchorOffset);\n                    range.setEnd(element, currentPosition);\n                }\n                this.selectionFocusTouch = { focusNode: range.startContainer.parentElement.id, focusOffset: range.startOffset };\n            }\n        }\n        selection.removeAllRanges();\n        selection.addRange(range);\n        return range;\n    };\n    TextSelection.prototype.getTouchAnchorElement = function (selection, isCurrentFocus) {\n        var element = document.getElementById(this.selectionAnchorTouch.anchorNode.toString());\n        var startNode = null;\n        var offset = 0;\n        if (element) {\n            startNode = element.childNodes[0];\n            // eslint-disable-next-line radix\n            offset = parseInt(this.selectionAnchorTouch.anchorOffset.toString());\n        }\n        else {\n            if (isCurrentFocus) {\n                startNode = selection.focusNode;\n                offset = selection.focusOffset;\n            }\n            else {\n                startNode = selection.anchorNode;\n                offset = selection.anchorOffset;\n            }\n        }\n        return { anchorNode: startNode, anchorOffset: offset };\n    };\n    TextSelection.prototype.getTouchFocusElement = function (selection, isCurrentAnchor) {\n        var element = document.getElementById(this.selectionFocusTouch.focusNode.toString());\n        var startNode = null;\n        var offset = 0;\n        if (element) {\n            startNode = element.childNodes[0];\n            // eslint-disable-next-line radix\n            offset = parseInt(this.selectionFocusTouch.focusOffset.toString());\n        }\n        else {\n            if (isCurrentAnchor) {\n                startNode = selection.anchorNode;\n                offset = selection.anchorOffset;\n            }\n            else {\n                startNode = selection.focusNode;\n                offset = selection.focusOffset;\n            }\n        }\n        return { focusNode: startNode, focusOffset: offset };\n    };\n    TextSelection.prototype.createTouchSelectElement = function (event) {\n        var topMargin = 10;\n        this.isTouchSelection = true;\n        var selection = window.getSelection();\n        if (selection.type === 'Range') {\n            // eslint-disable-next-line max-len\n            this.dropDivElementLeft = createElement('div', { id: this.pdfViewer.element.id + '_touchSelect_droplet_left', className: 'e-pv-touch-select-drop' });\n            // eslint-disable-next-line max-len\n            this.dropDivElementRight = createElement('div', { id: this.pdfViewer.element.id + '_touchSelect_droplet_right', className: 'e-pv-touch-select-drop' });\n            this.dropElementLeft = createElement('div', { className: 'e-pv-touch-ellipse' });\n            this.dropElementLeft.style.transform = 'rotate(0deg)';\n            this.dropDivElementLeft.appendChild(this.dropElementLeft);\n            this.dropElementRight = createElement('div', { className: 'e-pv-touch-ellipse' });\n            this.dropElementRight.style.transform = 'rotate(-90deg)';\n            this.dropElementRight.style.margin = '0 9px 0 0';\n            this.dropDivElementRight.appendChild(this.dropElementRight);\n            this.pdfViewerBase.pageContainer.appendChild(this.dropDivElementLeft);\n            this.pdfViewerBase.pageContainer.appendChild(this.dropDivElementRight);\n            var range = selection.getRangeAt(0);\n            var rangePosition = range.getBoundingClientRect();\n            var dropElementRect = this.dropDivElementLeft.getBoundingClientRect();\n            // eslint-disable-next-line max-len\n            var pageTopValue = this.pdfViewerBase.pageSize[this.pdfViewerBase.currentPageNumber - 1].top;\n            var viewerLeftPosition = this.pdfViewerBase.viewerContainer.getBoundingClientRect().left;\n            var topClientValue = this.getClientValueTop(rangePosition.top, this.pdfViewerBase.currentPageNumber - 1);\n            // eslint-disable-next-line max-len\n            var topPositionValue = topClientValue + pageTopValue * this.pdfViewerBase.getZoomFactor() + (dropElementRect.height / 2) * this.pdfViewerBase.getZoomFactor() + 'px';\n            this.dropDivElementLeft.style.top = topPositionValue;\n            this.dropDivElementLeft.style.left = rangePosition.left - (viewerLeftPosition + (dropElementRect.width)) + 'px';\n            this.dropDivElementRight.style.top = topPositionValue;\n            // eslint-disable-next-line max-len\n            this.dropDivElementRight.style.left = rangePosition.left + rangePosition.width - viewerLeftPosition + 'px';\n            var currentPageLeft = this.pdfViewerBase.getElement('_pageDiv_' + (this.pdfViewerBase.currentPageNumber - 1)).getBoundingClientRect().left;\n            var currentRangeLeft = rangePosition.left - currentPageLeft;\n            // eslint-disable-next-line max-len\n            this.topStoreLeft = { pageTop: pageTopValue, topClientValue: this.getMagnifiedValue(topClientValue), pageNumber: this.pdfViewerBase.currentPageNumber - 1, left: this.getMagnifiedValue(currentRangeLeft), isHeightNeeded: true };\n            // eslint-disable-next-line max-len\n            this.topStoreRight = { pageTop: pageTopValue, topClientValue: this.getMagnifiedValue(topClientValue), pageNumber: this.pdfViewerBase.currentPageNumber - 1, left: this.getMagnifiedValue(currentRangeLeft + rangePosition.width), isHeightNeeded: true };\n            this.dropDivElementLeft.addEventListener('touchstart', this.onLeftTouchSelectElementTouchStart);\n            this.dropDivElementLeft.addEventListener('touchmove', this.onLeftTouchSelectElementTouchMove);\n            this.dropDivElementLeft.addEventListener('touchend', this.onLeftTouchSelectElementTouchEnd);\n            this.dropDivElementRight.addEventListener('touchstart', this.onRightTouchSelectElementTouchStart);\n            this.dropDivElementRight.addEventListener('touchmove', this.onRightTouchSelectElementTouchMove);\n            this.dropDivElementRight.addEventListener('touchend', this.onRightTouchSelectElementTouchEnd);\n            // eslint-disable-next-line max-len\n            this.calculateContextMenuPosition((event.touches[0].clientY + this.dropDivElementLeft.clientHeight + topMargin), (parseInt(this.dropDivElementLeft.style.left, 10) - topMargin));\n        }\n    };\n    /**\n     * @param top\n     * @param left\n     * @private\n     */\n    // eslint-disable-next-line\n    TextSelection.prototype.calculateContextMenuPosition = function (top, left) {\n        var _this = this;\n        var topMargin = 10;\n        if (Browser.isDevice && !this.pdfViewer.enableDesktopMode) {\n            // eslint-disable-next-line\n            var contextTop = top - this.contextMenuHeight;\n            if (contextTop < this.pdfViewerBase.toolbarHeight) {\n                top = top + this.contextMenuHeight;\n            }\n            else {\n                top = contextTop;\n            }\n            if ((top + this.contextMenuHeight) > window.innerHeight) {\n                top = top - this.contextMenuHeight;\n            }\n        }\n        if (this.pdfViewer.contextMenuSettings.contextMenuAction === 'MouseUp') {\n            left = left - 50;\n        }\n        var proxy = this;\n        setTimeout(function () {\n            var leftValue = 35;\n            var selectedContent = document.getElementsByClassName(\"e-pv-maintaincontent\")[0] ? document.getElementsByClassName(\"e-pv-maintaincontent\")[0].getBoundingClientRect() : null;\n            if (selectedContent) {\n                if ((selectedContent.bottom + proxy.contextMenuHeight + proxy.pdfViewerBase.toolbarHeight) > window.innerHeight) {\n                    top = selectedContent.top - (proxy.contextMenuHeight + proxy.pdfViewerBase.toolbarHeight - topMargin);\n                }\n                else {\n                    top = selectedContent.bottom + proxy.pdfViewerBase.toolbarHeight - topMargin;\n                }\n                left = selectedContent.left - leftValue;\n                var toolbarModule = _this.pdfViewer.toolbarModule ? _this.pdfViewer.toolbarModule.annotationToolbarModule : 'null';\n                if (!toolbarModule || !toolbarModule.textMarkupToolbarElement || toolbarModule.textMarkupToolbarElement.children.length === 0) {\n                    // eslint-disable-next-line max-len\n                    proxy.pdfViewerBase.contextMenuModule.open(top, left, proxy.pdfViewerBase.viewerContainer);\n                }\n            }\n        });\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.initiateSelectionByTouch = function () {\n        this.pdfViewerBase.textLayer.clearDivSelection();\n        this.pdfViewerBase.contextMenuModule.close();\n        var lowerPageIndex = this.pdfViewerBase.currentPageNumber - 3;\n        lowerPageIndex = (lowerPageIndex < 0) ? 0 : lowerPageIndex;\n        var higherPageIndex = this.pdfViewer.currentPageNumber + 1;\n        // eslint-disable-next-line max-len\n        higherPageIndex = (higherPageIndex < (this.pdfViewerBase.pageCount - 1)) ? higherPageIndex : (this.pdfViewerBase.pageCount - 1);\n        for (var i = lowerPageIndex; i <= higherPageIndex; i++) {\n            var textLayer = this.pdfViewerBase.getElement('_textLayer_' + i);\n            if (textLayer) {\n                if (textLayer.childNodes !== null) {\n                    this.applySelectionMouseScroll(i);\n                }\n            }\n        }\n        if (this.selectionRangeArray.length > 0) {\n            this.pdfViewer.fireTextSelectionStart(this.selectionRangeArray[0].pageNumber + 1);\n        }\n    };\n    // eslint-disable-next-line\n    TextSelection.prototype.terminateSelectionByTouch = function (event) {\n        var topMargin = 10;\n        this.maintainSelectionOnZoom(true, false);\n        this.applySpanForSelection();\n        if (this.pdfViewerBase.getTextMarkupAnnotationMode()) {\n            // eslint-disable-next-line max-len\n            this.pdfViewer.annotationModule.textMarkupAnnotationModule.drawTextMarkupAnnotations(this.pdfViewer.annotationModule.textMarkupAnnotationModule.currentTextMarkupAddMode);\n        }\n        else {\n            this.fireTextSelectEnd();\n            var top_4 = event.changedTouches[0].clientY + event.currentTarget.clientHeight;\n            var spanBounds = this.getSpanBounds();\n            if ((spanBounds.bottom + this.contextMenuHeight + this.pdfViewerBase.toolbarHeight) > window.innerHeight) {\n                top_4 = spanBounds.top - (this.contextMenuHeight + this.pdfViewerBase.toolbarHeight);\n            }\n            else {\n                top_4 = spanBounds.bottom + this.pdfViewerBase.toolbarHeight - topMargin;\n            }\n            this.pdfViewerBase.contextMenuModule.open(top_4, (spanBounds.right - spanBounds.left) / 2, this.pdfViewerBase.viewerContainer);\n        }\n    };\n    TextSelection.prototype.getSpanBounds = function () {\n        var spanWidth = [];\n        var spanRight = [];\n        var spanLeft = [];\n        var spanHeight = 0;\n        var selectedContent = document.getElementsByClassName(\"e-pv-maintaincontent\");\n        if (selectedContent.length > 0) {\n            for (var i = 0; i < selectedContent.length; i++) {\n                var spanElement = selectedContent[i].getBoundingClientRect();\n                spanHeight = spanHeight + spanElement.height;\n                spanWidth.push(spanElement.width);\n                spanRight.push(spanElement.right);\n                spanLeft.push(spanElement.left);\n            }\n            // eslint-disable-next-line max-len\n            return { top: selectedContent[0].getBoundingClientRect().top, bottom: selectedContent[selectedContent.length - 1].getBoundingClientRect().bottom, left: Math.min.apply(null, spanLeft), right: Math.max.apply(null, spanRight), width: Math.max.apply(null, spanWidth), height: spanHeight };\n        }\n    };\n    TextSelection.prototype.getNodeElement = function (range, touchX, touchY, event, nodeElement) {\n        if (document.caretRangeFromPoint) {\n            range = document.caretRangeFromPoint(touchX, touchY);\n            nodeElement = this.onTouchElementScroll(range, nodeElement, touchY, event);\n            // eslint-disable-next-line\n        }\n        else if (document.caretPositionFromPoint) {\n            // eslint-disable-next-line\n            var start = document.caretPositionFromPoint(touchX, touchY);\n            // eslint-disable-next-line\n            var end = document.caretPositionFromPoint(touchX, touchY);\n            range = document.createRange();\n            range.setStart(start.offsetNode, start.offset);\n            range.setEnd(end.offsetNode, end.offset);\n            nodeElement = this.onTouchElementScroll(range, nodeElement, touchY, event);\n        }\n        return nodeElement;\n    };\n    TextSelection.prototype.isTouchedWithinContainer = function (event) {\n        var elements = document.elementsFromPoint(event.touches[0].clientX, event.touches[0].clientY);\n        var isTouchedWithinContainer = false;\n        if (elements.length !== 0) {\n            isTouchedWithinContainer = true;\n        }\n        return isTouchedWithinContainer;\n    };\n    TextSelection.prototype.onTouchElementScroll = function (range, nodeElement, touchY, event) {\n        var viewerScrollTop = this.pdfViewerBase.viewerContainer.scrollTop;\n        if (range != null) {\n            nodeElement = range.startContainer;\n            var isScrollBar = this.isScrolledOnScrollBar(event);\n            if (!this.pdfViewerBase.viewerContainer.contains(nodeElement.parentElement) || isScrollBar) {\n                if (touchY < this.pdfViewerBase.viewerContainer.clientHeight) {\n                    this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop - 30;\n                }\n                else {\n                    this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop + 30;\n                }\n            }\n        }\n        else {\n            if (touchY < this.pdfViewerBase.viewerContainer.clientHeight) {\n                this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop - 30;\n            }\n            else {\n                this.pdfViewerBase.viewerContainer.scrollTop = viewerScrollTop + 30;\n            }\n        }\n        return nodeElement;\n    };\n    TextSelection.prototype.isCloserTouchScroll = function (currentDifference) {\n        var isForwardMovement = false;\n        if (this.previousScrollDifference > currentDifference) {\n            isForwardMovement = true;\n        }\n        return isForwardMovement;\n    };\n    TextSelection.prototype.getClientValueTop = function (clientValue, pageNumber) {\n        if (this.pdfViewerBase.getElement('_pageDiv_' + pageNumber)) {\n            // eslint-disable-next-line max-len\n            return clientValue - this.pdfViewerBase.getElement('_pageDiv_' + pageNumber).getBoundingClientRect().top;\n        }\n        else {\n            return clientValue;\n        }\n    };\n    TextSelection.prototype.isScrolledOnScrollBar = function (event) {\n        var isScrollBar = false;\n        // eslint-disable-next-line max-len\n        if (event.touches && (this.pdfViewerBase.viewerContainer.clientHeight + this.pdfViewerBase.viewerContainer.offsetTop) < event.touches[0].clientY && event.touches[0].clientY < (this.pdfViewerBase.viewerContainer.offsetHeight + this.pdfViewerBase.viewerContainer.offsetTop)) {\n            isScrollBar = true;\n        }\n        return isScrollBar;\n    };\n    TextSelection.prototype.getTextLastLength = function (element) {\n        if (element) {\n            return element.textContent.length;\n        }\n        else {\n            return 0;\n        }\n    };\n    TextSelection.prototype.getNodeElementFromNode = function (node) {\n        if (node.parentElement) {\n            return node.parentElement;\n        }\n        else {\n            return node.parentNode;\n        }\n    };\n    /**\n     * Copy the selected text in the PDF Document.\n     *\n     * @returns void\n     */\n    TextSelection.prototype.copyText = function () {\n        var selectionText = '';\n        this.maintainSelectionOnZoom(true, false);\n        if (this.selectionRangeArray.length > 0) {\n            for (var i = 0; i < this.selectionRangeArray.length; i++) {\n                selectionText += this.selectionRangeArray[i].textContent;\n            }\n        }\n        if (selectionText.length > 0) {\n            if (this.pdfViewer.annotation) {\n                this.pdfViewer.annotation.isShapeCopied = false;\n            }\n            var textArea = document.createElement('textarea');\n            textArea.contentEditable = 'true';\n            textArea.textContent = selectionText;\n            // eslint-disable-next-line max-len\n            if (this.pdfViewer.annotation && this.pdfViewer.annotation.freeTextAnnotationModule) {\n                this.pdfViewer.annotation.freeTextAnnotationModule.selectedText = selectionText;\n            }\n            textArea.style.position = 'fixed';\n            document.body.appendChild(textArea);\n            textArea.select();\n            try {\n                document.execCommand('copy');\n            }\n            catch (ex) {\n                console.warn('Copy to clipboard failed.', ex);\n            }\n            finally {\n                if (textArea) {\n                    document.body.removeChild(textArea);\n                }\n            }\n        }\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.destroy = function () {\n        this.clear();\n    };\n    /**\n     * @private\n     */\n    TextSelection.prototype.getModuleName = function () {\n        return 'TextSelection';\n    };\n    return TextSelection;\n}());\nexport { TextSelection };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}